------------------------------------------------------------------------
r491786 | kahatlen | 2007-01-02 04:47:47 -0800 (Tue, 02 Jan 2007) | 9 lines

DERBY-2200: Add performance tests to Derby using the junit perf framework

This patch (derby2200.p1.diff.txt) adds
-- few simple performance tests using the junit perf framework.
-- small addition to the reporting in JDBCPerfTestCase to indicate the
   framework the test is running in.

Patch contributed by Sunitha Kambhampati.

------------------------------------------------------------------------
r491769 | kahatlen | 2007-01-02 02:16:53 -0800 (Tue, 02 Jan 2007) | 2 lines

DERBY-2149: Replace Vectors and Hashtables with ArrayLists and HashMaps in RAMTransaction

------------------------------------------------------------------------
r491768 | kahatlen | 2007-01-02 02:13:27 -0800 (Tue, 02 Jan 2007) | 4 lines

DERBY-2100: Convert derbynet/prepStmt.java to JUnit

Patch contributed by ?\195?\152ystein Gr?\195?\184vlen.

------------------------------------------------------------------------
r491632 | bpendleton | 2007-01-01 13:10:20 -0800 (Mon, 01 Jan 2007) | 12 lines

DERBY-2202: DROP PROCEDURE depends on SET SCHEMA

This patch was contributed by Yip Ng (yipng168@gmail.com)

The symptom of this jira is the same as those described in DERBY-1304
for DROP VIEW except that it applies to DROP PROCEDURE, DROP FUNCTION
and DROP SYNONYM statements. (Their bind logic are centralized in
DropAliasNode.) The DropAliasNode's bindStatement() should have created
a dependency on the statement, so when its associated alias descriptor
gets dropped, the statement can be invalidated accordingly. This explains
why subsequent DROP PROCEDURE statement fails.

------------------------------------------------------------------------
r489603 | kahatlen | 2006-12-22 02:25:22 -0800 (Fri, 22 Dec 2006) | 2 lines

DERBY-2199: Use initCause() in BaseJDBCTestCase.assertSQLState().

------------------------------------------------------------------------
r489597 | kahatlen | 2006-12-22 02:10:10 -0800 (Fri, 22 Dec 2006) | 5 lines

DERBY-2152: Support diagnostic vti tables that take parameters, such
as SpaceTable

Fix test failures in jdk6. Patch contributed by A B (qozinx@gmail.com).

------------------------------------------------------------------------
r489053 | kahatlen | 2006-12-20 03:28:07 -0800 (Wed, 20 Dec 2006) | 3 lines

DERBY-2191: Cleanup of FormatableBitSet
Removal of dead code. Patch contributed by Dyre Tjeldvoll.

------------------------------------------------------------------------
r488834 | abrown | 2006-12-19 14:29:22 -0800 (Tue, 19 Dec 2006) | 3 lines

Remove unnecessary imports from NewInvocationNode.java that were added as
part of svn #488827. 

------------------------------------------------------------------------
r488827 | abrown | 2006-12-19 14:10:56 -0800 (Tue, 19 Dec 2006) | 21 lines

DERBY-2152: Support diagnostic "table functions" for querying Derby diagnostic
VTIs that take parameters.  The table functions are exposed via the TABLE
constructor syntax:

  SELECT <rcList> from
    TABLE ( <sysdiag-schema>.<vti-table-name> (<arg-list>) )
    [ AS ] corrlationName

 Note that:

  a. We only support VTI table function names that are in the SYSCS_DIAG schema
  b. The correlation name *is* required, though use of the "AS" keyword
     is optional (section 7.6 of the SQL 2003 spec, "<table primary>").
  c. The argument list can be empty if the underlying VTI supports it.

The VTI table names that have been added are as follows:

  SYSCS_DIAG.SPACE_TABLE maps to org.apache.derby.diag.SpaceTable
  SYSCS_DIAG.ERROR_LOG_READER maps to org.apache.derby.diag.ErrorLogReader
  SYSCS_DIAG.STATEMENT_DURATION maps to org.apache.derby.diag.StatementDuration

------------------------------------------------------------------------
r488803 | rhillegas | 2006-12-19 12:45:20 -0800 (Tue, 19 Dec 2006) | 1 line

DERBY-2129: Record release of 10.2.2.0 in the STATUS file.
------------------------------------------------------------------------
r488672 | bernt | 2006-12-19 05:35:14 -0800 (Tue, 19 Dec 2006) | 1 line

DERBY-2147 Enable code that allows pattern and escape in LIKE predicate to be column references
------------------------------------------------------------------------
r487788 | tmnk | 2006-12-16 03:16:04 -0800 (Sat, 16 Dec 2006) | 1 line

- DERBY-1471 Implement layer B streaming for new methods defined in JDBC4.0 - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r487742 | djd | 2006-12-15 16:54:35 -0800 (Fri, 15 Dec 2006) | 2 lines

DERBY-2164 Add some comments to EngineType class and clean up its use.

------------------------------------------------------------------------
r487656 | bpendleton | 2006-12-15 12:44:53 -0800 (Fri, 15 Dec 2006) | 1 line

Correct typo in checkForAutoIncrement javadoc
------------------------------------------------------------------------
r487655 | djd | 2006-12-15 12:37:52 -0800 (Fri, 15 Dec 2006) | 3 lines

DERBY-2179 Temp fix to the test to avoid installing a thread context class loader and
losing the previously installed one. Can be omitted beacuse the actual portion of
the test fixture that uses the class loader is blocked by DERBY-2162.
------------------------------------------------------------------------
r487414 | bpendleton | 2006-12-14 17:01:14 -0800 (Thu, 14 Dec 2006) | 55 lines

DERBY-1644: NPE when inserting values to tbl w/ identity col gen by default

When the VALUES clause encounters multiple rows, it generates a UNION
node tree to combine the rows to be inserted. InsertNode notices the
top-level UNION node and calls the special checkAutoincrementUnion()
method which knows how to recursively traverse the Union tree and
call checkAutoIncrement() on the underlying RowResultSetNode instances
at the leaf level of the tree.

HOWEVER, when the number of columns in the rows in the VALUES clause
is a subset of the number of columns in the table we're inserting into,
the top node of the tree is not a UnionNode, but is rather a
ProjectRestrictNode. This means that we skip past the UnionNode test and
just call checkAutoincrement(), which processes the PRN but doesn't
go down to the RowResultSetNode(s) at the leaf level.

This leaves the ResultColumn instance at the leaf level with a NULL column
descriptor, which causes the NPE during the code generation phase.

And, there is a second, related problem. The enhanceRCLForInsert() call
is also only made at the top level of the tree. However, this call is a
necessary pre-condition for calling checkAutoincrement() because
enhanceRCLForInsert() ensures that the proper ResultColumnList values are
in place prior to the checkAutoincrement() reconciliation of the column lists.

The patch solves these problems by merging the code from InsertNode.bind
together with the current recursive processing in
ResultColumnList.checkAutoincrementUnion() to produce a new recursive
routine, which I have called enhanceAndCheckForAutoincrement(), which will
recursively traverse the ResultSet tree, calling *both* enhanceRCLForInsert()
and checkAutoincrement() on the various nodes in the tree.

Thus the primary ideas involved in this patch are:
 - When an INSERT statement will insert multiple rows from the VALUES
   clause, the compiler will compile the various values into a tree of
   UnionNodes with RowResultSetNodes at the leaves of the three
 - The columns specified in the INSERT statement may be a subset
   of the rows in the table. The "extra" columns need to be constructed by
   the INSERT statement, either by generating NULL values for those
   columns which are nullable, or by compiling a default values for those
   columns which have DEFAULT values, or by generating a value for an IDENTITY
   column which is GENERATED. The work of constructing these extra
   column values is done by genNewRCForInsert.
 - For columns which are GENERATED ALWAYS, we must make sure that
   the INSERT statement doesn't allow the user to insert their own value for
   the generated column.
 - The columns which are specified in the INSERT column spec may not match
   the order in which the columns arise in the table. Therefore, the column
   values may need to be re-ordered by the INSERT statement so that they
   occur in the proper order.
 - In the case when the ResultSet which provides the values for the INSERT
   statement is not just a single node, but is rather a tree of UnionNodes, the
   above processing needs to happen throughout the tree, not just at
   the root node. 

------------------------------------------------------------------------
r487314 | mamta | 2006-12-14 11:25:44 -0800 (Thu, 14 Dec 2006) | 10 lines

EmbedCallableStatement.executeStatement stuffs the output parameter value into
ParameterValueSet object. But ParameterValueSet object which is fetched at the
beginning of the method might not be the valid object if a new activation object
got created for the Statement because it was invalid. I am making changes such
that a fetch of ParameterValueSet object into a local variable is done after
the possiblity of new Activation object has been accounted for. I have also put
javadoc comments for the users of ParameterValueSet object which is returned
by EmbedPreparedStatement.getParms method.


------------------------------------------------------------------------
r487307 | djd | 2006-12-14 11:10:45 -0800 (Thu, 14 Dec 2006) | 3 lines

DERBY-2138 Remove the DataDictionaryContext and instead use the fact there is a single DataDictionary per database.
Cleanup DependableFinder to take a passed in reference to a data dictionary rather than trying to find the data
dictionary from the context.
------------------------------------------------------------------------
r486321 | myrnavl | 2006-12-12 13:22:50 -0800 (Tue, 12 Dec 2006) | 2 lines

DERBY-2143 - 1 more master/canon update

------------------------------------------------------------------------
r486240 | djd | 2006-12-12 09:09:19 -0800 (Tue, 12 Dec 2006) | 2 lines

DERBY-2138 (partial) Cleanup DependableFinder and associated classes by removing an unused method
and adding comments to related classes.
------------------------------------------------------------------------
r486201 | djd | 2006-12-12 07:59:52 -0800 (Tue, 12 Dec 2006) | 5 lines

DERBY-2040 (partial) Change the api for jarReader to return the StorageFile rather
than the (potentially) opened jar. Removes the possibility for user code to
access the jar by calling methods of JarReader directly (and hence abusing any
privileged blocks that would be required while opening the jar). Cleans up JarLoader
by having explict calls to open the stream or file within the class loader.
------------------------------------------------------------------------
r484841 | djd | 2006-12-08 15:23:46 -0800 (Fri, 08 Dec 2006) | 4 lines

DERBY-2138 (partial) Move the booting of the DataDictionary to BasicDatabase from LanguageConnectionFactory
wihc makes more sense once there is a single dictionary per database. Change some calls to obtain a reference
to the DataDictionary from Database instead of looking for the pushed DataDictionaryContext.
DataDictionaryContext context is still pushed, this is an incremental step to removing it.
------------------------------------------------------------------------
r484797 | suresht | 2006-12-08 13:42:14 -0800 (Fri, 08 Dec 2006) | 24 lines

DERBY-606 : SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE fails on (very) large tables

Patch Contributed by Mayuresh Nirhali.

Problem was when Allocated Extent associated with last allocated page is being
compressed, All the pages are found to be free, thus new_highest_page is set to
'-1'. Now, when the CompressSpaceOperation is being logged
CompressedNumber.writeInt method is called with value -1. This method is
written to throw exception if the value is less than Zero, hence the 
IOException occurs. 

This patch addresses the problem  by modifying compress 
log record to write the new Highest Page as an uncompressed number, 
if the database is created/hard-upgrade to 10.3. A new Compress Log 
Record Class is created that will read/write new_highest_page in compressed 
format as before 10.3. Old version of compress log Operation is used on 
recovery, if  the log record needs to be replayed on upgrade 
from old-version of the database and also on soft-upgrade to 10.3. 

Test cases for this bug are  added to the existing OnlineCompressTest.java
test and to the upgrade test .



------------------------------------------------------------------------
r484722 | djd | 2006-12-08 12:02:24 -0800 (Fri, 08 Dec 2006) | 4 lines

DERBY-538 DERBY-2040 Remove the FileResource.getAsStream method as the getAsFile()
method now returns a StorageFile and that class has a getInputStream method.
Incremental step in pushing the JarClassLoader to work off URLs for the jar files
and thus allow use of the standard java.net.URLClassLoader.
------------------------------------------------------------------------
r484672 | djd | 2006-12-08 09:51:55 -0800 (Fri, 08 Dec 2006) | 2 lines

DERBY-2083 Fix broken backup/restore tests. Caused by not updating path through code
when a service is directly accessed as a file rather than through the StorageFactory api.
------------------------------------------------------------------------
r484671 | myrnavl | 2006-12-08 09:48:02 -0800 (Fri, 08 Dec 2006) | 10 lines

DERBY-2143 - patch DERBY_2143_2110_trunk.diff2; 
  - adjusting the translated messages for changes of DERBY_2110
  - adjusting the translated messages for some removed messages that are
    still present in 10.2 (XJ089, XJ092, 01J03, 01J09, 01J11)
  - modifying message XJ125 to only mention TYPE_SCROLL_INSENSITIVE in all
    languages except ja_JP, zh_CN, zh_TW (don't know those characters enough
    to tell what to remove)
  - reformat DBLOOK_usage message to not wrap in 80 characters


------------------------------------------------------------------------
r484615 | bernt | 2006-12-08 06:14:39 -0800 (Fri, 08 Dec 2006) | 1 line

DERBY-1856 Added Session.SECACC and Session.CHKSEC to the switch in DRDAConnThread.run()
------------------------------------------------------------------------
r483822 | djd | 2006-12-07 20:28:06 -0800 (Thu, 07 Dec 2006) | 4 lines

DERBY-2164 (partial) Remove AccessFactory (store) from LanguageConnectionFactory and
instead code can find the AccessFactory from the Transaction object.
The AccessFactory getAccessManager() method already existed but was not exposed
at the highest level.
------------------------------------------------------------------------
r483820 | myrnavl | 2006-12-07 20:22:32 -0800 (Thu, 07 Dec 2006) | 3 lines

DERBY-2143 - adding quote that broke the build


------------------------------------------------------------------------
r483767 | djd | 2006-12-07 17:26:19 -0800 (Thu, 07 Dec 2006) | 2 lines

DERBY-2138 (partial) Couple of additional import cleanups for classes that imported
DataDictionaryContext without using it.
------------------------------------------------------------------------
r483766 | djd | 2006-12-07 17:23:18 -0800 (Thu, 07 Dec 2006) | 1 line

DERBY-2138 (partial) Cleanup imports in functionTests.util that imported DatadictionaryContext but did not use it.
------------------------------------------------------------------------
r483765 | djd | 2006-12-07 17:10:25 -0800 (Thu, 07 Dec 2006) | 2 lines

DERBY-2138 (partial) More import cleanups in iapi/db

------------------------------------------------------------------------
r483762 | djd | 2006-12-07 17:02:01 -0800 (Thu, 07 Dec 2006) | 2 lines

DERBY-2138 (partial) Organize imports in impl/sql/catalog for classes that import DataDictionaryContext but do not use it.

------------------------------------------------------------------------
r483761 | djd | 2006-12-07 16:56:25 -0800 (Thu, 07 Dec 2006) | 2 lines

DERBY-2138 (partial) Cleanup imports on impl/sql/execute classes that imported
DataDictionaryContext without using it.
------------------------------------------------------------------------
r483738 | djd | 2006-12-07 15:45:38 -0800 (Thu, 07 Dec 2006) | 3 lines

DERBY-537 Fix sqlj.replace_jar and sqlj.remove_jar to work under a security manager.
Add a test to test the simple mechanics of the the sqlj functions separated from
the jar files being active on the database class path.
------------------------------------------------------------------------
r483696 | myrnavl | 2006-12-07 14:11:50 -0800 (Thu, 07 Dec 2006) | 2 lines

DERBY-2143 - committing patch DERBY2143_misc for servlet and test docs.

------------------------------------------------------------------------
r483653 | djd | 2006-12-07 12:41:11 -0800 (Thu, 07 Dec 2006) | 7 lines

DERBY-552 Fix fetching resources from an installed jar when the database itself is a jar file.
The old code did not handle the case when the length of the resource (jar) entry was unknown.
New code reads the resource from the JarInputStream into a local byte array and returns a
stream based upon that to the application. This also provides better isolation between
the application and derby, denying user code the ability to read the entire jar or
to prevent correct shutdown of the database. Added utilities to AccessibleByteArrayOutputStream
to enable copying an InputStream into a local array.
------------------------------------------------------------------------
r483642 | fuzzylogic | 2006-12-07 12:12:48 -0800 (Thu, 07 Dec 2006) | 3 lines

Remove NLS comments to prevent possible confusion, fix typo in checklocaleinfo
target

------------------------------------------------------------------------
r483628 | rhillegas | 2006-12-07 11:41:23 -0800 (Thu, 07 Dec 2006) | 1 line

DERBY-2132: Mention JDBC4.0 in the javadoc for EmbeddedDriver. Also briefly describe driver autoloading under Java SE 6.
------------------------------------------------------------------------
r483610 | fuzzylogic | 2006-12-07 11:10:27 -0800 (Thu, 07 Dec 2006) | 3 lines

DERBY-2163: Remove service extension entry from locale jars and derbyrun.jar.
Also remove stale references to COPYRIGHT.

------------------------------------------------------------------------
r483606 | djd | 2006-12-07 10:59:27 -0800 (Thu, 07 Dec 2006) | 3 lines

DERBY-2083 Ensure the store closes the StorageFactory it is using at database shutdown time.
Add shutdown code for the JarStorageFactory to close the jar file it has opened.
Ensure the monitor does not use a stream opened from a StorageFactory after it has called shutdown().
------------------------------------------------------------------------
r483596 | fuzzylogic | 2006-12-07 10:31:18 -0800 (Thu, 07 Dec 2006) | 2 lines

DERBY-2143: Split engine messages for new locales.

------------------------------------------------------------------------
r483532 | abrown | 2006-12-07 08:37:58 -0800 (Thu, 07 Dec 2006) | 11 lines

DERBY-2153:

  1. Create a new JUnit utility file, junit/JAXPFinder.java, that is only
     instantiated when all required XML classes are in the classpath.

  2. Move the import of DocumentBuilderFactory out of junit/XML.java and into
     junit/JAXPFinder.java. This extra level of indirection combined with the
     conditional instantiation of JAXPFinder ensures that we do not attempt to
     instantiate a DocumentBuilderFactory unless we have the necessary JAXP
     classes.

------------------------------------------------------------------------
r483356 | fuzzylogic | 2006-12-06 22:27:34 -0800 (Wed, 06 Dec 2006) | 3 lines

DERBY-2143: Merge revision 483352 to trunk, adds updated localized messages
developed during 10.2 release cycle to trunk.

------------------------------------------------------------------------
r483354 | fuzzylogic | 2006-12-06 22:22:00 -0800 (Wed, 06 Dec 2006) | 2 lines

Add new, empty files for the new localized message files for merge to trunk.

------------------------------------------------------------------------
r483307 | djd | 2006-12-06 16:22:47 -0800 (Wed, 06 Dec 2006) | 1 line

Fix up javadoc warnings in ExecSPSNode.
------------------------------------------------------------------------
r483296 | djd | 2006-12-06 16:04:54 -0800 (Wed, 06 Dec 2006) | 1 line

Fix javadoc errors caused by @see tags that referred to http URLs directly instead of through <a href ... /a>
------------------------------------------------------------------------
r483160 | djd | 2006-12-06 09:39:22 -0800 (Wed, 06 Dec 2006) | 3 lines

DERBY-538 (partial) Move the functionality of InstalledJar into JarLoader since there
was a 1-1 correspondence between the classes following the recent cleanup.

------------------------------------------------------------------------
r483157 | davidvc | 2006-12-06 09:34:43 -0800 (Wed, 06 Dec 2006) | 4 lines

Fixed this so that you can change the user and the calendar, making
this more easily "demoable" without having to change code.  Also
fixed svn:ignore properties for stuff we don't want to check in.

------------------------------------------------------------------------
r483148 | djd | 2006-12-06 08:51:13 -0800 (Wed, 06 Dec 2006) | 3 lines

DERBY-538 (partial) Cleanup the setInvalid methods of JarLoader to remove the option of re-creating the
InstalledJar since it was never used.

------------------------------------------------------------------------
r483108 | djd | 2006-12-06 07:15:29 -0800 (Wed, 06 Dec 2006) | 3 lines

DERBY-538 (partial) Cleanup the jar loading code to consistently use the java.util.jar classes
instead of the java.util.zip classes.

------------------------------------------------------------------------
r482983 | bernt | 2006-12-06 01:26:27 -0800 (Wed, 06 Dec 2006) | 1 line

DERBY-1231 LIKE does not match empty strings when used with a prepared statement.
------------------------------------------------------------------------
r482972 | kahatlen | 2006-12-06 00:51:32 -0800 (Wed, 06 Dec 2006) | 4 lines

DERBY-2155: checkDataSource and checkDataSource30 fail in the tinderbox test

Update master files for DerbyNetClient and fix typo in test output.

------------------------------------------------------------------------
r482894 | fuzzylogic | 2006-12-05 21:03:54 -0800 (Tue, 05 Dec 2006) | 2 lines

Fix build error when compiling just with JDK 1.4

------------------------------------------------------------------------
r482850 | djd | 2006-12-05 16:45:46 -0800 (Tue, 05 Dec 2006) | 4 lines

DERBY-538 (partial) Move the jar based code from JarFileJava2 to InstalledJar and remove JarFileJava2.
Since J2ME/CDC/Foundation and J2SE both support java.util.jar there is no need to have a zip based
implementation (which was for the JDK 1.1 no longer supported). More cleanup will be done to completely
switch over to java.util.jar.
------------------------------------------------------------------------
r482835 | djd | 2006-12-05 16:09:45 -0800 (Tue, 05 Dec 2006) | 3 lines

DERBY-538 (partial) Rename jarFile to InstalledJar so that once JarFileJava2 is merged into it the
java.util.jar.JarFile can be used directly without causing confusion.

------------------------------------------------------------------------
r482812 | djd | 2006-12-05 14:39:35 -0800 (Tue, 05 Dec 2006) | 3 lines

DERBY-538 (partial) Initial step in cleaning up JarFile/JarFileJava2 as a step to having a single class since
all environments Derby runs in supports the java.util.Jar package.

------------------------------------------------------------------------
r482806 | mamta | 2006-12-05 14:19:14 -0800 (Tue, 05 Dec 2006) | 4 lines

Add some sanity code to make sure that the connection is indeed idle when the code expects it to. 
Also, enhanced XA related test to make sure that writable XA transaction following a read-only XA 
transaction works correctly.

------------------------------------------------------------------------
r482717 | djd | 2006-12-05 09:30:34 -0800 (Tue, 05 Dec 2006) | 5 lines

Have EmbedResultSet obtain its EmbedStatement's result set concurrency directly rather than
going through the JDBC method api which in turns requires the check on if the Statement is open.
In this case it's known the Statement is open since it is creating the ResultSet.
Mentioned as one of the optimizatons in DERBY-1876.

------------------------------------------------------------------------
r482529 | fuzzylogic | 2006-12-04 23:02:16 -0800 (Mon, 04 Dec 2006) | 5 lines

DERBY-1529: Add LICENSE and NOTICE files to the Eclipse plugins, update build
instructions

Committed for Rajesh Kartha <kartha02@gmail.com>

------------------------------------------------------------------------
r482435 | djd | 2006-12-04 17:07:43 -0800 (Mon, 04 Dec 2006) | 1 line

DERBY-1808 Changes to the metadata test also require the master file for the upgrade test to be fixed.
------------------------------------------------------------------------
r482433 | abrown | 2006-12-04 16:47:02 -0800 (Mon, 04 Dec 2006) | 32 lines

DERBY-1758 (partial): Enable the lang/XMLBindingTest to run under a security
manager. Changes include all of the following:

 - Updates lang/XMLBindingTest.java so that it will run under the default
testing security manager (i.e. removed the "noSecurityManager()" wrapper).

 - Adds a new property, derbyTesting.jaxpjar, to the default testing policy
file. This property holds the location of the JAXP jar picked up from the
classpath _if_ that jar is external to the JVM. If the jar is either embedded
within, or "endorsed" by, the JVM then this property is unused.

    The JAXP jar is then given permission to read the "extin" testing
directory, which is the directory into which the DTD required by XMLBindingTest
is copied (and thus JAXP has permission to read the DTD file).

 - Adds a new static utility method, "getJAXPParserLocation()", to the
junit/XML.java file. This method instantiates a JAXP object and then uses
the implementation-specific class name to try to find out where the JAXP
jar is located.

- Modifies derbyTesing/junit/build.xml so that junit/XML.java will only
build with 1.4 JVMs and higher. This is required because junit/XML.java
now references a JAXP class that is not defined in 1.3.

 - Updates the "getURL()" method of junit/SecurityManagerSetup.java to account
for situations where a class "code source" is null. Also updates the
"determineClasspath()" method of that class to set the derbyTesting.jaxpjar
property as appropriate.

 - And finally, moves the build order of the derbyTesting/junit directory
so that it is built *before* the derbyTesting/harness directory.

------------------------------------------------------------------------
r482426 | djd | 2006-12-04 16:18:17 -0800 (Mon, 04 Dec 2006) | 2 lines

DERBY-1808 Add inbuilt functions SIGN, SQRT, RAND, RANDOM, COSH, COT, SINH and TANH
Patch contributed by  Richard Wheeldon Email: richard@rswheeldon.com
------------------------------------------------------------------------
r482389 | myrnavl | 2006-12-04 14:20:06 -0800 (Mon, 04 Dec 2006) | 2 lines

DERBY-2037 - tool to flag possible errors in localized message files.

------------------------------------------------------------------------
r482358 | bpendleton | 2006-12-04 13:07:25 -0800 (Mon, 04 Dec 2006) | 33 lines

DERBY-1204: TRIGGER with multi-row INSERT action throws OutOfBounds exception

This patch was contributed by Yip Ng (yipng168@gmail.com)

The statement fails because the bindReferencesClause() method in
CreateTriggerNode did not filter those column references that are not
relevent to the conversion processing for OLD/NEW transition variables.
The above trigger action will have the following parse tree: (roughly)

              InsertNode
                 |
              UnionNode
               /     \
        UnionNode    RowRSNode
         /    \            |
RowRSNode RowRSNode  NumericConstantNode
      |       |                    |
 ColRef    NumericConstantNode    333
      |       |
     n.i     999

Note that the CollectNodesVisitor collects *ALL* the ColumnReferences in
the trigger action. In the above case, it returned 3 column references
nodes. One in the top level Union node, one in top level Union Node's
left child which it is also an UnionNode and the last one is found in
the RowResultSetNode.

The UnionNodes will have a copy of the CRs from its left child and
those CRs will not have its beginOffset set which indicates they are
not relevant for the conversion processing here, so the corrective
action here is to skip these entries.


------------------------------------------------------------------------
r482303 | abrown | 2006-12-04 11:27:08 -0800 (Mon, 04 Dec 2006) | 4 lines

DERBY-2131 (partial): Change privileged block in SqlXmlUtil.serializeToString()
so that it contains as little code as possible.  Also adds a catch block
around the privileged block to unwrap security exceptions.

------------------------------------------------------------------------
r482221 | rhillegas | 2006-12-04 07:37:29 -0800 (Mon, 04 Dec 2006) | 1 line

DERBY-2129: Update STATUS and CHANGES files before generating 10.2.2 release.
------------------------------------------------------------------------
r482129 | kahatlen | 2006-12-04 02:54:53 -0800 (Mon, 04 Dec 2006) | 7 lines

DERBY-2140: BlobClob4BlobTest.testSelfDestructiveClob() fails with
"ERROR X0X95: Operation 'DROP TABLE' cannot be performed on object
'TESTCLOB' because there is an open ResultSet dependent on that
object."

Close ResultSet and Statement in testSelfDestructiveClob.

------------------------------------------------------------------------
r481611 | djd | 2006-12-02 11:38:36 -0800 (Sat, 02 Dec 2006) | 2 lines

Add comment to ModuleFactory.getApplicationProperties() describing its functionality.

------------------------------------------------------------------------
r481602 | djd | 2006-12-02 10:50:26 -0800 (Sat, 02 Dec 2006) | 4 lines

DERBY-2094 (partial) Initial partial implementation of the order entry test transactions using the
defined behaviour from the appendix TPC-C specification. Only stock level added.
Also added a JUnit testing frame work to test the functionality of the operations.

------------------------------------------------------------------------
r481574 | djd | 2006-12-02 08:14:48 -0800 (Sat, 02 Dec 2006) | 1 line

DERBY-1965 Ensure sockets opened by NetworkServerControlImpl are explicitly closed.
------------------------------------------------------------------------
r481467 | djd | 2006-12-01 17:01:11 -0800 (Fri, 01 Dec 2006) | 2 lines

DERBY-2096 Missing file from last commit that broke build.

------------------------------------------------------------------------
r481423 | djd | 2006-12-01 14:06:29 -0800 (Fri, 01 Dec 2006) | 1 line

organize imports (using eclipse) in a number of query nodes, cleans up several unrequired imports of DataDictionayContext.
------------------------------------------------------------------------
r481421 | djd | 2006-12-01 14:00:54 -0800 (Fri, 01 Dec 2006) | 1 line

DERBY-2096 Move remaining methods that are limited to StatementNode from QueryTreeNode.
------------------------------------------------------------------------
r481252 | fernanda | 2006-12-01 06:38:49 -0800 (Fri, 01 Dec 2006) | 3 lines

DERBY-2025 convert lang/updatableResultSet.java to JUnit


------------------------------------------------------------------------
r481181 | kahatlen | 2006-12-01 00:16:09 -0800 (Fri, 01 Dec 2006) | 6 lines

DERBY-2122: Optimize ContainerLock.isCompatible() and RowLock.isCompatible()

Build a bit mask from the compatibility tables in ContainerLock and
RowLock, and replace look-up in two-dimensional array with bitwise
and.

------------------------------------------------------------------------
r481117 | abrown | 2006-11-30 16:19:26 -0800 (Thu, 30 Nov 2006) | 7 lines

DERBY-2131: Use a privileged block when calling out to the JAXP parser
so that users running with a security manager can insert XML values
that reference external DTDs without encountering security exceptions.

This patch does not include any tests; however, relevant test cases
will be enabled as part of DERBY-1758.

------------------------------------------------------------------------
r481114 | myrnavl | 2006-11-30 16:10:15 -0800 (Thu, 30 Nov 2006) | 2 lines

DERBY-2135 - add a note re modifying number of parameters in messages.

------------------------------------------------------------------------
r481026 | rhillegas | 2006-11-30 10:17:08 -0800 (Thu, 30 Nov 2006) | 1 line

DERBY-1919: Commit derby-1919-v01.diff, pointing index.html at the release notes as well as the NOTICE and LICENSE files.
------------------------------------------------------------------------
r480861 | kahatlen | 2006-11-29 23:02:10 -0800 (Wed, 29 Nov 2006) | 2 lines

DERBY-2123: Remove workaround for old JIT bug from StoredPage

------------------------------------------------------------------------
r480664 | mikem | 2006-11-29 10:10:22 -0800 (Wed, 29 Nov 2006) | 3 lines

javadoc fix, removing @return from a void function.


------------------------------------------------------------------------
r480299 | davidvc | 2006-11-28 16:25:20 -0800 (Tue, 28 Nov 2006) | 3 lines

Fixed some formatting/comments and one bugfix.  Also added svn:ignore
to the proper places so things don't accidentally get checked in.

------------------------------------------------------------------------
r480228 | mamta | 2006-11-28 13:54:38 -0800 (Tue, 28 Nov 2006) | 2 lines

Remove imports that are not required.

------------------------------------------------------------------------
r480160 | myrnavl | 2006-11-28 11:13:42 -0800 (Tue, 28 Nov 2006) | 2 lines

DERBY-2110 - removing innocent spaces in the tags

------------------------------------------------------------------------
r479886 | djd | 2006-11-27 20:12:14 -0800 (Mon, 27 Nov 2006) | 2 lines

DERBY-2096 (partial) Move needsSavepoint() to StatementNode, remove QueryTreeNode.bind and optimize.
Have GenericStatement use StatementNode for the head of the statement's query tree.
------------------------------------------------------------------------
r479527 | myrnavl | 2006-11-26 22:37:26 -0800 (Sun, 26 Nov 2006) | 9 lines

DERBY-2110 - correcting typos in a number of messages
- fix involved also updating MessageBuilder.java, because the resulting
  dita file did not correctly replace all quotes when put into html.
- also corrected BlobClob4BlobTest which has the string of message 40X0D
  hardcoded.
- also updated errorCode.out masters, incl. for j9_13 and j9_22, even though
  that's not really needed anymore.


------------------------------------------------------------------------
r479119 | kahatlen | 2006-11-25 04:25:28 -0800 (Sat, 25 Nov 2006) | 4 lines

DERBY-812: Scripts to publish Derby test results

Added licence headers.

------------------------------------------------------------------------
r479044 | kahatlen | 2006-11-24 15:06:41 -0800 (Fri, 24 Nov 2006) | 2 lines

Fixed typo in javadoc.

------------------------------------------------------------------------
r478891 | kahatlen | 2006-11-24 06:32:07 -0800 (Fri, 24 Nov 2006) | 4 lines

DERBY-2116: Test files missing svn:eol-style

Set the svn:eol-style property to native.

------------------------------------------------------------------------
r478883 | kahatlen | 2006-11-24 05:51:37 -0800 (Fri, 24 Nov 2006) | 4 lines

DERBY-2115: Some master files don't have the svn:eol-style property

Set the svn:eol-style property to native for these files.

------------------------------------------------------------------------
r478877 | kahatlen | 2006-11-24 05:33:01 -0800 (Fri, 24 Nov 2006) | 5 lines

DERBY-1434: Client can send incorrect database name to server after
having made multiple connections to different databases.

Patch contributed by Julius Stroffek.

------------------------------------------------------------------------
r478802 | kahatlen | 2006-11-24 00:35:04 -0800 (Fri, 24 Nov 2006) | 4 lines

DERBY-812: Scripts to publish Derby test results

Contributed by Ole Solberg.

------------------------------------------------------------------------
r478622 | bpendleton | 2006-11-23 09:27:39 -0800 (Thu, 23 Nov 2006) | 9 lines

DERBY-1089: NPE inserting a join into a table with a generated column
DERBY-2015: NPE in INSERT .. SELECT with IDENTITY column

When an INSERT ... SELECT statement inserts a GENERATED ALWAYS identity
column, the identity column's column reference is NULL, since that
column does not have a corresponding column in the SELECT list. This
NULL expression needs to be skipped over when remapping column references
from the SELECT column list to the INSERT column list. 

------------------------------------------------------------------------
r478348 | abrown | 2006-11-22 14:30:36 -0800 (Wed, 22 Nov 2006) | 4 lines

DERBY-1758 (partial): Remove the old lang/xmlBinding.java test and the
old xmlSuite.  They have now been replaced with lang/XMLBindingTest.java
and suites/XMLSuite.java, respectively, both of which are run with JUnit.

------------------------------------------------------------------------
r478336 | abrown | 2006-11-22 13:47:23 -0800 (Wed, 22 Nov 2006) | 16 lines

DERBY-1758 (partial):

  1. Updates XMLBindingTest to ignore the Windows line-ending character
     ("\r") when counting characters as part of serialization.

  2. Updates XMLBindingTest to run with NO security manager for now.
     This works toward the "progress not perfection" goal of incremental
     development.  Once the questions surrounding the security policy for
     JAXP have been answered the test can be updated to run with the security
     manager.

  3. Creates a new JUnit suite, suites/XMLSuite.java, to run all of the
     XML JUnit tests, and enables that suite to run as part of
     lang/_Suite.java, which in turn means it is executed as part
     suites.All.

------------------------------------------------------------------------
r478031 | djd | 2006-11-21 20:44:35 -0800 (Tue, 21 Nov 2006) | 1 line

DERBY-2096 (partial) Change the main return type from parsing a statement to a StatementNode.
------------------------------------------------------------------------
r477645 | kahatlen | 2006-11-21 04:10:38 -0800 (Tue, 21 Nov 2006) | 4 lines

DERBY-2102: JDBC.assertFullResultSet should handle byte arrays

Patch contributed by ?\195?\152ystein Gr?\195?\184vlen.

------------------------------------------------------------------------
r477420 | djd | 2006-11-20 16:03:11 -0800 (Mon, 20 Nov 2006) | 5 lines

DERBY-2096 (partial) Rename the optimize() method for StatementNode to optimizeStatement() as a step
in switching the return type of a parse statement to StatementNode. Make optimizeStatement() void
as no implementation ever switches the type and several implementations did not handle the
type switching anyway.

------------------------------------------------------------------------
r477371 | djd | 2006-11-20 14:32:53 -0800 (Mon, 20 Nov 2006) | 5 lines

DERBY-2096 (partial) Rename the bind() method for StatementNode to bindStatement() as a step
in switching the return type of a parse statement to StatementNode. Make bindStatement() void
as no implementation ever switches the type and several implementations did not handle the
type switching anyway.

------------------------------------------------------------------------
r477348 | djd | 2006-11-20 13:30:06 -0800 (Mon, 20 Nov 2006) | 3 lines

Delete three node classes that are not used and have not been modified since the initial contribution.
Also removed them from derby.jar.
HashNodeList, QuantifiedBinaryOperator and QuantifiedUnaryOperator.
------------------------------------------------------------------------
r477168 | kahatlen | 2006-11-20 05:17:11 -0800 (Mon, 20 Nov 2006) | 15 lines

DERBY-1132: Truncation Error with Concat

The Char & Varchar functions were not handled separately to assign to
length for the target type (in the bindExpression() method of
CastNode.java) and thus a default value of 15 was getting assigned to
it (from getColumnDisplaySize() method of DataTypeUtilities class)

Now I added a check for the string types (i.e. both Char & Varchar) in
the source type, and using the operand's maximum length or the maximum
length for that data type (whichever is minimum) and assigning it to
be the length for the target type. Thus avoiding the unwanted
truncation error caused by the default value of 15.

Patch contributed by Saurabh Vyas.

------------------------------------------------------------------------
r476662 | kahatlen | 2006-11-18 15:49:04 -0800 (Sat, 18 Nov 2006) | 2 lines

DERBY-2099: Make BasePage.getPageId() final

------------------------------------------------------------------------
r476645 | myrnavl | 2006-11-18 14:50:22 -0800 (Sat, 18 Nov 2006) | 3 lines

DERBY-1850 - SURTest_ij.sql - after sed-ing for j2ME, missed updating client canon


------------------------------------------------------------------------
r476588 | myrnavl | 2006-11-18 11:02:54 -0800 (Sat, 18 Nov 2006) | 5 lines

DERBY-1850 - jdbcapi/SURTest_ij.sql fails on IBM WCTME 5.7 Foundation (jdkJ2ME Spec v1.0)
- added the required ij.dataSource settings 
- added sedding of first CONNECTION line, to avoid extra master


------------------------------------------------------------------------
r476548 | myrnavl | 2006-11-18 08:03:33 -0800 (Sat, 18 Nov 2006) | 5 lines

DERBY-2049 - parameterMapping and updatableResultset failing with wctme5.7 foundation
- updated j9_foundation output to reflect new messages
- adjusted test 48 to not run BigDecimal queries


------------------------------------------------------------------------
r476425 | myrnavl | 2006-11-17 19:26:40 -0800 (Fri, 17 Nov 2006) | 6 lines

DERBY-1849 - grantRevokeDDL and grantRevokeDDL2.sql fail with ibm wctme5.7_foundation (jdkJ2ME Spec v1.0)
- accepting that triggers are not supported with this jvm
- updated masters to latest syntax changes in test
- stopped NPE by adding ij.dataSource properties to grantRevokeDDL2.out


------------------------------------------------------------------------
r476365 | abrown | 2006-11-17 15:30:51 -0800 (Fri, 17 Nov 2006) | 12 lines

DERBY-1758 (partial): Adds a new JUnit test to replace the old
lang/xmlBinding.java test. The patch does the following:

  - Adds XML file insertion utility methods to junit/XML.java
  - Creates a new JUnit test called lang/XMLBindingTest.java that
    uses the new utility methods to test various binding scenarios
    with Derby's SQL/XML operators.
  - Overloads the TestConfiguration.defaultSuite() method with a boolean
    signature to allow optional addition of CleanDatabaseSetup.
  - Updates lang/XMLTypeAndOpsTest to use the new overloaded defaultSuite()
    method. 

------------------------------------------------------------------------
r476353 | djd | 2006-11-17 15:02:30 -0800 (Fri, 17 Nov 2006) | 2 lines

Remove some unused methods from LanguageConnectionContext,
anyoneBlocked,getAccessFactory,setTransaction
------------------------------------------------------------------------
r476342 | djd | 2006-11-17 14:20:12 -0800 (Fri, 17 Nov 2006) | 3 lines

DERBY-2096 (partial) Change the methods in the grammar (sqlgrammar.jj) that return statements to declare thier
return type as the more specific StatementNode rather than QueryTreeNode.

------------------------------------------------------------------------
r476318 | djd | 2006-11-17 13:14:19 -0800 (Fri, 17 Nov 2006) | 2 lines

Remove reference to the connection once it is closed in derbynet/ShutDownDBWhenNSShutsDownTest

------------------------------------------------------------------------
r476316 | djd | 2006-11-17 13:11:59 -0800 (Fri, 17 Nov 2006) | 3 lines

Various changes to ensure JDBC objects are closed when running the JUnit tests in the jdbcapi package.
Change UpdateableResultSetTest to become standard and use the connection provided by
the super class.
------------------------------------------------------------------------
r476315 | djd | 2006-11-17 13:10:17 -0800 (Fri, 17 Nov 2006) | 1 line

Close one of the ResultSets used to clean up databases from CleanDatabaseTestSetup.
------------------------------------------------------------------------
r476224 | djd | 2006-11-17 09:30:43 -0800 (Fri, 17 Nov 2006) | 1 line

Close a CallableStatement in ProcedureTest
------------------------------------------------------------------------
r476204 | djd | 2006-11-17 08:36:14 -0800 (Fri, 17 Nov 2006) | 2 lines

Clean up some assertTrue(..., false) to fail() in HoldabilityTest,
close some ResultSet's left open and simplify the tearDown method.
------------------------------------------------------------------------
r476201 | djd | 2006-11-17 08:33:30 -0800 (Fri, 17 Nov 2006) | 1 line

Close a PreparedStatement in SURTest.
------------------------------------------------------------------------
r476199 | djd | 2006-11-17 08:30:45 -0800 (Fri, 17 Nov 2006) | 1 line

Clean up some asserts and close a PreparedStatement in SURBaseTest
------------------------------------------------------------------------
r476197 | djd | 2006-11-17 08:28:42 -0800 (Fri, 17 Nov 2006) | 1 line

Close some Statement objects left open in XMLTypeAndOpsTest
------------------------------------------------------------------------
r476196 | djd | 2006-11-17 08:27:21 -0800 (Fri, 17 Nov 2006) | 1 line

Null out the DDL connection reference in PrepareExecuteDDL on tearDown.
------------------------------------------------------------------------
r476195 | djd | 2006-11-17 08:25:47 -0800 (Fri, 17 Nov 2006) | 1 line

Ensure ConcurrencyTest closes the second connection it opens in some fixtures.
------------------------------------------------------------------------
r476190 | mikem | 2006-11-17 08:07:35 -0800 (Fri, 17 Nov 2006) | 6 lines

DERBY-2093

Fixed error in initSlotTable() to print the right page info in case
of error during initialization of page from disk into cache.


------------------------------------------------------------------------
r476182 | djd | 2006-11-17 07:46:01 -0800 (Fri, 17 Nov 2006) | 2 lines

Change GroupByExpressionTest to use the standard CleanDatabaseTestSetup rather than
its own mechanism to drop objects.
------------------------------------------------------------------------
r476180 | djd | 2006-11-17 07:35:08 -0800 (Fri, 17 Nov 2006) | 5 lines

Null out the NetworkServerControl in the tearDown method of the
network server decorator. This seems to stop future startups of
the server taking 60+ seconds and causing tests to fail.
Will add a note to DERBY-1966 that this is a possible cause of
network start delays. Also null of the FileOutputStream field.
------------------------------------------------------------------------
r476087 | bernt | 2006-11-17 01:17:55 -0800 (Fri, 17 Nov 2006) | 1 line

DERBY-2084 getTransactionIsolation() in network client should not activate a transaction
------------------------------------------------------------------------
r475817 | kristwaa | 2006-11-16 09:06:34 -0800 (Thu, 16 Nov 2006) | 2 lines

DERBY-1693: Log a token in derby.log for LOBs instead of the actual content when derby.language.logStatementText=true (token: "NULL|[BC]LOB(<length>|<stream class>)")

------------------------------------------------------------------------
r475803 | djd | 2006-11-16 08:36:41 -0800 (Thu, 16 Nov 2006) | 2 lines

DERBY-1030 (partial) Add some comments to the logic for the RETURNS ON NULL INPUT's state field.

------------------------------------------------------------------------
r475780 | djd | 2006-11-16 07:49:28 -0800 (Thu, 16 Nov 2006) | 3 lines

DERBY-927 (partial) Clean up code related to serviceProviders to aid progress towards
merging services and storage factories in the monitor.

------------------------------------------------------------------------
r475779 | djd | 2006-11-16 07:46:52 -0800 (Thu, 16 Nov 2006) | 3 lines

DERBY-927 (partial) StorageFactoryService needs to allow for the return for StorageFile.list()
being null as documented in the api.

------------------------------------------------------------------------
r475728 | kahatlen | 2006-11-16 05:32:06 -0800 (Thu, 16 Nov 2006) | 2 lines

Fix javadoc warnings in JarUtil.

------------------------------------------------------------------------
r475724 | kahatlen | 2006-11-16 05:22:29 -0800 (Thu, 16 Nov 2006) | 2 lines

Removed javadoc templates which hid the excellent javadoc for StoredPage.

------------------------------------------------------------------------
r475492 | djd | 2006-11-15 15:29:21 -0800 (Wed, 15 Nov 2006) | 1 line

DERBY-1030 (partial) Remove test cases from functions.sql that are covered in RoutineTest (junit test).
------------------------------------------------------------------------
r475490 | djd | 2006-11-15 15:22:26 -0800 (Wed, 15 Nov 2006) | 3 lines

DERBY-1030 (partial) Add test cases to RoutineTest that demonstrate this bug, where
a function declared as RETURNS NULL ON NULL INPUT can be called when its argument is NULL.
Look for the comment with this bug number.
------------------------------------------------------------------------
r475449 | djd | 2006-11-15 13:58:34 -0800 (Wed, 15 Nov 2006) | 3 lines

DERBY-1030 (partial) Add a new JUnit test class intended to hold all routine (procedure and function)
test cases. Migrate some test cases from functions.sql related to checking the RETURNS NULL or CALLED
on NULL INPUT clauses for functions. 
------------------------------------------------------------------------
r475446 | djd | 2006-11-15 13:54:40 -0800 (Wed, 15 Nov 2006) | 1 line

Remove test cases from functions.sql that are covered by MathTrigFunctionsTest.
------------------------------------------------------------------------
r475370 | kahatlen | 2006-11-15 11:17:53 -0800 (Wed, 15 Nov 2006) | 4 lines

DERBY-2089: jdbc4/VerifySignatures.junit is failing

Adding "create=true" so that the test database is created.

------------------------------------------------------------------------
r475330 | mikem | 2006-11-15 09:53:45 -0800 (Wed, 15 Nov 2006) | 10 lines

DERBY-2057
contributed by Yip Ng
patch:  derby2057-trunk-diff02.txt

Fixed SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE() implementation to match
documentation.  Arguments should treat non-zero as "true", previous to this
fix only "1" was treated as true.



------------------------------------------------------------------------
r474884 | djd | 2006-11-14 09:31:34 -0800 (Tue, 14 Nov 2006) | 1 line

DERBY-2033 Remove the old dcl.sql test from the old harness.
------------------------------------------------------------------------
r474878 | djd | 2006-11-14 09:21:08 -0800 (Tue, 14 Nov 2006) | 3 lines

DERBY-2033 Convert remaining tests from dcl.sql to DatabaseClassLoadingTest including those
that execute against a database in a jar. Database in a jar tests pass but cause an issue on
clenaup which is entered as DERBY-2083.
------------------------------------------------------------------------
r474803 | kristwaa | 2006-11-14 06:36:38 -0800 (Tue, 14 Nov 2006) | 2 lines

DERBY-2054: Rewrite test derbynet/SuicideOfStreaming to JUnit. Moved tests ByteArrayCombinerStreamTest and SqlExceptionTest from old harness to suites.All.

------------------------------------------------------------------------
r474720 | bernt | 2006-11-14 02:25:51 -0800 (Tue, 14 Nov 2006) | 1 line

DERBY-638 Network driver setTransactionIsolation() causes a commit, but does not complete it locally
------------------------------------------------------------------------
r474695 | kahatlen | 2006-11-14 00:32:25 -0800 (Tue, 14 Nov 2006) | 7 lines

DERBY-801: Allow parallel access to data files

This patch (DERBY-801-7.patch) turns the DEBUG_PRINT messages in
RAFContainer4 into assertions guarding the method entry points.

Patch contributed by Anders Morken.

------------------------------------------------------------------------
r474628 | fuzzylogic | 2006-11-13 18:28:02 -0800 (Mon, 13 Nov 2006) | 2 lines

DERBY-2030: 'show tables' should show system tables.

------------------------------------------------------------------------
r474619 | djd | 2006-11-13 17:17:14 -0800 (Mon, 13 Nov 2006) | 4 lines

Simplify the interaction between the monitor and the StorageFactory when the
monitor is obtaining a list of services to boot. Cleaner code avoids creating
a new StorageFactory implementation for each file and handles non-directories cleaner.

------------------------------------------------------------------------
r474593 | fuzzylogic | 2006-11-13 16:02:35 -0800 (Mon, 13 Nov 2006) | 4 lines

Grant permission to read ${user.home}/junit.properties to all. Left it in the
previous section so that this new section just needs to be removed once
CompatibilityTest has been rewritten.

------------------------------------------------------------------------
r474552 | djd | 2006-11-13 14:57:49 -0800 (Mon, 13 Nov 2006) | 2 lines

Add utility methods for JUnit tests to get a DataSource based upon the current configuration
but pointing to a different database and to shutdown a database from a data source.
------------------------------------------------------------------------
r474502 | bpendleton | 2006-11-13 12:36:51 -0800 (Mon, 13 Nov 2006) | 13 lines

DERBY-1495: Error modifying an identity column after altering the column
DERBY-1645: ALTER TABLE SET INCREMENT turns off "Generated By Default"

This patch changes ModifyColumnNode.bindAndValidateDefault so that it
detects the case(s) where the user is altering aspects of an identity column,
and ensures that the other aspects of that identity column are preserved and
not lost. The crucial issue is that if the column is Generated By Default,
then the DefaultInfoImpl column in the SYSCOLUMNS table needs to get
retained when the user uses ALTER TABLE to change either the start value
or the increment value; otherwise the behavior effectively switches from
Generated By Default to Generated Always.


------------------------------------------------------------------------
r474376 | djd | 2006-11-13 07:50:24 -0800 (Mon, 13 Nov 2006) | 1 line

DERBY-537 (partial) Remove some dead code for handling jar files stored within the database.
------------------------------------------------------------------------
r474015 | kahatlen | 2006-11-12 11:14:32 -0800 (Sun, 12 Nov 2006) | 3 lines

Clean up javadoc comments in ClientBaseDataSource to make them more
readable in the published API.

------------------------------------------------------------------------
r473834 | djd | 2006-11-11 16:08:07 -0800 (Sat, 11 Nov 2006) | 3 lines

DERBY-537 (partial) Call FileResource.add in a privleged block when executing code to add a jar,
driven by sqlj.install_jar. Allows one test fixture in DatabaseClassLoadingTest to be executed
with a security manager.
------------------------------------------------------------------------
r473828 | djd | 2006-11-11 15:11:56 -0800 (Sat, 11 Nov 2006) | 5 lines

DERBY-537 (partial) Fix the reading of the jar file (through a URL or file name) for sqlj.install_jar
and replace_jar to be under a privileged block. Switched the order of lookup from the jar path to
be URL and then as a file name. Otherwise a security exception is thrown trying to open the URL
path as a file name.

------------------------------------------------------------------------
r473783 | djd | 2006-11-11 11:50:15 -0800 (Sat, 11 Nov 2006) | 2 lines

SupportFilesSetup needs to convert from the File to a URL in a privileged block as
that operation requires the permission to read user.dir.
------------------------------------------------------------------------
r473780 | djd | 2006-11-11 11:41:05 -0800 (Sat, 11 Nov 2006) | 2 lines

DERBY-537 (partial) Change the DatabaseClassLoadingTest to install and replace the jar files using
the SupportFilesSetup decorator so that the engine will have the correct permissions to read the jar files.
------------------------------------------------------------------------
r473778 | djd | 2006-11-11 11:33:55 -0800 (Sat, 11 Nov 2006) | 2 lines

Add decorator SupportFilesSetup which allows resources to be copied from the classpath
into the extin, extinout & extout folders to match the old harness behaviour.
------------------------------------------------------------------------
r473688 | kahatlen | 2006-11-11 02:36:16 -0800 (Sat, 11 Nov 2006) | 2 lines

Fixed wrong class name in copyright header.

------------------------------------------------------------------------
r473687 | kahatlen | 2006-11-11 02:28:07 -0800 (Sat, 11 Nov 2006) | 6 lines

DERBY-2067: Assert failure in EmbedConnection.restoreContextStack()
when running lang/closed.java

Change the assert so that it doesn't raise an error if the engine has
been shut down.

------------------------------------------------------------------------
r473603 | bpendleton | 2006-11-10 16:51:33 -0800 (Fri, 10 Nov 2006) | 7 lines

DERBY-2018: NullPointerException in CREATE VIEW ... VALUES NULL

This patch was contributed by Yip Ng (yipng168@gmail.com)

This fix catches untyped null in CreateViewNode at bind phase (same logic
as CursorNode) and throws the exception. 

------------------------------------------------------------------------
r473440 | djd | 2006-11-10 11:31:18 -0800 (Fri, 10 Nov 2006) | 2 lines

DERBY-537 Fix JarLoader missed from last commit.

------------------------------------------------------------------------
r473416 | djd | 2006-11-10 10:30:50 -0800 (Fri, 10 Nov 2006) | 1 line

DERBY-537 (partial) Cleanup JarUtil removing code that is never called and making class package private.
------------------------------------------------------------------------
r473413 | djd | 2006-11-10 10:26:19 -0800 (Fri, 10 Nov 2006) | 3 lines

DERBY-2055 1) Adds a new class Load.java to execute the schema scripts for OE within the junit framework.
2) Adds a new utility method to BaseJDBCTestCase to take a resource name and execute it using runScript. 
Contributed by  Sunitha Kambhampati ksunithaghm@gmail.com
------------------------------------------------------------------------
r473396 | djd | 2006-11-10 09:36:57 -0800 (Fri, 10 Nov 2006) | 3 lines

Add some comments to ConstantActionActivation to inform how the activation gets
hooked up to the ConstantAction.

------------------------------------------------------------------------
r473387 | djd | 2006-11-10 08:39:20 -0800 (Fri, 10 Nov 2006) | 2 lines

DERBY-2040 (partial) Create the class loaders (JarLoader instances) for database class loading
within a privileged block.
------------------------------------------------------------------------
r473366 | djd | 2006-11-10 07:26:58 -0800 (Fri, 10 Nov 2006) | 4 lines

DERBY-2047 Remove TestDataSourceFactory and clean up associated code. Functionality
has been replaced by JDBCDataSource and J2EEDataSource which allows clean separation
for JSR169 which does not include the XA and connection pooling data sources.

------------------------------------------------------------------------
r473176 | djd | 2006-11-09 19:42:54 -0800 (Thu, 09 Nov 2006) | 1 line

DERBY-2063 Add comment to BootTestAll related to this bug.
------------------------------------------------------------------------
r473175 | djd | 2006-11-09 19:36:32 -0800 (Thu, 09 Nov 2006) | 3 lines

DERBY-1952 DERBY-2047 Convert store/BootAllTest to run as a standard JUNit test and
not within the harness. Added a store._Suite and hooked it into the suites.All and
the ant junit-all target.
------------------------------------------------------------------------
r473123 | djd | 2006-11-09 14:49:55 -0800 (Thu, 09 Nov 2006) | 6 lines

DERBY-2063 (partial) Change ShutdownDBWhenNSShutsDown from being a JUnit test run under the old
harness to one that is run as a regular JUnit tests. Add a new _Suite for derbynet and hook it
into suites.All and the ant junit-all target. Required fixing some bugs in the DriverManager
connection handling. Also refactored NetworkServerTestSetup to allow starting the server
from the "command line" and to provide some utility methods for tests, e.g. to get
a correctly setup NetworkServerControl.
------------------------------------------------------------------------
r473079 | djd | 2006-11-09 13:38:52 -0800 (Thu, 09 Nov 2006) | 2 lines

DERBY-1952 DERBY-2047 Remove the remaining code directly related to derbyTesting.xa.single.
This functionality has been replaced with a decorator.
------------------------------------------------------------------------
r472902 | kristwaa | 2006-11-09 05:58:31 -0800 (Thu, 09 Nov 2006) | 2 lines

DERBY-2000: Granted permission to create derby.system.home to derby.jar

------------------------------------------------------------------------
r472859 | kahatlen | 2006-11-09 02:57:47 -0800 (Thu, 09 Nov 2006) | 6 lines

DERBY-2038: lang/releaseCompileLocks.sql and lang/closed.java fail
under JDK 1.6 in insane mode

Added sed scripts which deleted the differing parts of the stack trace
from the test output.

------------------------------------------------------------------------
r472803 | kahatlen | 2006-11-08 23:43:38 -0800 (Wed, 08 Nov 2006) | 5 lines

DERBY-2050: Manipulating CachedItems could be more efficient

Use five boolean fields instead of one int to record CachedItem's
state. Contributed by Dyre Tjeldvoll.

------------------------------------------------------------------------
r472738 | suresht | 2006-11-08 17:55:43 -0800 (Wed, 08 Nov 2006) | 6 lines

simple update to the master file specific to ibm 15 jvm. This file 
did not seems to have got updated correctly  with  sql file
copyright changes. 
   


------------------------------------------------------------------------
r472722 | djd | 2006-11-08 16:56:20 -0800 (Wed, 08 Nov 2006) | 6 lines

DERBY-2047 DERBY-1952 (partial) Implement the ability to run with the default connction coming from
an XADataSource as a decorator via the utility method TestConfiguration.connectionXADecorator.
This will replace the functionality driven by the property derbyTesting.xa.single.
Improved jdbc4.ConnectionTest and PreparedStatementTest to also run their test fixtures with
this XA decorator. This will replace the old harness suite jdbcxa40 which does not seem to be part
of derbyall but the new runs are part of jdbc4._Suite.
------------------------------------------------------------------------
r472708 | bpendleton | 2006-11-08 16:00:45 -0800 (Wed, 08 Nov 2006) | 11 lines

DERBY-1490: Provide RENAME COLUMN functionality

This patch provides a new statement:

  RENAME COLUMN [schema.]table.column TO new-column

The patch contains sqlgrammar.jj changes which implement the new syntax
using the existing execution support in RenameConstantAction.java. The
patch also includes new tests in the lang/altertable.sql test program.


------------------------------------------------------------------------
r472707 | djd | 2006-11-08 16:00:17 -0800 (Wed, 08 Nov 2006) | 3 lines

DERBY-2047 (partial) Expose the generic data source (bean) property setting method in JDBCDataSource
and change DataSourcePropertiesTest to use it as part of clean up to ensure clean separation between
old harness code and JUnit code.
------------------------------------------------------------------------
r472704 | djd | 2006-11-08 15:51:46 -0800 (Wed, 08 Nov 2006) | 3 lines

DERBY-2033 (partial) All of the test cases from dcl.sql are converted to DatabaseClassLoadingTest
except those related to jarring up the database and runing tests against that read-only database.
Add DatabaseClassLoadingTest into lang._Suite.
------------------------------------------------------------------------
r472613 | djd | 2006-11-08 11:49:13 -0800 (Wed, 08 Nov 2006) | 6 lines

DERBY-2048 Add an additional cleanup step(compression) to cleanDatabase() method.
After objects removal is performed via removeObjects(), object compression is performed in the
new compressObjects() method on the SYS.SYSDEPENDS to compact the system table.
(Currently it only compress this system table.)

Contributed by Yip Ng yipng168@gmail.com
------------------------------------------------------------------------
r472391 | abrown | 2006-11-07 20:53:54 -0800 (Tue, 07 Nov 2006) | 8 lines

DERBY-2052: JDBC.assertRowInResultSet compares the wrong value if using
trimmed strings and a SMALLINT column exists. 

Patch that 1) moves the locally scoped variables in JDBC.assertRowInResultSet()
into the for loop, and 2) sets the "obj" variable through all paths.

Contributed by Dan Debrunner (djd@apache.org) 

------------------------------------------------------------------------
r472228 | djd | 2006-11-07 12:05:22 -0800 (Tue, 07 Nov 2006) | 4 lines

DERBY-2023 DERBY-2047 Add JUnit utility class J2EEDataSource to return XA and ConnectionPooling
data source implementations. Split out from JDBCDataSource to ensure no class not found exceptions
when running in JSR169. Changed JUnit tests using the old harness class TestDataSourceFactory
to use the J2EEDataSource and/or JDBCDataSource.
------------------------------------------------------------------------
r472187 | djd | 2006-11-07 10:18:54 -0800 (Tue, 07 Nov 2006) | 7 lines

DERBY-2036 DERBY-2043 DERBY-2047 (partial) Re-work connection handling in JUnit tests.
Create connection factory Connector with two implementations, DataSourceConnector and DriverManagerConnector.
This ensures that running tests does not attempt to load DriverManager when running tests with JSR169.
Ensure DataSource implementation sets user name and password from configuration for the getConnection()
method to ensure the ChangerUserTestSetup works.
Refactor the setting of data source Java bean properties to be from a HashMap rather than a Properties
object to ensure that no special code exists at the lowest level to deal with different property types.
------------------------------------------------------------------------
r472016 | kahatlen | 2006-11-06 23:39:25 -0800 (Mon, 06 Nov 2006) | 17 lines

DERBY-2023: Ensure all tests called by jdbc40._Suite run in embedded
and client as required

The attached patch (derby-2023.diff) makes most of the tests in
jdbc4._Suite run in client and embedded. The exceptions are

  - ClosedObjectTest
  - StatementEventsTest
  - XA40Test
  - UnsupportedVetter
  - DataSourceTest

These tests can only run in embedded mode until DERBY-2047 has been
fixed, and I have added a note about it in their suite() methods.

jdbc4._Suite is removed from jdbc40.runall.

------------------------------------------------------------------------
r471862 | kahatlen | 2006-11-06 11:58:18 -0800 (Mon, 06 Nov 2006) | 7 lines

DERBY-2046: Make class org.apache.derby.iapi.store.raw.PageKey final

The methods of the PageKey class are called frequently both from the
lock manager and the cache manager. Since no other classes extend it,
it should be declared final to help the run-time compiler optimize the
method calls.

------------------------------------------------------------------------
r471808 | djd | 2006-11-06 10:39:16 -0800 (Mon, 06 Nov 2006) | 2 lines

DERBY-2043 DERBY-2047 (partial) More connection utility method cleanup to provide a single consistent
shutdownEngine() method.
------------------------------------------------------------------------
r471459 | bpendleton | 2006-11-05 08:45:24 -0800 (Sun, 05 Nov 2006) | 16 lines

DERBY-2014: NullPointerException with NULLIF in GROUP BY clause

This change was contributed by Yip Ng (yipng168@gmail.com)

The NPE happens in isEquivalent() method where it does not handle
value is null. (same symptom as DERBY-2008) and the patch addresses
this + additonal testcases.

The isEquivalent() method is used to compare the select column
against the group by with expression. Note that it is comparing
the structural form of the two expressions for equivalence at bind phase
and not comparing the actual row values at runtime to produce a result.

This patch converts all the tests in the previous patch into junit.
Also the javadoc for ValueNode.isEquivalent() method has been updated.

------------------------------------------------------------------------
r471366 | fuzzylogic | 2006-11-04 21:14:13 -0800 (Sat, 04 Nov 2006) | 2 lines

Add *.dtd and messages*.xml to list of exclusions for the derbydocs target.

------------------------------------------------------------------------
r471104 | djd | 2006-11-03 18:47:29 -0800 (Fri, 03 Nov 2006) | 3 lines

DERBY-2033 (partial) Add login in CleanDatabaseTestSetup to unset database properties as
part of the cleanup. Specifcally unset derby.database.classpath for the DatabaseClassLoadingTest
but others can be added in the future.
------------------------------------------------------------------------
r471089 | djd | 2006-11-03 17:08:34 -0800 (Fri, 03 Nov 2006) | 4 lines

DERBY-2043 (partial) Cleanup some of the connection methods in TestConfiguration to allow easier
transition of the DataSource code into the junit package. Add a utility shutdownDatabase() method
to TestConfiguration rather than using a getConnection with shutdown=true and duplicated code
for catching the exception and asserting its SQL state.
------------------------------------------------------------------------
r470956 | djd | 2006-11-03 11:17:21 -0800 (Fri, 03 Nov 2006) | 4 lines

DERBY-2033 (partial) Initial test cases for DatabaseClassLoadingTest but test is not ready to
be added to a suite yet. Fix the no security manager decorator to work correctly as it is
required by this test. Add some utility methods to JDBC for testing result sets.

------------------------------------------------------------------------
r470943 | abrown | 2006-11-03 10:57:02 -0800 (Fri, 03 Nov 2006) | 3 lines

Test committer capabilities by making a small fix to comments
in OptimizerImpl.java

------------------------------------------------------------------------
r470909 | jta | 2006-11-03 09:18:43 -0800 (Fri, 03 Nov 2006) | 2 lines

DERBY-1986 Add Cryptographic Software Notice to the README.

------------------------------------------------------------------------
r470862 | rhillegas | 2006-11-03 07:51:16 -0800 (Fri, 03 Nov 2006) | 1 line

DERBY-1868: Point message writers to the website for guidance on how to write messages.
------------------------------------------------------------------------
r470636 | fuzzylogic | 2006-11-02 18:13:30 -0800 (Thu, 02 Nov 2006) | 3 lines

DERBY-2006: Refactor junit-oneclass target to set the jvm from a property,
and set the default to 'java' in junit-init.

------------------------------------------------------------------------
r470604 | fuzzylogic | 2006-11-02 15:50:58 -0800 (Thu, 02 Nov 2006) | 3 lines

DERBY-2006: Add a top-level Ant target that runs the junit tests and generates
a report.

------------------------------------------------------------------------
r470573 | kahatlen | 2006-11-02 14:39:53 -0800 (Thu, 02 Nov 2006) | 6 lines

DERBY-801 (partial) Allow parallel access to data files

DERBY-801-6.patch remedies the noise from the iosInProgress sanity
checking by checking the committed drop state before croaking.
Patch contributed by Anders Morken.

------------------------------------------------------------------------
r470492 | djd | 2006-11-02 11:53:26 -0800 (Thu, 02 Nov 2006) | 1 line

DERBY-2021 Fix ConcurrencyTest to run embedded and client.
------------------------------------------------------------------------
r470476 | djd | 2006-11-02 11:05:48 -0800 (Thu, 02 Nov 2006) | 2 lines

DERBY-2021 Fix DataSourceProperties and SURQueryMixTest to runs tests in client and embedded as needed.
Fix DataSourceProperties to actually run some tests.
------------------------------------------------------------------------
r470463 | djd | 2006-11-02 10:25:58 -0800 (Thu, 02 Nov 2006) | 2 lines

DERBY-2032 Convert MathTrigFunctionsTest to use PreparedStatements instead of many compiled Statements
and thus reduce execution time from eighty seconds to around ten seconds.
------------------------------------------------------------------------
r470434 | djd | 2006-11-02 09:26:44 -0800 (Thu, 02 Nov 2006) | 2 lines

DERBY-467 Add a new test for tesing security issues related to server side Java procedures and functions.
New test is lang.RoutineSecurityTest.
------------------------------------------------------------------------
r470418 | djd | 2006-11-02 09:04:12 -0800 (Thu, 02 Nov 2006) | 1 line

DERBY-2021 Fix SURTest.suite() to run client & embedded.
------------------------------------------------------------------------
r470372 | rhillegas | 2006-11-02 06:26:09 -0800 (Thu, 02 Nov 2006) | 1 line

DERBY-1993: Checkin derby-1993-v03.diff, which puts the demo classes in the org.apache.derbyDemo namespace.
------------------------------------------------------------------------
r470362 | kahatlen | 2006-11-02 05:47:30 -0800 (Thu, 02 Nov 2006) | 5 lines

DERBY-801 (partial) Allow parallel access to data files

Use Derby's own module loading mechanism to load RAFContainer4.
Patch contributed by Anders Morken.

------------------------------------------------------------------------
r470305 | kahatlen | 2006-11-02 02:04:21 -0800 (Thu, 02 Nov 2006) | 4 lines

DERBY-2005: Convert jdbcapi/Stream.java to JUnit

Clean-up patch contributed by Fernanda Pizzorno.

------------------------------------------------------------------------
r470294 | kahatlen | 2006-11-02 01:43:04 -0800 (Thu, 02 Nov 2006) | 6 lines

DERBY-2027: JUnit suite All crashes with OutOfMemoryError when running
LobLengthTest

Use LoopingAlphabetStream instead of ByteArrayInputStream to reduce
memory usage. Patch contributed by Kristian Waagan.

------------------------------------------------------------------------
r470233 | djd | 2006-11-01 20:57:18 -0800 (Wed, 01 Nov 2006) | 3 lines

DERBY-2021 (partial) Change ProcedureTest.suite() to run tests embedded and client. Cleanup
the creation of tables and procedures to use the decorateSQL method of CleanDatabaseTestSetup
rather than a test specific way to drop objects.
------------------------------------------------------------------------
r470223 | djd | 2006-11-01 20:17:20 -0800 (Wed, 01 Nov 2006) | 4 lines

DERBY-2021 (partial) Wrap each suite (embedded and client) in CleanDatabaseSetup when using the defaultSuite() method.
ResultSetCloseTest required this and it makes better sense than the single wrapping of both suites with a clean database
decorator.

------------------------------------------------------------------------
r470221 | djd | 2006-11-01 20:13:48 -0800 (Wed, 01 Nov 2006) | 2 lines

DERBY-2021 (partial) Fix UpdateXXXTest and ResultSetCloseTest suite() methods to run in client as well.

------------------------------------------------------------------------
r470152 | djd | 2006-11-01 16:56:32 -0800 (Wed, 01 Nov 2006) | 2 lines

DERBY-2005 converts the test jdbcapi/Stream.java to Junit.
Contributed by Fernanda Pizzorno fernanda.pizzorno@sun.com
------------------------------------------------------------------------
r470142 | djd | 2006-11-01 15:55:24 -0800 (Wed, 01 Nov 2006) | 3 lines

DERBY-1995 Add final base schema script, index.sql for additional indexes required by the test.
Added copy to the build target to copy the scripts to the classes folder.

------------------------------------------------------------------------
r470128 | rhillegas | 2006-11-01 14:52:42 -0800 (Wed, 01 Nov 2006) | 1 line

DERBY-1868: Commit Knut Anders' patch to point the compiler at antlibrary.dir rather than ant.home.
------------------------------------------------------------------------
r470024 | djd | 2006-11-01 10:32:58 -0800 (Wed, 01 Nov 2006) | 6 lines

DERBY-1974 Add utility method TestConfiguration.sqlAuthorizationDecorator to change the default
database to one that has SQL authorization mode enabled. Have PrepareExecuteDDL use this decorator
and add this test to lang._Suite. Fix a bug in assertDrainResults() where the wrong variable
was being used to check an assert.


------------------------------------------------------------------------
r470008 | rhillegas | 2006-11-01 09:43:29 -0800 (Wed, 01 Nov 2006) | 1 line

DERBY-1868: Delete generated messages_en.properties at clobber time. Teach subversion to ignore this generated file.
------------------------------------------------------------------------
r469975 | rhillegas | 2006-11-01 08:44:26 -0800 (Wed, 01 Nov 2006) | 1 line

DERBY-1868: Check in derby-1868-merged-v01.diff. This causes the Derby build to consume an xml file of message descriptors and generate the engine's messages_en.properties as well as the SQLState tables for the Reference Guide.
------------------------------------------------------------------------
r469965 | djd | 2006-11-01 08:22:51 -0800 (Wed, 01 Nov 2006) | 3 lines

DERBY-2028 add names to existing JUnit test suites without a name.
contributed by Kristian Waagan Kristian.Waagan@Sun.com

------------------------------------------------------------------------
r469713 | djd | 2006-10-31 16:05:24 -0800 (Tue, 31 Oct 2006) | 4 lines

DERBY-1758 Remove the old lang/xml_general.sql test and the corresponding master files.
That test has now been replaced by lang/XMLTypeAndOpsTest.java, which is a JUnit test.
Contributed by A B qozinx@gmail.com

------------------------------------------------------------------------
r469634 | djd | 2006-10-31 12:11:56 -0800 (Tue, 31 Oct 2006) | 1 line

DERBY-1975 Remove work in progress comments from DropDatabaseSetup.
------------------------------------------------------------------------
r469632 | djd | 2006-10-31 12:09:07 -0800 (Tue, 31 Oct 2006) | 2 lines

DERBY-1975 Enhance the single database decorator and DropDatabaseSetup to use a unique database name
and to drop the database at tearDown.
------------------------------------------------------------------------
r469594 | djd | 2006-10-31 10:21:42 -0800 (Tue, 31 Oct 2006) | 1 line

DERBY-1975 (partial) Add some incremental work to support a single use database for a test.
------------------------------------------------------------------------
r469591 | djd | 2006-10-31 10:13:00 -0800 (Tue, 31 Oct 2006) | 2 lines

Name the test suite in the jdbc4._Suite.

------------------------------------------------------------------------
r469588 | djd | 2006-10-31 10:05:31 -0800 (Tue, 31 Oct 2006) | 2 lines

DERBY-1970 Add initial performance test that uses the new JDBCPerfTestCase class.
Contributed by Sunitha Kambhampati ksunithaghm@gmail.com
------------------------------------------------------------------------
r469576 | djd | 2006-10-31 09:35:54 -0800 (Tue, 31 Oct 2006) | 1 line

DERBY-1987 (partial) Add build.xml files to hook order entry classes into build system.
------------------------------------------------------------------------
r469573 | djd | 2006-10-31 09:26:18 -0800 (Tue, 31 Oct 2006) | 2 lines

DERBY-1994 Add the interfaces to execute the business transactions and display the results for the order entry toolkit.

------------------------------------------------------------------------
r469572 | djd | 2006-10-31 09:23:16 -0800 (Tue, 31 Oct 2006) | 2 lines

DERBY-1994 (partial) Add the base POJO classes for the data objects in order entry test toolkit.

------------------------------------------------------------------------
r469567 | djd | 2006-10-31 09:18:43 -0800 (Tue, 31 Oct 2006) | 3 lines

DERBY-1970 Add JDBCPerfTestCase as initial step in adding performance tests to Derby's testing.
Contributed by Sunitha Kambhampati ksunithaghm@gmail.com

------------------------------------------------------------------------
r469410 | kahatlen | 2006-10-31 00:28:26 -0800 (Tue, 31 Oct 2006) | 6 lines

DERBY-1991: Misleading stack traces for exceptions raised by the JDBC
4.0 embedded driver

Don't set the stack trace of the SQLException to the stack trace of
the dummy exception in SQLExceptionFactory40.

------------------------------------------------------------------------
r469272 | djd | 2006-10-30 12:54:52 -0800 (Mon, 30 Oct 2006) | 2 lines

Remove the SQL tests moved to JUnit LangScripts from derbylang.

------------------------------------------------------------------------
r469215 | djd | 2006-10-30 10:12:15 -0800 (Mon, 30 Oct 2006) | 2 lines

Move a set of language SQL scripts from the old harness (derbylang suite) to the JUnit test LangScripts.
Tests moved are: aggbuiltin, comparisons, delete, insert, schemas, select, stringtypes, update, valuesclause, views.
------------------------------------------------------------------------
r469128 | kahatlen | 2006-10-30 03:45:56 -0800 (Mon, 30 Oct 2006) | 4 lines

DERBY-1979: Convert jdbcapi/characterStreams.java to JUnit

Patch contributed by Fernanda Pizzorno.

------------------------------------------------------------------------
r469102 | bernt | 2006-10-30 01:34:06 -0800 (Mon, 30 Oct 2006) | 1 line

DERBY-1953 Test changes. MODE DB2SQL removed from most tests
------------------------------------------------------------------------
r468803 | djd | 2006-10-28 18:34:56 -0700 (Sat, 28 Oct 2006) | 4 lines

DERBY-2007 Add a convenience method in DatabasePropertyTestSetup that returns a decorator
that sets up BUILTIN authentication with the passed in list of users. Use this for the NIST
test as seemed to be the intention under the old harness. Remove the remaining harness properties
files for the nist suite.
------------------------------------------------------------------------
r468696 | bpendleton | 2006-10-28 09:15:09 -0700 (Sat, 28 Oct 2006) | 9 lines

DERBY-2008: NPE with 2-arg SUBSTR call in GROUP BY clause

This patch was contributed by Yip Ng (yipng168@gmail.com)

For SUBSTR function, there can be 2 or 3 arguments, and in the
case of 2-args, the rightOperand of the TernaryOperatorNode will
be null. In its isEquivalent() method, it did not take care of
this case; thus, the NPE.

------------------------------------------------------------------------
r468605 | bpendleton | 2006-10-27 18:00:44 -0700 (Fri, 27 Oct 2006) | 18 lines

DERBY-1758: Enable xmlSuite to run as part of derbyall for qualified JVMs

This patch was contributed by A B (qozinx@gmail.com)

I'm attaching another patch, d1758_followup_v1.patch, that moves the XML
utility methods out of junit.JDBC and into a new class, junit.XML, per Dan's
suggestion (thanks Dan).

Note that I changed the "haveClass()" method in JDBC.java from private to
protected so that it can be called from the junit.XML class.  That was the
easiest thing to do. 

Since checking the classpath is not a JDBC-specific operation, the other
option is to move "haveClass()" to some other class in the junit package.  If
anyone indicates a preference for doing so and also indicates the class to
which the method should be moved, I can do it this way.  Otherwise I'll just
leave it as it is (i.e. keep it in JDBC.java and make it protected).

------------------------------------------------------------------------
r468563 | djd | 2006-10-27 15:24:42 -0700 (Fri, 27 Oct 2006) | 2 lines

DERBY-1930 Apply corrections noted in comments by Dag H. Wanvik in DERBY-1930.

------------------------------------------------------------------------
r468561 | djd | 2006-10-27 15:19:54 -0700 (Fri, 27 Oct 2006) | 3 lines

DERBY-1930 (partial) Initial addition of information from JDBC paper on the web-site
onto the JDBC package.html page for Derby's published Javadoc.

------------------------------------------------------------------------
r468553 | djd | 2006-10-27 14:52:38 -0700 (Fri, 27 Oct 2006) | 2 lines

DERBY-2007 (partial) Remove old properties files used by old harness for the NIST suite.

------------------------------------------------------------------------
r468517 | djd | 2006-10-27 13:09:00 -0700 (Fri, 27 Oct 2006) | 2 lines

DERBY-2007 (partial) Update readme to reflect switch to JUnit for NIST suite.

------------------------------------------------------------------------
r468514 | djd | 2006-10-27 13:04:21 -0700 (Fri, 27 Oct 2006) | 4 lines

DERBY-2007 (partial) Switch NIST suite over to Junit. Removed from old harness suites and added NistScripts
into lang._Suite. Added constraint names to various DDL statements in the nist SQL scripts to produce
constant output. Modify the .out files to match the output under JUnit, including not removing blank lines.
Still cleanup to do including modifying the readme to reflect changes.
------------------------------------------------------------------------
r468503 | bpendleton | 2006-10-27 12:17:28 -0700 (Fri, 27 Oct 2006) | 34 lines

DERBY-1758: Enable xmlSuite to run as part of derbyall for qualified JVMs

This patch was contributed by A B (qozinx@gmail.com)

This patch adds two JUnit tests to lang/_Suite.java. The first test,
XMLTypeAndOpsTest.java, is meant to be a JUnit equivalent to the current
lang/xml_general.sql test. The second test, XMLMissingClassesTest,
tests the behavior of the SQL/XML operators when the required JAXP
or Xalan classes are not in the classpath.

The XML classes can be provided in any of a number of ways:
1) bundled into the JVM
2) installed as endorsed libraries
3) specified in the classpath
Hand-testing was performed to ensure that the new JUnit tests perform
correctly in these various configurations.

If the tests are run in an environment which does not support the XML
features, the tests quietly do nothing.

The patch, d1758_newJUnitTests_v2.patch, also adds a new utility method
and some associated state to JDBC.java for checking two things:
1) that the classpath has JAXP and Xalan classes, and
2) if the classpath has Xalan, check that the version of Xalan meets
the minimum requirement for use of Derby SQL/XML operators.
These methods/flags are then used to determine when to run the new
XML JUnit tests.

NOTE: After this patch has been reviewed/updated and finally committed
I will post a separate patch to remove the old lang/xml_general.sql test
and the corresponding master files. I will then continue addressing the
rest of the tasks for this issue (esp. xmlBinding.java) in incremental fashion.


------------------------------------------------------------------------
r468502 | djd | 2006-10-27 12:06:19 -0700 (Fri, 27 Oct 2006) | 3 lines

DERBY-2007 (partial) Improve CleanDatabaseTestSetup to handle tables in a dependency loop due
to foreign key constraints and simple cases for objects that are dependent across schemas.

------------------------------------------------------------------------
r468448 | djd | 2006-10-27 09:40:08 -0700 (Fri, 27 Oct 2006) | 3 lines

DERBY-2007 (partial) Add setting the lock timeouts for the Nist scripts to match the behaviour under the old harness.
NistScripts is still a work in  progress.

------------------------------------------------------------------------
r468447 | djd | 2006-10-27 09:34:24 -0700 (Fri, 27 Oct 2006) | 5 lines

DERBY-2007 (partial) The dropping of tables in CleanDatabaseTestSetup needs to be smarter for
the nist suite since it has tables that depend on each other. This is an incremental change
that copes with tables in the same schema depending on each other except when two tables
reference each other.

------------------------------------------------------------------------
r468296 | kahatlen | 2006-10-26 23:36:03 -0700 (Thu, 26 Oct 2006) | 26 lines

DERBY-1989: Convert jdbc4/TestDbMetaData.java to JUnit

The new TestDbMetaData tests everything the old one did, except for
the constants in JDBC40Translation. All but one of them are already
tested in JDBC40TranslationTest, and the patch adds the missing one to
that test.

The patch also makes a couple of small changes in junit/JDBC.java:

  * assertColumnNames:
      - declare it as "throws SQLException" instead of "throws
        Exception"
      - changed order in call to Assert.assertEquals() so that errors
        are not shown with expected/actual mixed up.

  * assertRowInResultSet:
      - since a result set can contain values that vary slightly from
        time to time (for instance, identifiers which contain
        timestamps), one needs a way to accept different values for a
        column. With a small change (only changing the order of a call
        to equals()), it was possible to give assertRowInResultSet()
        an object whose equals() method returned true for all
        acceptable values. This makes it possible to use
        assertRowInResultSet() where the old harness used sed scripts
        to filter out varying values.

------------------------------------------------------------------------
r468209 | djd | 2006-10-26 17:31:25 -0700 (Thu, 26 Oct 2006) | 2 lines

DERBY-2003 Add a utility method to allow setting the lock timeouts as a decorator building off DatabasePropertyTestSetup.
Use this decorator in BlobClob4Blob to reduce the wait time.
------------------------------------------------------------------------
r468102 | rhillegas | 2006-10-26 12:36:44 -0700 (Thu, 26 Oct 2006) | 1 line

DERBY-1377: Remove copyright headers from nist sql scripts and canons.
------------------------------------------------------------------------
r468067 | djd | 2006-10-26 10:19:21 -0700 (Thu, 26 Oct 2006) | 3 lines

DERBY-1952 (partial) Change CanonTestCase to not ignore blank lines in the output. The skipping of blank lines in
the old harness was probably due to the use of sed. Skipping blank lines makes it harder to create a new master
file from the output.
------------------------------------------------------------------------
r468046 | djd | 2006-10-26 08:50:47 -0700 (Thu, 26 Oct 2006) | 2 lines

DERBY-1952 (partial) Remove the SQL lang tests from the old harness that are run by the JUnit test LangScripts.

------------------------------------------------------------------------
r467793 | rhillegas | 2006-10-25 15:25:46 -0700 (Wed, 25 Oct 2006) | 1 line

DERBY-1377: Add copyright headers to sql test scripts. Adjust canons accordingly.
------------------------------------------------------------------------
r467755 | djd | 2006-10-25 13:45:18 -0700 (Wed, 25 Oct 2006) | 2 lines

Add test suite names to NistScripts (which is still under development).

------------------------------------------------------------------------
r467612 | kahatlen | 2006-10-25 04:52:05 -0700 (Wed, 25 Oct 2006) | 5 lines

DERBY-815: Prevent unneeded object creation and excessive decoding in
parseSQLDTA_work()

Patch contributed by Dyre Tjeldvoll.

------------------------------------------------------------------------
r467578 | kahatlen | 2006-10-25 00:44:55 -0700 (Wed, 25 Oct 2006) | 4 lines

DERBY-912: OutOfMemory error on continuous execution of SQL statement

Reuse free sort identifiers.

------------------------------------------------------------------------
r467522 | davidvc | 2006-10-24 17:19:57 -0700 (Tue, 24 Oct 2006) | 2 lines

Fixed to point to the correct download site for JUnit 3.8.1

------------------------------------------------------------------------
r467474 | djd | 2006-10-24 13:45:07 -0700 (Tue, 24 Oct 2006) | 1 line

DERBY-1995 (partial) Add SQL scripts to create tables, primary key and foreign key constraints for order entry testkit.
------------------------------------------------------------------------
r467473 | djd | 2006-10-24 13:45:03 -0700 (Tue, 24 Oct 2006) | 1 line

DERBY-1995 (partial) Add SQL scripts to create tables, primary key and foreign key constraints for order entry testkit.
------------------------------------------------------------------------
r467309 | tmnk | 2006-10-24 04:20:47 -0700 (Tue, 24 Oct 2006) | 1 line

- DERBY-1990 Make writeEncryptedScalarStream and writePlainScalarStream methods in org.apache.derby.client.net.Request as private - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r466940 | kahatlen | 2006-10-22 23:39:18 -0700 (Sun, 22 Oct 2006) | 2 lines

DERBY-1988: Convert jdbc4/TestJDBC40Exception.java to JUnit

------------------------------------------------------------------------
r466390 | kahatlen | 2006-10-21 05:42:38 -0700 (Sat, 21 Oct 2006) | 2 lines

Removed outdated comment. There are no RowId classes in the Derby code.

------------------------------------------------------------------------
r466279 | suresht | 2006-10-20 15:22:24 -0700 (Fri, 20 Oct 2006) | 8 lines

DERBY-1925 : (Add re-encrytion  of database test cases to the upgrade test.)

Merged fix (r452682) from 10.2 branch to trunk. 

This patch adds test cases to the upgrade test to test encryption of an
un-encrypted database and re-encryption of encrypted database.


------------------------------------------------------------------------
r466221 | suresht | 2006-10-20 11:07:36 -0700 (Fri, 20 Oct 2006) | 14 lines

DERBY-1240 ( creating /restoring a db from backup using createFrom with log at 
             different location copies the log from backup to the db dir also).

Problem was restore code in the RawStore was copying all the files that does 
not exist in the database directory after the restore was completed by the 
data factory and log factory boot methods. Because the log is placed at
different location when an external log location is specified, the log
directory does not exist in the database directory. In this case code in the 
RawStore was incorrectly copying log files also because the log directory does 
not exist in the database directory. This patch fixes the problem by restoring
only the files that are not restored by the other factories. Currently, they
are jar files in the database and backup history file.
 

------------------------------------------------------------------------
r465935 | djd | 2006-10-19 16:34:10 -0700 (Thu, 19 Oct 2006) | 1 line

DERBY-1976 Improvements in the utility JUnit JDBC methods.
------------------------------------------------------------------------
r465694 | kahatlen | 2006-10-19 10:48:44 -0700 (Thu, 19 Oct 2006) | 4 lines

DERBY-1962: Convert jdbcapi/resultsetJdbc30.java to junit

Patch contributed by Fernanda Pizzorno.

------------------------------------------------------------------------
r465673 | djd | 2006-10-19 09:34:22 -0700 (Thu, 19 Oct 2006) | 1 line

DERBY-1976 New & modified utility methods for JDBC JUnit tests to aid conversions of SQL script tests.
------------------------------------------------------------------------
r465601 | kahatlen | 2006-10-19 05:16:12 -0700 (Thu, 19 Oct 2006) | 4 lines

DERBY-1895: Convert jdbcapi/blobclob4BLOB.java to JUnit

Patch contributed by Fernanda Pizzorno.

------------------------------------------------------------------------
r465249 | tmnk | 2006-10-18 06:47:19 -0700 (Wed, 18 Oct 2006) | 1 line

- DERBY-1535 Trial 2 for DERBY-550, improve use of Engine from NetworkServer and reduce memory usage - Replacing call of setByte() to call of setBinaryInputStream(), which was room to improvement in DERBY-1559. - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r465122 | bpendleton | 2006-10-17 18:43:14 -0700 (Tue, 17 Oct 2006) | 41 lines

DERBY-1967: UNION (ALL) constraint violation problem

This patch was contributed by Yip Ng (yipng168@gmail.com)

In the bind phase of ConditionalNode (NULLIF), the CAST node is
generated on top of the untyped NULL and it gets the data type
descriptor(DTD) of the left operand. However, the CAST node should
have DTD where its value can be nullable.

BinaryComparisonOperatorNode bcon = (BinaryComparisonOperatorNode)testCondition;

QueryTreeNode cast = getNodeFactory().getNode(
C_NodeTypes.CAST_NODE,
thenElseList.elementAt(0),
bcon.getLeftOperand().getTypeServices(), <=== not nullable!
getContextManager());

The second query:

select nullif('x','x') as f0, f1 from a
   union all
   select nullif('x','x') as f0, nullif(1,1) as f1 from b;

works because it didn't generate a NormalizedResultSet on top of
the PRN on the right hand side of the union since the datatype and
length matches. So it didn't hit the path where it does additional
checking at execution time.

For the first query:

select nullif('x','x') as f0, f1 from a
   union all
   select nullif('x','x') as f0, nullif('x','x') as f1 from b;

The union result column's length does not match with the right hand
side result column, so it generated a NormalizedResultSet on top of
the RHS of the union. When the system retrieves the row from
NormalizedResultSet at execution time, the normalize method is called
on the DTD and checks if the source is NULL and whether its DTD
is not nullable. In this case, the SQLSTATE 23502 is thrown. 

------------------------------------------------------------------------
r465020 | djd | 2006-10-17 12:55:53 -0700 (Tue, 17 Oct 2006) | 3 lines

DERBY-1897 Removed the load of DataSourcePropertiesTest from jdbcapi._Suite for J2ME
by requiring that JDBC 3 be supported for that test.

------------------------------------------------------------------------
r464999 | djd | 2006-10-17 11:45:55 -0700 (Tue, 17 Oct 2006) | 3 lines

DERBY-1952 (partial) DERBY-1971 (partial) Change more of the tests run from jdbcapi._Suite to return suites
that run in embedded and client as primary configurations. Name some of the TestSuites returned from TestConfiguration
to make the hierarchy view in the Swing Test Runner more useful.
------------------------------------------------------------------------
r464970 | suresht | 2006-10-17 10:32:03 -0700 (Tue, 17 Oct 2006) | 11 lines

DERBY-1953 (Make FOR EACH clause and MODE DB2SQL in CREATE TRIGGER 
           statement optional)

Patch Contributed by Yip Ng.

This patch makes the FOR EACH clause optional in CREATE TRIGGER
statement. Since the changes are mainly in the trigger definition of
sqlgrammar.jj file and to make this backward compatibile with previous 
releasesof Derby, I also addressed DERBY-1770, Make MODE DB2SQL optional.


------------------------------------------------------------------------
r464785 | djd | 2006-10-16 20:48:49 -0700 (Mon, 16 Oct 2006) | 4 lines

DERBY-1952 (partial) Add some utility methods in TestConfiguration to allow test classes to easily implement
suite() methods that run in embedded and/or client server.
Convert some tests to use these utility methods. Change NetworkServerTestSetup to create a server console
output file in the logs folder in append mode.
------------------------------------------------------------------------
r464644 | djd | 2006-10-16 12:56:01 -0700 (Mon, 16 Oct 2006) | 2 lines

DERBY-1952 (partial) Remove the _Suite tests from the old harness suites in order to allow faster
conversion of them to Junit suites that run successfully in standalone mode.
------------------------------------------------------------------------
r464610 | djd | 2006-10-16 11:24:53 -0700 (Mon, 16 Oct 2006) | 3 lines

DERBY-1791 Setup the policy file and security manager setup so that the system property
derbyTesting.testjarpath describes the file location of derbyTesting.jar so that ij
can be given permission to read its contents. This is to access the SQL scripts within the resource.
------------------------------------------------------------------------
r464607 | djd | 2006-10-16 11:19:53 -0700 (Mon, 16 Oct 2006) | 4 lines

DERBY-1952 (partial) Setup methods in TestConfiguration to allow tests' suite() methods to add tests that
run in the client/server configuration. Change TimeHandlingTest and LangScripts to use these methods
so that by themselves they run embedded and network server tests.
Remove the Client and Embedded top-level suites as that choice is now driven into a test itself.
------------------------------------------------------------------------
r464592 | djd | 2006-10-16 11:00:47 -0700 (Mon, 16 Oct 2006) | 1 line

Remove unused import from CleanDatabaseTestSetup
------------------------------------------------------------------------
r464551 | bpendleton | 2006-10-16 09:32:50 -0700 (Mon, 16 Oct 2006) | 22 lines

DERBY-737: SYSCS_UTIL.SYSCS_COMPRESS_TABLE should create statistics

This patch was contributed by Mamta A. Satoor (msatoor@gmail.com)

The changes have been very localized in
AlterTableConstantAction.java!updateIndex(). Currently, this method checks
if statistics already exist for an index. If yes, then it sets a flag
updateStatistics to true. Later, the code checks for this flag and drops
the existing statistics and creates new statistics for that index provided
the user table at this point is not empty. So, as we can see, if there is
an index with no preexisting statistics, the flag updateStatistics will be
set to false and hence no statistics related code is executed and hence
even though the user table is not empty at the time of compress, no
statistics get generated for such an index.

I am proposing to fix the problem by still using the flag to see if
an index has pre-existing statistics. If yes, then we should drop
those statistics. Next, whether the index has pre-existing statistics or
not, go ahead and create new statistics for the index provided the
user table is not currently empty.


------------------------------------------------------------------------
r464504 | bernt | 2006-10-16 07:16:43 -0700 (Mon, 16 Oct 2006) | 1 line

DERBY-1893 Convert largedata/lobLengthTests.java to junit. Comitted by ?\195?\152ystein Gr?\195?\184vlen
------------------------------------------------------------------------
r464215 | bpendleton | 2006-10-15 08:35:27 -0700 (Sun, 15 Oct 2006) | 28 lines

DERBY-630: CREATE TRIGGER fails with null pointer exception

This patch was contributed by Yip Ng (yipng168@gmail.com)

The current implementation for CREATE TRIGGER needs to handle null compilation
schema. A compilation schema with null value indicates that the
trigger action statement text does not depend on the current schema. This means:

1. It is safe to compile this statement in any schema since there is no dependency with
    the CURRENT SCHEMA. i.e.: All relevent fields are qualified with a specific schema.

2. The statement cache mechanism can utilize this piece of information to enable
    better statement plan sharing across different schemas; thus, avoiding unnecessary
    statement compilation.

 
So the proposal is:

a) Allow null compilation schema. The system catalog first needs to change the
   compiliation schema id column of SYS.SYSSTATEMENTS and SYS.SYSVIEWS system
   table's nullability to true. This would also require a soft upgrade for the
   previous versions of Derby. This step will resolve the NPE problem of this jira.

b) Handle null compilation schema in statement preparation logic. This can be filed
   as a separate jira as improvement. It may require some work on the SQL parser to
   determine whether the compiled statement depends on the CURRENT SCHEMA or not, so
   that the compilation schema can be properly set. 

------------------------------------------------------------------------
r464202 | tmnk | 2006-10-15 07:36:41 -0700 (Sun, 15 Oct 2006) | 1 line

- DERBY-1942 There exists difference between behavior of setNull(Types.TIME) and setTiime(null) - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r464078 | bpendleton | 2006-10-14 17:29:29 -0700 (Sat, 14 Oct 2006) | 11 lines

DERBY-183: Allow unnamed parameters in CREATE FUNCTION

This patch was contributed by James F. Adams (derby@xemaps.com)

The lookahead in the grammar of my previous patches did not work for some
parameter types. I have reworked the lookahead to use syntactic lookahead
similar to that used elsewhere in the grammar. I have included an additional
test that would have failed with the previous patch. I have run the
lang/functions.sql and lang/procedure.java using the various frameworks
without error.

------------------------------------------------------------------------
r463982 | bpendleton | 2006-10-14 10:00:54 -0700 (Sat, 14 Oct 2006) | 47 lines

DERBY-183: Allow unnamed parameters in CREATE FUNCTION

This patch was contributed by James F. Adams (derby@xemaps.com)

The patch does the following:

1) Modifies java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj
    a) Initializes parameterName to "" in procedureParameterDefinition
       and functionParameterDefinition
    b) Makes parameterName optional in procedureParameterDefinition
       and functionParameterDefinition

2) Modifies java/engine/org/apache/derby/impl/sql/compile/CreateAliasNode.java
   to ignore function and procedure parameter names equal to "" when
   checking for duplicate parameter names. 

Tests have been added to lang/functions.sql and lang/procedure.java. 

The parameter name is made optional by surrounding its production with [].

This changes the grammar from:

parameterName = identifier(Limits.MAX_IDENTIFIER_LENGTH, true)
  typeDescriptor = dataTypeDDL()

to:

        [ parameterName = identifier(Limits.MAX_IDENTIFIER_LENGTH, true) ]
        typeDescriptor = dataTypeDDL()

This results in a choice conflict because certain tokens satisfy both
identifier() and dataTypeDDL(). An additional token of lookahead resolves
this conflict. This results in:

        [ LOOKAHEAD(2) parameterName = identifier(Limits.MAX_IDENTIFIER_LENGTH, true) ]
        typeDescriptor = dataTypeDDL()

Expressing this in an alternate form such as:

        (
                parameterName = identifier(Limits.MAX_IDENTIFIER_LENGTH, true)
                typeDescriptor = dataTypeDDL()
        ) | typeDescriptor = dataTypeDDL()

still results in a choice conflict so I opted for the more compact form.


------------------------------------------------------------------------
r463565 | kahatlen | 2006-10-12 22:55:18 -0700 (Thu, 12 Oct 2006) | 7 lines

DERBY-1956: Remove stale code from the statement classes in the client driver

The patch removes escapedProcedureCallWithResult_ and all code that is
only executed when the flag is true. It also removes a couple of
methods that became no-ops, and SQLStates and messages that are never
used.

------------------------------------------------------------------------
r462784 | kahatlen | 2006-10-11 05:07:24 -0700 (Wed, 11 Oct 2006) | 23 lines

DERBY-1610: Resolve difference of type compatibility between Embedded
and NetworkServer/NetworkDriver

Fixed failures in the JDBC 4.0 tests. Description of the patch:

  * Check for unsupported types before checking incompatibilities
    since JDBC 4.0 specifies that SQLFeatureNotSupportedException
    should be raised for certain types if they are unsupported.

  * Change timing of calls to checkForClosedStatement() to make
    ClosedObjectTest get the expected SQLState when the statement is
    closed.

  * Add type checking to the JDBC 4.0 length-less blob/clob overloads.

  * Since the type checking already checks for closed statement and
    invalid parameter index, remove those tests from
    checkSetterPreconditions(). Since the only code that is left in
    checkSetterPreconditions() after the removal of those checks is a
    call to checkForEscapedCallWithResult(), replace all calls to
    checkSetterPreconditions() with calls to
    checkForEscapedCallWithResult().

------------------------------------------------------------------------
r462607 | mikem | 2006-10-10 15:23:45 -0700 (Tue, 10 Oct 2006) | 15 lines

DERBY-1785
contributed by Myrna van Lunteren
patch: DERBY-1785_20061007.diff

Attaching a band-aid patch for this issue. I chose to comment out the method 
rather than remove as a way to document the quirky behavior.

Having the method setSecurityProps overload the one in jvm.java causes 
problems when running the junit tests - they *do* successfully run with 
securityManager.
Foundation class tests actually run ok with security manager - except when 
useprocess is false. This is caused by a bug in the jvm. See also DERBY-885.



------------------------------------------------------------------------
r462556 | mikem | 2006-10-10 13:52:49 -0700 (Tue, 10 Oct 2006) | 8 lines

DERBY-1829
contributed by Myrna van Lunteren

Skipping this test with foundation...Triggers are not officially supported with that jvm.

This patch should also go into 10.2.


------------------------------------------------------------------------
r454623 | mikem | 2006-10-09 22:40:37 -0700 (Mon, 09 Oct 2006) | 6 lines

DERBY-1939

Bug was already fixed in trunk, merging added tests and new sanity
check from 10.1 codeline to trunk.


------------------------------------------------------------------------
r454312 | tmnk | 2006-10-09 01:54:58 -0700 (Mon, 09 Oct 2006) | 1 line

- DERBY-1610 Resolve difference of type compatibility between Embedded and NetworkServer/NetworkDriver - adjust index for parameter using checkForEscapedCallWithResult method. - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r454269 | davidvc | 2006-10-08 21:02:59 -0700 (Sun, 08 Oct 2006) | 2 lines

Fixed days of week, should only be seven days.

------------------------------------------------------------------------
r454098 | tmnk | 2006-10-08 00:41:08 -0700 (Sun, 08 Oct 2006) | 1 line

- DERBY-1610 Resolve difference of type compatibility between Embedded and NetworkServer/NetworkDriver - Fix to resolve error in jdk13 test of compatibility suite - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r454069 | fuzzylogic | 2006-10-07 20:52:56 -0700 (Sat, 07 Oct 2006) | 5 lines

DERBY-1941: Include derbyrun.jar in list of jars needed in the classpath for
testing in java/testing/README.htm

Committed for James F. Adams <derby@xemaps.com>

------------------------------------------------------------------------
r453935 | mikem | 2006-10-07 08:33:24 -0700 (Sat, 07 Oct 2006) | 32 lines

DERBY-1716
contributed by Yip Ng
patch: derby1716-trunk-diff03.txt

Unlike other descriptors, when privilege(s) get revoked from user,
the statement is not subject to recompilation, so then we are back to square one
since the previous patch attempts to bring in the permission descriptor(s) into
the permission cache at compilation time to avoid reading from system tables at
execution time.

I believe the proper proposal fix is to use internal nested read-only transaction
when the system is reading permission descriptors from the system tables. At a
high level, a statement undergoes the following typical steps for it to get executed
by the system:

1. Statement Compilation Phase
a) Parse the statement
b) Bind the statement and collects required permissions for it to be executed.
c) Optimize the statement
d) Generate the activation for the statement


2. Statement Execution Phase
a) Check if the authoration id has the required privileges to execute the statement.
b) Execute the statement


The problem lies in permissions checking step at statement execution phase. Before a statement can be executed in SQL authorization mode, the authorization id's privileges needs to be check against the permission cache or if the privileges are not available in the cache, the system needs to read this metadata information from the system tables. But the system is using *user transaction* to do this, so the shared locks that got acquired by the user transaction may not get released immediately; therefore, leading to lock timeout when the grantor attempts to revoke the user's privilege. To resolve this issue, the system now will start an internal read-only nested transaction(same lock space as the parent transaction) to read permission related info from the system tables and release the shared locks
as soon as the permissions check is completed before statement execution. This tackles the root of the stated problem. 



------------------------------------------------------------------------
r453922 | tmnk | 2006-10-07 07:54:57 -0700 (Sat, 07 Oct 2006) | 1 line

- DERBY-1610 Resolve difference of type compatibility between Embedded and NetworkServer/NetworkDriver - Updated missed 2 master files. - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r453913 | rhillegas | 2006-10-07 07:14:19 -0700 (Sat, 07 Oct 2006) | 1 line

DERBY-1940: Remove Ease of Development to conform to recent changes to the JDBC4 api.
------------------------------------------------------------------------
r453886 | tmnk | 2006-10-07 04:24:06 -0700 (Sat, 07 Oct 2006) | 1 line

- DERBY-1610 Resolve difference of type compatibility between Embedded and NetworkServer/NetworkDriver - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r453845 | davidvc | 2006-10-06 21:59:28 -0700 (Fri, 06 Oct 2006) | 2 lines

DERBY-1936 - LocalCalendar Sample Application

------------------------------------------------------------------------
r453655 | rhillegas | 2006-10-06 09:09:14 -0700 (Fri, 06 Oct 2006) | 1 line

DERBY-1921: Bring STATUS file uptodate with recent release of 10.2.1.6.
------------------------------------------------------------------------
r453420 | bpendleton | 2006-10-05 16:11:32 -0700 (Thu, 05 Oct 2006) | 33 lines

DERBY-1489: Provide ALTER TABLE DROP COLUMN functionality

This patch provides support for ALTER TABLE t DROP COLUMN c.

The patch modifies the SQL parser so that it supports statements of the form:

  ALTER TABLE t DROP [COLUMN] c [CASCADE|RESTRICT]

If you don't specify CASCADE or RESTRICT, the default is CASCADE.

If you specify RESTRICT, then the column drop will be rejected if it would
cause a dependent view, trigger, check constraint, unique constraint,
foreign key constraint, or primary key constraint to become invalid.

Currently, column privileges are not properly adjusted when dropping a
column. This is bug DERBY-1909, and for now we simply reject DROP COLUMN
if it is specified when sqlAuthorization is true. When DERBY-1909 is fixed,
the tests in altertableDropColumn.sql should be merged into altertable.sql,
and altertableDropColumn.sql (and .out) should be removed.

This new feature is currently undocumented. DERBY-1926 tracks the documentation
changes necessary to document this feature.

The execution logic for ALTER TABLE DROP COLUMN is in AlterTableConstantAction,
and was not substantially modified by this change. The primary changes to
that existing code were:
 -  to hook RESTRICT processing up to the dependency manager so that
    dependent view processing was sensitive to whether the user
    had specified CASCADE or RESTRICT
 -  to reread the table descriptor from the catalogs after dropping all the
    dependent schema objects and before compressing the table, so that the
    proper scheman information was used during the compress.

------------------------------------------------------------------------
r453395 | djd | 2006-10-05 14:40:18 -0700 (Thu, 05 Oct 2006) | 6 lines

DERBY-1732 1. Make change to GenericStatementContext.isLastHandler() so it will return false for JVM errors thus
allowing the outer contexts to take corrective action.
2. Store transaction context treats JVM errors as session severity. To ensure consistency,
map severity for non StandardException instances to be SESSION_SEVERITY in GenericLanguageContext,
and GenericStatementContext.
Patch contributed by  Sunitha Kambhampati ksunithaghm@gmail.com
------------------------------------------------------------------------
r453352 | mikem | 2006-10-05 13:15:41 -0700 (Thu, 05 Oct 2006) | 11 lines

DERBY-1847
contributed by Mamta Satoor
patch: DERBY1846_V1_diff_AddColumnAndGrantRevoke.txt

 To recap the problem, in SQL Authorization mode, when a new column is added to a table, the rows in SYSCOLPERMS for the table in question were not getting updated to incorporate the new column. This caused ASSERT failure when a non-table owner attempted to select the new column. 

 Some background information on system table involved: SYSCOLPERMS keeps track of column level privileges on a given table. One of the columns in SYSCOLPERMS is "COLUMNS" and it has a bit map to show which columns have the given permission granted on them. When a new column is added to the user table, the "COLUMNS" need to be expanded by one bit and that bit should be initialized to zero since no privileges have been granted on that column at the ALTER TABLE...ADD COLUMN time. 

 I have fixed this problem by having AlterTableConstantAction.addNewColumnToTable call the new method in DataDictionary called updateSYSCOLPERMSforAddColumnToUserTable. At this point, we know of only the TableDescriptor's uuid which can help us determine all the rows in SYSCOLPERMS for that given table uuid. I get ColPermsDescriptor for each one of those rows and then use the ColPermsDescriptor's uuid to update the "COLUMNS" column so SYSCOLPERMS is aware of the newly added column in user table. This fixes the problem because at the time of SELECT, when we do privilege lookup in SYSCOLPERMS, we have info on the newly added column. 


------------------------------------------------------------------------
r452983 | kahatlen | 2006-10-04 12:13:47 -0700 (Wed, 04 Oct 2006) | 4 lines

DERBY-1889: Convert jdbcapi/lobStreams.java to JUnit

Removed unused master file.

------------------------------------------------------------------------
r452832 | kahatlen | 2006-10-04 04:02:21 -0700 (Wed, 04 Oct 2006) | 10 lines

DERBY-1910: OutOfMemoryError happens when jdbcapi/_Suite.junit was
executed as DerbyNetClient (in jvm1.4.2)

The problem was being caused by some of the tests that kept a
reference to a connection object which prevented this object from
being garbage collected. The attached patch (derby-1910.diff) fixes
that problem.

Patch contributed by Fernanda Pizzorno.

------------------------------------------------------------------------
r452609 | rhillegas | 2006-10-03 13:36:30 -0700 (Tue, 03 Oct 2006) | 1 line

DERBY-1921: Miscellaneous improvements to the STATUS file.
------------------------------------------------------------------------
r452259 | mikem | 2006-10-02 16:23:04 -0700 (Mon, 02 Oct 2006) | 9 lines

DERBY-1894
contributed by Yip Ng
patch: derby1894-trunk-diff02.txt

The fix is in FromBaseTable's getFromTableByName() method, where it is using 
the resolved synonym table name to do the binding for ORDER BY column. 
Patch includes additional tests.


------------------------------------------------------------------------
r451704 | fuzzylogic | 2006-09-30 18:05:01 -0700 (Sat, 30 Sep 2006) | 2 lines

DERBY-1900: Force execute bit on scripts, attempt number 2.

------------------------------------------------------------------------
r451548 | fuzzylogic | 2006-09-29 23:24:00 -0700 (Fri, 29 Sep 2006) | 2 lines

Add toursdb.xml and toursdb_readme.html to -src distribution.

------------------------------------------------------------------------
r451466 | fuzzylogic | 2006-09-29 14:47:08 -0700 (Fri, 29 Sep 2006) | 2 lines

DERBY-1900: Force filemode on files in -bin to have execute bit.

------------------------------------------------------------------------
r451432 | rhillegas | 2006-09-29 14:01:26 -0700 (Fri, 29 Sep 2006) | 1 line

DERBY-1885: Remove spurious derby.logs from the source distributions.
------------------------------------------------------------------------
r451363 | rhillegas | 2006-09-29 10:53:49 -0700 (Fri, 29 Sep 2006) | 1 line

DERBY-1899: Fix the release generation problems which Andrew found in the source distributions.
------------------------------------------------------------------------
r451255 | kahatlen | 2006-09-29 05:06:36 -0700 (Fri, 29 Sep 2006) | 4 lines

DERBY-1889: Convert jdbcapi/lobStreams.java to JUnit

Patch contributed by Fernanda Pizzorno.

------------------------------------------------------------------------
r451147 | bernt | 2006-09-29 00:48:47 -0700 (Fri, 29 Sep 2006) | 1 line

DERBY-729 Scalar time and date functions return 0 instead NULL when argument is NULL. Submitted by Bernt M. Johnsen
------------------------------------------------------------------------
r451065 | fuzzylogic | 2006-09-28 17:01:16 -0700 (Thu, 28 Sep 2006) | 2 lines

DERBY-1593: Fix paths for test jars inside of lib-debug distribution.

------------------------------------------------------------------------
r450950 | djd | 2006-09-28 11:06:46 -0700 (Thu, 28 Sep 2006) | 1 line

Minor cleanup of query tree ConstantNodes, removing some unused code.
------------------------------------------------------------------------
r450738 | fuzzylogic | 2006-09-28 00:41:58 -0700 (Thu, 28 Sep 2006) | 4 lines

DERBY-1844: Sed out exception diff in blobclob4BLOB.java

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r450736 | fuzzylogic | 2006-09-28 00:39:13 -0700 (Thu, 28 Sep 2006) | 4 lines

DERBY-1841: Update lang/groupBy.sql masters for j9.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r450687 | fuzzylogic | 2006-09-27 21:32:41 -0700 (Wed, 27 Sep 2006) | 4 lines

DERBY-1891: Fix XN002 to have correct codepoint name: SECTKN

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r450681 | fuzzylogic | 2006-09-27 21:17:46 -0700 (Wed, 27 Sep 2006) | 4 lines

DERBY-1874: update largeDataTests/LobLimits master for new exception names.

Committed for Kristian Waagan <Kristian.Waagan@sun.com>

------------------------------------------------------------------------
r450607 | djd | 2006-09-27 15:33:06 -0700 (Wed, 27 Sep 2006) | 3 lines

DERBY-1879 Save the EmbedResultSetMetaData object and the case-insensitive column name map in the ResultDescription object
and not EmbedResultSet. This means these objects are created once per compiled plan (as needed) and not once per
EmbedResultSet (as needed). This improves the performance by reducing the overhead for simple queries (DERBY-1876).
------------------------------------------------------------------------
r450508 | mikem | 2006-09-27 10:10:56 -0700 (Wed, 27 Sep 2006) | 18 lines

DERBY-1878
contributed by Sunitha Kambhampati
patch: derby1878.diff.txt 

 I am attaching the patch (derby1878.diff.txt) to improve some error handling in some of the network server tests.

 1.The execCmdDumpResults used by the five tests timeslice.java,maxthreads.java,testij.java,runtimeinfo.java,sysinfo.java suffer from the same problems that was fixed for testProperties.java namely
 -- the outputstream for the sub process's is not flushed out
 -- there is no timeout handling for the ProcessStreamResult
 2.Eliminate duplication of code in these 5 tests for execCmdDumpResults(String[] args) method. The execCmdDumpResults method basically exec's a new process and then waits for the process to dump the results. A new utility class - ExecProcUtil is added with execCmdDumpResults that is generalized to take the necessary input from the tests as well as fixes the issues mentioned in #1. The OutputStream is flushed out by calling bos.flush and System.out.flush and the timeout is added for ProcessStreamResult.
 3.Make use of the TimedProcess to kill process if process does not exit within the timeout period.
 4.TestConnection.java test has some variation of the execCmdDumpResults and it also adds some testcases into this method. Hence this method in this test is left as is and timeout handling is added.
 5.testij.out has been updated. The previous master file was eating away the last line that was written to System.out, but now that the process's streams are flushed properly, the last line in testij.out test which prints out 'End test'
 is also seen in the output file.

 Also noticed that these tests - like timeslice.java, maxthreads.java all seem to set the properties for the server and then check if the property is set. The functionality of the server when these properties is set is not being tested. It will be good to add tests that test that the functionality itself is working as expected or not. Please note, recently connecting to server with timeslice options discovered some issues with server (see DERBY-1856). 


------------------------------------------------------------------------
r450155 | mikem | 2006-09-26 12:19:40 -0700 (Tue, 26 Sep 2006) | 23 lines

DERBY-1866
contributed by Army Brown
patch: d1866_v1.patch

Attaching a first patch for this issue, d1866_v1.patch. In short, the problem was that, when pushing predicates to subqueries beneath UNIONs, the predicates were always being pushed to the *first* table in the subquery's FROM list, regardless of whether or not that was actually the correct table. Thus it was possible to push a predicate down to a base table to which it didn't apply, thereby leading to an assertion failure in sane mode and an index out of bounds exception in insane mode.

For details on how this occurred and what the fix is, please refer to the code comments in the patch. The d1866_v1 patch does the following:

1. Adds logic to ensure scoped predicates are only pushed
to the appropriate base tables.

2. Adds one line to OptimizerImpl to solve the hang that
was occuring for the second query shown in repro.sql.
The problem there was just that one variable was not
being properly reset when beginning a new round of
optimization.

3. Adds some test cases to verify the changes for #1 and
#2.

Note that the patch is mostly just explanatory comments for existing and new logic, plus the test cases.


------------------------------------------------------------------------
r450129 | mikem | 2006-09-26 10:53:46 -0700 (Tue, 26 Sep 2006) | 5 lines

DERBY-1890

Fixed gramatical error in XSDFI message.


------------------------------------------------------------------------
r450060 | rhillegas | 2006-09-26 07:25:45 -0700 (Tue, 26 Sep 2006) | 1 line

DERBY-1529: Move LICENSE and NOTICE files to the customary place in an Apache plugin.
------------------------------------------------------------------------
r449930 | kahatlen | 2006-09-25 23:55:54 -0700 (Mon, 25 Sep 2006) | 5 lines

DERBY-1883: I18N tests fail on Linux/JVM 1.4.2 when derbyclient.jar is
the first element of the classpath

Grant derbyclient.jar permission to read derby.* properties.

------------------------------------------------------------------------
r449869 | mikem | 2006-09-25 17:10:45 -0700 (Mon, 25 Sep 2006) | 8 lines

DERBY-1858
contributed by Yip Ng
patch: derby1858-trunk-diff02.txt

Fixes problem that DropSchemaNode's bind phase did not add the required schema 
privilege for it to check at runtime.


------------------------------------------------------------------------
r449695 | rhillegas | 2006-09-25 07:53:49 -0700 (Mon, 25 Sep 2006) | 1 line

DERBY-1886: Remove junit.jar from source distributions.
------------------------------------------------------------------------
r449671 | kahatlen | 2006-09-25 05:58:35 -0700 (Mon, 25 Sep 2006) | 17 lines

DERBY-1751: derbynet/testSecMec.java fails with ShutdownException in
DerbyNetClient framework

The attached patch avoids the problem seen in this issue by setting
the console output of the network server to a file. This change in
made to the following files:

* functionTests/tests/jdbc4/TestConnectionMethods.java
* functionTests/tests/derbynet/testSecMec.java
* functionTests/tests/derbynet/dataSourcePermissions_net.java
* junit/NetworkServerTestSetup.java

It also changes DRDAProtocolException so that agent Errors will be
printed to the network server console instead of System.out.

Contributed by Fernanda Pizzorno.

------------------------------------------------------------------------
r449616 | kahatlen | 2006-09-25 02:14:54 -0700 (Mon, 25 Sep 2006) | 5 lines

DERBY-1326: Network server may abandon sessions when Derby system is
shutdown and this causes intermittent hangs in the client

Added JUnit test case which reliably reproduces the hang.

------------------------------------------------------------------------
r449326 | rhillegas | 2006-09-23 15:57:13 -0700 (Sat, 23 Sep 2006) | 1 line

DERBY-1529: Add LICENSE and NOTICE file to Eclipse core plugin zip.
------------------------------------------------------------------------
r449116 | mikem | 2006-09-22 15:36:20 -0700 (Fri, 22 Sep 2006) | 4 lines

DERBY-1830
missed new file VTITest.java in last commit.


------------------------------------------------------------------------
r449114 | mikem | 2006-09-22 15:29:28 -0700 (Fri, 22 Sep 2006) | 12 lines

DERBY-1830
contributed by Sunitha Kambhampati

The testcase added for derby-1660 in optimizerOverrides.sql uses jdbc:default:connection and does not work with wctme5.7 foundation causing the diff mentioned in this jira. This testcase needs to be excluded and should run only in environments that have support for DriverManager.

This patch (derby1830.diff.txt) converts this particular testcase into a junit test.

1. Add a new Junit test in lang suite - VTITest.java
2. Conditionally add the test fixture bulkInsertVtiTest if JDBC.vmSupportsJDBC2() is true.
3. Since the problematic testcase is converted to junit test, remove this test from optimizerOverrides.sql and update the master files for embedded and server frameworks.


------------------------------------------------------------------------
r448949 | djd | 2006-09-22 07:44:55 -0700 (Fri, 22 Sep 2006) | 2 lines

DERBY-1862 Patch makes a map of column names to column number. The map is populated when the first call to findColumn is made.
Patch contributed by Andreas Korneliussen andreas.korneliussen@sun.com 
------------------------------------------------------------------------
r448948 | djd | 2006-09-22 07:30:53 -0700 (Fri, 22 Sep 2006) | 2 lines

Minor cleanup in EmbedResultSet.java, code to set warning in constructor can use the addWarning() method
rather than repeating code.
------------------------------------------------------------------------
r448900 | kahatlen | 2006-09-22 05:18:15 -0700 (Fri, 22 Sep 2006) | 4 lines

DERBY-1826: Add JUnit utility methods for database/server shutdown

Patch contributed by Deepa Remesh.

------------------------------------------------------------------------
r448833 | kahatlen | 2006-09-21 23:33:15 -0700 (Thu, 21 Sep 2006) | 2 lines

DERBY-1834: Updated master file for jdk16.

------------------------------------------------------------------------
r448758 | suresht | 2006-09-21 17:59:49 -0700 (Thu, 21 Sep 2006) | 16 lines

DERBY-1854 (SYSCS_COMPRESS_TABLE corrupts table with a single column which is both a primary key and a foreign key)

Problem was all the conglomerate descriptor entries in sys.sysconglomerates
were not getting updated with new conglomerate number generated for an index 
during compress/bulk-insert, when an index is shared. Update code was assuming 
conglomerate id is common when an index is shared, but that is not correct. 
ConglomerateID's in sys.sysconglomerates are unique. 

This patch modifies the update conglomerate descriptor code to update each
conglomerate descriptor separately using conglomerateID as the key, when
there are more than one conglomerate descriptor referring to the same 
conglomerate(conglomerate number). 

This patch also adds a test-case to test import into a table that has the same column as a primary key and foreign key,  import was also causing corruption because of the same problem.  See DERBY-1641 , for details. 


------------------------------------------------------------------------
r448691 | mikem | 2006-09-21 14:24:25 -0700 (Thu, 21 Sep 2006) | 9 lines

DERBY-1776
contributed by Army Brown
patch:  d1776_reuseInt.patch

In a review comment for a different issue someone mentioned that instead of creating new Integer() objects it'd be better to use the Derby ReuseFactory where possible to avoid excessive object creation. I get the feeling that's not a big deal with the _v1 patch for this issue, but I nonetheless thought it'd be a good idea to follow that advice with the changes.

So I'm attaching a tiny patch, d1776_reuseInt.patch, that replaces the calls to "new Integer()" in the _v1 patch (which has already been committed) with calls to ReuseFactory.getInteger(). Functionally, the patch doesn't change anything. 


------------------------------------------------------------------------
r448617 | fuzzylogic | 2006-09-21 11:05:52 -0700 (Thu, 21 Sep 2006) | 3 lines

DERBY-1846: Double up the backslashes for tr. Tested on bash and
tcsh on both Mac OS X and Linux, as well as Cygwin and MKS on Windows.

------------------------------------------------------------------------
r448472 | kahatlen | 2006-09-20 23:12:23 -0700 (Wed, 20 Sep 2006) | 2 lines

Fix javadoc warnings caused by non-ascii characters.

------------------------------------------------------------------------
r448465 | kahatlen | 2006-09-20 22:37:44 -0700 (Wed, 20 Sep 2006) | 2 lines

Fix javadoc warning.

------------------------------------------------------------------------
r448456 | djd | 2006-09-20 21:28:14 -0700 (Wed, 20 Sep 2006) | 2 lines

DERBY-1811 Ensure embedded ResultSet.getTimestamp on a TIME column returns a java.sql.Timestamp with a date portion
equal to the current date at the time the getTimestamp method is called.
------------------------------------------------------------------------
r448424 | mikem | 2006-09-20 18:24:25 -0700 (Wed, 20 Sep 2006) | 7 lines

DERBY-1787
contributed by Mamta Satoor
patch: DERBY1787_UseCorrectTerminologyV1diff.txt

Grant revoke functionality was added in Derby 10.2 The comments that went into the grant revoke code, in some places refer to database owner as "dba". They are not the same thing. In the grant revoke world, dba is a role. We haven't added roles into Derby yet but current use of dba in comments might make it confusing when we do start working on roles including dba.


------------------------------------------------------------------------
r448338 | djd | 2006-09-20 13:56:54 -0700 (Wed, 20 Sep 2006) | 2 lines

DERBY-1700 Cleanup some remaining comments that referred to closeCleanup parameters and
a parameter reference in the unused class MergeJoinResultSet.
------------------------------------------------------------------------
r448286 | djd | 2006-09-20 11:24:25 -0700 (Wed, 20 Sep 2006) | 9 lines

DERBY-1700 Next step that changes the methods in ResultSetFactory not to have a closeCleanup method parameter
which due to the previous patches was always being passed in as null. Changed all callers to not pass the null
and thus remove the closeMethodArgument in ResultSetNode.
Since most of the calls are to ResultSetFactory methods are by generated code cannot rely on compile time checks
to ensure all callers are correct. Needed to reduced the argument count by one for the generated method call for
any getXXXResultSet that no longer passes the closeCleanup (null) argument. Have confidence in the change as derbyall
passes and the code coverage numbers at http://wiki.apache.org/db-derby/CodeCoverage show complete coverage of these
factory methods except for ones related to VTIs.

------------------------------------------------------------------------
r448258 | mikem | 2006-09-20 09:35:09 -0700 (Wed, 20 Sep 2006) | 19 lines

DERBY-1775
contributed by Army Brown
committing  d1775_v2.patch

Attaching a patch that does the following:

1. Updates the 2200M message text to be more generic,
as suggested in the description of this issue.

2. Replaces "see next exception" with the in-lined
error message while continuing to do exception
chaining as usual.

3. Also replaces "see next exception" with in-line
error messages for a couple of other SQL/XML
errors--namely UNEXPECTED_XML_ERROR and
XML_QUERY_ERROR. 


------------------------------------------------------------------------
r448133 | kahatlen | 2006-09-20 02:17:38 -0700 (Wed, 20 Sep 2006) | 5 lines

DERBY-1869: lang/timestampArith.java fails if it starts right before midnight

If it is less than two minutes until midnight, wait until after
midnight before running the test.

------------------------------------------------------------------------
r448101 | mikem | 2006-09-20 00:05:01 -0700 (Wed, 20 Sep 2006) | 5 lines

DERBY-1834

master updates for previous error message change.


------------------------------------------------------------------------
r448085 | suresht | 2006-09-19 23:14:29 -0700 (Tue, 19 Sep 2006) | 12 lines

DERBY-1718 ( creating an after insert trigger with trigger action involving 
xml datatype throws java.io.NottSerializableException)

Patch contributed by Yip Ng.

The fix basically implements the Formatable interface for SqlXmlUtil class. 
Currently, it writes out the query expression string instead of the XPath 
object(its serializable I think), and then later recompiles the query once 
at evaluation time. The reason behind this is that I don't want the stored 
form to be tied to a particular XML implementation.


------------------------------------------------------------------------
r448048 | mikem | 2006-09-19 20:45:55 -0700 (Tue, 19 Sep 2006) | 10 lines

DERBY-1772
contributed by Army Brown

Attaching the simplest patch possible for this issue--just changes SQLSTATE '42Z78' to a Derby-specific SQLSTATE, 'XML00'. I also moved SQLSTATE '42Z7Z' to 'XML01' since I believe it falls into the same category of "Derby-specific errors that are not covered by the SQLStandard."

I read through the SQL standard definitions for SQLSTATES and none of them jumped out at me as being more appropriate than '42', so I just created a new set of SQLSTATEs, "XMLxx", for this particular issue. As I said, this was just the easiest way to go; if anyone can suggest a better SQLSTATE to fit the errors, please let me know. Otherwise, the d1772_v1.patch should be all it takes to resolve this issue.

Note: Since we don't currently have any tests for cases where the classpath is missing the required Xalan/JAXP classes, there were no test/master files to update. The need to add tests for such scenarios is filed as part of DERBY-1758. 


------------------------------------------------------------------------
r448034 | mikem | 2006-09-19 19:40:57 -0700 (Tue, 19 Sep 2006) | 31 lines

DERBY-1766
contributed by Army Brown

Well, after that paragraph of justification, it turns out that there are only three places where we use the 42Z79 SQLSTATE. But still, I think it's a useful error message and should be kept around; it could come in handy further down the road if SQL/XML functionality is expanded.

As for line/column numbers, it turns out that those values are readily available from within sqlgrammar.jj and thus can easily be passed as part of the error message. The only potential downside that I can see is that we have to create an Integer object out of the line/col numbers in order to pass them to the StandardException constructor...but maybe that's not a big deal...? The fact that no one has done this earlier makes me wonder if there's some "gotcha" here that I'm missing, but I haven't seen any problems with it just yet...

Attaching a patch d1776_v1.patch that changes the error message for 42Z79 as mentioned in my previous comment and also does the following:

1. Adds line and column numbers to the error message to indicate where
the missing keyword is expected.

2. Removes one "lookahead" call that was causing 42Z79 to be raised
for a missing "AS" keyword when in fact the keyword was present
(what was missing was the datatype). To avoid confusion, I
removed the lookahead and now the user will see a more generic
42X01 error in that particular case.

3. Updated xml_general master files accordingly.

So with this patch applied, instead of:

select xmlserialize(x) from t;
ERROR 42Z72: XML syntax error; missing keyword(s): 'AS'.

we'll now see:

create table t (i int, x xml);
ERROR 42Z72: Missing SQL/XML keyword(s) 'AS' at line 1, column 22. 


------------------------------------------------------------------------
r448026 | bpendleton | 2006-09-19 18:34:21 -0700 (Tue, 19 Sep 2006) | 11 lines

DERBY-1304: DROP VIEW does not always completely remove view

This patch was contributed by Yip Ng (yipng168@gmail.com)

The problem is that DROP VIEW's binding logic is using its superclass
QueryTreeNode's bind() method which just simply returns the object itself.
So there is no actual binding done in DROP VIEW at all! It should have
created a dependency on the statement, so when its associated descriptor
gets dropped, the statement can be invalidated accordingly. This explains
why the second DROP VIEW fails since it is not invalidated by the system.

------------------------------------------------------------------------
r448003 | fuzzylogic | 2006-09-19 15:44:02 -0700 (Tue, 19 Sep 2006) | 2 lines

Add missed files from DERBY-1547 checkin

------------------------------------------------------------------------
r447970 | fuzzylogic | 2006-09-19 14:02:49 -0700 (Tue, 19 Sep 2006) | 4 lines

DERBY-1846: update-with-jdbc4 scripts need to patch up modules.properties
Many other minor fixes and tweaks to the scripts to get them working in
different environments.

------------------------------------------------------------------------
r447922 | fuzzylogic | 2006-09-19 10:35:37 -0700 (Tue, 19 Sep 2006) | 5 lines

DERBY-1547: Include build number in DatabaseMetaData getDatabaseProductVersion
and getDriverVersion calls.

Committed for V. Narayanan <V.Narayanan@sun.com>

------------------------------------------------------------------------
r447877 | bpendleton | 2006-09-19 08:16:00 -0700 (Tue, 19 Sep 2006) | 11 lines

DERBY-147: ERROR 42x79 if specify same column twice and use ORDER BY

This patch contributed by Bernd Ruehlicke (apache@priwall.org)

This patch changes the getOrderByColumn method in ResultColumnList so that
it uses ResultColumn.isEquivalent to determine whether the column specified
in the ORDER BY clause is ambiguous or not. It is ok to select the ORDER BY
column multiple times, so long as all the occurrences are equivalent. If there
is an ambiguity, the statement is rejected and the user must reword it to
clarify which column is to be used for ordering the results.

------------------------------------------------------------------------
r447856 | kahatlen | 2006-09-19 07:24:45 -0700 (Tue, 19 Sep 2006) | 5 lines

DERBY-801 (partial) Allow parallel access to data files

Backing out the patch for DERBY-733 as it is not needed anymore and
the code is cleaner without it.

------------------------------------------------------------------------
r447815 | kahatlen | 2006-09-19 03:58:03 -0700 (Tue, 19 Sep 2006) | 8 lines

DERBY-801 (partial) Allow parallel access to data files

Adding RAFContainer4 which is used instead of RAFContainer on jdk1.4
and higher. RAFContainer4 uses FileChannels to access the data files,
and therefore multiple threads may access them in parallel.

Patch contributed by Anders Morken.

------------------------------------------------------------------------
r447736 | mikem | 2006-09-18 22:12:33 -0700 (Mon, 18 Sep 2006) | 27 lines

DERBY-1694
contributed by Sunitha Kambhampati

I was looking at the testProperties issue that caused problems because of test hang. The test doesnt hang in my environment but I thought I would look to see why the test didnt timeout.

I found couple of issues here:
0. The testProperties.java and several networkserver tests exec new processes to start server, test properties,shutdown server etc. In some cases, we wait to capture the output from the subprocess that is started. ProcessStreamResult is used for this purpose. ProcessStreamResult is part of the harness (see org.apache.derbyTesting.functionTests.harness.ProcessStreamResult) and it starts a thread to read data from the process's stream and writes it out. Once EOS (-1) is reached, the thread exits after doing a notifyAll.

1. ProcessStreamResult.Wait() does not work with the timeout case. I think the original intention of the method that takes the timeout was to force the thread to stop, once the timeout period has elapsed. The method Wait() does not handle this case.
2. On timeout, the myThread needs to stop its work. The run() method does not handle this case.
3. testProperties test does not make use of the ProcessStreamResult timeout mechanism.
4. Process's are exec'd in the tests and they are not destroyed within a timeout period. The network server tests start server using Process, and then cleanup by shutting them down. It will all work ok, if no deadlock or blocking of process's occur. It seems to me though, that we should have a way to destroy the processes that are
started as part of each test given a timeout period. Each test must learn to do the cleanup when it leaves and the test has knowledge of all the sub-processes that it has exec'd. The current test harness has a class TimedProcess which could work.

In the spirit of incremental development, I am attaching a patch(derby1694.p2.diff.txt and corresponding stat file - derby1694.p2.stat.txt) that fixes problems 1,2 and 3. I think #4 can be handled as a separate issue/patch.

This patch
-- fixes the timeout handling in ProcessStreamResult. Instance variable 'interrupted' is a flag to indicate if a timeout has occurred or if the thread's work has been interrupted in between. The flag 'finished' indicates whether the work has been finished by the thread. Changes are in Wait() method to make use of wait(timeoutms) if a timeout is specified in ProcessStreamResult. If timeout time has elapsed, then the interrupted flag is set to true.
-- Adds condition in the run() method to check if interrupted is true. If so, the thread will stop its work and leave.
-- correctly return if the thread's work was interrupted either because of a timeout or if it was interrupted.
-- Make use of the ProcessStreamResult with a timeout setting of 2 minutes in testProperties test. Note, the timeout handling only comes into effect when ProcessStreamResult.Wait() method is called.

other notes:
-- when you run a test, the suite property for timeout does not get picked up. I think this is intentional behavior.
-- Issues mentioned above are not specific to just testProperties but exist for other networkserver tests. There are a total of 7 files in derbynet that make use of this.


------------------------------------------------------------------------
r447644 | bpendleton | 2006-09-18 16:53:11 -0700 (Mon, 18 Sep 2006) | 14 lines

DERBY-1589: CREATE TABLE throws NPE after DROPs and REVOKEs

FKConstraintDefinitionNode, which is the compiler implementation code
for the "foreign key ... references ... " constraint in the compiler,
is not properly registering that the statement containing the
foreign key constraint has a dependency on the table being referenced. Due
to the lack of the dependency, when the referenced table (t11ConstraintTest)
is dropped, the statement is not invalidated. 

This patch changes the compiler so that it creates a dependency from
a statement with a FOREIGN KEY clause in it to the table which is
referenced by that clause. The patch also contains a simple regression
test, based on the original bug.

------------------------------------------------------------------------
r447502 | fuzzylogic | 2006-09-18 11:59:06 -0700 (Mon, 18 Sep 2006) | 3 lines

DERBY-1588: Fix links in demo.html to point to the local copy of the 
documentation instead of the Derby website.

------------------------------------------------------------------------
r447469 | mikem | 2006-09-18 09:54:06 -0700 (Mon, 18 Sep 2006) | 33 lines

DERBY-1784
contributed by Yip Ng

 
After studying the
compiler code abit more, I found that DML statements such as INSERT, UPDATE and DELETE also suffer from the same problem (they use different bind logic)

With that said, this patch attempts to address all the stated problems above
when column reference is qualified with a synonym table name.

The fundamental problem is that Derby does not keep the original unbound table 
name around once the synonym is resolved. So the fix is to address this case 
and apply the qualification properly.

In the VIEW resolution case, the system needs to preserve the synonym name as 
VIEW gets expanded to a subquery, the name to be set should be the exposed 
name of the table and not the resolved table name.

For * expansion in the SELECT list, if the FROM clause happens to be a synonym, 
the system should prepend it with the unbound name and not the resolved table 
name. This way the binding logic is normalized.

For DML cases, the synonym name needs to be normalized to its base table so that
setColumnDescriptor can apply correctly. When the system binds the expression 
for this result column, it will resolve this properly since the column binding 
logic are in the respective FromTable subclasses implementation where they 
will use the exposed name this time to check for qualification.

I wrote more testcases for synonym.sql but I found out that this SQL file is 
actually not part of derbylang suite, so the patch added this back to the test 
bucket. 


------------------------------------------------------------------------
r447462 | kahatlen | 2006-09-18 09:35:25 -0700 (Mon, 18 Sep 2006) | 5 lines

DERBY-1326: Network server may abandon sessions when Derby system is
shutdown and this causes intermittent hangs in the client

Re-enable shutdown in checkDataSource test.

------------------------------------------------------------------------
r447375 | kahatlen | 2006-09-18 04:41:37 -0700 (Mon, 18 Sep 2006) | 7 lines

DERBY-1326 (partial) Network server may abandon sessions when Derby
system is shutdown and this causes intermittent hangs in the client

Don't poison the network server's worker threads when an engine
shutdown is detected. Poisoning the threads could lead to abandoning
of sessions and hangs in the client.

------------------------------------------------------------------------
r447212 | mikem | 2006-09-17 20:25:34 -0700 (Sun, 17 Sep 2006) | 49 lines

DERBY-1706
contributed by Mamta Satoor

This fix addresses the null pointer reported in DERBY-1706.

SESSION schema is a special schema which is used for global temporary tables. 
In order to handle global temporary table, Derby creates a in-memory SESSION 
schema descriptor which does not have any uuid associated with it. A physical 
SESSION schema(with it's uuid set properly) will be created *only* if there is
a persistent object created in it by a user. Global temporary tables can only 
reside in SESSION schema and Derby documentation recommends that SESSION schema
should not be used for other persistent objects. This is because the same 
object name could be referencing different objects within SESSION schema 
depending on in what order they got created.

For instance
create table session.t1(c11 int);
-- the following select will get data from the persistent table t1 in SESSION schema
select * from session.t1;
declare global temporary table session.t1(c11 int, c12 int) on commit delete rows not logged;
-- the following select this time will return data from the temporary table t1 rather than persistent table t1
-- This is because, at any time, if there is a global temporary table by the table referenced by a statement,
-- then Derby will always pick up the global temporary table. If no global temporary table by that name is
-- found, then Derby will look for persistent table in SESSION schema. If none found, then error will be thrown
select * from session.t1;
-- following will drop the temporary table t1 and not the persistent table t1
drop table session.t1;
-- the following select will get data from the persistent table t1 in SESSION schema because temporary table
-- doesn't exist anymore
select * from session.t1;

So, as can be seen from the example above, the statements referencing SESSION schema objects could have different meanings depending on what kind of objects exist in SESSION schema. Because of this, the compiled plans of statements referencing SESSION schema are not saved in the statement cache, rather they get compiled everytime they are executed. In order to enforce this, in the compilation phase, Derby checks if the statement at hand is referencing a SESSION schema object by calling referencesSessionSchema method. If this method returns true, the statement's compiled plan will not be saved in the statement cache.

Now, taking the script provided by Yip which results in NPE
set schema session;
create table t1 (i int);

Derby calls referencesSessionSchema while compiling "create table t1 (i int); " to see if it references SESSION schema object. Since, there is no schema associated with the table t1, Derby will check for the compilation schema which in this case is SESSION schema because we used "set schema session; ". (This happens in QueryTreeNode.getSchemaDescriptor(String schemaName, boolean raiseError) line 1486). The method
then tries to call an equal method on the UUID associated with the SESSION schema descriptor but since it is null(because no physical SESSION schema has been created yet), we end up with a null pointer exception. This will happen only if no physical SESSION schema has been created yet and user tries to create a first persistent object inside SESSION schema after doing a set schema session.

Following will not give a NPE because user hand created SESSION schema before doing set schema SESSION and creating an object inside it.
create schema session;
set schema session;
create table t1 (i int);
The hand creation of SESSION schema causes Derby to have a schema descriptor for SESSION schema with it's uuid set correctly.

The fix for the NPE is simple and that is to check if the UUID is null.


------------------------------------------------------------------------
r447011 | mikem | 2006-09-16 20:57:05 -0700 (Sat, 16 Sep 2006) | 32 lines

DERBY-1707
contributed by       Mamta A. Satoor

Basically, FromBaseTable.verifyProperties method had following if condition

if (constraintSpecified)
{
    ConglomerateDescriptor cd =
    dDictionary.getConglomerateDescriptor(
    consDesc.getConglomerateId());
    String indexName = cd.getConglomerateName();
    tableProperties.remove("constraint");
    tableProperties.put("index", indexName);
}


The if condition above did not do null check for consDesc. In Sunitha's case, 
her sql statement looked as follows 
SELECT * FROM t1 --DERBY-PROPERTIES constraint=null;
When null value is supplied for constraint property, consDesc will be null and the code inside the if condition above should not be executed. I changed the if condition above as follows
if (constraintSpecified && consDesc != null)
and now constraint=nulll does not result in null pointer exception. I added a 
test case for this in lang/optimizerOverrides.sql and noticed that 
constraint=null resulted in an index scan. There is already a test which 
checks for index=null and that property results in a table scan. This behavior 
seems to be in line with the documentation in Tuning Derby Guide for 10.2 
(section name Overriding the default optimizer behavior) which says that if 
null is specified for property index, a table scan will be performed on the 
table. It does not say anything about a table scan for constraint=null
                                      


------------------------------------------------------------------------
r446924 | rhillegas | 2006-09-16 12:27:53 -0700 (Sat, 16 Sep 2006) | 1 line

DERBY-1777: Commit Army's d1777_v2.patch, cleaning up an NPE in the optimizer.
------------------------------------------------------------------------
r446789 | mikem | 2006-09-15 16:54:19 -0700 (Fri, 15 Sep 2006) | 6 lines

DERBY-1736
contributed by Yip Ng, yipng168@gmail.com

Addtional grant and revoke tests developed during the 10.2 buddy testing.


------------------------------------------------------------------------
r446672 | rhillegas | 2006-09-15 11:17:40 -0700 (Fri, 15 Sep 2006) | 1 line

DERBY-1853: Template for bundled release notes, plus release machinery for bundling.
------------------------------------------------------------------------
r446652 | mikem | 2006-09-15 09:41:24 -0700 (Fri, 15 Sep 2006) | 10 lines

DERBY-1729
contributed by Yip Ng, yipng168@gmail.com

Adding a jdk16 specific master.  This is an issue with exception handling in 
jdk16. Reported as DERBY-1629. To temporarily resolve the regression test 
failure a jdk, a jdk16 specific master is being added.  This was what was done 
for procedureInTrigger test.



------------------------------------------------------------------------
r446538 | kahatlen | 2006-09-15 00:52:18 -0700 (Fri, 15 Sep 2006) | 13 lines

DERBY-1326 (partial) Network server may abandon sessions when Derby
system is shutdown and this causes intermittent hangs in the client

Two small cleanups:

  Make NetworkServerControlImpl.startNetworkServer() remove the
  sessions it closes from sessionTable. Also, synchronize on runQueue
  to prevent modifications while the queue is traversed.

  Invoke closeSession() and close() in a finally clause in
  DRDAConnThread.handleException() to ensure proper closing of the
  session when an unexpected error happens.

------------------------------------------------------------------------
r446536 | fuzzylogic | 2006-09-15 00:34:39 -0700 (Fri, 15 Sep 2006) | 4 lines

DERBY-1665 (partial): fix formatting of javadoc for iapi.store.access.Qualifier.
The content of the javadoc for this class needs a review to address the other
comments in this JIRA issue.

------------------------------------------------------------------------
r446527 | fuzzylogic | 2006-09-14 22:56:49 -0700 (Thu, 14 Sep 2006) | 2 lines

DERBY-1741: Remove cloudscape references from toolsmessages files.

------------------------------------------------------------------------
r443169 | fuzzylogic | 2006-09-13 16:45:04 -0700 (Wed, 13 Sep 2006) | 3 lines

DERBY-1846: Trim off the carriage return of each line of the list files.
The files need to be CRLF to be read properly on Windows.

------------------------------------------------------------------------
r443167 | fuzzylogic | 2006-09-13 16:38:49 -0700 (Wed, 13 Sep 2006) | 4 lines

DERBY-1846: Add a script that allows users to easily update their Derby jars
with the JDBC4 classes. Also a minor edit to derby_common.sh which prevents
a warning on Linux.

------------------------------------------------------------------------
r443076 | fuzzylogic | 2006-09-13 12:03:03 -0700 (Wed, 13 Sep 2006) | 2 lines

Minor fix to detect MKS before running `expr index` which can output error text.

------------------------------------------------------------------------
r443038 | suresht | 2006-09-13 10:25:56 -0700 (Wed, 13 Sep 2006) | 25 lines


DERBY-1618: (store/BootAllTest.junit fails on with jdk13 based jvms)

Patch Contributed by Myrna van Lunteren.

On jdk131, in the situation invoked by the testSettingBootAllPropertyWithHomePropertySet() 
test in BootAllTest.java, when the DriverPropertyInfo.choices were accessed.
the problem was because in BaseMonitor.java there were no elements found resulting from
provider.getBootTimeServices(). 

underlying real issue was  database directory was not getting set to the
correct path in the storage factory (DirStorageFactory.java), when all the 
database are loaded (derby.system.bootAll=true) and system home is set. 

This patch correctly sets the database directory in the storage factory, in the
above mentioed scenario.  

Modified the test lang/GetPropertyInfoTest.java to access the choices,
description, and required fields, but it didn't actually duplicate the problem
in BootAllTest.java. But as that's in that test I thought it was unnecessary to
add more.




------------------------------------------------------------------------
r442958 | kahatlen | 2006-09-13 05:23:34 -0700 (Wed, 13 Sep 2006) | 5 lines

DERBY-1833: Remove messages made unused by implementation of DERBY-690
and DERBY-775

Patch contributed by Dag H. Wanvik.

------------------------------------------------------------------------
r442761 | fuzzylogic | 2006-09-12 17:04:40 -0700 (Tue, 12 Sep 2006) | 4 lines

Minor javadoc fix for iapi/types/XML.java

Committed for Army Brown <qozinx@gmail.com>

------------------------------------------------------------------------
r442737 | fuzzylogic | 2006-09-12 15:23:16 -0700 (Tue, 12 Sep 2006) | 3 lines

Set svn:eol-style on shell scripts to LF and batch files to CRLF to prevent
accidental switch of the line endings. Fix command in stopNetworkServer

------------------------------------------------------------------------
r442677 | fuzzylogic | 2006-09-12 12:20:55 -0700 (Tue, 12 Sep 2006) | 3 lines

Unset svn:eol-style on batch files so that they have the correct line endings
if the distributions are built on Linux.

------------------------------------------------------------------------
r442674 | fuzzylogic | 2006-09-12 12:00:58 -0700 (Tue, 12 Sep 2006) | 2 lines

DERBY-1032: Allow new scripts to run on MKS.

------------------------------------------------------------------------
r442647 | suresht | 2006-09-12 10:25:10 -0700 (Tue, 12 Sep 2006) | 20 lines

DERBY-1786 (a crash during re-encryption may cause an unrecoverable db)

The problem was when transaction log spans more than one log file during (re)
encryption of the database and if there is a crash just before switching the
database to use the new encryption properties; On recovery checkpoint in the
first log file is used as reference and the next log file is assumed to have
the commit log record for (re) encryption and deleted incorrectly to force the
roll-back , which lead to the incomplete rollback of re-encryption. And that
caused recovery failures on next (re) encryption crashed. 

This patch fixes the problem by ensuring there a checkpoint record in the
last log file before creating a new log file with new encryption properties
and writing the commit log record. Log is also flushed before making the
transaction log use the new encryption key to avoid any part of old log 
records in the buffers getting encrypted with the new encryption key. 
While working on this problem , I noticed error message thrown incase of 
re-encryption failures are confusing, added a new error message to indicate 
failures specific to (re) encryption. 


------------------------------------------------------------------------
r442646 | fuzzylogic | 2006-09-12 10:03:01 -0700 (Tue, 12 Sep 2006) | 2 lines

DERBY-1843: Pass arguments to derby_common.bat for processing.

------------------------------------------------------------------------
r442490 | kahatlen | 2006-09-11 23:55:44 -0700 (Mon, 11 Sep 2006) | 9 lines

DERBY-803: derbynet/DerbyNetAutoStart.java test fails intermittently
with org.apache.derby.iapi.services.context.ShutdownException

Let the test wait between closing client connections and shutting down
the engine. This way, the server threads get time to close the
connections cleanly before the engine is taken down.

Patch contributed by Fernanda Pizzorno.

------------------------------------------------------------------------
r442464 | kahatlen | 2006-09-11 22:59:34 -0700 (Mon, 11 Sep 2006) | 7 lines

DERBY-1832: sysinfo test fails with "access denied
(java.util.PropertyPermission java.class.path read)" when
derbyclient.jar is first in classpath

Grant derbyclient.jar privileges needed for sysinfo and
sysinfo_withproperties.

------------------------------------------------------------------------
r442463 | kahatlen | 2006-09-11 22:57:41 -0700 (Mon, 11 Sep 2006) | 9 lines

DERBY-1817: Race condition in network server's thread pool

Clean-up of NetworkServerControlImpl:
  - moves generation of connection number into addSession()
  - adds new method removeThread() which can be used instead of
    getThreadList().remove()
  - removes methods that are no longer used
  - makes methods that are only used by NetworkServerControlImpl private

------------------------------------------------------------------------
r442462 | kahatlen | 2006-09-11 22:55:31 -0700 (Mon, 11 Sep 2006) | 5 lines

DERBY-1817: Race condition in network server's thread pool

Reduce the amount of code synchronized on runQueue in
NetworkServerControlImpl.addSession().

------------------------------------------------------------------------
r442199 | andreask | 2006-09-11 05:48:11 -0700 (Mon, 11 Sep 2006) | 1 line

DERBY-1691 blobclob4BLOB.java fails under DerbyNet framework. Fixed by printing stack traces to stdout. Contributed by Oystein.Grovlen@sun.com
------------------------------------------------------------------------
r441802 | kahatlen | 2006-09-09 08:50:02 -0700 (Sat, 09 Sep 2006) | 14 lines

DERBY-1817: Race condition in network server's thread pool

Instead of always putting new sessions in the run queue when there are
free threads, the network server now compares the number of free
threads and the size of the run queue. This is done to prevent the run
queue from growing to a size greater than the number of free
threads. Also, the server now synchronizes on runQueue until the
session has been added to the queue. This is to prevent two threads
from deciding that there are enough free threads and adding the
session to the run queue, when there in fact only were enough free
threads for one of them. With this patch, I am not able to reproduce
DERBY-1757 on platforms where the failure was easily reproduced
before.

------------------------------------------------------------------------
r441789 | kahatlen | 2006-09-09 07:38:54 -0700 (Sat, 09 Sep 2006) | 2 lines

DERBY-1767: Made UpdatableResultSetTest run as part of _Suite.

------------------------------------------------------------------------
r441779 | kahatlen | 2006-09-09 04:26:03 -0700 (Sat, 09 Sep 2006) | 5 lines

DERBY-1675: Network Server should not send to client that it supports
EUSRIDPWD when running against Sun JVM

Updating comments. Patch contributed by Sunitha Kambhampati.

------------------------------------------------------------------------
r441740 | bpendleton | 2006-09-08 21:40:56 -0700 (Fri, 08 Sep 2006) | 29 lines

DERBY-1759: XMLSERIALIZE doesn't follow spec when serializing sequence

This patch was contributed by Army Brown (qozinx@gmail.com)

The patch does the following:

  1. Adds logic to SqlXmlUtil.serializeToString() to perform the
     steps of "sequence normalization" as required by XML serialization
     rules. This includes throwing an error if the user attempts to
     explicitly serialize a sequence that contains one or more top-level
     attribute nodes.

  2. In order to ensure that the serialization error is only thrown
     when the user performs an explicit XMLSERIALIZE, I added a
     new field, "containsTopLevelAttr", to the XML class. This field
     indicates whether or not the XML value corresponds to a sequence
     with a top-level attribute node. If the user calls XMLSERIALIZE
     on an XMLDataValue for which containsTopLevelAttr is true,
     then we'll throw the serialization error 2200W as dictated by
     SQL/XML.

  3. Adds appropriate test cases to lang/xml_general.sql to verify
     the fix.

  4. Since Xalan doesn't provide a built-in way to retrieve a sequence
     of attribue values (as opposed to attribute nodes), I also included
     in lang/xml_general.sql a (rather ugly) way to accomplish that
     task within the serialization restrictions of SQL/XML. 

------------------------------------------------------------------------
r441722 | mikem | 2006-09-08 18:29:42 -0700 (Fri, 08 Sep 2006) | 20 lines

DERBY-1675
contributed by Sunitha Kambhampati

USRIDPWD support depends on the JCE available in the classpath of the server

This patch(derby1675.diff.txt) does the following
1. Add code to check if server jvm can support EUSRIDPWD.
2. Throw an error if the derby.drda.securityMechanism is set to ENCRYPTED_USER_AND_PASSWORD_SECURITY
and if the server jvm cannot support EUSRIDPWD.
3. Server sends the client the list of supported security mechanisms as part of ACCSECRD. Now, the server will correctly only send EUSRIDPWD as an option if the running server can support this security mechanism.

Test related changes:
Changes were made to testProtocol.java and a new method readSecMecAndSECCHKCD is added to TestProto to read the SECMEC and SECCHKCD values. Note, that with ibm142 and ibm15 jvms that support eusridpwd, the SECMEC value 9 (eusridpwd) will be sent as part of the ACCSECRD response. But for the jvms that dont support the eusridpwd, the SECMEC value of 9 wont be sent. The new method readSecMecAndSECCHKCD takes
care of printing out the SECMEC values that are sent by the server - this results in the need for a new master file for the jvm that support eusridpwd and the jvm that cannot support it. A new master file has been added for ibm14.

Tests for codepath that covers #2 is already present in testSecMec.java. This results in themaster updates for the jvms that do not support eusridpwd for the case where server is started with
derby..drda.securityMechanism=ENCRYPTED_USER_AND_PASSWORD_SECURITY.



------------------------------------------------------------------------
r441601 | djd | 2006-09-08 11:21:43 -0700 (Fri, 08 Sep 2006) | 3 lines

DERBY-1809 Fix bug where use of builtin functions in the SYSFUN schema within VIEWs would throw an exeception
at CREATE VIEW time. Caused by the AliasDescriptor for such functions reporting they were persistent (had rows
in SYSALIASES) when they are not persistent.
------------------------------------------------------------------------
r441584 | mikem | 2006-09-08 10:39:50 -0700 (Fri, 08 Sep 2006) | 15 lines

DERBY-1522
contributed by Deepa Remesh, dremesh@gmail.com

Attaching a patch 'derby1522_v2.diff. It includes a JUnit test for testing the 
switch to SQL standard authorization. It tests following:

1. grant/revoke is not available if derby.database.sqlAuthorization property 
is not set.
2. grant/revoke is available when derby.database.sqlAuthorization is set to true.
3. Once derby.database.sqlAuthorization is set to true, it cannot be set to any other value.

This patch also modifies DatabasePropertyTestSetup.tearDown method. The tearDown method resets the property values to old values. It will now ignore exceptions when property reset is not supported. I am including this small change in the above patch. (I had opened DERBY-1827 for the issue with tearDown method. ). I am using TestUtil.getConnection method to shutdown the database. I have opened DERBY-1826 to add methods to Derby's JUnit classes for shutdown.



------------------------------------------------------------------------
r441426 | fuzzylogic | 2006-09-08 01:14:00 -0700 (Fri, 08 Sep 2006) | 3 lines

DERBY-706: Fix multiple declarations of properties in 
testProperties_derby.properties reported by John Embretsen

------------------------------------------------------------------------
r441232 | djd | 2006-09-07 14:31:54 -0700 (Thu, 07 Sep 2006) | 5 lines

DERBY-1700  Patch the removes closeCleanup from ResultSet implementations:

- remove any field storing the reference to a close cleanup method
- remove any calling of the method
- remove passing the reference to the method in the constructor. 
------------------------------------------------------------------------
r441185 | kahatlen | 2006-09-07 12:29:00 -0700 (Thu, 07 Sep 2006) | 5 lines

DERBY-1767: insertRow(), updateRow() and deleteRow() cannot handle
table names and column names containing double quotes

Patch contributed by Fernanda Pizzorno.

------------------------------------------------------------------------
r441140 | mikem | 2006-09-07 09:54:09 -0700 (Thu, 07 Sep 2006) | 23 lines

DERBY-1729, contributed by Yip Ng
committing derby1729-trunk-diff03.txt patch.

The GrantNode and RevokeNode should have derived from DDLStatementNode instead
of MiscellaneousStatementNode. Subclassing DDLStatementNode will generate a
call to GenericResultSetFactory's getDDLResultSet() in the activation class
and invokes the GenericAuthorizer's authorize() method with the proper
parameters to enforce the correct semantics.

public ResultSet getDDLResultSet (Activation activation) throws StandardExceptio
n
{
        getAuthorizer(activation).authorize(activation, Authorizer.SQL_DDL_OP);
            return getMiscResultSet( activation);
}

Also adding an additional sql file for derbylang. The reason I didn't include
this in grantRevokeDDL.sql is because of name collision and this testcase is
one of the many additonal grant/revoke tests that I wrote and I'll like to
append the rest of those testcases to this file(grantRevokeDDL2.sql) when I
submit my patch for DERBY-1736.


------------------------------------------------------------------------
r441131 | djd | 2006-09-07 09:16:15 -0700 (Thu, 07 Sep 2006) | 4 lines

DERBY-1686 The original fix retrieves all the relevent providers such as table, view, and routine descriptor(s)
of the given view at bind time and pass this information to runtime later
for it to determine if the privilege is grantable or not by the grantor.
Patch contributed by Yip Ng - yipng168@gmail.com
------------------------------------------------------------------------
r441105 | djd | 2006-09-07 07:55:02 -0700 (Thu, 07 Sep 2006) | 6 lines

DERBY-1700 (partial) Change the compile time code generation to always pass null for the close cleanup method
when generating ResultSets. This is because the close cleanup method adds no value since it is only used
for current time & date resetting, which is also performed at every execute if a statement uses the SQL
current time or date constructs. Incremental development, first just run with no close cleanup method,
future steps will include removal of related code from the implementations of ResultSets, then from
the ResultSetFactory api and its callers.
------------------------------------------------------------------------
r441098 | djd | 2006-09-07 07:42:46 -0700 (Thu, 07 Sep 2006) | 1 line

DERBY-1802 Fix accidental bad change for lang._Suite.
------------------------------------------------------------------------
r441097 | djd | 2006-09-07 07:35:35 -0700 (Thu, 07 Sep 2006) | 4 lines

DERBY-1802  Patch which contains JUnit tests for DERBY-475 and DERBY-592,
the built-in math functions and JDBC escape functions.
Contributed by Susan Cline home4slc@yahoo.com

------------------------------------------------------------------------
r441088 | djd | 2006-09-07 07:07:22 -0700 (Thu, 07 Sep 2006) | 1 line

Move GroupByExpression test from the derbylang suite to the lang._Suite.
------------------------------------------------------------------------
r440846 | mikem | 2006-09-06 12:45:15 -0700 (Wed, 06 Sep 2006) | 3 lines

javadoc fixes.


------------------------------------------------------------------------
r440762 | djd | 2006-09-06 09:20:34 -0700 (Wed, 06 Sep 2006) | 2 lines

DERBY-1700 (partial) Add JUnit lang/TimeHandlingTest that perfoms tests on CURRENT TIME and CURRENT TIMESTAMP
and can be exapnded to test CURRENT DATE and other date & time functionality.
------------------------------------------------------------------------
r440550 | bpendleton | 2006-09-05 18:00:35 -0700 (Tue, 05 Sep 2006) | 10 lines

DERBY-1491: Provide ALTER TABLE functionality to change a column's default value

This change contains new test cases in the altertable.sql test which explore
the behavior of the ALTER TABLE ALTER COLUMN statement to alter a column's
defaults. Note that this patch only includes new tests; the current product
already supports the functionality to change a column's default value. The
code to support this was a side effect of the DERBY-119 changes, which wired up
the already-existing parser routines to the new ALTER TABLE t ALTER COLUMN c
statement.

------------------------------------------------------------------------
r440517 | kahatlen | 2006-09-05 15:43:23 -0700 (Tue, 05 Sep 2006) | 4 lines

DERBY-1813: Fix hard-coded JDBC 4.0 type constants

Updated JDBC40Translation with the new values.

------------------------------------------------------------------------
r440373 | djd | 2006-09-05 08:34:44 -0700 (Tue, 05 Sep 2006) | 4 lines

DERBY-1791 Change the test Security Manager policy files to use a different variable for derbyTesting.jar and derbyclient.jar.
Allows these jars to be in different directories to the other derby jars (e.g. the new distribution layout with
top level test folder). Makes the old harness use the eisting variables set up by the new JUnit related class
SecurityManagerSetup.
------------------------------------------------------------------------
r440321 | kahatlen | 2006-09-05 04:32:42 -0700 (Tue, 05 Sep 2006) | 2 lines

DERBY-1768: Removed empty JDBC 4.0 RowId classes

------------------------------------------------------------------------
r440062 | andreask | 2006-09-04 06:05:32 -0700 (Mon, 04 Sep 2006) | 1 line

DERBY-1800 testSetBinaryStreamLengthLessOnBlobTooLong fails with Unexpected SQL state. Fix is to flush the BLOB data when there is an SQLException
------------------------------------------------------------------------
r439861 | djd | 2006-09-03 15:41:46 -0700 (Sun, 03 Sep 2006) | 6 lines

DERBY-1700 (partial) Initial version of a TimeHandlingTest that includes tests for CURRENT TIME.
Will expand to also test CURRENT DATE and CURRENT TIMESTAMP.
Not yet added to the suites.
Improve CleanDatabaseTestSetup to allow it to be the super-class for a decorator that
performs initial schema setup with automatic dropping of everything.
Improved CleanDatabaseTestSetup to drop functions.
------------------------------------------------------------------------
r439845 | djd | 2006-09-03 14:09:19 -0700 (Sun, 03 Sep 2006) | 1 line

Improve JDBC.dropSchema to include dropping synoyms based upon JDBC metadata. Includes a workaround for DERBY-1790.
------------------------------------------------------------------------
r439775 | mikem | 2006-09-03 06:21:33 -0700 (Sun, 03 Sep 2006) | 19 lines

DERBY-1756
patch Derby1756.2.diff.txt contributed by Sunitha Kambhampati

with derby-962 changes, if client jvm supports EUSRIDPWD then the client would 
use EUSRIDPWD as the security mechanism. But it is possible that the server jvm
might not support EUSRIDPWD and the connection can fail.
When DERBY-1517, DERBY-1755 is fixed, there might be a way to use EUSRIDPWD 
when both client and server vm's have support for it.

This patch does the following:
o Do not use EUSRIDPWD as the default security mechanism even if the client vm can support it.
o Fix comments in testSecMec.java.
o Existing tests in testSecMec.java cover this codepath and the master file 
output reflects the changes made. Note, only the ibm14 client master file has 
changed since only ibm141 and greater jvms come with jce that can support 
eusridpwd.



------------------------------------------------------------------------
r439702 | mikem | 2006-09-02 19:28:35 -0700 (Sat, 02 Sep 2006) | 8 lines

DERBY-1810

Bumping the time to wait for server to start in this test.  In my environment
this test is failing consistently (and bad error handling in the test then 
causes this test to hang forever).  Bumping the timeout so far has made it 
pass (I tried it 10 times), where before it failed 10 times.


------------------------------------------------------------------------
r439335 | fuzzylogic | 2006-09-01 07:38:24 -0700 (Fri, 01 Sep 2006) | 4 lines

Additional j9 masters for DERBY-1702.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r439315 | rhillegas | 2006-09-01 06:34:57 -0700 (Fri, 01 Sep 2006) | 1 line

DERBY-1566: Commit Jean's diff-4 changes to the message generator.
------------------------------------------------------------------------
r439279 | kahatlen | 2006-09-01 04:57:54 -0700 (Fri, 01 Sep 2006) | 8 lines

DERBY-418: outofmemory error when running large query in autocommit=false mode
DERBY-1142: Metadata calls leak memory

Notify GenericLanguageConnectionContext when activations are marked as
unused, and clean up unused activations when a new one is added.

Patch contributed by Mayuresh Nirhali.

------------------------------------------------------------------------
r439209 | fuzzylogic | 2006-08-31 23:37:39 -0700 (Thu, 31 Aug 2006) | 6 lines

Update j9 master due to recent changes for issues DERBY-836, DERBY-1554,
DERBY-1702, and add a comment regarding why floattypes is skipped on 1.3.1-level
VMs including wsdd5.6/wctme5.7.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r439128 | suresht | 2006-08-31 18:19:50 -0700 (Thu, 31 Aug 2006) | 7 lines

DERBY-1783 (opening of file even on jvms with support for "rwd" mode incorrectly maps to "rw" mode). 

Patch that fixes the logical code error by adding parentheses around the OR clause. In addition one minor fix to the javadoc for the method is done.

Patch Contributed by Olav Sandstaa.


------------------------------------------------------------------------
r439098 | djd | 2006-08-31 16:25:25 -0700 (Thu, 31 Aug 2006) | 1 line

DERBY-1315 Missed UnionNode on last commit.
------------------------------------------------------------------------
r439093 | rhillegas | 2006-08-31 16:20:41 -0700 (Thu, 31 Aug 2006) | 1 line

DERBY-1566: Check in the SQLState generator written by David and debugged by Jean and John.
------------------------------------------------------------------------
r439083 | djd | 2006-08-31 15:57:32 -0700 (Thu, 31 Aug 2006) | 3 lines

DERBY-1315 This patch adds a small amount of logic to remove entries from an Optimizable's "best plan" HashMap when they are no longer needed. For more on when this is possible, see the discussion here:
http://article.gmane.org/gmane.comp.apache.db.derby.devel/26051
Patch contributed by "A B" qozinx@gmail.com
------------------------------------------------------------------------
r439048 | djd | 2006-08-31 14:06:49 -0700 (Thu, 31 Aug 2006) | 1 line

Fix type in javadoc for BaseJDBCTEstCase.
------------------------------------------------------------------------
r439041 | mikem | 2006-08-31 13:39:25 -0700 (Thu, 31 Aug 2006) | 15 lines

DERBY-1793

Increasing the maximum time to wait for the server to start up from 30 to 60 
seconds.  The test checks in 500ms increments, so this change does not increase
the time for test to run for those who are already successfully running it.
So far this change has made this test pass in my environment, where previously
it failed consistently.  Since this test passes in the nightly full test runs
across a number of environments I assume the network server startup time is
somehow related to my particular machine (processor, memory, disk frag, firewall, vpn, ...)

Others have seen this issue so I am committing to the codeline.  I have filed
a separate issue that work should be done to measure the performance of 
network server startup as a targeted test (DERBY-1794).


------------------------------------------------------------------------
r438996 | fuzzylogic | 2006-08-31 10:35:14 -0700 (Thu, 31 Aug 2006) | 3 lines

Put toursdb into a subdirectory in toursdb.jar so that it is possible to connect
to it.

------------------------------------------------------------------------
r438975 | djd | 2006-08-31 09:18:34 -0700 (Thu, 31 Aug 2006) | 5 lines

DERBY-1555 Add some code to allow different JUnit TestConfigurations at start up based upon if the TestConfiguration
class determines it is running within the old harness or not. Add a utility method to allow JUnit suites or tests
to determine if they are running in the harness or not, and thus have temporary code to ease transistion from
the old harness. With this commit the code is setup to assume it's always running in the harness, need some
more testing to fully support this flag when running outside the harness.
------------------------------------------------------------------------
r438972 | djd | 2006-08-31 09:15:07 -0700 (Thu, 31 Aug 2006) | 2 lines

Clean up some methods in BaseTestCase that were declared to throw PrivilegedActionException but actually had
no code that would do so.
------------------------------------------------------------------------
r438971 | djd | 2006-08-31 09:13:19 -0700 (Thu, 31 Aug 2006) | 1 line

Add some comments to hopefully clarify LangScripts purpose.
------------------------------------------------------------------------
r438942 | mikem | 2006-08-31 07:39:55 -0700 (Thu, 31 Aug 2006) | 11 lines

DERBY-1583
contributed by Bryan Pendleton

If a particular
ColumnDescriptor has no associated TableDescriptor at the
time that CompilerContextImpl.addRequiredColumnPriv is
called, then there is no column privilege that needs to be added. 




------------------------------------------------------------------------
r438578 | mikem | 2006-08-30 11:31:45 -0700 (Wed, 30 Aug 2006) | 3 lines

a couple of simple javadoc fixes.


------------------------------------------------------------------------
r438489 | andreask | 2006-08-30 07:11:08 -0700 (Wed, 30 Aug 2006) | 1 line

removed duplicated lines in properties file - DERBY-1558 followup
------------------------------------------------------------------------
r438478 | andreask | 2006-08-30 06:06:05 -0700 (Wed, 30 Aug 2006) | 1 line

DERBY-1559 when receiving a single EXTDTA object representing a BLOB, the server do not need to read it into memory before inserting it into the DB. Patch which reduces memory usage from 350 MB to 40 MB in network server vm when inserting a 64MB BLOB
------------------------------------------------------------------------
r438299 | djd | 2006-08-29 16:51:29 -0700 (Tue, 29 Aug 2006) | 4 lines

DERBY-1555 Add configuration decorator to change the default user for a configuaration
and use it in the NistScripts JUnit test. NistScripts is an initial pass at the setup of running
nist under JUnit, it fails at the moment in about a third of the test cases probably due to
output that is being sed'ed in the old harness and should not be.
------------------------------------------------------------------------
r438289 | fuzzylogic | 2006-08-29 16:26:32 -0700 (Tue, 29 Aug 2006) | 2 lines

Fix location of test directory in the -lib distribution.

------------------------------------------------------------------------
r438273 | djd | 2006-08-29 15:48:27 -0700 (Tue, 29 Aug 2006) | 1 line

Add comments to nist/readme to indicate changes to tests as required for revisions 438211 and 365776
------------------------------------------------------------------------
r438211 | djd | 2006-08-29 13:59:44 -0700 (Tue, 29 Aug 2006) | 1 line

Minor fix to nist scripts basetab, schema1 and schema5 not to call exit at the end as it is not required.
------------------------------------------------------------------------
r438122 | mikem | 2006-08-29 10:25:23 -0700 (Tue, 29 Aug 2006) | 21 lines

DERBY-1130
contributed by Deepa Remesh

Committing patch 'd1130-v2.diff' which ensures that database name set using setConnectionAttributes does not get used by client data sources. Changes are:

1) Appends the attributes in setConnectionAttributes method to database name only if database name has been already set on the data source. This will handle both these cases successfully:

a) When database name is not set as a DataSource property - In this case, if we pass in database name as a connection attribute, it will not get used. databaseName is a required Derby DataSource property. If it is not set, we cannot get a connection using the DataSource. It will fail with the following exception:
08001 - Required Derby DataSource property databaseName not set.
So, there is no need to append the connectionAttributes to the database name variable if databaseName DataSource property is not set. This way, we can avoid using database name in case it is passed in as a connection attribute.

Without the patch, if database name was not set, the code was using "null" as database name and creating a database named null if "create=true" is specified or throwing an exception that it cannot connect to database named null.

b) When database name is set as a DataSource property - In this case, if we pass in database name as a connection attribute, it will not be used. This is because database name set as DataSource property will over-ride it. This case is correctly handled (even without the patch).

2) The exception message is changed to indicate we are referring to "Derby DataSource" property:
08001 - Required Derby DataSource property databaseName not set.

3) Adds test to jdbcapi/checkDataSource.java. Adds a new method "testClientDSConnectionAttributes" which is run only in client framework. Modifies master files. 


------------------------------------------------------------------------
r437976 | kahatlen | 2006-08-28 22:50:44 -0700 (Mon, 28 Aug 2006) | 6 lines

DERBY-1417: Add new, lengthless overloads to the streaming api

Prevent materialization of lengthless streams in SQLBlob.setWidth().

Contributed by Kristian Waagan.

------------------------------------------------------------------------
r437832 | djd | 2006-08-28 14:02:18 -0700 (Mon, 28 Aug 2006) | 1 line

DERBY-1555 Remove comment left in after re-naming of method.
------------------------------------------------------------------------
r437823 | djd | 2006-08-28 13:53:57 -0700 (Mon, 28 Aug 2006) | 1 line

DERBY-1674 (partial) Remove TabInfo interface as the implementation of system tables is private to the impl/sql/catalog package.
------------------------------------------------------------------------
r437822 | djd | 2006-08-28 13:47:43 -0700 (Mon, 28 Aug 2006) | 5 lines

DERBY-1292 1) The addition of a copy method to org.apache.derby.client.am.ColumnMetaData.
2) Modifications to org.apache.derby.client.am.PreparedStatement to hold on to a copy of the column meta data for each entry used in batch updates.
3) A test was added to org.apache.derbyTestingfunctionTests.tests.derbynet.prepStmt. 

Patch contributed by James F. Adams derby@xemaps.com
------------------------------------------------------------------------
r437380 | mikem | 2006-08-27 08:10:06 -0700 (Sun, 27 Aug 2006) | 10 lines

DERBY-1681
contributed by Army Brown

Adding extra tests for this issue, fix already committed.  

Note that the test cases which were added for DERBY-1633 actually already 
demonstrate the problem reported (and now fixed) in this issue. This checkin
is a dedicated test case for this issue.


------------------------------------------------------------------------
r437215 | bpendleton | 2006-08-26 12:42:02 -0700 (Sat, 26 Aug 2006) | 18 lines

DERBY-119: Add ALTER TABLE option to change column from NULL to NOT NULL

This change merges the db2AlterColumn and columnAlterClause routines in
the parser to provide a single ALTER TABLE ALTER COLUMN statement that
provides support for changing the NULL / NOT NULL constraint on a
column in a table.

I believe that the existing execution code in AlterTableConstantAction
is correct, and so this patch primarily involves parser changes to hook
up the compiler to the existing execution code.

The patch also modifies the constraint handling in ModifyColumnNode so
that a column cannot be changed to NULL-able if it is part of either a
primary key or a unique constraint. Prior to the patch, ModifyColumnNode
only checked for a PRIMARY KEY constraint, so this patch also adds a check
for a UNIQUE constraint. It also rewords the error message to describe the
new conditions which can cause the ALTER COLUMN to be rejected.

------------------------------------------------------------------------
r437168 | kahatlen | 2006-08-26 07:31:51 -0700 (Sat, 26 Aug 2006) | 4 lines

DERBY-705: Re-enable test which was disabled in DERBY-506 commit

Patch contributed by V. Narayanan.

------------------------------------------------------------------------
r437127 | kahatlen | 2006-08-26 01:43:58 -0700 (Sat, 26 Aug 2006) | 15 lines

DERBY-1473: Add cut-off and truncation logic to streaming classes in
the embedded driver

This patch adds the capability to handle length less streams
properly. Such streams are now capped at the maximum length of the
column it is inserted into. If the stream is longer than the limit, a
DerbyIOException (subclass of IOException) is thrown, causing a
statement severity StandardException to be thrown. The exception
handling system takes care of cleaning up.

If a stream is shorter or longer than the specified length, an
exception is thrown as required by JDBC 3.0.

Contributed by Kristian Waagan.

------------------------------------------------------------------------
r437070 | djd | 2006-08-25 20:55:39 -0700 (Fri, 25 Aug 2006) | 2 lines

DERBY-883 Enhance GROUP BY clause to support expressions instead of just column references.
Patch contributed by  Manish Khettry - manish_khettry@yahoo.com
------------------------------------------------------------------------
r437009 | djd | 2006-08-25 16:12:15 -0700 (Fri, 25 Aug 2006) | 2 lines

DERBY-1555 (partial) Have SURDataModelSetup test for embedded vs. network using utility methods
in the JUnit classes.
------------------------------------------------------------------------
r436965 | djd | 2006-08-25 14:39:24 -0700 (Fri, 25 Aug 2006) | 1 line

DERBY-1555 (partial) Embedded and Client need to be public classes to run as JUnit tests.
------------------------------------------------------------------------
r436957 | djd | 2006-08-25 14:21:58 -0700 (Fri, 25 Aug 2006) | 4 lines

DERBY-1555 (partial) Add some top level JUnit suites that run all the tests in the packages (AllPackages),
all the tests in Embedded and (Derby) Client configurations and run All the configurations.
Also adds the logic in TestConfiguration to switch configurations to Client.
Just a checkpoint (incremental development), more work needed, see some failures running All.
------------------------------------------------------------------------
r436955 | djd | 2006-08-25 14:14:55 -0700 (Fri, 25 Aug 2006) | 1 line

Change jdcb40 suite to run most of the JUnit tests through _Suite.
------------------------------------------------------------------------
r436904 | mikem | 2006-08-25 11:57:57 -0700 (Fri, 25 Aug 2006) | 5 lines

DERBY-1698, contributed by Deepa Remesh

adds an additional test to jdbcapi/SetQueryTimeoutTest.java. This patch adds a test for executeUpdate method call.


------------------------------------------------------------------------
r436820 | djd | 2006-08-25 07:53:01 -0700 (Fri, 25 Aug 2006) | 5 lines

Make BaseTestCase install a security manager for its tests including adapting to the existing test
harness by not installing a security manager in that case. Allows JUnit tests to be run standalone
while installing a security manager automatically. Does require that the caller sets derby.system.home
when running the tests in JUnit test runners outside of the old harness. This will be addressed to
remove that requirement.
------------------------------------------------------------------------
r436817 | djd | 2006-08-25 07:37:38 -0700 (Fri, 25 Aug 2006) | 3 lines

Add some the JUnit test LnagScripts to the lang._Suite suite to start testing of running the .sql
scripts using JUnit. Currently it runs up to about eight test depending on configuration. These
tests do not currently replace the running of the scripts as regulaar tests.
------------------------------------------------------------------------
r436672 | fuzzylogic | 2006-08-24 23:20:13 -0700 (Thu, 24 Aug 2006) | 5 lines

DERby-1695: Add update4d testSecMec masters for JCC 2.6 and 2.8 needed after
DERBY-528.

Committed for Sunitha Kambhampati <ksunithaghm@gmail.com>

------------------------------------------------------------------------
r436660 | djd | 2006-08-24 22:02:56 -0700 (Thu, 24 Aug 2006) | 3 lines

Provide a consistent mechanism to test if the classes are being loaded by jars or
not in JUnit tests. Uses the SecurityManagerSetup class which basically already
determined this information at its startup.
------------------------------------------------------------------------
r436658 | fuzzylogic | 2006-08-24 21:57:36 -0700 (Thu, 24 Aug 2006) | 2 lines

Fix single quotes in a few messages to follow MessageFormat rules.

------------------------------------------------------------------------
r436653 | djd | 2006-08-24 21:52:09 -0700 (Thu, 24 Aug 2006) | 3 lines

Add DatabasePropertyTestSetup decorator that sets and clears database properties.
Fix a bug in SystemPropertyTestSetup noticed while testing DatabasePropertyTestSetup.
Change ConcurrencyTest to use DatabasePropertyTestSetup to work around bug DERBY-1762.
------------------------------------------------------------------------
r434587 | djd | 2006-08-24 18:27:39 -0700 (Thu, 24 Aug 2006) | 1 line

remove debug println accidently left in.
------------------------------------------------------------------------
r434586 | djd | 2006-08-24 18:26:59 -0700 (Thu, 24 Aug 2006) | 2 lines

Cleanup the autoloading tests to move the setup checks out of TestConfiguration into the tests
themselves as they are very specific to the autoloading tests.
------------------------------------------------------------------------
r434581 | djd | 2006-08-24 17:35:49 -0700 (Thu, 24 Aug 2006) | 1 line

Remove the assertSQLState from JDBC, one was already in BaseJDBCTestCase.
------------------------------------------------------------------------
r434577 | mikem | 2006-08-24 17:08:39 -0700 (Thu, 24 Aug 2006) | 5 lines

DERBY-1708, contributed by yip ng

Fixes the problem that the lock table statement is missing the logic to collect the required privilege at compilation phase; thus, it fails to enforce the required privilege needed by the statement at execution time. 


------------------------------------------------------------------------
r434562 | djd | 2006-08-24 16:31:20 -0700 (Thu, 24 Aug 2006) | 2 lines

Add methods to get a consistent folder for JUnit tests to store any failure information in.
Split the output comparision and handling from ScriptTestCase into CanonTestCase.
------------------------------------------------------------------------
r434556 | bpendleton | 2006-08-24 15:59:52 -0700 (Thu, 24 Aug 2006) | 36 lines

DERBY-688: Enhancements to XML functionality toward XPath/XQuery support

This patch was submitted by Army Brown (qozinx@gmail.com)

Attaching a "phase 7" patch, d688_phase7_v1.patch, that does the following:

  1 - Makes changes to catch all "Throwable" errors that might be
      thrown by Xalan or JAXP, instead of just catching the exceptions
      declared by the APIs. This is per the email thread here:

      http://www.nabble.com/xalan-assertion-when-execution-a-xml-query...-tf2149830.html#a5953476

      This allows Derby to continue working as normal if/when an
      unexpected Xalan/JAXP error (such NPE or assertion failure)
      occurs. In that case the statement itself will fail and the
      error will be printed, but Derby will continue to work as
      expected after the failure.

  2 - Slight change so that, in the event of an unexpected Xalan
      compilation error, the name of the operator that encountered
      the error will be printed as part of Derby's message. Currently
      the operator name isn't passed in and thus "{0}" shows up
      in the error message, which is incorrect.

  3 - Fixes a small bug in XML query execution code that was leading
      to NPEs in Xalan. Namely, the current code passes a null argument
      into Xalan where a non-null is expected (and required) for namespace
      prefix resolution.

  4 - Makes the first of two changes required to ensure Derby SQL/XML
      support agrees with the specification. The two changes are
      mentioned in my previous comments; this phase 7 patch addresses
      the first one (insertion of a non-Document node into a Derby XML
      column should not be allowed).


------------------------------------------------------------------------
r434408 | rhillegas | 2006-08-24 08:58:27 -0700 (Thu, 24 Aug 2006) | 1 line

DERBY-1582: Commit Deepa's d1582_v2.diff patch, raising a warning for vacuous REVOKEs.
------------------------------------------------------------------------
r434309 | kahatlen | 2006-08-23 23:11:32 -0700 (Wed, 23 Aug 2006) | 8 lines

DERBY-1500: PreparedStatement#setObject(int parameterIndex, Object x)
throws SQL Exception when binding Short value in embedded mode

setObject(int, Byte) is translated to setByte(int, byte)
setObject(int, Short) is translated to setShort(int, short)

Added test cases in jdbcapi/parameterMapping.java.

------------------------------------------------------------------------
r434273 | djd | 2006-08-23 17:38:45 -0700 (Wed, 23 Aug 2006) | 1 line

DERBY-1555 fix stray character in TestConfiguration that broke build.
------------------------------------------------------------------------
r434257 | djd | 2006-08-23 17:06:33 -0700 (Wed, 23 Aug 2006) | 3 lines

DERBY-1555 (partial) Remove access and use of static variables to store the current test configuration.
Changed to use a ThreadLocal private to TestConfiguration and access to the current configuration
is through utility methods in the base classes or TestConfiguration.getCurrent().
------------------------------------------------------------------------
r434245 | fuzzylogic | 2006-08-23 16:23:13 -0700 (Wed, 23 Aug 2006) | 3 lines

DERBY-1691: exclude blobclob4BLOB from running against JCC until the test
can be fixed.

------------------------------------------------------------------------
r434192 | djd | 2006-08-23 14:31:54 -0700 (Wed, 23 Aug 2006) | 2 lines

DERBY-1555 Change BaseJDBCTestCase.getXConnection() to getConnection and provide consistent initialization
of all connections returned by instance methods of BaseJDBCTestCase.
------------------------------------------------------------------------
r434169 | djd | 2006-08-23 13:42:13 -0700 (Wed, 23 Aug 2006) | 2 lines

Update the jdbc4 JUnit tests to use the recent additions, such as the single connection provided
by BaseJDBCTestCase and the test decorator base class BaseJDBCTestSetup.
------------------------------------------------------------------------
r434111 | rhillegas | 2006-08-23 11:14:11 -0700 (Wed, 23 Aug 2006) | 1 line

DERBY-1633: Commit Army's d1633_v3 patches, fixing the regression introduced by DERBY-805 in the behavior of views that involve joins.
------------------------------------------------------------------------
r434100 | djd | 2006-08-23 10:49:17 -0700 (Wed, 23 Aug 2006) | 5 lines

DERBY-1674 (partial) CatalogRowFactory.buildEmptyIndexRow() row was implemented in all the sub-classes but could
never be called, except for SYSTABLESRowFactory. Seen by code inspection and double checked with the code
coverage. Remove all the methods (except SYSTABLESRowFactory) and abstract definition in CatalogRowFactory.
Changed DataDictionaryImpl to call buildEmptyIndexRow using a reference to SYSTABLESRowFactory since it
was special case code for SYSTABLES.
------------------------------------------------------------------------
r434083 | djd | 2006-08-23 10:12:01 -0700 (Wed, 23 Aug 2006) | 1 line

DERBY-1734 (partial) Switch to simpler definition of system columns for SYSCHECKS, SYSCOLPERMS, SYSDUMMY1 and SYSFILES.
------------------------------------------------------------------------
r434046 | rhillegas | 2006-08-23 06:48:54 -0700 (Wed, 23 Aug 2006) | 1 line

DERBY-1621: Commit derby1621trunkdiff04.txt, causing recompilation of trigger actions after ddl.
------------------------------------------------------------------------
r434018 | kahatlen | 2006-08-23 05:02:52 -0700 (Wed, 23 Aug 2006) | 5 lines

DERBY-1743: derbynet/testSecMec.java fails with NullPointerException
(intermittent failure)

Make sure the logWriter is not null before printing the stack trace.

------------------------------------------------------------------------
r433931 | fuzzylogic | 2006-08-22 23:25:34 -0700 (Tue, 22 Aug 2006) | 2 lines

Add note about using ant -propertyfile to BUILDING.txt

------------------------------------------------------------------------
r433816 | fuzzylogic | 2006-08-22 17:44:18 -0700 (Tue, 22 Aug 2006) | 4 lines

DERBY-1033 DERBY-1405 DERBY-935: Add new top-level index.html to -bin
distribution which has links to the docs, demos, javadoc and external
resources. Also add the logo to the -bin distribution.

------------------------------------------------------------------------
r433790 | fuzzylogic | 2006-08-22 15:54:32 -0700 (Tue, 22 Aug 2006) | 3 lines

Add some JCC and JDK version specific masters in the hopes of fixing the
blobclob4BLOB test.

------------------------------------------------------------------------
r433688 | djd | 2006-08-22 09:51:41 -0700 (Tue, 22 Aug 2006) | 4 lines

DERBY-1674 (partial) Step towards removing iapi.sql.dictionary.TabInfo as its implementation TabInfoImpl
should be package private to impl.sql.catalog. All references now use TabInfoImpl directly instead
of TabInfo. Next step is to move the javadoc comments from TabInfo into TabInfoImpl and remove the class.
Simplify TabInfoImpl and IndexInfoImpl to not duplicate variables from CatalogRowFactory.
------------------------------------------------------------------------
r433685 | djd | 2006-08-22 09:48:11 -0700 (Tue, 22 Aug 2006) | 1 line

DERBY-1674 (partial) Remove IndexScan class from impl.sql.catalog as it is never used.
------------------------------------------------------------------------
r433655 | tmnk | 2006-08-22 07:57:58 -0700 (Tue, 22 Aug 2006) | 1 line

- Rollback DERBY-1513_DERBY-1535 see DERBY-1610 for detail - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r433632 | djd | 2006-08-22 06:50:53 -0700 (Tue, 22 Aug 2006) | 1 line

DERBY-1674 Remove some unused methods related to TabInfo classes.
------------------------------------------------------------------------
r433607 | andreask | 2006-08-22 04:46:13 -0700 (Tue, 22 Aug 2006) | 2 lines

DERBY-1558 enable more testcases in ConcurrencyTest. The patch makes use of SystemPropertiesTestSetup within the ConcurrencyTest.suite method to reduce lock timeout. It additionally makes use of NetworkServerTestSetup from the _Suite.suite() method. The _Suite_app.properties has been added to disable starting of network server. 

------------------------------------------------------------------------
r433491 | djd | 2006-08-21 20:47:44 -0700 (Mon, 21 Aug 2006) | 2 lines

DERBY-1739 Fix build error by missed change in SYSVIEWSRowFactory.java

------------------------------------------------------------------------
r433487 | djd | 2006-08-21 20:33:15 -0700 (Mon, 21 Aug 2006) | 4 lines

DERBY-1739 Do not have a set of column name for indexesin implementations of CatalogRowFactory
as they were never used and are of no need. If the column name was needed it would be better
to derive it from the column postions of the index, rather than duplicating information.

------------------------------------------------------------------------
r433450 | bpendleton | 2006-08-21 18:20:11 -0700 (Mon, 21 Aug 2006) | 9 lines

DERBY-688: Enhancements to XML functionality toward XPath/XQuery support

This patch was contributed by Army Brown (qozinx@gmail.com)

This change contains d688_phase6_v1.patch, which changes the SQLSTATEs for
XML errors to match the SQL/XML specification where possible, and that
moves the Derby-specific XML sql states to a compile-time range
(42Z70 - 42Z7Z) instead of an execution-time range (X0Xxx). 

------------------------------------------------------------------------
r433446 | djd | 2006-08-21 17:47:33 -0700 (Mon, 21 Aug 2006) | 1 line

DERBY-1739 (partial) Clean up implementation classes IndexInfoImpl and TabInfoImpl to not have public scope.
------------------------------------------------------------------------
r433445 | djd | 2006-08-21 17:41:28 -0700 (Mon, 21 Aug 2006) | 2 lines

DERBY-744 Add dependency of buildsource on the demo target to ensure correct ordering when executing ant all

------------------------------------------------------------------------
r433443 | djd | 2006-08-21 17:38:03 -0700 (Mon, 21 Aug 2006) | 3 lines

DERBY-744 Correct checking if the sane property is set.
Patch contributed by Andrew McIntyre

------------------------------------------------------------------------
r433434 | djd | 2006-08-21 17:05:45 -0700 (Mon, 21 Aug 2006) | 5 lines

DERBY-1734 (partial) Change SYSALIASESRowFactory to use the utility methods to obtain SystemColumn implementations
to avoid passing redundant parameters leading to bugs (see DERBY-1742). Fix the bug described by DERBY-1742
so that the column descriptor for SYSTEMALIAS BOOLEAN column is created correctly. Remove the calls to
convert the case for the SYSTEMALIASES columns as the system tables are an implementation detail of
Derby which is fixed at upper case.
------------------------------------------------------------------------
r433349 | djd | 2006-08-21 13:31:07 -0700 (Mon, 21 Aug 2006) | 5 lines

DERBY-1734 (partial) Add some utilitiy static factory methods to SystemColumnImpl to allow
easier building of system column lists for CatalogRowFactory. Remove column position (identifer)
from SystemColumn since it was redundant information. Still passed in some constructors of
SystemColumnImpl until all of the CatalogRowFactory implementations are modified to have
cleaner buildColumnList methods.
------------------------------------------------------------------------
r433331 | djd | 2006-08-21 12:19:07 -0700 (Mon, 21 Aug 2006) | 5 lines

DERBY-1609 Add IJRunScriptTest and _Suite JUnit tests for the testing of ij.runScript.
Modify runScript to take an OutputStream instead of a PrintStream, fix it to
correctly return the number of errors seen while running the script.
Add utility methods to BaseJDBCTestCase to run setup scripts from an InputStream or a String.

------------------------------------------------------------------------
r433274 | djd | 2006-08-21 09:11:36 -0700 (Mon, 21 Aug 2006) | 1 line

DERBY-1609 (partial) Remove some unused code in JDBCDisplayUtil.
------------------------------------------------------------------------
r433273 | djd | 2006-08-21 09:10:43 -0700 (Mon, 21 Aug 2006) | 2 lines

DERBY-1609 (partial) Fix a security exception reading the system property ij.showErrorCode.
Add code to return an error count for runScript (still needs to be tested).
------------------------------------------------------------------------
r433261 | djd | 2006-08-21 08:21:52 -0700 (Mon, 21 Aug 2006) | 4 lines

Remove largeCodeGen from lang._Suite as the test is too unstable to run in the nightlies
due to the different memory usage across vms. DERBY-1315 and DERBY-1735 should address
adding the test back in.

------------------------------------------------------------------------
r433085 | djd | 2006-08-20 16:22:04 -0700 (Sun, 20 Aug 2006) | 4 lines

DERBY-766 DERBY-1714 Convert largeCodeGen to a JUnit test, add it to the lang._Suite and add that to
the derbylang.runall old harness suite. Added tests for insert a large number of rows with a VALUES
clause. Test needs further improvements due to errors from DERBY-1315 and stack overflow with
a large INSERT VALUES clause.
------------------------------------------------------------------------
r432972 | djd | 2006-08-20 07:46:09 -0700 (Sun, 20 Aug 2006) | 3 lines

DERBY-1674 (partial) Move PermissionsCatalogRowFactory into its correct location under impl/sql/catalog.
System tables are a detail of the catalog implementation, not the dictionary api. The class was only ever referenced
in the impl/sql/catalog package.
------------------------------------------------------------------------
r432929 | bandaram | 2006-08-19 20:15:57 -0700 (Sat, 19 Aug 2006) | 4 lines

DERBY-1538: Disable GRANT or REVOKE operations for object owners and raise an error when attempted. Also Database owner will not be able to revoke or grant access to object owners as well.

Submitted by Satheesh Bandaram (bandaram@gmail.com)

------------------------------------------------------------------------
r432895 | djd | 2006-08-19 16:17:24 -0700 (Sat, 19 Aug 2006) | 2 lines

DERBY-1674 (partial) Clean up SystemColumn interface and implementation to hold the data type of
the column using the standard DataTypeDescriptor class rather than individual fields.
------------------------------------------------------------------------
r432859 | fuzzylogic | 2006-08-19 11:54:29 -0700 (Sat, 19 Aug 2006) | 2 lines

DERBY-1730: Fix generation of OSGi attributes in derby.jar manifest

------------------------------------------------------------------------
r432856 | djd | 2006-08-19 11:40:47 -0700 (Sat, 19 Aug 2006) | 7 lines

DERBY-766 DERBY-1714 Working method in CodeChunk that splits expressions out of generated methods that are too large.
Bumps the number of unions supported in largeCodeGen to over 6,000 from around 800. Also increases the
number of rows supported in a VALUES clause. A large number of UNION clauses still requires a large amount of
memory for optimization (see DERBY-1315). A large number of rows in a VALUES clause fails at some point due to
a StackOverflow. Subsequent commit will modify largeCodeGen to be a JUnit test and adapt to these changes
but running into issues finding a useful workign limits that can produce repeatable results without
hitting memory issues.
------------------------------------------------------------------------
r432705 | fuzzylogic | 2006-08-18 12:55:13 -0700 (Fri, 18 Aug 2006) | 2 lines

Minor javadoc fix to NetConnectionReply. Make @param parameter names match the method declaration.

------------------------------------------------------------------------
r432654 | djd | 2006-08-18 10:23:21 -0700 (Fri, 18 Aug 2006) | 1 line

Fix jdbcapi._Suite in DB2 client run by disabling ResultSetCloseTest
------------------------------------------------------------------------
r432645 | kahatlen | 2006-08-18 10:15:37 -0700 (Fri, 18 Aug 2006) | 10 lines

DERBY-244: with linux, depending on env setting $LANG and console
encoding, some i18n tests fail

  * Run the i18n tests run with -Dfile.encoding=UTF-8 and
    -Dconsole.encoding=UTF-8
  * Use UTF-8 encoding in ProcessStreamResult for the i18n tests
  * Make Sed.java read result files from i18n tests using UTF-8 encoding
  * Respect the derby.ui.codeset setting in i18n tests, and use UTF-8 if it
    is not specified.

------------------------------------------------------------------------
r432569 | andreask | 2006-08-18 06:05:45 -0700 (Fri, 18 Aug 2006) | 1 line

Fixed bug in setUp causing it to only start server when running in embedded mode. Removed import of ..functionalTests.util package.
------------------------------------------------------------------------
r432493 | kahatlen | 2006-08-17 22:47:07 -0700 (Thu, 17 Aug 2006) | 10 lines

DERBY-1710: Unchecked casts from SQLException to EmbedSQLException
cause ClassCastException in NetworkServerControlImpl when running
Java SE 6

The attached patch makes NetworkServerControlImpl use
SQLException.getSQLState() instead of EmbedSQLException.getMessageId()
where possible. Where it is not possible, check that the exception is
EmbedSQLException before casting, and fall back to a more generic
approach if it is not.

------------------------------------------------------------------------
r432487 | djd | 2006-08-17 21:41:49 -0700 (Thu, 17 Aug 2006) | 1 line

Move the framework JUnit classes for Derby into org.apache.derbyTesting.junit package.
------------------------------------------------------------------------
r432484 | djd | 2006-08-17 21:02:13 -0700 (Thu, 17 Aug 2006) | 1 line

Change ShutDownDBWhenNSShutsDownTest.java to use the connection provided by BaseJDBCTestCase.
------------------------------------------------------------------------
r432481 | djd | 2006-08-17 20:55:02 -0700 (Thu, 17 Aug 2006) | 1 line

Have ScriptTestCase use the connection provided by BaseJDBCTestCase.
------------------------------------------------------------------------
r432480 | djd | 2006-08-17 20:52:01 -0700 (Thu, 17 Aug 2006) | 1 line

Add a clean database test decorator to ProcedureTest.
------------------------------------------------------------------------
r432479 | djd | 2006-08-17 20:43:52 -0700 (Thu, 17 Aug 2006) | 1 line

Add a couple _Suite JUnit suites in lang and jdbc4, as framework, neither is used yet.
------------------------------------------------------------------------
r432478 | djd | 2006-08-17 20:42:29 -0700 (Thu, 17 Aug 2006) | 2 lines

Add some grant/revoke tests to PrepareExecuteDDL.

------------------------------------------------------------------------
r432477 | djd | 2006-08-17 20:39:11 -0700 (Thu, 17 Aug 2006) | 2 lines

Removing throwing Exception from setting up the Suite for ClosedObjectTest.

------------------------------------------------------------------------
r432475 | djd | 2006-08-17 20:37:20 -0700 (Thu, 17 Aug 2006) | 2 lines

DERBY-1712 Missed commit of TestConfiguration.

------------------------------------------------------------------------
r432469 | djd | 2006-08-17 19:48:15 -0700 (Thu, 17 Aug 2006) | 1 line

Remove Junit tests from jdbcapi.runall that included in _Suite.
------------------------------------------------------------------------
r432468 | djd | 2006-08-17 19:43:47 -0700 (Thu, 17 Aug 2006) | 3 lines

The patch (DERBY-1712.diff) has a new class NetworkServerTestSetup. This class is put into a new package for junit components, called org.apache.derbyTesting.junit, and the patch therefore also contains a new build file.
TestConfiguration had to be modified so that the new class could use DERBY_TEST_CONFIG attribute. 
patch contributed by Andreas Korneliusse nandreas.korneliussen@sun.com
------------------------------------------------------------------------
r432457 | djd | 2006-08-17 18:01:29 -0700 (Thu, 17 Aug 2006) | 3 lines

Change DataSourcePropertiesTest to be a self describing test and not rely on the old
test harness _app.properties method. Add it and ResultSetCloseTest to jdbcapi._Suite.

------------------------------------------------------------------------
r432456 | djd | 2006-08-17 17:59:18 -0700 (Thu, 17 Aug 2006) | 2 lines

Make ResultSetCloseTest and BLOBTest use the utility methods from BaseJDBCTestCase instead of using getXConnection().

------------------------------------------------------------------------
r432453 | djd | 2006-08-17 17:51:57 -0700 (Thu, 17 Aug 2006) | 2 lines

Change ProcedureTest to use the utility methods provided by BaseJDBCTestCase instead of using getXConnection.

------------------------------------------------------------------------
r432451 | djd | 2006-08-17 17:50:41 -0700 (Thu, 17 Aug 2006) | 3 lines

Change UpdateXXXTest suite method to pick up test methods starting with test automatically and
rename test that needs to be added when jdbc 2 or greater is supported.

------------------------------------------------------------------------
r432450 | djd | 2006-08-17 17:47:41 -0700 (Thu, 17 Aug 2006) | 4 lines

DERBY-1555 DERBY-1701 (partial) Change the tests that extend SURBaseTest to use the utilitiy methods
rather than the con field from SURBaseTest to fit into the generic single connection model provided
by BaseJDBCTestCase. Incremental development, next step will be to remove the con field from SURBaseTest.

------------------------------------------------------------------------
r432438 | djd | 2006-08-17 17:00:20 -0700 (Thu, 17 Aug 2006) | 5 lines

DERBY-1555 DERBY-1701 (partial) Incremental step in changing the tests that extend
SURBaseTest to use the single connection provided by BaseJDBCTestCase. Added
initialize method to BaseJDBCTestCase to allow tests to have a consistent
initial state for a connection. The SURBaseTest still has its con variable,
will be cleaned up in subsequent commits.
------------------------------------------------------------------------
r432432 | davidvc | 2006-08-17 16:38:38 -0700 (Thu, 17 Aug 2006) | 7 lines

DERBY-1691: jdbcapi/blobclob4BLOB.java fails under DerbyNet framework 
with JCC 2.6.

I filtered out the odd class obfuscation differences with the SqlException
class.  Passes with JCC 2.6 (I got the upgrade from the Cloudscape
site).

------------------------------------------------------------------------
r432367 | mikem | 2006-08-17 12:53:33 -0700 (Thu, 17 Aug 2006) | 12 lines

DERBY-1681, submitted by Army Brown

Fixes the following issue:
If Derby chooses to do a join between two FromTables and the right table is a chain of UNIONs, then the optimizer may choose to push the join predicate (if provided) down into the UNION and to both children of every UNION in the chain. But if the predicate cannot be pushed to the children of any of the UNIONs (except the top-level one) the predicate can end up being ignored altogether with respect to that UNION's children. The result is that query execution can return rows that do not satisfy the predicate.

This is a regression introduced in 10.1.2.4 and thus it affects 10.1.3 and 10.2. I came across this while tracing through code for DERBY-1633.

For more detailed explanation of problem and solution see html doc attached to
DERBY-1681.



------------------------------------------------------------------------
r432222 | djd | 2006-08-17 06:05:24 -0700 (Thu, 17 Aug 2006) | 2 lines

DERBY-1555 DERBY-1701 (partial) Add utiltiy methods to BaseJDBCTestCase to get Statements, PreparedStatements against
the default connection for the test.
------------------------------------------------------------------------
r432159 | fuzzylogic | 2006-08-16 22:51:03 -0700 (Wed, 16 Aug 2006) | 3 lines

DERBY-1032: Add scripts in bin to distributions and snapshots, remove frameworks
from snapshots.

------------------------------------------------------------------------
r432031 | djd | 2006-08-16 13:58:01 -0700 (Wed, 16 Aug 2006) | 1 line

DERBY-1701 (partial) change SURDataModelSetup to extend from BaseJDBCTestSetup and use its connection handling.
------------------------------------------------------------------------
r432029 | kahatlen | 2006-08-16 13:43:34 -0700 (Wed, 16 Aug 2006) | 8 lines

DERBY-1692: Client driver does not use the query timeout value set
using Statement.setQueryTimeout() for subsequent executions using the
same statement object

Make Statement resend the timeout value for each execution, and extend
SetQueryTimeoutTest with test cases for re-execution of Statement,
PreparedStatement and CallableStatement.

------------------------------------------------------------------------
r432028 | djd | 2006-08-16 13:42:18 -0700 (Wed, 16 Aug 2006) | 2 lines

DERBY-1555 DERBY-1701 (partial) Convert more tests to use the instance based get[X]Connection method
or the static openDefault method.
------------------------------------------------------------------------
r431999 | djd | 2006-08-16 12:25:31 -0700 (Wed, 16 Aug 2006) | 6 lines

DERBY-1555 DERBY-1701 (partial) Improve the BaseJDBCTest by adding support for a default connection
exactly like BaseJDBCTestSetup. Provides consistent handling for a connection in the common case
of a test using just one. Removes duplicated/inconistent code across many tests. First step
has the getConnection method called getXConnection until all the tests ahve stopped using the getConnection
static method and instead use the openDefaultConnection method.
Change the tests in jdbcapi to the new scheme.
------------------------------------------------------------------------
r431939 | djd | 2006-08-16 09:27:48 -0700 (Wed, 16 Aug 2006) | 1 line

DERBY-1701 (partial) Close statements and result sets in BLOBTest.
------------------------------------------------------------------------
r431919 | djd | 2006-08-16 08:19:05 -0700 (Wed, 16 Aug 2006) | 4 lines

DERBY-1555 DERBY-1701 (partial) Change the name of the TestConfiguration methods to openConnection from getConnection.
Step to having BaseJDBCTestCase.getConnection() be a method matching BaseJDBCTestSetup.getConnection, a handle
to a default connection stored in the instance. This will remove a lot of code in the classes that extend BaseJDBCTestCase
that store a connection locally and have N different ways of cleaning it up.
------------------------------------------------------------------------
r431916 | djd | 2006-08-16 08:10:04 -0700 (Wed, 16 Aug 2006) | 1 line

DERBY-1701 (partial) close a Statement object in the BlobTest
------------------------------------------------------------------------
r431884 | andreask | 2006-08-16 05:08:06 -0700 (Wed, 16 Aug 2006) | 1 line

added PGP key for Andreas Korneliussen
------------------------------------------------------------------------
r431844 | kahatlen | 2006-08-15 23:44:17 -0700 (Tue, 15 Aug 2006) | 2 lines

Added my PGP key.

------------------------------------------------------------------------
r431799 | djd | 2006-08-15 21:39:51 -0700 (Tue, 15 Aug 2006) | 4 lines

DERBY-1701 (partial) Clean up some of the jdbcapi tests by closing statements when finished and
cleaning up the connection. The connection handling needs to be simplified by having default connection
handling in BaseJDBCTestCase.

------------------------------------------------------------------------
r431744 | rhillegas | 2006-08-15 17:13:05 -0700 (Tue, 15 Aug 2006) | 1 line

DERBY-1689: Commit remove_10_2_upg_test.diff, removing the test for 10.1 to 10.2 upgrade.
------------------------------------------------------------------------
r431741 | bpendleton | 2006-08-15 16:48:22 -0700 (Tue, 15 Aug 2006) | 17 lines

DERBY-415 : sysinfo with -cp client should not complain about DB2 Driver

This change modifies the behavior of the "-cp client" argument to the
sysinfo tool. Formerly, this argument checked for both the DerbyNetClient
and the DB2 JCC driver, and complained if both drivers were not present.

Increasingly, users of Derby are using just the DerbyNetClient, and the use
of the JCC driver is less common, so it makes sense that "-cp client" should
focus on the DerbyNetClient, and the DB2 JCC driver can be treated separately.

So, "-cp client" now only checks for the DerbyNetClient, and a new argument
"-cp db2driver" is added to check for the DB2 JCC driver. The new behavior is:
   java sysinfo -cp: checks all the various components of the classpath
   java sysinfo -cp client: just checks the network client
   java sysinfo -cp db2driver: just checks the JCC driver


------------------------------------------------------------------------
r431734 | suresht | 2006-08-15 16:26:50 -0700 (Tue, 15 Aug 2006) | 4 lines

This patch fixes couple of java doc warnings. 

Contributed by Army Brown (qozinx@gmail.com).

------------------------------------------------------------------------
r431698 | mikem | 2006-08-15 13:55:21 -0700 (Tue, 15 Aug 2006) | 9 lines

DERBY-1652, submitted by Yip Ng

The cause of the problem is that the trigger descriptor is created after the stored prepared statement(SPS) has been compiled, so the compiled form of the SPS is not aware of that its trigger action can fire on the trigger table itself. Hence, the constant action was not generated correctly.

During upgrade, the SPSs are invalidated at database boot time. The SPS will be recompile when it is being invoked and the recompilation at this point will of course detect the relevent trigger and generate the correct constant action for the SPS and produce the expected behavior when the SPS is executed - throwing an error when it exceeds the trigger's maximum depth in the above case.

The simplest solution without introducing another revalidation of the SPS is to create the trigger descriptor first before compiling the SPS. I ran derbyall and had to go over the testcases which have the wrong master outputs and I have corrected them on this patch.


------------------------------------------------------------------------
r431697 | djd | 2006-08-15 13:38:48 -0700 (Tue, 15 Aug 2006) | 2 lines

DERBY-1694 Cleanup derbynet/testProperties so that it always handles the output from the processes it forks.
Not handling the output can lead to hangs according to the javadoc for java.lang.Process.
------------------------------------------------------------------------
r431696 | djd | 2006-08-15 13:37:07 -0700 (Tue, 15 Aug 2006) | 2 lines

Fix testSecMec so that if the server fails to start (checked by pinging it) the test prints a fail message
and completes, rather than just calling System.exit().
------------------------------------------------------------------------
r431663 | davidvc | 2006-08-15 11:35:54 -0700 (Tue, 15 Aug 2006) | 2 lines

DERBY-1691: jdbcapi/blobclob4BLOB.java fails under DerbyNet framework 

------------------------------------------------------------------------
r431603 | kahatlen | 2006-08-15 07:20:46 -0700 (Tue, 15 Aug 2006) | 5 lines

DERBY-1688: ConsistencyToken.hashCode() is not thread safe

Rewrite the method to use a thread-safe approach as suggested by The
"Double-Checked Locking is Broken" Declaration.

------------------------------------------------------------------------
r431593 | kahatlen | 2006-08-15 05:46:30 -0700 (Tue, 15 Aug 2006) | 12 lines

DERBY-1574: NullPointerException in UPDATE with COALESCE and subquery

This patch
- adds a preprocess method to CoalesceFunctionNode to override the one
  in ValueNode, thus making sure the arguments get handled.
- adds a printSubNodes method to CoalesceFunctionNode (was missing
  too, I discovered, when I was trying to look at the parse tree after
  binding).
- adds a new test case to coalesceTests.java and an updated master

Patch contributed by Dag H. Wanvik.

------------------------------------------------------------------------
r431474 | djd | 2006-08-14 16:50:03 -0700 (Mon, 14 Aug 2006) | 5 lines

DERBY-766 (partial) Almost working code in CodeChunk that splits expressions out from a method into
a sub-method for generated code. Increased the number of unions supported in the largeCodeGen test
from ~800 to ~1300. Code not yet enabled as some unexpected errors exist at 1400 unions, leading
to a ClassCastException. Committing as a checkpoint, the actual split call from BCMethod is commented
out to avoid any problems running it.
------------------------------------------------------------------------
r431395 | davidvc | 2006-08-14 11:17:57 -0700 (Mon, 14 Aug 2006) | 5 lines

DERBY-1664: (Partial) This is the first pass at a test that can be used
to gauge how long it takes to do each part of the startup process.  
This could likely be extended to also test how long it takes to create
tables of different size, how long it takes to insert rows, etc.

------------------------------------------------------------------------
r431293 | bandaram | 2006-08-13 22:06:16 -0700 (Sun, 13 Aug 2006) | 4 lines

DERBY-634: Prevent StackOverflow due to bad subquery optimization. Prevent cases of subquery optimization that can cause runtime stack overflow.

Submitted by Satheesh Bandaram (satheesh@gmail.com)

------------------------------------------------------------------------
r431195 | djd | 2006-08-13 10:08:04 -0700 (Sun, 13 Aug 2006) | 5 lines

Have the test harness jdbcapi run a single JUnit suite jdbcapi._Suite that includes most of the JUnit tests
that were run individually. Tests in this suite that were excluded in derby net or had _app.properties file
now self-exclude themselves based upon the JUnit utility methods indicating which JDBC client they are running.
Remaining JUnit tests should be included in jdbcapi._Suite, think they were added after I has started the _Suite
work.
------------------------------------------------------------------------
r430946 | fuzzylogic | 2006-08-11 19:37:38 -0700 (Fri, 11 Aug 2006) | 2 lines

Fix missed masters due to 10.3 bump

------------------------------------------------------------------------
r430894 | djd | 2006-08-11 13:57:18 -0700 (Fri, 11 Aug 2006) | 3 lines

Junit improvements, have the ScriptTestCase use the openTestResource method in BaseTestCase to get the script
file to avoid exceptions with a security manager. Added a couple more tests to the language scripts and added
the clean database decorator to each test run.
------------------------------------------------------------------------
r430891 | kmarsden | 2006-08-11 13:50:29 -0700 (Fri, 11 Aug 2006) | 7 lines

Backout change for 

DERBY-1130 Client should not allow databaseName to be set with setConnectionAttributes

To address concerns with the patch


------------------------------------------------------------------------
r430889 | djd | 2006-08-11 13:38:49 -0700 (Fri, 11 Aug 2006) | 3 lines

Junit improvements in the functionTests.tests.jdbcapi package. Add a _Suite to run all the JUnit tests.
Add checks to ConcurrencyTest, ProcedureTest and ScrollResultSet test to define their own requirements.
Make ConcurrencyTest not use the old harness to define when it is run.
------------------------------------------------------------------------
r430872 | djd | 2006-08-11 12:36:04 -0700 (Fri, 11 Aug 2006) | 2 lines

Junit improvements - setup security manager (not yet enabled for standalone tests) to be driven
by the test configuration, add openTestResource method in BaseTestCase that works with a security manager.
------------------------------------------------------------------------
r430867 | djd | 2006-08-11 12:22:33 -0700 (Fri, 11 Aug 2006) | 2 lines

DERBY-1556 (partial) Add an initial test decorator that cleans a database using the utility method JDBC.dropSchema.
More work is needed to drop functions, synonyms and handle dependencies between objects.
------------------------------------------------------------------------
r430864 | fuzzylogic | 2006-08-11 12:11:01 -0700 (Fri, 11 Aug 2006) | 3 lines

DERBY-1593: Separate test jars from "product" jars, add testing README.htm
and jakarta-oro-2.0.8.jar to test directory.

------------------------------------------------------------------------
r430857 | fuzzylogic | 2006-08-11 11:54:07 -0700 (Fri, 11 Aug 2006) | 2 lines

Bump trunk version to 10.3.0.0 alpha

------------------------------------------------------------------------
r430855 | djd | 2006-08-11 11:48:59 -0700 (Fri, 11 Aug 2006) | 2 lines

DERBY-1556 (partial) Add TODO's for the JDBC.dropSchema() method that shows work still needs to
be done to drop function and synonyms.
------------------------------------------------------------------------
r430853 | djd | 2006-08-11 11:41:09 -0700 (Fri, 11 Aug 2006) | 2 lines

DERBY-1556 (partial) Add the initial implementation of a  utility method in the JUnit JDBC class to drop a schema
and all of its objects. Will be called by a test decorator I will be committing soon.
------------------------------------------------------------------------
r430825 | davidvc | 2006-08-11 09:51:20 -0700 (Fri, 11 Aug 2006) | 4 lines

DERBY-1516: Inconsistent behavior for getBytes and getSubString for 
embedded versus network.  Contributed by Craig Russell


------------------------------------------------------------------------
r430815 | rhillegas | 2006-08-11 09:16:02 -0700 (Fri, 11 Aug 2006) | 1 line

DERBY-1530: Commit derby-1530_v01.diff, aligning Derby with the last JDBC4 signature changes.
------------------------------------------------------------------------
r430799 | mikem | 2006-08-11 07:35:00 -0700 (Fri, 11 Aug 2006) | 7 lines

DERBY-1660, submitted by Sunitha Kambhampati

This patch adds two new classes WarehouseVTI and TableVTI.
adds a new test case to test SYSCS_BULK_INSERT. This testcase is added to the existing optimizerOverrides.sql.
updates master files for embedded and network server. 


------------------------------------------------------------------------
r430714 | suresht | 2006-08-11 00:51:11 -0700 (Fri, 11 Aug 2006) | 14 lines

DERBY -1156 (partial) re-encryption of the database.

This patch:
1) prevents configuring a database for encryption or encryption with new 
key while restoring from backup using connection URL attributes createFrom/
restoreFrom/rollForwardRecoveryFrom. 

2) Modified the re-encryption crash recovery test to perform (re)encryption  while 
recovering from a previous crash with same attributes. 
 
3) Minor cleanup in  RawStore.java related to re-encryption.

 

------------------------------------------------------------------------
r430681 | fuzzylogic | 2006-08-10 22:29:52 -0700 (Thu, 10 Aug 2006) | 6 lines

DERBY-1597: set classpath in frameworks scripts from the value of DERBY_HOME instead of
sourcing the set*CP scripts. This prevents an accumulation of multiple Derby jar files in
the classpath after multiple runs of the scripts.

Committed for Ramandeep Kaur <ramandhindsa@gmail.com>

------------------------------------------------------------------------
r430677 | fuzzylogic | 2006-08-10 22:11:29 -0700 (Thu, 10 Aug 2006) | 2 lines

DERBY-1032 (partial): Add Windows batch scripts to bin

------------------------------------------------------------------------
r430670 | bpendleton | 2006-08-10 22:06:29 -0700 (Thu, 10 Aug 2006) | 30 lines

DERBY-688: Enhancements to XML functionality toward XPath and XQuery support

This revision contains d688_phase5_v1.patch.

This patch was contributed by Army Brown (qozinx@gmail.com).

The phase 5 patch, d688_phase5_v1.patch, adds code to determine whether or
not the user's classpath has the required XML classes and, if not, to throw
a user-friendly(-ier) error message whenver the user attempts to use any of
the XML operators.

I inquired as to the best way to do this in the following thread:

http://thread.gmane.org/gmane.comp.apache.db.derby.devel/25307/focus=25315

Dan suggested a) looking at the Derby code that loads modules, and
b) adding a new utility method to the ClassInspector class.

I looked at the module-loading code and it ultimately just makes a call to
Class.forName() and ignores a module if that call throws a LinkageError or
a ClassNotFoundException; see the getImplementations() method in
BaseMonitor.java. So based on that I added a utility method to ClassInspector
that does the same thing, except that it just returns "true" if the call
to Class.forName() succeeds and "false" otherwise. I made the new method
static because it doesn't rely on any state specific to ClassInspector and
because it would have taken a good deal of searching for me to figure out
how to instantiate an instance of ClassInspector correctly from within
the XML datatype class.


------------------------------------------------------------------------
r430668 | fuzzylogic | 2006-08-10 22:03:07 -0700 (Thu, 10 Aug 2006) | 2 lines

DERBY-1032 (partial): Add Unix scripts to bin directory

------------------------------------------------------------------------
r430641 | kmarsden | 2006-08-10 20:34:22 -0700 (Thu, 10 Aug 2006) | 9 lines

DERBY-1130 Client should not allow databaseName to be set with setConnectionAttributes

Attaching a patch 'd1130-client-v1.diff' which disallows databaseName attribute to be set using setConnectionAttributes method in client data sources. Tests added to jdbcapi/checkDataSource.java.


Contributed by Deepa Remesh



------------------------------------------------------------------------
r430626 | bpendleton | 2006-08-10 19:25:08 -0700 (Thu, 10 Aug 2006) | 37 lines

DERBY-688: Enhancements to XML functionality toward XPath and XQuery support

This revision contains d688_phase4_v2.patch.

This patch was contributed by Army Brown (qozinx@gmail.com).

The phase 4 patch, d688_phase4_v2.patch, adds some additional restrictions to
the ways in which XML values can be used. In particular:

  1. XML types cannot be used in CREATE PROCEDURE or CREATE FUNCTION statements.

  2. XML types cannot be used in import/export functions.

  3. XML types cannot be declared as columns in a global temp table.

I admit that I'm a bit fuzzy as to *why* these restrictions need to be in
place, but these are the restrictions that apply to the other "long" datatypes
in Derby (LOBs, LONG VARCHAR) so I'm enforcing them for XML, as well, to be
safe. It'll be easier to remove these restrictions in the future than it
will be to block them after users have potentially been relying on them.

One final restriction added by this patch is as follows: if a parameter is
used for the operand to an XMLPARSE operation, the parameter must have an
explicit cast to a character string type. I've put this restriction in place
because, based on my reading of the spec, this is required for SQL/XML[2006]
conformance. Further explanation can be found in comments for the relevant code.

d688_phase4_v2.patch also adds some simple test cases for each of these
restrictions to the lang/xml_general.sql test, with the corresponding master
updates.

And finally, the phase 4 patch includes two new error messages: one for the
XMLPARSE restriction, and one for missing XML classes, which is actually for
phase 5 but I included it in the phase 4 patch so that the two patches can
be applied sequentially (phase 4 then phase 5) without conflict. 


------------------------------------------------------------------------
r430578 | mikem | 2006-08-10 15:57:40 -0700 (Thu, 10 Aug 2006) | 38 lines

DERBY-1661, submitted by Sunitha 

Cause:
--On linux on the machine where the problem was hit, the default number for open file descriptors allowed is 1024. 
-- The problem lies in the sort code. The create index step involves the external merge sort.  There are some knobs in the code for the maximum number of input runs  to be used at a time. This is given by DEFAULT_MAX_MERGE_RUN in ExternalSortFactory.java. The default value is 1024.
--If the number of merge runs exceeds the limit given by DEFAULT_MAX_MERGE_RUN (lets call it 'x'), we combine the x number of runs into one larger run.  This process involves opening the x number of tmp files which is required to do the merge.
In this particular issue, when opening the 974th merge run, the too many files open is hit on this machine. 

See code:
org.apache.derby.impl.store.access.sort.MergeScan.init()

// Open a scan on each merge run.
int scanindex = 0;
Enumeration e = mergeRuns.elements();
while (e.hasMoreElements())
{
    // get the container id
    long id = ((Long) e.nextElement()).longValue();

    Transaction rawTran = tran.getRawStoreXact();  // get raw transaction
    int segmentId = StreamContainerHandle.TEMPORARY_SEGMENT;
    openScans[scanindex++] = 
    rawTran.openStreamContainer(segmentId, id, hold);   // <---------  This call throws the FileNotFoundException.
}

Workaround:
Increase the open file descriptor limit on the OS to a higher number. This solves the problem without any changes to derby.But this requires the user to explicitly change this limit on the machine, not a good option.
E.g on linux, the command to change the open file descriptor limit to 2048, 
$ulimit -n 2048 

To see the new /all limits, the command is
$ulimit -a


Fix to the problem:
1)change the DEFAULT_MAX_MERGE_RUN to 512.


------------------------------------------------------------------------
r430522 | djd | 2006-08-10 13:41:02 -0700 (Thu, 10 Aug 2006) | 3 lines

DERBY-766 (partial) Clean up the existing split methods to avoid confusion over a code
length passed in. Now length of the method's code is determined inside the methods rather
than being passed around.
------------------------------------------------------------------------
r430467 | mikem | 2006-08-10 11:11:46 -0700 (Thu, 10 Aug 2006) | 7 lines

DERBY-1660, submitted by Sunitha Kambhampati

This patch fixes the sql query used in the SYSCS_BULK_INSERT procedure to 
correctly use the optimizer hints using --DERBY-PROPERTIES clause instead of 
PROPERTIES.


------------------------------------------------------------------------
r430396 | mikem | 2006-08-10 07:38:33 -0700 (Thu, 10 Aug 2006) | 15 lines

DERBY-1248

This problem was caused because the backup of the database did not get all
the log records describing the changes to the data files that it got.
The problem is that the online backup reads page "through" the cache, rather 
than from disk so it is picking up "dirty" pages where the associated log 
records have not yet been flushed to disk. 
The backup of the log file on the other hand goes directly from disk and thus 
sometimes in this concurrent test misses some of the log records in the 
unflushed part of the log file. The fix is to flush the log file up to the
end at the end of the backup process after the data files have been copied
and before we copy the last of the log files to the backup.



------------------------------------------------------------------------
r430306 | djd | 2006-08-10 01:17:27 -0700 (Thu, 10 Aug 2006) | 2 lines

DERBY-766 (partial) Move code in CodeChunk into a sub-method so that it can be shared (in a future
commit) between the two ways of splitting a large method into sub-methods. 
------------------------------------------------------------------------
r430301 | fuzzylogic | 2006-08-10 01:13:30 -0700 (Thu, 10 Aug 2006) | 4 lines

DERBY-1470: Commit -alt4 patch, which adds sysinfo to derbyclient.jar and
unseals org.apache.derby.loc in derbynet.jar and derbyclient.jar to prevent
sealing problems.

------------------------------------------------------------------------
r430293 | djd | 2006-08-10 00:24:49 -0700 (Thu, 10 Aug 2006) | 5 lines

DERBY-766 (partial) Catch IOExceptions written while generating byte code in CodeChunk
as an exception means a limit of the class file format has been hit and subsequently
the generated code will be invalid. E.g. by trying to represent a invalid constant
pool index which is greater than 64k in two bytes.
Remove the unused class BCUnsupported.
------------------------------------------------------------------------
r430193 | djd | 2006-08-09 17:05:59 -0700 (Wed, 09 Aug 2006) | 6 lines

DERBY-766 (partial) Modify the approach in the split expressions method of CodeChunk to only identify
self-contained chunks of byte code from a limited set of instructions. Thus this is a "fail-safe" approach,
rather than trying to catch all the opcodes that would make a set of byte code not self-contained.
Incremental development, method is still not called and does not perform any splits yet,
I test it with calls from BCMethod and a reduced split threshold (e.g. split if the method
is ~3k big instead of the limit of 64k).
------------------------------------------------------------------------
r430189 | fuzzylogic | 2006-08-09 16:47:31 -0700 (Wed, 09 Aug 2006) | 2 lines

Back out accidental change to EmbedDatabaseMetaData.java

------------------------------------------------------------------------
r430177 | fuzzylogic | 2006-08-09 15:53:53 -0700 (Wed, 09 Aug 2006) | 4 lines

DERBY-1146: Add SHOW TABLES and DESCRIBE commands to ij.

Committed for Havard Mork <havard.mork@gmail.com>

------------------------------------------------------------------------
r430173 | djd | 2006-08-09 15:48:08 -0700 (Wed, 09 Aug 2006) | 3 lines

DERBY-1315 (minor cleanup) Remove a couple of unused fields and associated methods to save runtime space.
Reduce the scope of some fields and methods to better understand their use.

------------------------------------------------------------------------
r430172 | davidvc | 2006-08-09 15:42:20 -0700 (Wed, 09 Aug 2006) | 3 lines

DERBY-1377: (Partial) Inserted license headers into miscellaneous
files throughout the tree that were missed.

------------------------------------------------------------------------
r430170 | djd | 2006-08-09 15:38:46 -0700 (Wed, 09 Aug 2006) | 1 line

DERBY-1643 Rename the Dependency manager invalidation constant to represent its use of revoke restrict.
------------------------------------------------------------------------
r430149 | fuzzylogic | 2006-08-09 14:47:16 -0700 (Wed, 09 Aug 2006) | 3 lines

DERBY-1377 (partial): cleanup a couple of missed files, insert proper license
header into the generated ClassSizeCrawler.java

------------------------------------------------------------------------
r430143 | fuzzylogic | 2006-08-09 13:50:15 -0700 (Wed, 09 Aug 2006) | 2 lines

DERBY-1377: Fix license headers on remaining java files.

------------------------------------------------------------------------
r430077 | bpendleton | 2006-08-09 08:45:21 -0700 (Wed, 09 Aug 2006) | 38 lines

DERBY-1533: ArrayIndexOutOfBoundsException in DDMReader

DERBY-1533 follows in a series of bugs (DERBY-170, DERBY-428, DERBY-491,
DERBY-492, DERBY-614 among others) which have to do with the particulars of
the DRDA protocols used for handling long messages and large amounts of data.
In this particular issue, the problems involve the situation in which the
server is receiving a message which is segmented across multiple layer A
blocks using DSS continuations. This is a relatively unusual case, as
generally large amounts of data flow from the server to the client, not vice
versa.

This change contains two modifications to DDMReader, as well as some tests:

1) The Network Server method DDMReader.compressBLayerData was incorrect in
several respects. Rather than going through that code in detail, I noticed
that an almost identical version of this routine exists in the DerbyNetClient,
in the class Reply, and I am pretty confident that the client side code is
working, so I just wholesale modified the server's compressBLayerData method
so that it matched the client's method.

2) When the client is sending parameter data to the server, and the data to be
sent is a large array of bytes for a blob, the client, the client may send the
data inline as DRDA_TYPE_NVARBYTE, or it may externalize the data and send it
as DRDA_TYPE_NLOBBYTES. I believe that similar things happen with CLOB.
The client makes this decision based on the length of the data to be sent;
short values are sent inline, and long values are sent externalized. 
When the server receives the data, it must decide whether it is reading an
inline string of bytes, or externalized data, and it, too, makes this decision
based on the length of the data. However, the server's code for this was
comparing the length of the byte string against the amount of data left in the
current segment, as opposed to comparing it against the constant threshold
value for switching from inline bytes to externalized bytes; hence if a long
byte string happened to start late in a buffer, and was then segmented
(continued) into a subsequent buffer, the server would mistakenly think the
byte string was being sent as externalized bytes, when in fact it was sent as
inline bytes. 


------------------------------------------------------------------------
r430056 | rhillegas | 2006-08-09 06:51:30 -0700 (Wed, 09 Aug 2006) | 1 line

DERBY-528: Commit Francois' 528_diff_v5.txt patch, adding username/password substitution to our authentication options.
------------------------------------------------------------------------
r430051 | rhillegas | 2006-08-09 06:36:51 -0700 (Wed, 09 Aug 2006) | 1 line

DERBY-694: Commit Narayanan's DERBY-694_v6.diff patch so that statement severity errors don't close jdbc objects which they shouldn't.
------------------------------------------------------------------------
r429990 | suresht | 2006-08-09 01:39:52 -0700 (Wed, 09 Aug 2006) | 12 lines

DERBY -1156 (partial) encryption of an un-encrypted database and 
re-encryption of an encrypted databases with a new key.

This patch adds code required to do the following:
-- prevent (re) encryption of a database when it is read-only.
-- prevent (re) encryption of a database when it is in log archive mode. 
-- A  new test is added to check the above two error cases.
-- after (re) encryption of a container with newly gernerated encryption key , 
   it is synced to the disk, 



------------------------------------------------------------------------
r429957 | fuzzylogic | 2006-08-08 21:33:12 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377 (partial): Update checkToursDB master due to license header additions.

------------------------------------------------------------------------
r429935 | fuzzylogic | 2006-08-08 20:00:38 -0700 (Tue, 08 Aug 2006) | 4 lines

DERBY-1596: Add Working With Derby java files.

Committed for Stan Bradbury <Stan.Bradbury@gmail.com>

------------------------------------------------------------------------
r429927 | davidvc | 2006-08-08 19:01:26 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: Final mods for java/engine tree

------------------------------------------------------------------------
r429925 | davidvc | 2006-08-08 18:57:04 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial)  Add header for build.xml in root of iapi tree

------------------------------------------------------------------------
r429924 | davidvc | 2006-08-08 18:55:16 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) Dag's mods to iapi/util

------------------------------------------------------------------------
r429923 | davidvc | 2006-08-08 18:54:08 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) - Dag's mods to iapi/reference

------------------------------------------------------------------------
r429922 | davidvc | 2006-08-08 18:52:43 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) - Dag's mods to iapi/error

------------------------------------------------------------------------
r429920 | davidvc | 2006-08-08 18:44:23 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) Dag's changes to iapi/sql/execute

------------------------------------------------------------------------
r429919 | davidvc | 2006-08-08 18:43:06 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) Dag's mods to iapi/sql

------------------------------------------------------------------------
r429918 | davidvc | 2006-08-08 18:41:45 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) - Dag's adjustments to iapi/sql/dictionary

------------------------------------------------------------------------
r429914 | davidvc | 2006-08-08 18:36:46 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) - Dag's changes to iapi/sql/depend

------------------------------------------------------------------------
r429897 | fuzzylogic | 2006-08-08 17:15:01 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377 (partial): Update license headers in impl/load

------------------------------------------------------------------------
r429893 | djd | 2006-08-08 17:01:25 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1315 (minor cleanup) Make optimizerToBestPlanMap private scope and change its description into a javadoc comment.
------------------------------------------------------------------------
r429891 | rhillegas | 2006-08-08 16:56:09 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1377: Rototill trees under java/testing/org/apache/derbyTesting/functionTests/tests/jdbc4/ and java/testing/org/apache/derbyTesting/functionTests/tests/junitTests/
------------------------------------------------------------------------
r429889 | fuzzylogic | 2006-08-08 16:45:21 -0700 (Tue, 08 Aug 2006) | 3 lines

DERBY-1377 (partial): update license headers on functionTests files outside of
the tests directory.

------------------------------------------------------------------------
r429870 | fuzzylogic | 2006-08-08 15:57:12 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377 (partial): Update license headers for non-impl/non-iapi engine files.

------------------------------------------------------------------------
r429867 | davidvc | 2006-08-08 15:35:22 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) - Dag's mods to iapi/sql/conn

------------------------------------------------------------------------
r429863 | davidvc | 2006-08-08 15:34:16 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) Dag's updates to iapi/sql/compile

------------------------------------------------------------------------
r429860 | fuzzylogic | 2006-08-08 15:29:25 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377 (partial): Update the rest of the files in java/tools.

------------------------------------------------------------------------
r429856 | rhillegas | 2006-08-08 15:17:46 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1377: Rototill java/engine/org/apache/derby/iapi/db/, java/engine/org/apache/derby/iapi/jdbc/, and java/engine/org/apache/derby/iapi/types/
------------------------------------------------------------------------
r429847 | bpendleton | 2006-08-08 15:06:01 -0700 (Tue, 08 Aug 2006) | 33 lines

DERBY-688: Enhancements to XML functionality toward XPath/XQuery support

This revision contains d688_phase3_v1_code.patch and d688_phase3_v1_tests.patch

This patch was contributed by Army Brown (qozinx@gmail.com).

Attaching a "phase 3" patch that implements the XMLQUERY operator. The patch is in two parts:

  - d688_phase3_v1_code.patch
  - d688_phase3_v1_tests.patch

When committed, though, *both* patches should be committed together in
order to avoid test diffs.

The SQL parsing/compile time logic was added as part of the phase 2 patch;
this patch handles the execution-time logic by making the necessary Xalan
calls to evaluate an expression and to retrieve the results.

The phase 3 patch also adds logic to distinguish between two "types" of XML:
XML(DOCUMENT(ANY)) and XML(SEQUENCE), as defined in the SQL/XML[2006]
specification. The reason we need to distinguish between the two is that
the result of evaluating an XML query expression against an XML document
can be an arbitrary list of items including atomic values, attributes,
etc.--i.e. a sequence of items that is *not* required to form a valid
DOCUMENT node. For now, though, we only allow valid DOCUMENTs to be
inserted into XML columns, so we have to be able to look at the results
of the XMLQUERY operator to determine whether or not it's a valid DOCUMENT,
and if not we disallow insertion of that result into an XML column.
We can, however, keep the result transiently and pass it into other
operations that accept an XML value (namely, XMLSERIALIZE, which a user
can then use to retrieve the results in serialized form). 


------------------------------------------------------------------------
r429845 | davidvc | 2006-08-08 15:01:23 -0700 (Tue, 08 Aug 2006) | 3 lines

DERBY-1377: (Partial) - Added license text to build.xml files for
the tools subdirectory

------------------------------------------------------------------------
r429839 | davidvc | 2006-08-08 14:52:33 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) - Dag's changes to sql/execute/rts

------------------------------------------------------------------------
r429838 | davidvc | 2006-08-08 14:50:02 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) - Dag's changes to sql/execute

------------------------------------------------------------------------
r429836 | rhillegas | 2006-08-08 14:49:27 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1377: Rototill trees under java/engine/org/apache/derby/impl/db/ and java/engine/org/apache/derby/impl/io/
------------------------------------------------------------------------
r429834 | davidvc | 2006-08-08 14:47:07 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) - Dag's changes to impl/sql

------------------------------------------------------------------------
r429830 | davidvc | 2006-08-08 14:40:29 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (partial) - Dag's changes for sql/depend

------------------------------------------------------------------------
r429828 | davidvc | 2006-08-08 14:36:31 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) Dag's changes to impl/sql/conn for the license header

------------------------------------------------------------------------
r429826 | fuzzylogic | 2006-08-08 14:30:24 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: Update license headers in java/demo

------------------------------------------------------------------------
r429816 | rhillegas | 2006-08-08 14:15:30 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1377: Rototill tree under java/engine/org/apache/derby/iapi/store/
------------------------------------------------------------------------
r429812 | fuzzylogic | 2006-08-08 14:06:26 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: Update license headers in org.apache.derbyTesting.unitTests

------------------------------------------------------------------------
r429811 | rhillegas | 2006-08-08 13:56:54 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1377: Rototill tree under java/engine/org/apache/derby/iapi/services/
------------------------------------------------------------------------
r429803 | fuzzylogic | 2006-08-08 13:30:30 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377 (partial): Update license headers on files in drda

------------------------------------------------------------------------
r429802 | rhillegas | 2006-08-08 13:29:46 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1377: Rototill tree under java/engine/org/apache/derby/impl/store/
------------------------------------------------------------------------
r429795 | fuzzylogic | 2006-08-08 13:08:27 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377 (partial): Update license headers for client

------------------------------------------------------------------------
r429794 | rhillegas | 2006-08-08 13:02:58 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1377: Rototilled tree under java/engine/org/apache/derby/impl/services/
------------------------------------------------------------------------
r429791 | rhillegas | 2006-08-08 12:37:11 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1377: Rototill tree under java/engine/org/apache/derby/impl/jdbc/
------------------------------------------------------------------------
r429781 | rhillegas | 2006-08-08 12:11:11 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1377: Rototill remaining files under java/shared/org/apache/derby/shared/
------------------------------------------------------------------------
r429773 | jta | 2006-08-08 12:01:40 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377 (partial): update license headers for plugins subdirectory.

------------------------------------------------------------------------
r429771 | rhillegas | 2006-08-08 11:54:02 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1377: Rototill java/shared/org/apache/derby/shared/common/error/
------------------------------------------------------------------------
r429768 | rhillegas | 2006-08-08 11:44:05 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1377: Rototill java/shared/org/apache/derby/shared/common/reference/
------------------------------------------------------------------------
r429764 | bpendleton | 2006-08-08 11:39:07 -0700 (Tue, 08 Aug 2006) | 34 lines

DERBY-688: Enhancements to XML functionality toward XPath/XQuery support

This revision contains d688_phase2_v1_code.patch and d688_phase2_v3_tests.patch

This patch was contributed by Army Brown (qozinx@gmail.com).

Attaching a "phase 2" patch that does the following:

- Adds syntax and binding logic for XMLQUERY operator

- Updates syntax for XMLEXISTS to match XMLQUERY and does some refactoring
so that the two can share code. The most user-visible change in this area
is the change from BY VALUE to BY REF syntax, which required test updates
and corresponding master file updates.

Also as part of these changes I've rewritten some of the parse logic to
make it more easily extendible to a broader XMLQUERY syntax (as defined in
SQL/XML[2006]) when/if Derby supports the broader syntax (esp. optional
context items and variable bindings) in the future.

- These phase 2 patches do *not* actually implement the XMLQUERY operator
yet; they just allow parsing and binding of the operator. Execution-time
logic will come in a subsequent patch.

For the sake of review I've separated the Phase 2 patches into two
different parts:

  d688_phase2_v1_code.patch: The code changes.
  d688_phase2_v3_tests.patch: The test/master changes.

When committed, though, *both* patches should be committed together
in order to avoid test diffs.


------------------------------------------------------------------------
r429763 | davidvc | 2006-08-08 11:37:38 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: Dag's updates of header files for sql/compile.

------------------------------------------------------------------------
r429762 | davidvc | 2006-08-08 11:33:04 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377: (Partial) - Dag's submission for impl/sql/catalog

------------------------------------------------------------------------
r429734 | davidvc | 2006-08-08 10:07:27 -0700 (Tue, 08 Aug 2006) | 2 lines

DERBY-1377 (Partial) - Fix license headers for the dblook subdirectory.

------------------------------------------------------------------------
r429728 | rhillegas | 2006-08-08 09:51:59 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1524: Add new assertion overload.
------------------------------------------------------------------------
r429698 | bpendleton | 2006-08-08 08:53:29 -0700 (Tue, 08 Aug 2006) | 55 lines

DERBY-688: Enhancements to XML functionality toward XPath/XQuery support

This revision contains d688_phase1_v3.patch.

This patch was contributed by Army Brown (qozinx@gmail.com).

Attaching a "phase 1" patch, d688_phase1_v1.patch, for this issue that does the following:

  1. Reorganizes XML-specific code as follows:

    - Moves all code that relies on JAXP and Xalan classes
      out of XML.java and into a new class, SqlXmlUtil.java.
      See comments at the beginning of SqlXmlUtil for an
      explanation of why this was done.

    - Creates a new class, SqlXmlExecutor, in the impl.sql.execute
      package that serves as the class on which all XML operator
      calls are generated. Ex. for XMLEXISTS, instead of
      generating:

         <xmlOperand>.XMLExists(<query-expr>, xmlOperand)

      we now generate:

         <SqlXmlExecutor>.XMLSerialize(<query-expr>, xmlOperand)

      Along with making the code cleaner by allowing all
      XML operator calls to be defined in the same class,
      this new class has other benefits, as well--see
      comments at the beginning of SqlXmlExecutor for
      more of an explanation.

  2. Changes implementation of XPath from XSLT processing to
     the low-level Xalan API, which is faster, more flexible,
     and better for implementation of the XMLQUERY operator
     (the XMLQUERY operator will be coming in subsequent
     phases). Note that as part of this change I've removed
     the dependency on an explicit declaration of Xerces
     as the parser; Derby will now pick up the parser from
     the JVM (i.e. this patch resolves DERBY-567).

  3. Makes a small change to the XMLEXISTS operator to bring
     it more in line with SQL/XML spec. More specifically,
     the query expression that is specified must now be a string
     literal; parameters and other expressions are not allowed.

  4. Updates the XML test and master files (lang/xml_general.sql
     and lang/xmlBinding.java) to bring them in sync with the latest
     Derby codeline. Since the XML tests are not (yet) run
     as part of derbyall, the master files need to be updated
     to reflect some client/server changes that have gone into
     the codeline for 10.2 (for example, server pre-fetching
     behavior).


------------------------------------------------------------------------
r429677 | rhillegas | 2006-08-08 08:05:02 -0700 (Tue, 08 Aug 2006) | 1 line

DERBY-1649: Better sed'ing of cursor names in wisconsin output.
------------------------------------------------------------------------
r429648 | tmnk | 2006-08-08 06:21:18 -0700 (Tue, 08 Aug 2006) | 1 line

- DERBY-1637 OutBufferedStream.java fails on ibm131/jdk131 jvms. - Patch by Sunitha Kambhampati(ksunithaghm@gmail.com)
------------------------------------------------------------------------
r429561 | fuzzylogic | 2006-08-07 21:26:35 -0700 (Mon, 07 Aug 2006) | 4 lines

DERBY-1320: Fix lang/procedure.java on IBM JDK 1.5. 

Committed for Manjula Kutty <manjula.kutty@gmail.com>

------------------------------------------------------------------------
r429551 | fuzzylogic | 2006-08-07 20:20:12 -0700 (Mon, 07 Aug 2006) | 3 lines

DERBY-1431: Remove demos from snapshots and remove link to demos from
frameworks/readme.html, which is in the snapshot.

------------------------------------------------------------------------
r429550 | fuzzylogic | 2006-08-07 20:16:23 -0700 (Mon, 07 Aug 2006) | 5 lines

DERBY-1614: Do not set any heap size flags or network server apart from those
specified by the jvmflags property.

Committed for John Embretsen <John.Embretsen@sun.com>

------------------------------------------------------------------------
r429515 | davidvc | 2006-08-07 16:53:01 -0700 (Mon, 07 Aug 2006) | 3 lines

DERBY-1377: (Partial) Updated the tools/sysinfo directory to use the
new license header

------------------------------------------------------------------------
r429500 | davidvc | 2006-08-07 15:42:12 -0700 (Mon, 07 Aug 2006) | 4 lines

DERBY-1377: (Partial).  Inserted license headers to .jj files
and updated java files for the tools/ij subdirectory.


------------------------------------------------------------------------
r429496 | davidvc | 2006-08-07 15:28:17 -0700 (Mon, 07 Aug 2006) | 3 lines

DERBY-1377: (Partial) - inserted license headers to files that
didn't have them in the java/build subtree

------------------------------------------------------------------------
r429495 | davidvc | 2006-08-07 15:26:59 -0700 (Mon, 07 Aug 2006) | 4 lines

DERBY-1377: (Partial) - Updated license headers for the build
subtree.


------------------------------------------------------------------------
r429425 | rhillegas | 2006-08-07 11:33:13 -0700 (Mon, 07 Aug 2006) | 1 line

DERBY-1554: Revert IDENTITY_VAL_LOCAL() behavior on multi-row inserts to that seen in 10.1.3. Applying patch derby1554trunkdiff02.txt.
------------------------------------------------------------------------
r429417 | suresht | 2006-08-07 11:04:32 -0700 (Mon, 07 Aug 2006) | 8 lines

DERBY -1156 (partial) re-encryption of the database.

This patch adds priveleged blocks required to run (re) encryption of the 
database under security manager. Enabled the related tests to run under 
security manager,



------------------------------------------------------------------------
r429412 | djd | 2006-08-07 10:56:58 -0700 (Mon, 07 Aug 2006) | 3 lines

Change UpdateXXTest to be a JUnit test that runs under J2ME and its suite method to setup
the test cases correctly based upon the JDBC environment. No longer requires a _app.properties
file from the old test harness.
------------------------------------------------------------------------
r429401 | djd | 2006-08-07 10:17:43 -0700 (Mon, 07 Aug 2006) | 1 line

java.sql.Savepoint is the correct class to check to see if JDBC 3 and JSR 619 is supported, not ParameterMetaData
------------------------------------------------------------------------
r429365 | rhillegas | 2006-08-07 08:19:28 -0700 (Mon, 07 Aug 2006) | 1 line

DERBY-1640: Update master for XATest to account for changes introduced by DERBY-1579.
------------------------------------------------------------------------
r429350 | rhillegas | 2006-08-07 07:13:00 -0700 (Mon, 07 Aug 2006) | 1 line

DERBY-1029: Delete directory of empty files.
------------------------------------------------------------------------
r429155 | djd | 2006-08-06 10:07:03 -0700 (Sun, 06 Aug 2006) | 5 lines

Update the SQL script JUnit test running (ScriptTestCase) to use the new ij.runScript. This allows
the scripts to easily use the default connection from the super class BaseJDBCTest without having
to resort to setting system properties.
Cleanup the LangScripts test case to allow it to be called as a main method to run arbitrary
scripts from the command line.
------------------------------------------------------------------------
r429154 | djd | 2006-08-06 09:54:04 -0700 (Sun, 06 Aug 2006) | 3 lines

DERBY-1638 Add methods to JDBC for JUnit that indicates if the virtual machine environment
supports JDBC 2,3 or 4 and JSR169. Naming of methods indicates that the define the vm
level of support rather than the clients level.
------------------------------------------------------------------------
r429036 | djd | 2006-08-05 12:33:52 -0700 (Sat, 05 Aug 2006) | 7 lines

DERBY-1544 Adds a method 'grantPublicAccessToSystemRoutines' to DataDictionaryImpl which is called when doing a
full upgrade. This method goes through list of routines that needs to be granted public access and calls
'createRoutinePermPublicDescriptor' for each routine. This is the same as the method that is called during
database creation. It is slightly modified to allow specifying of an authorization id for the grantor.
When upgrading, authorization id of user performing upgrade is used.
Adds a test to upgrade test to verify that the 5 system routines are added to the routine permissions table.
Patch contributed by Deepa Remesh
------------------------------------------------------------------------
r429014 | suresht | 2006-08-05 10:11:47 -0700 (Sat, 05 Aug 2006) | 42 lines

DERBY -1156 (partial) (re) encryption of an existing database.

This patch adds code required to correctly handle crash/recovery during 
encryption of an un-encrypted database and encryption of an encrypted 
database with a new key.

Crashes before updating the database with the new encryption key 
are handled by recovery, those log records are encrypted old key. 

Crashes after updates to the service.properties with a new encryption key 
is handled by using the new status flag (derby.storage.databaseEncryptionStatus)  
to track the changes and by writing the transaction log encrypted with 
new key to a new log file. 

Logging system can handle only one encryption key, which means the 
recovery can read the log with a new key or the old key. Checkpoint 
log record is also encrypted. So it is necessary for the system
to find a checkpoint in the log that it can decrypt using the encryption 
key stored in the service.properties or the one provided by the user. 
This is ensured by  by writing  COMMIT and CHECKPOINT log records
into a new log file and delete that file on-reboot if there is a crash 
before checkpoint records are updated. 

CHECKPOINT and COMMIT is done after setting the databaseEncryptionStatus to 
IN-PROGRESS in the service.properties.On a reboot if databaseEncryptionStatus 
is  IN-PROGRESS,  then engine first checks if checkpoint is in the last 
log file , it it is then (re) encryption is complete otherwise it deletes the 
last log file before doing recovery. Because the last log file also 
had the commit record , it is also gone; Now recovery sees log only encrypted 
with the old key and no end for re-encryption transaction, so it the (re) 
encryption work rolled back and database is brought to the state it was 
before (re) encryption started. 

If engine find a checkpoint in the last log file when databaseEncryptionStatus
is IN-PROGRESS , the it is clear that checkpoint is encrypted with the new 
key; so it does any cleanup required. 


Added new test cases using debug flags to crash at critical 
point during (re) encryption and recovery of failed (re)encryption. 


------------------------------------------------------------------------
r428952 | fuzzylogic | 2006-08-04 20:44:23 -0700 (Fri, 04 Aug 2006) | 3 lines

Put reference to iapi.reference.Attribute back until I can figure out why it is
actually needed.

------------------------------------------------------------------------
r428937 | kmarsden | 2006-08-04 18:50:47 -0700 (Fri, 04 Aug 2006) | 5 lines

DERBY-1108
The test jdbcapi/setTransactionIsolation.java fails with ibm jvm1.5
Contributed by Manjula Kutty


------------------------------------------------------------------------
r428930 | djd | 2006-08-04 17:22:39 -0700 (Fri, 04 Aug 2006) | 7 lines

DERBY-1643 In Derby, the execute permission on a routine can't be revoked as long as there are dependent objects
relying on that permissions. This patch implements that behavior by adding a new revoke invalidation action
REVOKE_EXECUTE_PRIVILEGE, just for routine revoke. This invalidation gets sent when a revoke execute is issued.
When dependents, a ViewDescriptor and/or a TriggerDescriptor, get this invalidation action, they will
raise error that revoke execute can't be performed because there is a dependent object on that permission. 

Patch submitted by Mamta Satoor
------------------------------------------------------------------------
r428924 | djd | 2006-08-04 16:33:25 -0700 (Fri, 04 Aug 2006) | 4 lines

DERBY-1377 (partial) Move copyright notices from COPYRIGHT file to NOTICE file to
match ASF policy defined at:
http://www.apache.org/legal/src-headers.html

------------------------------------------------------------------------
r428923 | davidvc | 2006-08-04 16:30:27 -0700 (Fri, 04 Aug 2006) | 4 lines

DERBY-1377: (Partial) - added license headers to the files and
scripts in the frameworks directory.  


------------------------------------------------------------------------
r428917 | davidvc | 2006-08-04 16:07:59 -0700 (Fri, 04 Aug 2006) | 5 lines

DERBY-1377: (Partial) - Inserted license text into files in tools
directory that had no license text and seemed to need it.  This is
not in conflict with the issue Dan had raised, as these files previously
had no copyright message.

------------------------------------------------------------------------
r428910 | djd | 2006-08-04 15:28:55 -0700 (Fri, 04 Aug 2006) | 3 lines

DERBY-766 (partial) Add initial code/method and many comments as to how to split expressions out of large
generated methods. New code is not called yet and doesn't do much, first step in incremental development
of this method.
------------------------------------------------------------------------
r428899 | fuzzylogic | 2006-08-04 15:03:56 -0700 (Fri, 04 Aug 2006) | 4 lines

DERBY-1319: Document the toursdb schema.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r428892 | fuzzylogic | 2006-08-04 14:32:05 -0700 (Fri, 04 Aug 2006) | 2 lines

DERBY-1424: Fix badness caused by a double patch command from last checkin.

------------------------------------------------------------------------
r428891 | fuzzylogic | 2006-08-04 14:27:01 -0700 (Fri, 04 Aug 2006) | 3 lines

DERBY-1424: Build derbyclient.jar using classlister. Also removes an unnecessary
class from derbytools.jar.

------------------------------------------------------------------------
r428887 | davidvc | 2006-08-04 14:18:26 -0700 (Fri, 04 Aug 2006) | 2 lines

DERBY-1629 - Fixed canon for j9 VM (contributed by Myrna)

------------------------------------------------------------------------
r428872 | djd | 2006-08-04 13:29:29 -0700 (Fri, 04 Aug 2006) | 6 lines

DERBY-1544 (partial) Upgrading a database from 10.1 to 10.2 should automatically change database owner,
recorded as owner of system schemas in sysschemas, from pseudo user 'DBA' to authorizationID of the user
attempting upgrade. This was being done in DataDictionaryImpl.updateSchemaAuth method.
I think a wrong index was being used in the call to updateRow. Also the SCHEMAAID column which we are changing
is not part of any index in SYSSCHEMAS. So there is no need to update any index. 
Patch contributed by Deepa Remesh
------------------------------------------------------------------------
r428866 | davidvc | 2006-08-04 13:09:46 -0700 (Fri, 04 Aug 2006) | 3 lines

DERBY-1647: JDK 1.6 derbynet is failing due to SQLException.toString() 
changes

------------------------------------------------------------------------
r428801 | djd | 2006-08-04 10:57:54 -0700 (Fri, 04 Aug 2006) | 5 lines

DERBY-1612 (partial) If revoke statement finds a constraint dependent on the table/column on which privilege
is being revoked, the constraint will be dropped automatically. This functionality is similar to what is
supported for triggers and views. And just like triggers and views, more work is required so that constraint will get
dropped only if it depends on the particular privilege TYPE or particular column that is being revoked.
Patch contributed by Mamta Satoor.
------------------------------------------------------------------------
r428536 | djd | 2006-08-03 14:41:29 -0700 (Thu, 03 Aug 2006) | 5 lines

DERBY-1611 (partial) This patch concentrates on basic revoke functionality for views. If revoke statement finds a
view dependent on the table/column/routine on which privilege is being revoked, the view will be dropped automatically.
This functionality is similar to what is supported for triggers. And just like triggers, more work is required so
that view will get dropped only if it depends on the particular privilege TYPE or particular column that is being revoked.
Patch contributed by Mamta Satoor.
------------------------------------------------------------------------
r428510 | rhillegas | 2006-08-03 13:13:30 -0700 (Thu, 03 Aug 2006) | 1 line

DERBY-1252: Commit derby1252.diff, causing various SUR-related metadata calls to report the correct answers based on the client and server rev levels.
------------------------------------------------------------------------
r428252 | djd | 2006-08-02 22:58:44 -0700 (Wed, 02 Aug 2006) | 3 lines

DERBY-1609 (partial) Change the lang/wisconsin.java test to use the new ij.runScript method
rather than its previous use of the utilMain.go method. Change the sed commands because the
cursor names are different in the output due to the use of a connection in a different state.
------------------------------------------------------------------------
r428160 | djd | 2006-08-02 14:37:13 -0700 (Wed, 02 Aug 2006) | 2 lines

DERBY-1521 Patch which sets "derby.database.sqlAuthorization" for an upgraded database and tests that grant/revoke is available.
Patch submitted by Deepa Remesh
------------------------------------------------------------------------
r428128 | davidvc | 2006-08-02 13:16:35 -0700 (Wed, 02 Aug 2006) | 5 lines

DERBY-1629 - Added comment to lang/procedureInTrigger.sql to indicate a 
known bug is being encountered, and added a jdk16-specific output file.  
Note that the j9 run of procedureInTrigger.sql will probably fail, but I 
can't fix this as I don't have a j9 VM.

------------------------------------------------------------------------
r428115 | djd | 2006-08-02 12:48:59 -0700 (Wed, 02 Aug 2006) | 3 lines

DERBY-1579 Remove SYS.SYSREQUIREDPERM system table and update all the associated master output files.

Patch contributed by Yip Ng yipng168@gmail.com
------------------------------------------------------------------------
r428065 | fuzzylogic | 2006-08-02 10:42:08 -0700 (Wed, 02 Aug 2006) | 3 lines

DERBY-1630: Remove reference to engine class in NetConnection40. Generate
client exception using client.am.SqlException.

------------------------------------------------------------------------
r428044 | davidvc | 2006-08-02 09:32:02 -0700 (Wed, 02 Aug 2006) | 3 lines

DERBY-1616: Lots of jdk1.6 regression test failures with diffs because 
of SQL Exception instead of java.sql.SQLException

------------------------------------------------------------------------
r428012 | bpendleton | 2006-08-02 07:51:31 -0700 (Wed, 02 Aug 2006) | 12 lines

DERBY-1456: Network Server agentError logs only to console

Patch contributed by Sunitha Kambhampati (ksunithaghm@gmail.com)

This patch does the following:
1. Use the correct errorCodePoint for agent errors. CodePoint.AGNPRMRM.
Agent errors will be logged ok.
2. In agent errors, retrieve the descriptive string passed in as argument.
3. override Exception.getMessage() , so call to
DRDAProtocolException.getMessage() will return the diagnostic message.


------------------------------------------------------------------------
r427969 | rhillegas | 2006-08-02 05:50:33 -0700 (Wed, 02 Aug 2006) | 1 line

DERBY-1417: Commit derby-1417-7a-clientborderfix.diff, fixing a hang on a border condition.
------------------------------------------------------------------------
r427911 | fuzzylogic | 2006-08-01 23:28:46 -0700 (Tue, 01 Aug 2006) | 2 lines

DERBY-939: Add missed files from checkin of derby939trunkdiffpatch2.txt

------------------------------------------------------------------------
r427901 | davidvc | 2006-08-01 22:37:10 -0700 (Tue, 01 Aug 2006) | 3 lines

This was a rogue file that slipped into the DERBY-939 commit, backing
out the change

------------------------------------------------------------------------
r427899 | davidvc | 2006-08-01 22:30:11 -0700 (Tue, 01 Aug 2006) | 3 lines

DERBY-939: NullPointerException at ResultSet.close() time for simple 
query using UNION and INTERSECT.  Contributed by Yip Ng.

------------------------------------------------------------------------
r427866 | fuzzylogic | 2006-08-01 20:06:16 -0700 (Tue, 01 Aug 2006) | 4 lines

DERBY-1619: Decode encoded characters in path URLs in sysinfo. Prevents
duplicate entries for jar files from appearing in the output when the path
contains a character which gets encoded when passed as a URL.

------------------------------------------------------------------------
r427816 | fuzzylogic | 2006-08-01 17:20:38 -0700 (Tue, 01 Aug 2006) | 4 lines

DERBY-1537: Don't put metadata.properties into derbytools.jar. Avoids boot-time
exception when running tests with derbytools.jar in front of derby.jar in the 
classpath. 

------------------------------------------------------------------------
r427801 | djd | 2006-08-01 16:51:45 -0700 (Tue, 01 Aug 2006) | 3 lines

DERBY-1609 (partial) Fix wisconsin.java test by initializing the connections for the utilMain object.
Once wisconsin.java moves to using the new runScript the initConnections method will not be required
by this test and can return to being packahe protected.
------------------------------------------------------------------------
r427796 | fuzzylogic | 2006-08-01 16:44:49 -0700 (Tue, 01 Aug 2006) | 8 lines

DERBY-1241: When booting a database under security manager, boot may fail with
message java.sql.SQLException: Java exception: 'access denied 
(java.io.FilePermission for logmirror.ctrl if database was not shutdown cleanly
after previous access. Fix uses existing privExists method to access the file,
avoiding the SecurityException.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r427795 | davidvc | 2006-08-01 16:40:24 -0700 (Tue, 01 Aug 2006) | 2 lines

Fixed eol-style on these master files

------------------------------------------------------------------------
r427458 | bandaram | 2006-07-31 23:16:47 -0700 (Mon, 31 Jul 2006) | 4 lines

DERBY-1608: Recognize newly added SYSFUC routines as system builtin functions. Builtin functions don't need authorization checks and have execute permission to PUBLIC by default.

Submitted by Satheesh Bandaram (satheesh@gmail.com)

------------------------------------------------------------------------
r427434 | djd | 2006-07-31 20:56:52 -0700 (Mon, 31 Jul 2006) | 2 lines

DERBY-1609 (partial) Put in temp fix for ij to allow tests to continue to run against jdk 1.3

------------------------------------------------------------------------
r427358 | bandaram | 2006-07-31 16:23:27 -0700 (Mon, 31 Jul 2006) | 4 lines

DERBY-1367: Enable grantRevoke.java test in DerbyNetClient framework.

Submitted by Satheesh Bandaram (satheesh@gmail.com)

------------------------------------------------------------------------
r427354 | djd | 2006-07-31 16:12:25 -0700 (Mon, 31 Jul 2006) | 2 lines

DERBY-1609 (partial) fix build issue.

------------------------------------------------------------------------
r427298 | djd | 2006-07-31 14:42:26 -0700 (Mon, 31 Jul 2006) | 7 lines

Change the JUnit JDBC client code to use DB2Client as the clearer name
when using DB2's JDBC driver, rather than the somewhat confusing DerbyNet.
DerbyNet is used in the old test harness, but going foward it would
be much clearer to call it what it is.
Use equality methods for checking which client is running, rather
than reference checks.
Add isEmbedded(, isDerbyNetClient and is isDB2Client methods to the JDBCClient class.
------------------------------------------------------------------------
r427293 | djd | 2006-07-31 14:35:23 -0700 (Mon, 31 Jul 2006) | 4 lines

DERBY-1609 (partial) Move initializing connections from system properties
in ij's utilMain into a separate method from the constructor. Allows ij's
runScript method to create a constructor without creating unrequired
connections based upon System properties.
------------------------------------------------------------------------
r427272 | fuzzylogic | 2006-07-31 14:07:28 -0700 (Mon, 31 Jul 2006) | 4 lines

DERBY-1606: Add comment regarding skip.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r427266 | fuzzylogic | 2006-07-31 14:02:51 -0700 (Mon, 31 Jul 2006) | 4 lines

DERBY-1607: Canon updates for j9 / j9_foundation.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r427237 | fuzzylogic | 2006-07-31 12:58:36 -0700 (Mon, 31 Jul 2006) | 5 lines

DERBY-1462: Sed out db.lck warnings from some store tests. These warnings are
printed when running the store tests with pre-1.4 JVMs on non-windows platforms.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r427232 | fuzzylogic | 2006-07-31 12:45:32 -0700 (Mon, 31 Jul 2006) | 4 lines

DERBY-1606: skip derbyrunjartest.java on j9/j9_foundation due to hang

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r427193 | fuzzylogic | 2006-07-31 11:33:53 -0700 (Mon, 31 Jul 2006) | 5 lines

DERBY-1605: To determine whether or not JVM has JDBC4, compare with 
java.specification.version, not java.vm.version.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r427190 | fuzzylogic | 2006-07-31 11:06:48 -0700 (Mon, 31 Jul 2006) | 6 lines

DERBY-1091: Don't prepend a caret to jvmflags in RunSuite if the system
properties are empty, but the suite property is not. Fixes several tests
for J2ME (j9_foundation).

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r427131 | bandaram | 2006-07-31 07:48:21 -0700 (Mon, 31 Jul 2006) | 4 lines

Disable attempting to drop permission descriptors in non SQL authorization mode. In soft upgrade mode to 10.2, it is possible not to have permission catalogs at all.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r427118 | bandaram | 2006-07-31 07:01:57 -0700 (Mon, 31 Jul 2006) | 4 lines

Update couple of missed master files.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r427112 | rhillegas | 2006-07-31 06:19:08 -0700 (Mon, 31 Jul 2006) | 1 line

DERBY-1417: Commit derby-1417-6d-clientimpl.diff, the network client implementation of lengthless overloads for the streaming api, introduced by JDBC4.
------------------------------------------------------------------------
r426893 | djd | 2006-07-30 08:16:07 -0700 (Sun, 30 Jul 2006) | 2 lines

DERBY-1609 (partial) Have ij.runScript use utilMain directly, rather than Main,
to avoid one additional object.
------------------------------------------------------------------------
r426890 | djd | 2006-07-30 08:00:34 -0700 (Sun, 30 Jul 2006) | 1 line

Fix mistakes in last checkin.
------------------------------------------------------------------------
r426887 | djd | 2006-07-30 07:40:08 -0700 (Sun, 30 Jul 2006) | 1 line

Minor cleanup in ij code, make methods non-public and remove an un-required method.
------------------------------------------------------------------------
r426849 | djd | 2006-07-29 16:20:40 -0700 (Sat, 29 Jul 2006) | 3 lines

DERBY-1609 (partial) Add a runScript method to ij. Initial version runs a script
successfully using the passed in connection. More work is needed to avoid the
standard ij startup which opens connections and to return the number of errors.
------------------------------------------------------------------------
r426847 | bandaram | 2006-07-29 16:12:58 -0700 (Sat, 29 Jul 2006) | 10 lines

DERBY-1543:This patch should address these two left over items in GRANT/REVOKE implementation. Some implementation notes:

1) Now Derby raises an SQLWarning when SQL authorization is ON without authentication at connect time. This is done by checking if AuthenticationService being used is an instance of NoneAuthenticationServiceImpl. Since this is the default authentication service with Derby, it should always be present.

2) Added code to drop permission descriptors from SYSTABLEPERMS, SYSCOLPERMS and SYSROUTINEPERMS when the object they provide permission for is dropped. This includes tables, views and routines and these descriptors needs to be removed from permissionCache as well.

I have tested the cases when PermissionsDescriptors are in cache also.

Submitted by Satheesh Bandaram (bandaram@gmail.com)

------------------------------------------------------------------------
r426825 | djd | 2006-07-29 09:44:47 -0700 (Sat, 29 Jul 2006) | 2 lines

DERBY-766 (partial) Add check to ensure a generated method is no split if it contains a return
instruction in the middle.
------------------------------------------------------------------------
r426671 | djd | 2006-07-28 14:30:36 -0700 (Fri, 28 Jul 2006) | 2 lines

DEBRY-1609 (partial) Minor cleanup in ij.Main.java, remove unused field & method
and make two public fields private.
------------------------------------------------------------------------
r426570 | rhillegas | 2006-07-28 08:40:42 -0700 (Fri, 28 Jul 2006) | 1 line

DERBY-1510: Commit derby-1510-1a.diff, fixing an infinite loop.
------------------------------------------------------------------------
r426398 | kahatlen | 2006-07-27 23:15:26 -0700 (Thu, 27 Jul 2006) | 6 lines

DERBY-1586: The attributesAsPassword property doesn't work correctly
with EmbeddedConnectionPoolDataSource

Forward the requestPassword parameter from createPooledConnection() to
EmbedPooledConnection's constructor.

------------------------------------------------------------------------
r426315 | djd | 2006-07-27 16:08:02 -0700 (Thu, 27 Jul 2006) | 8 lines

Add a utility JUnit TestCase that runs .sql scripts using ij
similar to the test harness, but much simpler.
Compares the master files using simple line by line assertEquals.
No sedding of output is performed (or should be :-).
Added one JUnit suite lang/LangScripts that runs a handful of .sql tests.
Currently a work-in progress, it has not been added to derbyall.


------------------------------------------------------------------------
r426310 | djd | 2006-07-27 15:58:12 -0700 (Thu, 27 Jul 2006) | 1 line


------------------------------------------------------------------------
r426308 | djd | 2006-07-27 15:56:43 -0700 (Thu, 27 Jul 2006) | 7 lines

Add framework code to BaseTestCase to automatically install the security manager
with the default test policy file for every JUnit test. Security manager
code separated into SecurityManagerSetup for clarity. Allows Derby JUnit
tests to be run via JUnit test runners without specifiying any system
properties.
Not enabled at the moment, needs testing, can be enabled by commenting
out line in runBase in BaseTestCase.
------------------------------------------------------------------------
r426048 | andreask | 2006-07-27 05:43:51 -0700 (Thu, 27 Jul 2006) | 1 line

updated policy to be in line with permissions granted for derbyclient.jar in derby_tests.policy. Follow-up to DERBY-1545. This should enable running the server host on a remote machine when running the testProtocol test.
------------------------------------------------------------------------
r425987 | kahatlen | 2006-07-27 00:26:57 -0700 (Thu, 27 Jul 2006) | 23 lines

DERBY-1546: Derby JDBC 4.0 driver returns 3 for JDBC driver major version

Description of the changes:

  * EmbedDatabaseMetaData40 and NetDatabaseMetaData40 override
    getJDBCMajorVersion() and getJDBCMinorVersion().

  * jdbcapi/dbMetaDataJdbc30.java was modified to print "AS EXPECTED"
    instead of the returned value from the JDBC version methods (of
    course, it prints something else if the version is not as
    expected). This was done in order to avoid the need for separate
    jdk16 canons.

  * TestUtil.getJDBCMajorVersion() was updated to recognize JDBC major
    version > 3.

  * Fixed a bug in build.xml in functionTests/util. TestUtil.java is
    incorrectly compiled with source and target level 1.4. It works
    correctly after an 'ant clobber' because some other 1.3 class
    depends on it and causes it to be compiled as part of another ant
    target, but if TestUtil.java is the only file that needs
    recompilation, jdk 1.4 is used.

------------------------------------------------------------------------
r425941 | djd | 2006-07-26 20:37:51 -0700 (Wed, 26 Jul 2006) | 5 lines

Add a PrepareExecuteDDL JUnit test with initial cases that tests preparing statements
and then executing DDL before executing the prepared statement.
Add support to compile Junit tests in the functionTests/lang package.


------------------------------------------------------------------------
r425923 | djd | 2006-07-26 17:46:43 -0700 (Wed, 26 Jul 2006) | 2 lines

Add some JUnit JDBC utility methods, compare the meta data for a select list
with DatabaseMetaData and a method to drain a ResultSet. 
------------------------------------------------------------------------
r425846 | djd | 2006-07-26 14:26:49 -0700 (Wed, 26 Jul 2006) | 5 lines

DERBY-1521 Attaching a patch 'd1521-patch1-v1.diff' which modifies UpgradeTester to test the grant/revoke feature. This is a preliminary patch which tests the default upgrade behaviour: In upgrades from versions earlier than 10.2,
* grant/revoke feature is not available in soft upgrade
* grant/revoke feature is not available in full upgrade (by default). This feature will be available after full upgrade only if "derby.database.sqlAuthorization" is true. 

Patch contributed by Deepa Remesh
------------------------------------------------------------------------
r425836 | djd | 2006-07-26 13:36:41 -0700 (Wed, 26 Jul 2006) | 5 lines

DERBY-1539 Supports basic revoke functionality for triggers.
If revoke statement finds a trigger dependent on the table/column/routine
on which privilege is being revoked, the trigger will be dropped automatically.

Patch contributed by Mamta Satoor
------------------------------------------------------------------------
r425820 | djd | 2006-07-26 12:53:16 -0700 (Wed, 26 Jul 2006) | 2 lines

Cleanup of SPSDescriptor to remove setting of unused field paramDefaults.
Field still exists more work to do remove it entirely
------------------------------------------------------------------------
r425814 | djd | 2006-07-26 12:41:58 -0700 (Wed, 26 Jul 2006) | 1 line

Minor cleanup in some data dictionary descriptors moving towards the identity being immmutable
------------------------------------------------------------------------
r425781 | suresht | 2006-07-26 10:11:33 -0700 (Wed, 26 Jul 2006) | 7 lines

DERBY -1156 (partial) re-encryption of the database.

This patch adds a new test that tests recovery of the database 
if the engine crashes just before committing the re-encryption
with a new password phrase. Crash is simulated using the debug flags. 


------------------------------------------------------------------------
r425772 | rhillegas | 2006-07-26 09:24:47 -0700 (Wed, 26 Jul 2006) | 1 line

DERBY-1540: Committed derby-1540_v01.diff, which causes this test to run under the SecurityManager.
------------------------------------------------------------------------
r425765 | rhillegas | 2006-07-26 08:45:40 -0700 (Wed, 26 Jul 2006) | 1 line

DERBY-1541: Committed derby-1541_v01.diff, which deletes a cruft file.
------------------------------------------------------------------------
r425732 | andreask | 2006-07-26 06:42:14 -0700 (Wed, 26 Jul 2006) | 1 line

DERBY-1545 derbynet/testProtocol.java fails with security manager enabled. Fixed by granting SocketPermission in policy file for the test
------------------------------------------------------------------------
r425726 | andreask | 2006-07-26 06:05:02 -0700 (Wed, 26 Jul 2006) | 1 line

DERBY-1587 INTEGER function cannot be abbreviated by INT. Fix consists of one LOC change in sqlgrammar.jj and updates of master files. Contributed by Yip Nig
------------------------------------------------------------------------
r425719 | kahatlen | 2006-07-26 05:19:42 -0700 (Wed, 26 Jul 2006) | 8 lines

DERBY-1563: derbynet/ShutDownDBWhenNSShutsDownTest.junit fails on
Solaris sparc

The attached patch (derby-1563.diff) fixes the problem by waiting
before checking if the file exists.

Patch contributed by Fernanda Pizzorno.

------------------------------------------------------------------------
r425703 | kahatlen | 2006-07-26 04:12:32 -0700 (Wed, 26 Jul 2006) | 7 lines

DERBY-1571: NetworkServerControlImpl.consoleExceptionPrintTrace()
prints stack trace even when logWriter is null

Made NetworkServerControlImpl.shutdown() set logWriter to a silent
stream instead of null to avoid printing stack traces of expected
exceptions during shutdown.

------------------------------------------------------------------------
r425479 | djd | 2006-07-25 11:26:33 -0700 (Tue, 25 Jul 2006) | 5 lines

DERBY-1581 Avoid reloading the Provider from the data dictionary when
executing an invalidateFor on the Provider. Previosuly the code
when loading the stored dependencies and converting them to an in-memory from
reloaded the provider once per dependent. This patch re-uses the Provider
passed into the invalidateFor method.
------------------------------------------------------------------------
r425472 | djd | 2006-07-25 11:08:16 -0700 (Tue, 25 Jul 2006) | 2 lines

Convert JUnit ProcedureTest to use the BaseJDBCTestSetup as the parent class
for its decarator.
------------------------------------------------------------------------
r425457 | davidvc | 2006-07-25 09:53:51 -0700 (Tue, 25 Jul 2006) | 2 lines

Fixed copyright date per Dan's comment

------------------------------------------------------------------------
r425446 | davidvc | 2006-07-25 09:22:05 -0700 (Tue, 25 Jul 2006) | 6 lines

DERBY-1578 - A number of tests fail due to rework on toString() method 
of SQLException.

derbyall passes clean now, except I am getting some diffs in some
i18n tests due to locale differences.  Not sure how to fix those.

------------------------------------------------------------------------
r425391 | andreask | 2006-07-25 06:18:45 -0700 (Tue, 25 Jul 2006) | 1 line

updated source file header for recently added file to comply with new policy. Initial source file also had incorrect copyright dates. It was added as part of DERBY-1296.
------------------------------------------------------------------------
r425388 | andreask | 2006-07-25 05:58:18 -0700 (Tue, 25 Jul 2006) | 1 line

DERBY-1296 Setting property derby.system.bootAll causes NullPointerException in BaseMonitor.bootProviderServices. Fix and test contributed by Fernanda Pizzorno
------------------------------------------------------------------------
r425385 | kahatlen | 2006-07-25 05:21:38 -0700 (Tue, 25 Jul 2006) | 6 lines

DERBY-1586 (partial) The attributesAsPassword property doesn't work
correctly with EmbeddedConnectionPoolDataSource

This patch adds a JUnit test which reproduces the bug. The test is not
run in any suite since the bug is not fixed.

------------------------------------------------------------------------
r425326 | kahatlen | 2006-07-25 01:12:41 -0700 (Tue, 25 Jul 2006) | 2 lines

DERBY-1536: Adding assert in unwrap test jdbc4/ConnectionTest.junit

------------------------------------------------------------------------
r425184 | bandaram | 2006-07-24 13:59:04 -0700 (Mon, 24 Jul 2006) | 4 lines

Fix a typo in sqlgrammar. REVOKE statement needs DD_VERSION_DERBY_10_2 or higher not 10_1 as in the code. Other GRANT/REVOKE statements correctly require DD_VERSION_DERBY_10_2 in the code.

Submitted by Satheesh Bandaram(bandaram@gmail.com)

------------------------------------------------------------------------
r425130 | djd | 2006-07-24 10:35:18 -0700 (Mon, 24 Jul 2006) | 1 line

DERBY-1581 (partial) Fix build error in PermissionsDescriptor.
------------------------------------------------------------------------
r425126 | djd | 2006-07-24 10:27:36 -0700 (Mon, 24 Jul 2006) | 3 lines

Minor cleanup on the StatementPermission objects, clarify that these classes represent the
permissions required by a statement (not used) and change come fields to private to avoid
other code being able to change them to subvert the system.
------------------------------------------------------------------------
r425116 | djd | 2006-07-24 09:50:09 -0700 (Mon, 24 Jul 2006) | 2 lines

DERBY-1581 (partial) Clean-up some descriptor objects as a step to ensuring their identity is immutable
once created and/or fully populated. Remove some unused methods.
------------------------------------------------------------------------
r424686 | kahatlen | 2006-07-23 01:04:08 -0700 (Sun, 23 Jul 2006) | 5 lines

DERBY-1572: Output from tools/derbyrunjartest.java can be mixed

Wait until all output from one command has been saved before executing
the next command.

------------------------------------------------------------------------
r424616 | djd | 2006-07-22 11:33:30 -0700 (Sat, 22 Jul 2006) | 1 line

Remove unused old modifiesTableUUID method from the ConstantAction hierarchy.
------------------------------------------------------------------------
r424539 | tmnk | 2006-07-22 02:00:08 -0700 (Sat, 22 Jul 2006) | 1 line

- DERBY-1513_1535 Trial 1 for DERBY-550 & Trial 2 for DERBY-550 - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r424389 | davidvc | 2006-07-21 10:02:25 -0700 (Fri, 21 Jul 2006) | 4 lines

DERBY-1438: Text written by SQLException.toString differs between client and
embedded driver.  This includes a one-line change to source and 1 MB of
changes to master files.  Sigh...

------------------------------------------------------------------------
r424388 | djd | 2006-07-21 09:54:14 -0700 (Fri, 21 Jul 2006) | 4 lines

DERBY-1555 DERBY-1562 (partial) Add new classes BaseJDBCTestSetup and JDBC to support
JDBC Unit test development.
BaseJDBCTestSetup is a TestSetup decorator for setup that uses JDBC.
JDBC class is a holder for JDBC test utility methods.
------------------------------------------------------------------------
r424368 | djd | 2006-07-21 09:02:27 -0700 (Fri, 21 Jul 2006) | 2 lines

DERBY-1555 (partial) Move the code to obtain a default connection into TestConfiuration
for the JUnit test setup to allow it to be shared across multiple classes.
------------------------------------------------------------------------
r424135 | djd | 2006-07-20 16:49:23 -0700 (Thu, 20 Jul 2006) | 1 line

DERBY-1555 (partial) Minor cleanup on some JUnit tests, make the base test classes abstract.
------------------------------------------------------------------------
r424072 | kahatlen | 2006-07-20 14:32:15 -0700 (Thu, 20 Jul 2006) | 15 lines

DERBY-323: Locale problem in test of derby

Description of the patch:

  1) Rewrite tools/derbyrunjartest.java to use jvm.getCommandLine() to
     get the command line to start the test with.

  2) Move the setting of user.language and user.country from RunTest
     and NetServer to jvm.getCommandLine(). This way, all of the java
     processes that are forked from the test harness or from a test
     get the same locale.

  3) Add Locale.setDefault(Locale.US) to RunTest.main(). This fixes
     the issue with the nist tests.

------------------------------------------------------------------------
r423989 | bandaram | 2006-07-20 10:09:03 -0700 (Thu, 20 Jul 2006) | 16 lines

DERBY-781: Materialize select subqueries where possible to avoid recreating their resultsets multiple times. Here is more info from the contributor.

Attaching a patch (d781_v1.patch) to address this issue by allowing the optimizer to consider and choose hash joins with subqueries, which is a more general case of the specific union example mentioned in the description for this issue.  In brief, the patch does this by following up on the suggestions given by Jeff Lichtman in comments above and also in the following thread:

http://article.gmane.org/gmane.comp.apache.db.derby.devel/12208

Since result set materialization comes for "free" with hash joins, that fact we now allow hash joins with subqueries (as of this patch) means that we implicitly have a way to materialize the subquery result sets.

The details of the patch are included as DERBY-781_v1.html.  I added a simple test to lang/subquery.sql to demonstrate that the optimizer can and will choose to do hash joins for subqueries, and I updated one other master file--predicatesIntoViews--for which the optimizer is now choosing a hash join instead of a nested loop.  Testing of "unsafe" hash joins (see section VII of the document) and generation of correct plans is done through existing tests, esp. the lang/lojreorder.sql test, which was very useful in helping to verify the correctness of the changes.

Note that I did not add the sample union query shown in the description for this issue to the tests because when I run it against the current codeline, the optimizer will already choose to do materialization of the UnionNode (via hash join) even without the patch for this issue, and thus it didn't seem like that particular test case was useful.  The new test in subqery.sql is more relevant because the optimizer will choose to do a nested loop join with the subquery before my changes and will do a hash join after my changes, which seems to more accurately reflect what this issue is about.

I ran derbyall using sane jars on Red Hat Linux with ibm142 and saw no new failures, and the overall execution time does not change despite the extra work the optimizer is doing.

Submitted by Army Brown (qozinx@gmail.com)

------------------------------------------------------------------------
r423976 | rhillegas | 2006-07-20 09:22:18 -0700 (Thu, 20 Jul 2006) | 1 line

DERBY-1029: Commit derby-1029_v05.diff, backing out the BOOLEAN datatype introduced by DERBY-499.
------------------------------------------------------------------------
r423949 | djd | 2006-07-20 07:59:31 -0700 (Thu, 20 Jul 2006) | 21 lines

DERBY-1330 (partial) Currently, in case of revoke privilege, DataDictionary.addRemovePermissionsDescriptor expects
it's callers to set the permission descriptor's uuid so that DependencyManager can be invoked by
addRemovePermissionsDescriptor to send REVOKE_PRIVILEGE action to permission descriptor's dependents
(sending of REVOKE_PRIVILEGE work has not been finished yet.
This patch is in preparation of that work). In order to set the uuid, the callers have to goto system
tables to find the uuid and then set the permission descriptor's uuid.

It will be less error prone if DataDictionary.addRemovePermissionsDescriptor did the setting of uuid of
permission descriptor, rather than having every caller set the uuid correctly.
DataDictionary.addRemovePermissionsDescriptor method has to goto the permission system tables anyways
and has the uuid information handy and hence it will be more efficient for it to set the uuid of the
permission descriptor. This is inline with the patch that was commited some time back so that resetting
of the uuid happened in addRemovePermissionsDescriptor method rather than expecting the callers to do that.

In order to do this, I have added an abstract method to PermissionsCatalogRowFactory called setUUIDOfThePassedDescriptor.
 This method will set the uuid of the passed permission descriptor to same value as the row corresponding to the
permission system table which is also passed as a parameter. This method will be called by
DataDictionary.addRemovePermissionsDescriptor. 

Patch submitted by Mamta Satoor.

------------------------------------------------------------------------
r423912 | kahatlen | 2006-07-20 04:54:35 -0700 (Thu, 20 Jul 2006) | 2 lines

DERBY-1527: Factor out type checks in EmbedResultSet and EmbedPreparedStatement

------------------------------------------------------------------------
r423827 | kahatlen | 2006-07-20 01:42:06 -0700 (Thu, 20 Jul 2006) | 5 lines

DERBY-1443: DataTypeDescriptor.isBinaryType() return false for Types.BLOB

Adding javadoc for isBinaryType() and isCharacterType() clarifying why
they return false for BLOB and CLOB.

------------------------------------------------------------------------
r423807 | kahatlen | 2006-07-19 23:48:31 -0700 (Wed, 19 Jul 2006) | 7 lines

DERBY-1417 (partial) Add new, lengthless overloads to the streaming api

Add the new overloads to the Brokered* classes and update
UnsupportedVetter with the methods we support.

Patch contributed by Kristian Waagan.

------------------------------------------------------------------------
r423800 | kahatlen | 2006-07-19 23:25:01 -0700 (Wed, 19 Jul 2006) | 2 lines

DERBY-1536: Extend tests for Wrapper interface

------------------------------------------------------------------------
r423754 | bandaram | 2006-07-19 21:32:04 -0700 (Wed, 19 Jul 2006) | 8 lines

DERBY-1357: Fix optimizer short-circuit logic. Here is the note from the contributor.

I also had to update the lang/predicatePushdown.out master file because with the d1357_v1.patch the order of a couple of qualifiers has changed. Note that the query plans themselves are exactly the same--the only thing that's changed is the the qualifier ordering for one query. This change of order occurs because as part of the costing code in FromBaseTable.estimateCost() the optimizer transfers predicates from one predicate list to another, gets an estimated cost, then puts the predicates back into the original list. The methods to do this transferring are in NestedLoopJoinStrategy.java and HashJoinStrategy.java. In the former, the predicates are transferred away in front-to-back order and then transferred back in back-to-front order, which leads to a reversal of the relevant predicate ordering. Ex. If we have a list L1 of preds A,B,C and we transfer them to L2 in front-to-back order, L2 will end up with A,B,C. Then, when we transfer the predicates back to L1, if we process L2 in back-to-front order, L1 will end up with C,B,A. That said, with d1357_v1 applied the short-circuit logic prevents the optimizer from trying to optimize a join order that is known to be bad. This means that we skip an unnecessary round of optimization and therefore skip one round of order reversal, which means the order of the predicate qualifiers in the final plan is now different.

I ran derbyall on Red Hat with sane jars and ibm142, and saw no new failures.

Submitted by Army Brown (qozinx@gmail.com)

------------------------------------------------------------------------
r423682 | suresht | 2006-07-19 17:37:07 -0700 (Wed, 19 Jul 2006) | 12 lines

DERBY-1373: Encrypted databases cannot be booted using the jar subprotocol 

Patch Contributed by Sunitha Kambhampati.

This patch makes the following changes:
1) Instead of using RandomAccessFile, the verifyKey.dat is read 
   as a InputStream.

2) Add a new test (encryptionKey_jar.sql) for booting encrypted 
  database using encryptionKey via classpath, and jar subprotocol.


------------------------------------------------------------------------
r423676 | djd | 2006-07-19 17:20:05 -0700 (Wed, 19 Jul 2006) | 3 lines

Mark test jdbc4/TestQueryObject as failing with the SecurityManager due to DERBY-1540
Remove disablein of SecurityManager for derbynet/testProtocol as it passes with the SecurityManager.

------------------------------------------------------------------------
r423616 | djd | 2006-07-19 14:37:47 -0700 (Wed, 19 Jul 2006) | 3 lines

derbynet/DerbyNetNewServer test now passes with the security manager.
Add comment as to why derbynet/testij runs without the security manager.

------------------------------------------------------------------------
r423577 | djd | 2006-07-19 12:23:32 -0700 (Wed, 19 Jul 2006) | 2 lines

Add Jira issue number (DERBY-537) comment to why dblook_test_net test is not run under the security manager.

------------------------------------------------------------------------
r423494 | rhillegas | 2006-07-19 08:30:39 -0700 (Wed, 19 Jul 2006) | 1 line

DERBY-1344: Commit bug1344-bumplastdigit_5.diff, bumping the last digit of the release identifier after generating the 10.2.0.4 snapshot.
------------------------------------------------------------------------
r423427 | kahatlen | 2006-07-19 03:34:00 -0700 (Wed, 19 Jul 2006) | 3 lines

DERBY-1534: Add BaseJDBCTestCase.assertSQLState() overload with no
message parameter

------------------------------------------------------------------------
r423352 | fuzzylogic | 2006-07-18 20:28:10 -0700 (Tue, 18 Jul 2006) | 4 lines

DERBY-1330 (partial) Commit javadoc fixes introduced by previous 1330 patch.

Committed for Mamta Satoor <msatoor@gmail.com>

------------------------------------------------------------------------
r423348 | fuzzylogic | 2006-07-18 19:54:01 -0700 (Tue, 18 Jul 2006) | 2 lines

runall files are not properties files. :-)

------------------------------------------------------------------------
r423266 | djd | 2006-07-18 15:11:50 -0700 (Tue, 18 Jul 2006) | 14 lines

DERBY-551  Adds a new reliability bit mask(MODIFIES_SQL_DATA_PROCEDURE_ILLEGAL) to CompilerContext.
Sets the above reliability for before triggers before binding the actionNode in CreateTriggerNode.
Checks the above reliability in CallStatementNode. After the called procedure is resolved, the sql allowed
by the procedure is checked and if it is "modifies sql data" and if we have set the reliability to
MODIFIES_SQL_DATA_PROCEDURE_ILLEGAL, it means we are calling a procedure that modifies sql data in the
action statement of a before trigger. In this case, an exception is thrown and trigger creation fails.
Removes the check in InternalTriggerExecutionContext.validateStatement which was used to catch the use of DML
in before triggers. This is a redundant check as use of DML in before triggers is now caught at compile time.
Added a comment to indicate this.
Adds a new message to indicate procedures that modify sql data are not allowed in before triggers.
Reuses the same SQLState as for invalid statement in triggers. 

Patch submitted by Deepa Remesh

------------------------------------------------------------------------
r423232 | djd | 2006-07-18 13:23:55 -0700 (Tue, 18 Jul 2006) | 3 lines

DERBY-1330 (partial) There is a typo in SYSROUTINEPERMSRowFactory.java for one of the variables and this patch fixes just that.
Patch submitted by Mamta Satoor

------------------------------------------------------------------------
r423141 | davidvc | 2006-07-18 10:22:33 -0700 (Tue, 18 Jul 2006) | 5 lines

DERBY-1395: Change the client SQLState to match that of embedded for the 
exception thrown on a closed statement whose connection is also closed.
Also fix this for when the connection is still open, they were not
consistent.

------------------------------------------------------------------------
r423132 | fuzzylogic | 2006-07-18 09:57:26 -0700 (Tue, 18 Jul 2006) | 2 lines

Comment out sysinfo_api test due to problem when running with jars

------------------------------------------------------------------------
r423068 | kahatlen | 2006-07-18 05:17:58 -0700 (Tue, 18 Jul 2006) | 5 lines

DERBY-1417 (partial) Add new, lengthless overloads to the streaming api

Disable five test cases in the DerbyNetClient framework. Patch
contributed by Kristian Waagan.

------------------------------------------------------------------------
r423034 | andreask | 2006-07-18 03:02:24 -0700 (Tue, 18 Jul 2006) | 1 line

DERBY-802 OufOfMemoryError when using BLOB from scrollable insensitive result sets. The fix is to avoid the use of cloning the rows before inserting them into the BackingStoreHashTable. The BackingStoreHashTable has been fixed so that it does not do unnecessary cloning. The estimateMemoryUsage methods of SQLBinary and its subclasses has been improved to return a better estimate, so that rows with BLOBs will be backed to disk when using BackingStoreHashTable. Tests have been committed separately.
------------------------------------------------------------------------
r423033 | andreask | 2006-07-18 02:58:14 -0700 (Tue, 18 Jul 2006) | 1 line

extended tests created in DERBY-1477 with four new testcases which uses projection in the select statements. The tests are for verifying that we do not get OutOfMemory issues when reading and updating BLOBS
------------------------------------------------------------------------
r422995 | kahatlen | 2006-07-18 00:18:33 -0700 (Tue, 18 Jul 2006) | 30 lines

DERBY-1417 (partial) Add new, lengthless overloads to the streaming api

Tests and implementations for the following methods on the embedded side:
[ResultSet]
  public void updateAsciiStream(int columnIndex, InputStream x)
  public void updateBinaryStream(int columnIndex, InputStream x)
  public void updateCharacterStream(int columnIndex, Reader x)
  public void updateAsciiStream(String columnName, InputStream x)
  public void updateBinaryStream(String columnName, InputStream x)
  public void updateCharacterStream(String columnName, Reader reader)
  public void updateBlob(int columnIndex, InputStream x)
  public void updateBlob(String columnName, InputStream x)
  public void updateClob(int columnIndex, Reader x)
  public void updateClob(String columnName, Reader x)
[PreparedStatement]
  public void setBinaryStream(int parameterIndex, InputStream x)
  public void setAsciiStream(int parameterIndex, InputStream x)
  public void setCharacterStream(int parameterIndex, Reader reader)
  public void setClob(int parameterIndex, Reader reader)
  public void setBlob(int parameterIndex, InputStream inputStream)

*IMPORTANT*: This patch must be built with Mustang build 91 for the
 tests to compile!

Some of the tests are temporarily disabled for the client
driver. These will be enabed when the client implementation is
submitted.

Patch contributed by Kristian Waagan.

------------------------------------------------------------------------
r422991 | fuzzylogic | 2006-07-17 23:57:13 -0700 (Mon, 17 Jul 2006) | 4 lines

DERBY-1525: Update to JDK 1.3 master for syscat.out.

Committed for Mamta Satoor <msatoor@gmail.com>

------------------------------------------------------------------------
r422882 | kahatlen | 2006-07-17 14:28:14 -0700 (Mon, 17 Jul 2006) | 3 lines

Adding more detailed comments to DRDAProtocolExceptionInfo.java. Patch
contributed by Sunitha Kambhampati.

------------------------------------------------------------------------
r422876 | fuzzylogic | 2006-07-17 14:15:13 -0700 (Mon, 17 Jul 2006) | 3 lines

DERBY-982: Add genus names for network server and client to sysinfo api. Update
published api javadoc for sysinfo. Add a test of the sysinfo public api.

------------------------------------------------------------------------
r422826 | davidvc | 2006-07-17 13:01:38 -0700 (Mon, 17 Jul 2006) | 4 lines

DERBY-1466: Network Server should flush the PrintWriter after console output
Contributed by Sunitha Kambhampati.


------------------------------------------------------------------------
r422706 | kahatlen | 2006-07-17 05:48:58 -0700 (Mon, 17 Jul 2006) | 5 lines

DERBY-836/DERBY-1514: Failures in derbyall in trunk seen after
revision 421960

Updated master files. Patch contributed by Mayuresh Nirhali.

------------------------------------------------------------------------
r422689 | kahatlen | 2006-07-17 04:30:37 -0700 (Mon, 17 Jul 2006) | 5 lines

DERBY-1493: Implement PreparedStatement.setNull(int, int, String) in
the embedded driver.

Patch submitted by V. Narayanan.

------------------------------------------------------------------------
r422633 | fuzzylogic | 2006-07-16 23:27:01 -0700 (Sun, 16 Jul 2006) | 2 lines

Set svn:eol-style native on onlineBackupTest4.out

------------------------------------------------------------------------
r421981 | djd | 2006-07-14 11:37:20 -0700 (Fri, 14 Jul 2006) | 3 lines

DERBY-1330 (partial) Move the resetting of permission descriptor's uuid into DataDictionary.addRemovePermissionsDescriptor method.
Patch submitted by Mamta Satoor

------------------------------------------------------------------------
r421932 | djd | 2006-07-14 09:04:03 -0700 (Fri, 14 Jul 2006) | 10 lines

DERBY-836 Fix metadata information for DECIMAL columns.
There are 3 possible cases with respect to finding the correct maximum width for DECIMAL type.

1. If scale = 0, only sign should be added to precision to compute max width.
2. scale = precision, in this case 3 should be added to precision for sign, decimal and an additional char '0'.
3. precision > scale > 0, 2 shoud be added to precision for sign and decimal. 

Patch submitted by Mayuresh Nirhali - Mayuresh.Nirhali@Sun.COM


------------------------------------------------------------------------
r421920 | djd | 2006-07-14 08:17:37 -0700 (Fri, 14 Jul 2006) | 3 lines

DERBY-551 (partial) Adds more comments to InternalTriggerExecutionContext.validateStatement.
Patch submitted by Deepa Remesh

------------------------------------------------------------------------
r421887 | kahatlen | 2006-07-14 05:20:01 -0700 (Fri, 14 Jul 2006) | 24 lines

DERBY-1481: Client driver: ResultSet.beforeFirst() gives protocol
error on scrollable, updatable result sets that are downgraded to
read-only

When the result set is downgraded from updatable to read-only because
the query generating the result set cannot produce an updatable result
set, the result set will be downgraded on the server side, and a
warning (SQLCARD) indicating the downgrade will be sent to the
client. Warnings on the server side are not cleared after they are
sent to the client causing the server to send the same warning several
times.

Positioning commands like ResultSet.beforeFirst() that do not return
any data also do not expect warnings to be returned. The protocol
error was being caused by this downgrade warning that was being sent
several times, one of them being in a response to a
ResultSet.beforeFirst() command.

The attached patch (derby-1481.diff) fixed the problem by clearing the
warnings after they are sent so that the same warning will not be sent
more than once.

The patch was contributed by Fernanda Pizzorno.

------------------------------------------------------------------------
r421856 | kahatlen | 2006-07-14 03:15:07 -0700 (Fri, 14 Jul 2006) | 5 lines

DERBY-1274: Network Server does not shutdown the databases it has
booted when started and shutdown from the command line

Fix submitted by Fernanda Pizzorno.

------------------------------------------------------------------------
r421832 | fuzzylogic | 2006-07-14 01:04:40 -0700 (Fri, 14 Jul 2006) | 5 lines

DERBY-1499: Fix J2ME (wctme 5.7) tests due to reference to DriverManager
in RunList.unloadEmbeddedDriver().

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r421721 | suresht | 2006-07-13 15:45:40 -0700 (Thu, 13 Jul 2006) | 15 lines

DERBY -1156 (partial)
This patch adds some code required to support reconfigure(rencryption) of
an already existing encrypted database with a new password(secret key)
or an external user specified encryption key.

-- disables encryption/re-encryption of an existing database if there 
   are any global transaction in the prepared state after recovery. 

-- disables encryption/re-encryption of an existing database if database 
   is soft-upgraded to 10.2. 

-- Added a test that tests re-encryption of an encrypted database
   when global transaction are in the prepared state after recovery. 


------------------------------------------------------------------------
r421717 | rhillegas | 2006-07-13 15:22:25 -0700 (Thu, 13 Jul 2006) | 1 line

DERBY-1459: Commit bug1459_v04.diff. This introduces a dummy jdbc driver so that JDBC4 driver autoloading will play well with the engine booting which happens when the public embedded driver classloads.
------------------------------------------------------------------------
r421570 | kahatlen | 2006-07-13 02:55:04 -0700 (Thu, 13 Jul 2006) | 9 lines

DERBY-253: Client should throw not implemented exception for
depricated setUnicodeStream/getUnicodeStream

This patch replaces the existing implementation of setUnicodeStream
and getUnicodeStream in the client driver to just throw a SQL
exception with SQL state equal to feature not implemented.

Patch contributed by Olav Sandst?\195?\165.

------------------------------------------------------------------------
r421566 | andreask | 2006-07-13 02:48:25 -0700 (Thu, 13 Jul 2006) | 1 line

Follow-up to DERBY-1497.When throwing exception NET_LOB_DATA_TOO_LARGE_FOR_JVM, add the OutOfMemoryError as cause.
------------------------------------------------------------------------
r421497 | davidvc | 2006-07-12 21:21:11 -0700 (Wed, 12 Jul 2006) | 4 lines

DERBY-1015: Define interface between network server and engine through 
Java interfaces.  This revision commits the ResultSet interfaces.  
Contributed by Sunitha Khambhampati.

------------------------------------------------------------------------
r421460 | davidvc | 2006-07-12 16:29:15 -0700 (Wed, 12 Jul 2006) | 2 lines

DERBY-1015: Added new interfaces

------------------------------------------------------------------------
r421448 | fuzzylogic | 2006-07-12 15:39:02 -0700 (Wed, 12 Jul 2006) | 4 lines

DERBY-1507: Add test-specific policy file for lang/xmlBinding.java

Committed for Army Brown <qozinx@sbcglobal.net>

------------------------------------------------------------------------
r421435 | davidvc | 2006-07-12 15:05:50 -0700 (Wed, 12 Jul 2006) | 5 lines

DERBY-1015: Define interface between network server and engine through 
Java interfaces.  Contributed by Sunitha Kambhampati.  Passes 
derbynetclientmats.


------------------------------------------------------------------------
r421281 | djd | 2006-07-12 07:57:29 -0700 (Wed, 12 Jul 2006) | 14 lines

DEBRY-551 (partial) This patch allows invoking procedures in triggered sql statement.

* Modifies the parser to allow call statement in the trigger action.

* Changes the validateStatement in InternalTriggerExecutionContext to catch following statements not allowed in triggers:
   - DDL statements are not allowed in triggers. This was caught as an assert failure as this would be caught at compile time in case of direct use of DDL statements. Since use of DDL statement inside a procedure will not be caught at compile time, patch changes the assert to a SQLException.
   - Insert, update, delete statements are not allowed in a before trigger. On the same lines, a procedure that modifies sql data should not be allowed in a before trigger. This is also caught at runtime. This uses the existing check in InternalTriggerExecutionContext.validateStatement. However, the existing check was limited to the trigger table. This check was modified to check for use of insert,update,delete statements on any table.

* Adds a new test lang/procedureInTrigger.sql to derbylang suite. The test is based on the scenarios in ' ProcedureInTrigger_Tests_v1.html'. Only one case (calling procedures that modify SQL data in before triggers) is handled differently by this patch. Trigger creation will pass but firing will fail. This behaviour will change once we move this check to compile time. So I have not modified the test case document. Also, I have not added the test cases for recursive triggers as I am not sure about the expected behaviour. This is being discussed as part of DERBY-1261 on derby-dev.

* Modifies tests and master files which used to check that call statement cannot be part of trigger action. 

Patch contributed by Deepa Remesh - dremesh@gmail.com

------------------------------------------------------------------------
r421255 | kahatlen | 2006-07-12 05:24:18 -0700 (Wed, 12 Jul 2006) | 11 lines

DERBY-1476: PreparedStatement.setNull(int,int) should throw
SQLFeatureNotSupportedException for unsupported types

derby-1476-v1.diff adds a call to checkForSupportedDataType() in
setNull(). It also moves that call in setObject() after 'if (obj ==
null) { setNull(pos, type); return; }' in order to avoid double
checking. New test cases have been added to SetObjectUnsupportedTest
so that it tests setObject(int,Object,int),
setObject(int,Object,int,int), setNull(int,int) and
setNull(int,int,String).

------------------------------------------------------------------------
r421218 | kahatlen | 2006-07-12 03:13:38 -0700 (Wed, 12 Jul 2006) | 12 lines

DERBY-1503: Make jdbc4/StatementEventsTest.junit test callable statements

The patch changes StatementEventsTest the following way:

 1) New methods setXA() and setCallable() which make it possible to
    use the same test method to test XAConnection/PooledConnection
    and PreparedStatement/CallableStatement.

 2) Split the test methods into smaller ones.

 3) Use asserts to report errors instead of System.out.println().

------------------------------------------------------------------------
r421179 | kahatlen | 2006-07-12 00:43:05 -0700 (Wed, 12 Jul 2006) | 7 lines

DERBY-1502: Non-deterministic behavior of lang/grantRevokeDDL.sql

I have created a sed file to remove the error messages from the
test. This will mask the privilege ordering in the HashMap object.

Patch contributed by Mamta A. Satoor.

------------------------------------------------------------------------
r421118 | djd | 2006-07-11 21:48:05 -0700 (Tue, 11 Jul 2006) | 8 lines

DERBY-1330 (partial) The patch gets rid of requirement of permission type along with the uuid to find a unique row.
Fixing this has in fact cleaned up the supporting code quite a bit. For instance, there is no need for special
class DDColumnPermissionDependableFinder or no need for a constructor in ColPermsDescriptor which takes permission
types in the form of an int. DDdependableFinder is much cleaner too with this patch. In addition, I have also created
a unique index on the uuid for these 3 system tables in order to quickly locate a row in those system tables.

Patch contributed by Mamta Satoor

------------------------------------------------------------------------
r421015 | djd | 2006-07-11 15:30:38 -0700 (Tue, 11 Jul 2006) | 3 lines

DERBY-1142 Stop memory leak for embedded metadata queries. Mark the embedded ResultSet as having a single use
activation so that upon a close its activation.

------------------------------------------------------------------------
r420892 | mikem | 2006-07-11 08:16:42 -0700 (Tue, 11 Jul 2006) | 4 lines

Improved the comments in some of the routines while debugging a DERBY-1248.
Separating the formatting/comment changes from the real fix.


------------------------------------------------------------------------
r420863 | andreask | 2006-07-11 07:17:28 -0700 (Tue, 11 Jul 2006) | 1 line

DERBY-1498 avoid tracing of LOB data in DRDAConnThread.readAndSetExtParams(..)
------------------------------------------------------------------------
r420821 | andreask | 2006-07-11 05:36:16 -0700 (Tue, 11 Jul 2006) | 1 line

DERBY-1497 assert failure in MessageUtil, because exception thrown with too many parameters when handling OutOfMemoryError
------------------------------------------------------------------------
r420656 | djd | 2006-07-10 16:12:31 -0700 (Mon, 10 Jul 2006) | 4 lines

DERBY-1142 (partial) Make EmbedResultSet close its activation in the close method when it is
single use ResultSet (e.g. from a Statement.executeQuery()). Otherwise the close of the activation
would be delayed until the EmbedResultSet was garbage collected and subsequent activity on the connection.

------------------------------------------------------------------------
r420535 | andreask | 2006-07-10 07:17:10 -0700 (Mon, 10 Jul 2006) | 1 line

DERBY-1351 lang/forupdate fails with invalid cursorname. Sed used to filter cursorname. Contributed by Fernanda Pizzorno
------------------------------------------------------------------------
r420522 | andreask | 2006-07-10 06:46:15 -0700 (Mon, 10 Jul 2006) | 1 line

DERBY-1352 force locale to be en_US when running tests from harness. The fix sets the system properties user.language=en and user.country=US for the VM of the test and for the VM of the network server when started from test harness. This ensures that tests like derbynet/sysinfo.java can run without filtering out all output
------------------------------------------------------------------------
r420497 | kahatlen | 2006-07-10 04:41:55 -0700 (Mon, 10 Jul 2006) | 13 lines

DERBY-1417: Add new, lengthless overloads to the streaming api

'derby-1417-2a-rstest-refactor.diff' refactors and rewrites parts of
jdbc4/ResultSetTest.junit. A few utility methods have been introduced,
and a TestSetup-class (anonymous) was used to create the table
once. This was done because the previous implementation could cause
other tests to fail if one test failed.

The utility methods follow a pattern that will also be used by a
number of tests written for the new lengthless overloads.

Patch contributed by Kristian Waagan.

------------------------------------------------------------------------
r420465 | kahatlen | 2006-07-10 02:04:57 -0700 (Mon, 10 Jul 2006) | 5 lines

DERBY-989: unit/daemonService.unit fails intermittently: 'ran out of time'

Updated the javadoc for DaemonService and BasicDaemon with information about
the case where unsubscribe() is called when the client is being serviced.

------------------------------------------------------------------------
r420436 | kahatlen | 2006-07-09 23:31:33 -0700 (Sun, 09 Jul 2006) | 22 lines

DERBY-1393: PreparedStatement.setObject(int,Object,int) should throw
SQLFeatureNotSupportedException for unsupported types

Description of the patch:

  The new setObject() methods call checkForSupportedDataType() to
  check whether targetSqlType is supported.

  Added a new error message "The data type ''{0}'' is not supported."
  with SQL state 0A000 (which ensures that the exception is converted
  to SQLFeatureNotSupportedException). This error message is used when
  targetSqlType is not supported.

  Added more JDBC 4.0 constants (from java.sql.Types) to
  JDBC40Translation and created a test JDBC40TranslationTest which
  tests that the constants are correct (the values of the constants
  are hard coded, so we don't get the compile-time check as with
  JDBC{2,3}0Translation).

  New test case SetObjectUnsupportedTest which is run as part of
  PreparedStatementTest and CallableStatementTest in the jdbc40 suite.

------------------------------------------------------------------------
r420312 | djd | 2006-07-09 09:35:43 -0700 (Sun, 09 Jul 2006) | 1 line

DERBY-1330 Add DDColumnPermissionsDependableFinder.java, missed from last commit
------------------------------------------------------------------------
r420306 | djd | 2006-07-09 09:17:53 -0700 (Sun, 09 Jul 2006) | 3 lines

DERBY-1330 (partial) Create dependencies between triggers, constraints & views and their required privileges.
Patch submitted by Mamta Satoor msatoor@gmail.com

------------------------------------------------------------------------
r420048 | fuzzylogic | 2006-07-07 21:31:23 -0700 (Fri, 07 Jul 2006) | 5 lines

DERBY-1091: Test harness does not pass jvm flags properly if there are more
than 1 property in jvm flags

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r419926 | mikem | 2006-07-07 10:08:33 -0700 (Fri, 07 Jul 2006) | 8 lines

Adding a test to help debug DERBY-1248.  OnlineBackupTest5.sql is just 
a slight variation of OnlineBackupTest4.sql.  It does the same work but
restores the backup to a new place in extinout, rather than on top of
the original case.  Hopefully if this test reproduces DERBY-1248 the info
in the old db will help understand what is going on.  Also changed the 
assert to dump the full page.


------------------------------------------------------------------------
r419852 | kahatlen | 2006-07-07 02:57:04 -0700 (Fri, 07 Jul 2006) | 5 lines

DERBY-1000: For LDAP authentication: derby.authentication.server
should support ldaps:// as part of the server url.

Patch contributed by Anders Morken.

------------------------------------------------------------------------
r419848 | kahatlen | 2006-07-07 02:14:54 -0700 (Fri, 07 Jul 2006) | 4 lines

DERBY-1474: Add assertEquals overloads for Blob and Clob

Follow-up patch contributed by Kristian Waagan.

------------------------------------------------------------------------
r419847 | andreask | 2006-07-07 02:05:52 -0700 (Fri, 07 Jul 2006) | 1 line

DERBY-1477 create JUnit tests for testing BLOB OutOfMemory problems. New tests for testing really big blobs (64MB). Not included in any suites.
------------------------------------------------------------------------
r419839 | andreask | 2006-07-07 01:43:29 -0700 (Fri, 07 Jul 2006) | 1 line

DERBY-1475 lang/procedure.java intermittently fails on solaris 10 x86. Contributed by Fernanda Pizzorno
------------------------------------------------------------------------
r419542 | kahatlen | 2006-07-06 06:00:23 -0700 (Thu, 06 Jul 2006) | 4 lines

DERBY-1474: Add assertEquals overloads for Blob and Clob

Patch contributed by Kristian Waagan.

------------------------------------------------------------------------
r419479 | kahatlen | 2006-07-06 01:04:01 -0700 (Thu, 06 Jul 2006) | 13 lines

DERBY-989: unit/daemonService.unit fails intermittently: 'ran out of time'

Two test fixes (in T_DaemonService.java)

  1) Clear the list of clients before each iteration of the test. This
     makes the failure be exposed earlier (10 minutes instead of one
     hour) because t_checkStatus() doesn't have to wait for
     unsubscribed clients to be serviced.

  2) Make the test accept that a client is serviced once after it has
     unsubscribed. This could happen if the client is being serviced
     when unsubscribe() is called.

------------------------------------------------------------------------
r419186 | andreask | 2006-07-05 01:07:25 -0700 (Wed, 05 Jul 2006) | 1 line

DERBY-1064 Delete cascade causes NULL values inserted into table when after delete Trigger fires. Contributed by Fernanda Pizzorno.
------------------------------------------------------------------------
r418933 | andreask | 2006-07-04 00:57:48 -0700 (Tue, 04 Jul 2006) | 1 line

DERBY-1043 Invalid column references are not caught in a trigger action statement when the referencing table of the column is the triggered table. Contributed by Fernanda Pizzorno.
------------------------------------------------------------------------
r418692 | kahatlen | 2006-07-02 23:14:07 -0700 (Sun, 02 Jul 2006) | 28 lines

DERBY-1364: Client driver does not roll back the effects of a stored
procedure when incorrectly invoked by executeQuery()/executeUpdate()

Description of the patch:

1. Checking of the number of result sets returned was moved from
   executeUpdate/executeQuery to a point in flowExecute where the
   transaction has not been auto-committed (otherwise, the transaction
   would already be committed when the exception was raised).

2. If the number of result sets does not match the execute type and
   auto-commit is enabled, the transaction is rolled back (otherwise,
   the transaction would be committed when the Statement was closed or
   re-executed).

3. All execute* methods in CallableStatement were removed since they
   have become identical to the methods in PreparedStatement. (Or
   almost identical. The methods in CallableStatement did not call
   checkStatementValidity() on errors, but that's probably a bug.)

4. SQL state for error message in executeQuery() was changed to match
   embedded (XJ201/XJ205 -> X0Y78). Updated English and Portuguese
   messages to use the new SQL state (no other translations existed
   for XJ201 and XJ205).

5. Added more rollback tests to jdbcapi/ProcedureTest.junit and
   enabled all test cases for DerbyNetClient.

------------------------------------------------------------------------
r418691 | kahatlen | 2006-07-02 22:57:33 -0700 (Sun, 02 Jul 2006) | 7 lines

DERBY-1468: Server returns data when it receives a QRYROWSET value of
zero on an OPNQRY, which doesn't follow DRDA protocol.

The patch disables pre-fetching for LMTBLKPRC when QRYROWSET=0 and
adds a test case to the protocol test which sends an OPNQRY for a
scrollable cursor with QRYROWSET=0.

------------------------------------------------------------------------
r418687 | kahatlen | 2006-07-02 22:45:32 -0700 (Sun, 02 Jul 2006) | 6 lines

DERBY-1427: sysinfo does not write Java SE and JDBC version when
running under JDK 1.6

Make sysinfo print "JRE - JDBC: Java SE 6 - JDBC 4.0" when running
under JVM version 1.6.

------------------------------------------------------------------------
r418672 | kmarsden | 2006-07-02 19:37:42 -0700 (Sun, 02 Jul 2006) | 10 lines

DERBY-578 - Grouped select from temporary table raises null pointer exception in byte code generator
DERBY-1464 - runtimestatistics can show that an index is being used even when it isn't

Contributed by Manish Khettry

The problem is simple enough-- we didn't have a conglomerate name for temporary tables. I fixed the code to behave more like what fillInScanArgs does.

Earlier, we would set the indexName field in DistinctScanResult to the conglomerate name (cd.getName()) used to scan the table. If the conglomerate was the base table itself then this was just plain wrong. The change, for this patch, passes null if no index is being used.


------------------------------------------------------------------------
r418240 | tmnk | 2006-06-30 04:23:17 -0700 (Fri, 30 Jun 2006) | 1 line

- DERBY-1461 Separate writeScalarStream to methods which handle either encrypted or plain streams. - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r418221 | andreask | 2006-06-30 02:58:59 -0700 (Fri, 30 Jun 2006) | 1 line

DERBY-1421 updates of LOBs fails with scrollable updatable result sets. Contributed by Fernanda Pizzorno
------------------------------------------------------------------------
r418110 | mikem | 2006-06-29 11:30:32 -0700 (Thu, 29 Jun 2006) | 3 lines

DERBY-1410 - fixed typo in error message.


------------------------------------------------------------------------
r418108 | mikem | 2006-06-29 11:27:51 -0700 (Thu, 29 Jun 2006) | 16 lines

DERBY-937, committing change by      Andreas Korneliussen.

notes by Andreas:
I was able to reproduce this problem on every run on a very fast laptop (it was not reproducible on any other Windows lab machine I have tried). This laptop happens to be the same kind as Ole uses for the nightly tests.

Adding a 10 second sleeping period after the population of the tables, did not have any effect. I therefore tried to do run a compress on the tables (based on the assumption that statistics is updated on compress), and now the test does not fail for me anymore.

Attached is the patch which makes this test stop failing. The patch does not seem to have any sideeffects on other platforms (Solaris) tested, however the test will use more time. 

note by mike:
I ran this change 20 times and it worked on my laptop, it would always fail
a few times out of 20 before the fix.  I am not sure why this fix works as
the test seems to already create indexes after tables so statistics should
already be up to date. 


------------------------------------------------------------------------
r418095 | mikem | 2006-06-29 10:42:45 -0700 (Thu, 29 Jun 2006) | 3 lines

DERBY-1410 - added missing error message for DATA_SQLDATA_READ_ILLEGAL_ACCESS_EXCEPTION.


------------------------------------------------------------------------
r417953 | kahatlen | 2006-06-29 00:02:36 -0700 (Thu, 29 Jun 2006) | 4 lines

DERBY-1463: Resolve javadoc warnings in BrokeredCallableStatement40

Patch submitted by V. Narayanan.

------------------------------------------------------------------------
r417753 | kahatlen | 2006-06-28 06:35:42 -0700 (Wed, 28 Jun 2006) | 10 lines

DERBY-1417: Add new, lengthless overloads to the streaming api

'derby-1417-1a-notImplemented.diff' adds a number of new lengthless
streaming overloads that Derby will not support. All methods added by the
patch throw not-implemented exceptions. We don't support them because we
either don't support the data type or because we don't yet support named
parameters in CallableStatement.

Patch submitted by Kristian Waagan.

------------------------------------------------------------------------
r417705 | kahatlen | 2006-06-28 02:35:50 -0700 (Wed, 28 Jun 2006) | 4 lines

DERBY-1445: Add new streaming overloads and modify some existing ones.

Fix test issues. Patch submitted by V. Narayanan.

------------------------------------------------------------------------
r417548 | kahatlen | 2006-06-27 11:26:28 -0700 (Tue, 27 Jun 2006) | 8 lines

DERBY-1445: Add new streaming overloads and modify some existing ones.

Adding new (JDBC 4.0) streaming overloads to ResultSet, PreparedStatement
and CallableStatement. The new overloads take a long as the length
parameter.

Patch contributed by V. Narayanan.

------------------------------------------------------------------------
r417497 | kahatlen | 2006-06-27 09:18:43 -0700 (Tue, 27 Jun 2006) | 41 lines

DERBY-137: Derby metadata always returns JDBC 2 result sets, even when
JDBC 3 result sets are required.

Summary of the changes:

  DatabaseMetaData:

    - getProcedureColumns: modified VTI to return an int instead of a
      short for the DATA_TYPE column
    - getTables: new columns: TYPE_CAT, TYPE_SCHEM, TYPE_NAME,
      SELF_REFERENCING_COL_NAME, REF_GENERATION (all null since Derby
      doesn't support typed tables)
    - getColumns: DATA_TYPE changed from SMALLINT to INTEGER. New
      columns: SCOPE_CATLOG, SCOPE_SCHEMA, SCOPE_TABLE,
      SOURCE_DATATYPE (all null since Derby doesn't support the REF or
      DISTINCT data types)
    - getVersionColumns: SCOPE, DECIMAL_DIGITS and PSEUDO_COLUMN
      changed from INTEGER to SMALLINT
    - getPrimaryKeys: KEY_SEQ changed from INTEGER to SMALLINT (the
      new query is ODBC compliant so getPrimaryKeysForODBC was removed)
    - getTypeInfo: DATA_TYPE changed from SMALLINT to INTEGER, NULLABLE, 
      SEARCHABLE, MINIMUM_SCALE and MAXIMUM_SCALE changed from INTEGER to
      SMALLINT
    - getIndexInfo: ORDINAL_POSITION changed from INTEGER to SMALLINT
    - getBestRowIdentifier: DATA_TYPE changed from SMALLINT to INTEGER
    - getUDTs: new columm: BASE_TYPE (null since Derby doesn't support
      the DISTINCT type or SELF_REFERENCING_COLUMN)

  ODBCMetadataGenerator:

    - cast DATA_TYPE columns to SMALLINT (as defined by ODBC)
    - don't cast columns that already are SMALLINT to SMALLINT

  Tests:

    - updated master files for metadata, odbc_metadata,
      bestrowidentifier, declareGlobalTempTableJava and
      Upgrade_10_1_10_2 (new columns and modified data types)
    - odbc_metadata.java: added information about nullability for some
      of the new columns to avoid ArrayIndexOutOfBoundsException

------------------------------------------------------------------------
r417368 | andreask | 2006-06-27 01:10:20 -0700 (Tue, 27 Jun 2006) | 1 line

DERBY-734 lang/closed.java fails because of incorrect ordering of the output during heavy load. Contributed by Kristian Waagan
------------------------------------------------------------------------
r417366 | andreask | 2006-06-27 00:59:54 -0700 (Tue, 27 Jun 2006) | 1 line

DERBY-1361 positioned updates and deletes allowed after a commit without repositioning the cursor - if the table is indexed on the columns selected
------------------------------------------------------------------------
r417210 | andreask | 2006-06-26 08:27:15 -0700 (Mon, 26 Jun 2006) | 1 line

DERBY-1436 setEmbeddedCP.ksh did not set classpath when DERBY_HOME was set. Contributed by Fernanda Pizzorno
------------------------------------------------------------------------
r417206 | andreask | 2006-06-26 08:06:21 -0700 (Mon, 26 Jun 2006) | 1 line

DERBY-1444 Using -Djvmflags option causes NoClassDefFoundError. Contributed by Vemund.Ostgaard@sun.com
------------------------------------------------------------------------
r417131 | kahatlen | 2006-06-25 23:45:01 -0700 (Sun, 25 Jun 2006) | 11 lines

DERBY-1455: Intermittent failure in derbynet/runtimeinfo.java

The problem occurs when the test has opened four connections, closes
three of them and runs getRuntimeInfo() on the server. The test
expects that there is one active session on the server, but in some
cases, the network server has not had enough time to clean up after
the closed connections, and more sessions are listed as active.

The patch solves this timing issue by invoking Thread.sleep(1000)
before calling getRuntimeInfo().

------------------------------------------------------------------------
r416959 | bpendleton | 2006-06-24 13:54:59 -0700 (Sat, 24 Jun 2006) | 16 lines

DERBY-1454: DRDA Protocol Exception when DSS is exactly 32767 bytes

The server is disconnecting the client connection. Client is sending a CNTQRY,
the server is receiving it and then server disconnects the client. In doneData
and writeFDODTA, it looks like if (writer.getDSSLength() >= blksize) ,
then the splitQRYDTA is called. From testing, it seems like they are hitting
an edge case, where the writer.getDSSLength() is equal to blksize and this
DSS is the only dss in the send buffer. 

The patch corrects the two splitQRYDTA calls to use > rather
than >= to determine if the DSS needs to be split.

The patch also contains a new test case in derbynet/prepStmt.java
to demonstrate the bug and its fix.


------------------------------------------------------------------------
r416889 | kahatlen | 2006-06-24 01:12:49 -0700 (Sat, 24 Jun 2006) | 25 lines

DERBY-955: Get derbyall on jdk1.6

This patch contains fixes to the following tests that are failing when
running derbyall with jdk 1.6:

* derbynetclientmats: tools/ieptests.sql

  -updated master file for jdk16

* derbynetclientmats: jdbcapi/parameterMapping.java

  -REMOVED jdk16 specific master file

* derbynetclientmats: jdbcapi/checkDataSource30.java

  -updated checkDataSource30.java and checkDataSource.java to produce
   output that is the same when running with jdk15 and jdk16
  -updated master files to reflect changes in output

* derbynetmats: tools/ieptests.sql

  -updated master file for jdk16

Patch contributed by Olav Sandst?\195?\165.

------------------------------------------------------------------------
r416696 | kahatlen | 2006-06-23 05:19:51 -0700 (Fri, 23 Jun 2006) | 6 lines

DERBY-1314: Differences between client and embedded when invoking
stored procedures using Statement.executeUpdate()

Make executeUpdate() return 0 on the client when executing a stored
procedure.

------------------------------------------------------------------------
r416661 | kahatlen | 2006-06-23 03:15:09 -0700 (Fri, 23 Jun 2006) | 112 lines

DERBY-1036: Embedded and client differ with regard to
Statement.setCursor Name. client will disallow duplicate cursor
names. Embedded will allow it.

and

DERBY-1183: Client java.sql.ResultSet.getCursorName() does not return
the correct cursor name for Statements after the first execution

Patch description:

The problem underlying DERBY-1183 is the following: A Statement (and by
inheritance, PreparedStatement and CallableStatement) will have a
cursor name associated with result set generated by the statement. Such
names are either set by the user (Statement#setCursorName) or assigned
by the system (aka "canned" cursor names in the client driver). In
either case, the user can get at the cursor name attached to a
statement by calling Resultset#getCursorName. This string can be used
to construct the SQL text of positioned update or delete statement.

Currently, when a cursor name is set on a statement, the following
actions are taken (Statement#setCursorName):

1. The statement's string variable cursorName_ is set to the
           new string. This keeps track of the user cursor name set
           for this statement.

2. A cache (clientCursorNameCache) of cursor names set by
the user for this connection is maintained to avoid having
any two identical cursor name for the same statement/result
set. When the cursor name is set, the check is performed
(2a) and the cache is updated with the new cursor name if
all is well (2b).

If the statement (only applies for PreparedStatement and
CallableStatement) already has a DRDA section (ch 7.14)
allocated, the following is also performed:

3. A map (cursor name -> section) is updated.

4. The section associated with this statement gets its
   variable clientCursorName set to the supplied cursor name.

For Statement, this association (steps 3 and 4) is performed at
statement execution time (inside flowExecute, just after the new
section is allocated for a query).

5. Also in flowExecute (of Statement, PreparedStatement) the
cursor (user set or canned) is associated with the result
set (call to mapCursorNameToResultSet).

The symptom of this bug is that the cursor name set for a statement
seems to be lost after one execution of that statement, reverting to a
canned cursor name for executions 2..n.

This happens because the cursor name is actually reset as part of the
next execute on a statement object:

        6. Open result sets for a statement are closed when
flowExecute calls readCloseResultSets. During the closing
of a result set, ResultSet#markClosed calls
statement_.removeClientCursorNameFromCache, which in
addition to removing the user cursor name from the cache
also sets the statements cursorName_ to null, causing it
effectively to be forgotten.

Since #5 happens *after* #6 in flowExecute, the execution still works,
but with a canned cursor instead of the user named cursor (see
mapCursorNameToResultSet).

This "race condition" suggests deferring the setup of mappings and
insertion into the name cache till execution time (*after* the closing
of open result sets on this statement). When studying this I found
there was already a bug filed (DERBY-1036) which advises that we defer
the check of duplicates till execution time, so this patch fixes both
DERBY-1183 and DERBY-1036.

In the patch, Statement#setCursorName now only sets the string
variable cursorName_.

The patch also removes the resetting of cursorName_ in
removeClientCursorNameFromCache, so it won't be forgotten. It is still
removed from the cache when the result set is closed (and current maps
deleted).

Furthermore, it moves #2, #3 and #4 till execution time (flowExecute).
Item #2a is performed at the start of flowExecute, so we can avoid
starting any protocol action if it turns out that we should not
start execution (duplicate name). The actions needed in
Statement#flowExecute and PreparedStatement#flowExecute are similar,
so I factored these out into the methods Statement#
checkForDuplicateCursorName and Statement#setupCursorNameCacheAndMappings.

Next, I removed code from getCursorName which redundantly performs #3
(now always handled at execute time).

CAVEAT: When working on understanding what goes on here, I found that
the Statement finalizer can lead to cursors being released; this is
part of the client side clean-up for statements that are not
explicitly closed (DERBY-210). This can sometimes lead to time
variability in canned cursor names in client driver tests which do not
close statements explicitly. If the canned cursor name occurs in the
canon file, we can see spurious diff due to this. I think we have seen
this in the past. Avoid it by closing statements or by naming the
cursors explicitly.

Finally, I removed work-around code in jdbcapi/checkDataSource.java
for derby-1036 and derby-1183 and updated masters to reflect that the
cursor names are no longer forgotten.

Patch submitted by Dag H. Wanvik.

------------------------------------------------------------------------
r416536 | suresht | 2006-06-22 18:12:17 -0700 (Thu, 22 Jun 2006) | 20 lines

DERBY-1156 (partial): re-encryting an encrypted database 

This patch adds some code required to support reconfigure(rencryption) of
an already existing encrypted database with a new password(secret key)
or an external user specified encryption key. Two new attributes 
"newBootPassword" and "newEncryptionkey" are introduced to support this 
functionality. 

- modified the code to support two have instance of two cipher 
   factories to exist. So that the existing data can decrypted with
   the old encryption key using one cipher factory and rewrite the data 
   with new encryption keys using another cipher factory. 

- re-enryption of the database with new keys is similar to encrypting 
   an already existing database. All the container data is read through 
   the page cache and  rewritten using the new encryption keys. 

- Added test case to test the re-encryption of an encrypted database.
 

------------------------------------------------------------------------
r416486 | mikem | 2006-06-22 15:17:21 -0700 (Thu, 22 Jun 2006) | 5 lines

DERBY-959

missed one new file in previous commit, adding it here.


------------------------------------------------------------------------
r416485 | mikem | 2006-06-22 15:13:41 -0700 (Thu, 22 Jun 2006) | 6 lines

DERBY-959, committing on behalf of  Sunitha Kambhampati.

Server changes to allow for query block size greater than 32k, as 
supported by the latest DRDA spec. 


------------------------------------------------------------------------
r416012 | bpendleton | 2006-06-21 08:48:57 -0700 (Wed, 21 Jun 2006) | 12 lines

DERBY-1338: Client tests fail with NoClassDefFound: DRDAProtocolExceptionInfo

Patch contributed by Dag Wanvik (dag.wanvik@sun.com)

Work around a classloader bug involving interrupt handling during class
loading. If the first request to load the DRDAProtocolExceptionInfo class
occurs during shutdown, the loading of the class may be aborted when the
Network Server calls Thread.interrupt() on the DRDAConnThread.  By including
a static reference to the DRDAProtocolExceptionInfo class here, we ensure
that it is loaded as soon as the DRDAConnThread class is loaded,
and therefore we know we won't be trying to load the class during shutdown.

------------------------------------------------------------------------
r415557 | andreask | 2006-06-20 01:21:55 -0700 (Tue, 20 Jun 2006) | 1 line

DERBY-1374 compatibility test fails with PROTOCOL Data Stream Syntax Error.Patch contributed by Fernanda Pizzorno
------------------------------------------------------------------------
r415328 | bernt | 2006-06-19 06:35:30 -0700 (Mon, 19 Jun 2006) | 1 line

DERBY-1384:  Increase default BLOB/CLOB length to maximum supported (2G-1). Submitted by Bernt M. Johnsen
------------------------------------------------------------------------
r415135 | kmarsden | 2006-06-18 06:39:51 -0700 (Sun, 18 Jun 2006) | 6 lines

DERBY-1420 Make JitTest.java independent of Derby release

remove DatabaseMetadata calls from JitTest so it does not need to be updated for the release.

Contributed by Mamta Satoor

------------------------------------------------------------------------
r414898 | davidvc | 2006-06-16 13:28:24 -0700 (Fri, 16 Jun 2006) | 2 lines

Removing MessageBundleTest until it gets fixed

------------------------------------------------------------------------
r414832 | bpendleton | 2006-06-16 07:02:15 -0700 (Fri, 16 Jun 2006) | 9 lines

DERBY-920: small changes to replace cloudscape with derby in comments and code

This patch was contributed by Scott Hutinger (s-hutinger@wiu.edu)

This change replaces the word "Cloudscape" with the word "Derby" in some
Ant build scripts, and changes the "reportCloudscape" method of the Sysinfo
implementation code to be named "reportDerby".


------------------------------------------------------------------------
r414795 | kahatlen | 2006-06-16 03:17:14 -0700 (Fri, 16 Jun 2006) | 15 lines

DERBY-501: Client and embedded drivers differ on invoking a procedure
that returns a single Dynamic resultSet using CallableStatement.executeQuery()

This patch modifies EmbedStatement.processDynamicResults() so that it
returns the number of dynamic results instead of a
boolean. EmbedStatement.executeStatement() uses this number to decide
whether an exception is to be raised. With this change, the
executeQuery and executeUpdate parameters are no longer needed in
GenericPreparedStatement.execute().

ProcedureTest.junit is now enabled in derbyall (all frameworks). Seven
of the test cases run in the embedded framework only, but I expect all
of them to succeed with the client driver after DERBY-1314 and
DERBY-1364 have been fixed.

------------------------------------------------------------------------
r414649 | mikem | 2006-06-15 11:26:26 -0700 (Thu, 15 Jun 2006) | 9 lines

DERBY-1408

Setting the test properties so that this test does not run with j9, it already
was disabled for the following:
runwithibm13=false
runwithjdk13=false
runwithjdk12=false


------------------------------------------------------------------------
r414647 | mikem | 2006-06-15 11:17:44 -0700 (Thu, 15 Jun 2006) | 15 lines

DERBY-1392, committed patch submitted by Anders Morken

RAFContainer.java#writePage(...) will
attempt to retry a write if an IOException is thrown on the first attempt. 
However, the next attempt does not add container header data to the first page, nor does it encrypt the data if the database is encrypted as the wrong buffer
is used in the catch block.

I'd expect this bug to be case silent corruption of encrypted databases if the 
code path was actually exercised. The fact that this bug still lives and 
nobody has discovered it is possibly an indication of how uncommon this code 
path is. Since the comment in the code says nothing about exactly what 
platforms the workaround was intended for, I don't know if these platforms are
still supported for Derby. 


------------------------------------------------------------------------
r414624 | rhillegas | 2006-06-15 08:51:48 -0700 (Thu, 15 Jun 2006) | 1 line

DERBY-1417: committed derby-1417-01-castsInTests, which adds some casts to some jdbc4 tests so that the tests will compile when the new streaming overloads turn up in a future build of jdk1.6
------------------------------------------------------------------------
r414562 | tmnk | 2006-06-15 04:38:26 -0700 (Thu, 15 Jun 2006) | 1 line

- DERBY-1388 Integrate processing code of two writeScalarStream methods. - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r414416 | davidvc | 2006-06-14 17:00:44 -0700 (Wed, 14 Jun 2006) | 4 lines

Removed SQL States and MessageId message ids that are unused and which
don't have matching messages, and then made MessageBundleTest a 
part of derbyall.

------------------------------------------------------------------------
r414199 | tmnk | 2006-06-14 04:23:23 -0700 (Wed, 14 Jun 2006) | 1 line

- TestDataReader class in jdbcapi/Stream.java creates test data of which length is not equals to value passed as length of test data. - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r414165 | andreask | 2006-06-14 02:46:35 -0700 (Wed, 14 Jun 2006) | 1 line

DERBY-1382 lobs fail silently with result sets of type TYPE_SCROLL_INSENSITIVE in client jdbc driver. Contributed by Fernanda Pizzorno.
------------------------------------------------------------------------
r413901 | tmnk | 2006-06-13 07:07:22 -0700 (Tue, 13 Jun 2006) | 1 line

- DERBY-1396 ReEncodedInputStream may fail to read all of source Reader - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r413710 | rhillegas | 2006-06-12 10:13:31 -0700 (Mon, 12 Jun 2006) | 1 line

DERBY-1389: Commit Narayanan's IS_AUTOCREMENT_v2.diff, adding a new column to the getColumns() metadata results as required by JDBC4.
------------------------------------------------------------------------
r413435 | halleypo | 2006-06-11 04:59:27 -0700 (Sun, 11 Jun 2006) | 1 line

DERBY-1376 - File java/engine/org/apache/derby/loc/messages_en.properties - Message XSLAT.D translated into Brazilian Portuguese
------------------------------------------------------------------------
r413411 | fuzzylogic | 2006-06-10 20:35:09 -0700 (Sat, 10 Jun 2006) | 3 lines

DERBY-1344: Update JitTest.out master, add to list of master files that are
touched by the regex.masters target.

------------------------------------------------------------------------
r413409 | fuzzylogic | 2006-06-10 20:05:56 -0700 (Sat, 10 Jun 2006) | 4 lines

DERBY-1376: Update XSLAT message to provide a better warning that the value
given to the logDevice attribute in the connection URL may contain another
database.

------------------------------------------------------------------------
r413179 | rhillegas | 2006-06-09 15:14:40 -0700 (Fri, 09 Jun 2006) | 1 line

DERBY-1344: Bump last digit of release identifier to 4 to reflect generation of a new 10.2 alpha snapshot.
------------------------------------------------------------------------
r413174 | suresht | 2006-06-09 14:37:29 -0700 (Fri, 09 Jun 2006) | 2 lines

Exclude SqlExceptionTest from ibm13 jvm test runs.

------------------------------------------------------------------------
r413129 | kmarsden | 2006-06-09 12:23:47 -0700 (Fri, 09 Jun 2006) | 10 lines

DERBY-1327 Identity column can be created with wrong and very large start with v
alue with "J2RE 1.5.0 IBM Windows 32 build pwi32dev-20060412 (SR2)" with JIT on

The fix for this issue would be to reduce the number of parameters required by the constructor to <=10 in org.apache.derby.iapi.sql.dictionary.ColumnDescriptor class. While researching into this, I found that all the 3 constructors in the class have a parameter named autoinc and it is defined as a boolean. This parameter is always equal to (parameter named autoincInc != 0). In my patch (Derby1327WrongStartKeyPatch1CodelineTrunk.txt) which is attached to this JIRA, I have removed the autoinc parameter and inside the constructors, I use (parameter named autoincInc != 0) instead of relying on autoinc. This cleans up the constructor parameter passing for all the 3 constructors and also brings down the number of parameters to <=10. The test program from the JIRA entry runs fine with this change and I have created a new test JitTest.java based on that test program. Hopefully this test can be a place holder for any future JIT issues. I also ran the test suites and there were no new failures.

I also removed the import of org.apache.derby.iapi.sql.dictionary.ColumnDescriptor from some classes which didn't really use ColumnDescriptor.

Contributed by Mamta Satoor


------------------------------------------------------------------------
r413123 | kahatlen | 2006-06-09 11:38:44 -0700 (Fri, 09 Jun 2006) | 8 lines

DERBY-1386: Wrong results with query using LIKE and ESCAPE clause that
includes "%", "\", and "_"

Queries using LIKE/ESCAPE could return wrong results if the first
wildcard character was preceded by an even number of escape
characters. This patch fixes the issue by changing the way
Like.lessThanString() parses the pattern string.

------------------------------------------------------------------------
r413086 | rhillegas | 2006-06-09 09:35:10 -0700 (Fri, 09 Jun 2006) | 1 line

DERBY-1389: backing out previous submission 413084 because it breaks the upgrade tests.
------------------------------------------------------------------------
r413084 | rhillegas | 2006-06-09 09:18:45 -0700 (Fri, 09 Jun 2006) | 1 line

DERBY-1389: Commit Narayanan's IS_AUTOINCREMENT.v1.diff, adding a new JDBC4 column to the results of the getColumns() metadata call.
------------------------------------------------------------------------
r412957 | fuzzylogic | 2006-06-09 00:00:18 -0700 (Fri, 09 Jun 2006) | 3 lines

DERBY-851: Remove remaining references to org.apache.derby.client.resource
package. Committing patch derby-851-remove-dncresource.diff.

------------------------------------------------------------------------
r412888 | davidvc | 2006-06-08 17:17:14 -0700 (Thu, 08 Jun 2006) | 5 lines

DERBY-851: Remove org.apache.derby.client.resource package - no longer needed.
Also removed client/am/ResourceUtilities.java, which was an API on 
top of the resources package.  Converted single usage of ResourceUtilities
to use MessageUtil instead.

------------------------------------------------------------------------
r412859 | rhillegas | 2006-06-08 14:07:31 -0700 (Thu, 08 Jun 2006) | 1 line

DERBY-1379: Committed Olav's autoload.diff. This fixes the problem which caused all of the nist tests to fail when derbyall was run against jar files under jdk1.6 with the db2jcc jar in the classpath.
------------------------------------------------------------------------
r412852 | davidvc | 2006-06-08 13:40:13 -0700 (Thu, 08 Jun 2006) | 3 lines

DERBY-1004: Client should not require user to rollback the active transaction before call to PooledConnection.getConnection()


------------------------------------------------------------------------
r412831 | andreask | 2006-06-08 11:31:45 -0700 (Thu, 08 Jun 2006) | 1 line

DERBY-1295 contributed by Fernanda Pizzorno. Scroll insensitive resultset should not implicitly close due to positioning in autocommit mode
------------------------------------------------------------------------
r412733 | halleypo | 2006-06-08 05:36:33 -0700 (Thu, 08 Jun 2006) | 1 line

DERBY-1339 Text for exceptions translated into Brazilian Portuguese - update
------------------------------------------------------------------------
r412711 | kahatlen | 2006-06-08 02:36:30 -0700 (Thu, 08 Jun 2006) | 4 lines

DERBY-501 (partial) Added test jdbcapi/ProcedureTest.junit. The test
is not enabled in any test suite, since it won't succeed until the
actual fix is checked in.

------------------------------------------------------------------------
r412515 | kmarsden | 2006-06-07 13:02:27 -0700 (Wed, 07 Jun 2006) | 9 lines

DERBY-435  Enable checkDataSource.java and checkDataSource30.java tests for fixed bugs.


I had attached one more small patch " d435-enable-tests-for-fixed-issues.diff" for trunk to be reviewed/committed. This patch enables the tests for issues which have been already fixed and it marks the remaining excludes in the test with the JIRA issue number.

Contributed by Deepa Remesh



------------------------------------------------------------------------
r412320 | kahatlen | 2006-06-07 01:02:06 -0700 (Wed, 07 Jun 2006) | 7 lines

DERBY-655: getImportedKeys returns duplicate rows in some cases

Updated master file for the upgrade test. Will have to be changed once
10.1.3 is released and the jars checked in.

Patch submitted by Mamta A. Satoor <msatoor@gmail.com>.

------------------------------------------------------------------------
r412239 | rhillegas | 2006-06-06 17:10:25 -0700 (Tue, 06 Jun 2006) | 1 line

DERBY-1380: derby-1380.v2.diff, adding new overloads for createQueryObject().
------------------------------------------------------------------------
r412222 | bandaram | 2006-06-06 14:49:24 -0700 (Tue, 06 Jun 2006) | 8 lines

DERBY-1365: Fixes two minor problems with logic in Optimizer. Here is the note from contributor:

In addition to fixing the two issues described, the patch also resolves another potential problem: there are several places in OptimizerImpl.getNextPermutation() where calls to rewindJoinOrder() are made. These calls typically indicate that the optimizer has decided to abandon or "short circuit" a join order before calculating the full cost. For some of these calls--esp. the ones that can occur in the middle of the join order (as opposed to those which will only occur on a complete join order)--the "rewind" operation needs to make sure to reload the best plans for the optimizables that are pulled as part of the "rewind" process. Otherwise Derby could end up generating a plan for an optimizable even though that plan was part of a join order that was "abandoned" (i.e. rewound in the middle), which is logically incorrect and could lead to sub-optimal performance. I've included changes for this issue as part of d1365_v1.patch.

I ran derbyall on Red Hat Linux with d1365_v1.patch applied and saw no new failures. I would appreciate reviews/comments/commit if anyone has the time... 

Submitted by Army Brown (qozinx@gmail.com)

------------------------------------------------------------------------
r412220 | rhillegas | 2006-06-06 14:42:45 -0700 (Tue, 06 Jun 2006) | 1 line

DERBY-1253: Make UnsupportedVetter test smart enough to handle methods which change shape.
------------------------------------------------------------------------
r412207 | rhillegas | 2006-06-06 13:44:11 -0700 (Tue, 06 Jun 2006) | 1 line

DERBY-1362: Commit bug1362_1.diff, fixing the manifest for derby.jar.
------------------------------------------------------------------------
r412204 | rhillegas | 2006-06-06 13:29:05 -0700 (Tue, 06 Jun 2006) | 1 line

DERBY-1380: Commit Dyre's derby-1380,v1.diff patch, which makes it possible to connect to Derby databases when running under build 86 of jdk1.6.
------------------------------------------------------------------------
r412181 | mikem | 2006-06-06 11:08:02 -0700 (Tue, 06 Jun 2006) | 3 lines

javadoc fix: @returns changed to @return.


------------------------------------------------------------------------
r411784 | halleypo | 2006-06-05 06:35:32 -0700 (Mon, 05 Jun 2006) | 1 line

DERBY-1350: Remove old constructors for SqlException and DisconnectException and clean up any remaining users of the old constructors + updates
------------------------------------------------------------------------
r411614 | halleypo | 2006-06-04 15:37:00 -0700 (Sun, 04 Jun 2006) | 1 line

DERBY-1339 Text for exceptions translated into Brazilian Portuguese - update
------------------------------------------------------------------------
r411564 | halleypo | 2006-06-04 07:25:43 -0700 (Sun, 04 Jun 2006) | 1 line

DERBY-1339 Text for exceptions translated into Brazilian Portuguese - update
------------------------------------------------------------------------
r411471 | halleypo | 2006-06-03 14:35:19 -0700 (Sat, 03 Jun 2006) | 1 line

DERBY-1339 messages for NetworkServerControl translated into Brazilian Portuguese - update
------------------------------------------------------------------------
r411435 | halleypo | 2006-06-03 06:44:21 -0700 (Sat, 03 Jun 2006) | 1 line

DERBY-1339 messages for NetworkServerControl translated into Brazilian Portuguese - update
------------------------------------------------------------------------
r411428 | kahatlen | 2006-06-03 06:00:50 -0700 (Sat, 03 Jun 2006) | 5 lines

DERBY-1356: Positioned update/delete when positioned after last or
before first causes NullPointerException

Patch contributed by Fernanda Pizzorno <Fernanda.Pizzorno@Sun.COM>.

------------------------------------------------------------------------
r411399 | bandaram | 2006-06-03 00:25:03 -0700 (Sat, 03 Jun 2006) | 4 lines

DERBY-655: Generate unique logical conglomerateId for duplicate indexes, instead of just reusing existing conglomerateId.

Submitted by Mamta A. Satoor(msatoor@gmail.com)

------------------------------------------------------------------------
r411393 | bandaram | 2006-06-03 00:02:32 -0700 (Sat, 03 Jun 2006) | 23 lines

DERBY-1329: Set ColumnReference in CurrentOfNode when a match is found.

Attaching a patch to address this issue. In a word, the problem is that the ColumnReference in a CurrentOfNode can, in certain situations, end up with a tableNumber that is never set, and hence it defaults to -1. The fix I've made ensures that the ColumnReference's tableNumber will always be set when necessary--i.e. when we've found the ResultColumn that matches the received ColumnReference. I think this is the correct fix for two reasons:

1) In FromList.bindColumnReferences(), there is the following comment:

  /* TableNumbers are set in the CR in the underlying
   * FromTable. This ensures that they get the table
   * number from the underlying table, not the join node.
   * This is important for beging able to push predicates
   * down through join nodes.
   */

The place where "TableNumbers are set" is in the getMatchingColumn() call, which means that the underlying FromTable (which includes CurrentOfNode) is responsible for setting the table number.

2) Inspection of all other FromTables that implement getMatchingColumn() shows that they all set the ColumnReference's table number if the corresponding ResultColumn is found. The one exception is JoinNode, but the getMatchingColumn() method in JoinNode in turn calls the method of the same name on the join's left and right nodes, so we know that, eventually, the ColumnReference's tableNumber will get set by one of the other FromTable's getMatchingColumn() calls. So the only FromTable that does not set the tableNumber is CurrentOfNode, and that's the reason for the failure described in this issue.

The change seems fairly minor but if anyone has a chance to double-check it, that'd be great. I also added a test case (using the repro posted in the above comments) to lang/update.sql.

I ran derbyall on Linux Red Hat (RHEL4) using ibm142 and saw no new failures.

Submitted by Army Brown (gozinx@gmail.com)

------------------------------------------------------------------------
r411336 | davidvc | 2006-06-02 16:44:33 -0700 (Fri, 02 Jun 2006) | 4 lines

DERBY-1069: Client unwraps exceptions now (the problem was in NetAgent).
Also fixed a bug where the cause stack trace was not being logged in
the trace file, and a formatting bug with the port number

------------------------------------------------------------------------
r411204 | djd | 2006-06-02 09:22:00 -0700 (Fri, 02 Jun 2006) | 5 lines

Ensure sanity check on stack depth of a generated method is only invoked
if the generated class is error free. Checks against an invalid class file
format can cause unexpected errors as the constant pool index values may be corrupt.
Fixes the lang/largeCodeGen.java test in sanity mode.

------------------------------------------------------------------------
r411174 | kahatlen | 2006-06-02 07:55:50 -0700 (Fri, 02 Jun 2006) | 4 lines

DERBY-1262: Like-predicates: % does not match tab character

Patch contributed by H?\195?\165vard Mork <havard.mork@gmail.com>.

------------------------------------------------------------------------
r411167 | bernt | 2006-06-02 07:25:48 -0700 (Fri, 02 Jun 2006) | 1 line

DERBY-1313: SUR: Use DRDA's extended diagnostic to send ROW_UPDATED and ROW_DELETED warnings. Submitted by Fernanda Pizzorno
------------------------------------------------------------------------
r411011 | kmarsden | 2006-06-01 17:52:03 -0700 (Thu, 01 Jun 2006) | 4 lines

DERBY-1148 part 2 javadoc fix
Contributed by Deepa Remesh


------------------------------------------------------------------------
r411002 | bandaram | 2006-06-01 16:56:15 -0700 (Thu, 01 Jun 2006) | 4 lines

Set current privilege type to be SELECT_PRIV during binding of select statement that a view represents.

Submitted by Satheesh Bandaram (satheesh@gmail.com)

------------------------------------------------------------------------
r410975 | davidvc | 2006-06-01 14:54:32 -0700 (Thu, 01 Jun 2006) | 11 lines

DERBY-1186 - Add a new test that does a sanity check of our message ids,
looking for duplicates and orphans.  Not part of derbyall yet because
there are a number of failures I need to track down.  The failures will
be fixed as a separate JIRA

No test suites run, as this is a new test and has no interaction with
existing code.

This checkin also has a rider which is a small javadoc fix to 
SqlException.java

------------------------------------------------------------------------
r410945 | rhillegas | 2006-06-01 13:51:32 -0700 (Thu, 01 Jun 2006) | 1 line

DERBY-942: Commit Kristian's derby-942-connectiontest-rewrite.diff, which generalizes the connection test to run under XA also.
------------------------------------------------------------------------
r410913 | kmarsden | 2006-06-01 12:05:12 -0700 (Thu, 01 Jun 2006) | 21 lines

DERBY-1366  minor patching up of some test issues - state May 31 2006

Contributed by Myrna van Lunteren

Attached is patch tests_20060531.diff (and stat) for the trunk, which removes some failures in derbyall runs with less commonly tested jvms by making a number of minor changes:

- after the fix for DERBY-577 all .java tests that use ext*
directories failed with the 'j9' jvms (wsdd5.6, wctme5.7,
wctme5.7_foundation - i.e. all jvms which have executable 'j9' instead of java). When I first started working with those jvms it seemed that those jvms decided another directory was user.dir, and the only solution I could see at the time was to add a section changing the directory. Removing the setting of user.dir made all jvms work the same way, so this if block had to come out, but I had forgotten...(change to RunTest.java that can only possibly affect j9 runs)

- because the j9 jvms do not run with security manager, the output of the test RunClassPathTester.java cannot be made stable. Adding RunClassPathTester_app.properties to skip the test with those jvms.

- wctme5.7_foundation required updated master(canon) for
grantRevokeDDL and outparams, and the canon for grantRevoke is no longer needed.

- upgrade test cannot be run with jdk131, ibm131, wsdd5.6, wctme5.7 or wctme5.7_foundation because it uses classes not present in those jvms. Added suites/upgrade.properties to skip.

I tested derbyall with wctme5.7_foundation and wctme5.7, ran affected tests with wsdd5.6, and upgrade suite with wcmte*, wsdd5.6, ibm131,jdk131, jdk142.



------------------------------------------------------------------------
r410860 | tmnk | 2006-06-01 06:15:50 -0700 (Thu, 01 Jun 2006) | 1 line

- DERBY-1346 unit/fillLog.unit seems to be failed if program was build as sane. - Patch by Myrna van Lunteren (m.v.lunteren@gmail.com)
------------------------------------------------------------------------
r410702 | djd | 2006-05-31 16:56:12 -0700 (Wed, 31 May 2006) | 1 line

DERBY-438 (partial) Add statement trigger tests involving selecting large CLOB values.
------------------------------------------------------------------------
r410695 | davidvc | 2006-05-31 15:41:15 -0700 (Wed, 31 May 2006) | 2 lines

DERBY-842 - Internationalize a message that was missed

------------------------------------------------------------------------
r410694 | rhillegas | 2006-05-31 15:40:31 -0700 (Wed, 31 May 2006) | 1 line

DERBY-1253: Check in bug1253_wireIn.diff. This wires the UnsupportedVetter test into the jdbc4 suite.
------------------------------------------------------------------------
r410591 | rhillegas | 2006-05-31 09:40:33 -0700 (Wed, 31 May 2006) | 1 line

DERBY-942: Kristian's patch to wire ConnectionTest into jdbc4 suite.
------------------------------------------------------------------------
r410572 | rhillegas | 2006-05-31 09:11:10 -0700 (Wed, 31 May 2006) | 1 line

DERBY-1344: Bump the last digit of the release identifier after posting a revised 10.2 snapshot.
------------------------------------------------------------------------
r410570 | tmnk | 2006-05-31 09:07:45 -0700 (Wed, 31 May 2006) | 1 line

- Rollback patches for DERBY-1302. Work for DERBY-1302 was suspended to release of 10.1.3 - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r410393 | halleypo | 2006-05-30 15:16:55 -0700 (Tue, 30 May 2006) | 1 line

DERBY-1339 messages for NetworkServerControl translated into Brazilian Portuguese - update
------------------------------------------------------------------------
r410384 | davidvc | 2006-05-30 14:46:44 -0700 (Tue, 30 May 2006) | 5 lines

DERBY-1350: Remove old constructors for SqlException and
DisconnectException and clean up any remaining users of the old
constructors.


------------------------------------------------------------------------
r410380 | halleypo | 2006-05-30 14:32:10 -0700 (Tue, 30 May 2006) | 1 line

DERBY-1339 sysinfoMessages translated into Brazilian Portuguese - update
------------------------------------------------------------------------
r410281 | rhillegas | 2006-05-30 06:48:10 -0700 (Tue, 30 May 2006) | 1 line

DERBY-1344: Bump last digit of release identifier after posting 10.2 snapshot.
------------------------------------------------------------------------
r410267 | kahatlen | 2006-05-30 05:53:22 -0700 (Tue, 30 May 2006) | 14 lines

DERBY-1308: Tests jdbcapi/HoldabilityTest.junit,
jdbcapi/UpdateXXXTest.junit,jdbcapi/SURTest.junit fail on
wctme5.7_foundation

Attaching patch DERBY-1308_3_20060527.*. In this patch, I moved the
get*DataSource* methods from functionTests/util/BaseJDBCTestCase.java
to a new file, functionTests/util/TestDataSourceFactory.java, and the
method getDefaultSourceProperties into
functionTests/util/TestConfiguration.java.  I adjusted affected tests
that I could find, and verified the affected tests where applicable
with wctme5.7, wsdd5.6, wctme5.7_foundation, jdk142 and jdk16.

Patch contributed by Myrna van Lunteren.

------------------------------------------------------------------------
r410061 | halleypo | 2006-05-29 02:20:50 -0700 (Mon, 29 May 2006) | 1 line

DERBY-1339 servlet messages translated into Brazilian Portuguese - update
------------------------------------------------------------------------
r410008 | halleypo | 2006-05-28 17:16:08 -0700 (Sun, 28 May 2006) | 1 line

DERBY-1339 servlet messages translated into Brazilian Portuguese - update
------------------------------------------------------------------------
r409899 | halleypo | 2006-05-27 17:41:13 -0700 (Sat, 27 May 2006) | 1 line

DERBY-1339 - Corrections due errors found by the program native2ascii
------------------------------------------------------------------------
r409885 | halleypo | 2006-05-27 14:40:34 -0700 (Sat, 27 May 2006) | 1 line

DERBY-1339 dbtools messages translated into Brazilian Portuguese - update
------------------------------------------------------------------------
r409884 | halleypo | 2006-05-27 14:38:24 -0700 (Sat, 27 May 2006) | 1 line

DERBY-1339 sysinfo messages translated into Brazilian Portuguese - update
------------------------------------------------------------------------
r409805 | fuzzylogic | 2006-05-26 20:17:00 -0700 (Fri, 26 May 2006) | 2 lines

DERBY-892: Add missing file from 892_4 patch.

------------------------------------------------------------------------
r409797 | tmnk | 2006-05-26 19:20:29 -0700 (Fri, 26 May 2006) | 1 line

- DERBY-1302_2 Indent source files touched in DERBY-326 - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r409713 | fuzzylogic | 2006-05-26 11:21:12 -0700 (Fri, 26 May 2006) | 4 lines

DERBY-1072: Update two more master files.

Committed for Mayuresh Nirhali <mayuresh.nirhali@sun.com>

------------------------------------------------------------------------
r409688 | kmarsden | 2006-05-26 09:08:48 -0700 (Fri, 26 May 2006) | 6 lines

DERBY-1245 Add o.a.derby.client.am.ClobWriter test coverage
DERBY-1354 Writer.write(int c) to writer from Clob.setCharacterStream(long pos) appends integer value, not character

Contributed by Anders Morken


------------------------------------------------------------------------
r409578 | bandaram | 2006-05-26 00:23:58 -0700 (Fri, 26 May 2006) | 3 lines

DERBY-1072: Fix misleading error while droping a view.

Submitted by Mayuresh Nirhali(Mayuresh.Nirhali@Sun.COM)
------------------------------------------------------------------------
r409565 | fuzzylogic | 2006-05-25 23:16:17 -0700 (Thu, 25 May 2006) | 5 lines

Add setIO permission back to derby_tests.policy. Causes test harness to die
suddenly at RunTest:2552 if we don't have this permission because we have
alerady set the security manager but don't have setIO permissions as granted
by useprocessfalse.policy.

------------------------------------------------------------------------
r409534 | fuzzylogic | 2006-05-25 18:11:26 -0700 (Thu, 25 May 2006) | 3 lines

DERBY-1348: hack to propagate derbyTesting.jar.path from system->suite->test.
Harness' use of properties really needs cleaning up.

------------------------------------------------------------------------
r409471 | fuzzylogic | 2006-05-25 14:21:19 -0700 (Thu, 25 May 2006) | 6 lines

DERBY-892: Provide derbyTesting.replacePolicyFile option for completely
replacing a tests' policy file. Remove serverPolicyFile option that wasn't being
used. Update testing/README.htm

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r409470 | kmarsden | 2006-05-25 14:15:22 -0700 (Thu, 25 May 2006) | 13 lines

DERBY-1148 Client XA getTransactionIsolation() does not return the correct isolation level when rejoining a global transaction

Contributed by Deepa Remesh

Summary of patch:

* Changes getTransactionIsolation method in org.apache.derby.client.am.Connection class to get the isolation level from server. The built-in function "CURRENT ISOLATION" is used for this. It throws SQLException in case of failures. At the start of the method, the current auto-commit value is stored in a variable. When executing the function, auto-commit is set to false. At the end of the method, auto-commit value is restored. As it is the client which drives the auto-commit, this strategy of locally changing the auto-commit works.

* Removes the excludes for DERBY-1148 and DERBY-1035 from checkDataSource test. Adds a test for transaction suspend/resume in checkDataSource test. Updates master files

With this patch, I have run derbynetclientmats with Sun jdk 1.4.2 on Windows XP. I also ran checkDataSource.java and checkDataSource30.java with embedded and client framework. No failures


------------------------------------------------------------------------
r409466 | kmarsden | 2006-05-25 13:59:02 -0700 (Thu, 25 May 2006) | 5 lines

DDERBY-1298 Tracing client data source gives NPE if all data source properties are not set

Contributed by Deepa Remesh


------------------------------------------------------------------------
r409459 | davidvc | 2006-05-25 13:26:26 -0700 (Thu, 25 May 2006) | 5 lines

DERBY-849: Internationalize Reply to Typdef in org.apache.derby.client.net
Also migrated some network exceptions from SQL State 08006 to 58009,
to be in line with DRDA spec.


------------------------------------------------------------------------
r409444 | rhillegas | 2006-05-25 12:45:50 -0700 (Thu, 25 May 2006) | 1 line

DERBY-1333: Commit Narayanan's jdbc40_xa_test_suite_v1.diff, creating a new xa suite for jdbc4 features.
------------------------------------------------------------------------
r409422 | djd | 2006-05-25 11:23:57 -0700 (Thu, 25 May 2006) | 9 lines

DERBY-438 Support statement triggers for BLOB and CLOB types. Change the trigger
virtual tables to implement PreparedStatement instead of ResultSet. This allows
the mechanism to use the java.sql.ResultSet generated from the language internal
ResultSet directly, rather than through a wrapper. The wrapper approach caused
issues when the wrapper's JDBC version does not match the version running in the
engine. BLOB/CLOB caused problems with statement triggers as the wrapper
only supported JDBC 1.2. Add tests for BLOB (will add CLOB in subsequent patch),
also add upgrade tests across release boundaries to ensure trigger modifications
in 10.2 do not break in soft upgrade mode.
------------------------------------------------------------------------
r409420 | rhillegas | 2006-05-25 11:10:40 -0700 (Thu, 25 May 2006) | 1 line

DERBY-1214: Commit Anurag's derby-1214_3.diff, changing the name of a test harness property.
------------------------------------------------------------------------
r409394 | rhillegas | 2006-05-25 07:13:53 -0700 (Thu, 25 May 2006) | 1 line

DERBY-1344: Commit bug1344-bumplastdigit.diff. This bumps the last number in the release identifier to distinguish our next snapshot off the mainline from the previous one. This also fixes a bug in the bumplastdigit target.
------------------------------------------------------------------------
r409170 | bernt | 2006-05-24 07:09:04 -0700 (Wed, 24 May 2006) | 1 line

DERBY-1322: Missing resets of isOnInsertRow state in net client when navigating away via other than ResultSet#next. Submitted by Fernanda Pizzorno
------------------------------------------------------------------------
r409037 | davidvc | 2006-05-23 19:15:57 -0700 (Tue, 23 May 2006) | 4 lines

DERBY-847: Internationalize NetIndoubtTransaction to NetSqlca in 
org.apache.derby.client.net


------------------------------------------------------------------------
r409009 | bernt | 2006-05-23 14:48:14 -0700 (Tue, 23 May 2006) | 1 line

DERBY-1276 Calling ResultSet.isLast() on a scrollable insensitive resultset, causes the entire ResultSet to be populated. Submitted by Andreas Korneliussen
------------------------------------------------------------------------
r409008 | davidvc | 2006-05-23 14:41:59 -0700 (Tue, 23 May 2006) | 3 lines

Exclude SqlExceptionTest from JDK 1.3 tests


------------------------------------------------------------------------
r409007 | rhillegas | 2006-05-23 14:11:42 -0700 (Tue, 23 May 2006) | 1 line

DERBY-1340: Anurag's derby-1340.diff, which reverts the refactoring of the client api committed as part of DERBY-1246.
------------------------------------------------------------------------
r409002 | kmarsden | 2006-05-23 13:29:47 -0700 (Tue, 23 May 2006) | 13 lines

DERBY-1325 Isolation level of local connection does not get reset after exiting a global transaction if the isolation level was changed using SQL

Attaching a patch 'derby-1325-v1.diff' which ensures correct isolation level gets used once we switch back to local mode when SQL is used to set the isolation level.

Patch does the following:

* Adds call to get the isolation level up to date when joining/resuming a global transaction. This will make sure the BrokeredConnection object has the correct isolation level to be used when we switch back to local mode.

* Adds a test to jdbcapi/checkDataSource.java and modifies the master files.

With this patch, I ran derbyall with Sun jdk 1.4.2 on Windows XP. No failures. 


------------------------------------------------------------------------
r408971 | davidvc | 2006-05-23 10:40:14 -0700 (Tue, 23 May 2006) | 6 lines

DERBY-848: Internationalize NetSqldta to OpenSocketAction in 
org.apache.derby.client.net.

Passes derbynetclientmats on JDK 1.4/Solaris and jdbc40 on JDK1.6/Solaris


------------------------------------------------------------------------
r408875 | bernt | 2006-05-23 04:43:31 -0700 (Tue, 23 May 2006) | 1 line

DERBY-1323 Detectability methods rowUpdated, rowInserted, rowDeleted can be called from illegal states in both clients. Submitted by Dag H. Wanvik
------------------------------------------------------------------------
r408822 | fuzzylogic | 2006-05-22 20:22:54 -0700 (Mon, 22 May 2006) | 5 lines

DERBY-1156: Fix encryptDatabaseTest1 on Solaris. Encryption provider on Solaris
does not accept 16-byte keys for the default cipher. 

Committed for Suresh Thalamati <suresh.thalamati@gmail.com>

------------------------------------------------------------------------
r408772 | rhillegas | 2006-05-22 15:19:08 -0700 (Mon, 22 May 2006) | 1 line

DERBY-1253: Commit bug1253_forwarding.diff. This forwards some miscellaneous JDBC4 calls to competent objects.
------------------------------------------------------------------------
r408733 | rhillegas | 2006-05-22 12:39:31 -0700 (Mon, 22 May 2006) | 1 line

DERBY-1214: Anurag's derby-1214_2.diff patch. This forwards new JDBC4 calls on Pooled and XA objects to the appropriate worker objects.
------------------------------------------------------------------------
r408502 | fuzzylogic | 2006-05-21 15:01:29 -0700 (Sun, 21 May 2006) | 5 lines

Put setIO permission back for derbyTesting.jar and codeclasses. Nist runs with
useprocess=false, so the harness needs this permission to change the system
out and error streams in execTestNoProcess(). Also remove some empty files
left by previous DERBY-892 checkin.

------------------------------------------------------------------------
r408077 | fuzzylogic | 2006-05-20 12:35:50 -0700 (Sat, 20 May 2006) | 4 lines

DERBY-1334: Add policy file for testProtocol to prevent hang on Unix platforms.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r407642 | fuzzylogic | 2006-05-18 14:56:36 -0700 (Thu, 18 May 2006) | 4 lines

DERBY-892: Allow for test-specific additions to the derby_tests.policy file.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r407637 | fuzzylogic | 2006-05-18 14:33:43 -0700 (Thu, 18 May 2006) | 5 lines

DERBY-1141: Improve usability of running tests with useprocess=false.
Committing patch dated 20060512.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r407617 | rhillegas | 2006-05-18 12:17:09 -0700 (Thu, 18 May 2006) | 1 line

DERBY-1282: Dyre's derby-1282.v1.diff patch. Fills in new client info methods added by JDBC4.
------------------------------------------------------------------------
r407549 | rhillegas | 2006-05-18 06:45:26 -0700 (Thu, 18 May 2006) | 1 line

DERBY-1255: Narayanan's ClobBlob_create_v1.diff patch. This adds the first increment of support for Connection.createClob() and createBlob(), new methods added in JDBC4.
------------------------------------------------------------------------
r407547 | tmnk | 2006-05-18 06:34:11 -0700 (Thu, 18 May 2006) | 1 line

- DERBY-1302 Indent source files touched in DERBY-326 - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r407403 | fuzzylogic | 2006-05-17 16:44:01 -0700 (Wed, 17 May 2006) | 3 lines

DERBY-1324: Clean up a couple of remaining copyright notices and misleading
javadoc text.

------------------------------------------------------------------------
r407396 | fuzzylogic | 2006-05-17 16:07:35 -0700 (Wed, 17 May 2006) | 5 lines

DERBY-514: Enable upgrade tests to work with unpackaged classes. Add upgrade
tests to derbyall.

Committed for Deepa Remesh <dremesh@gmail.com>

------------------------------------------------------------------------
r407366 | bandaram | 2006-05-17 13:17:45 -0700 (Wed, 17 May 2006) | 13 lines

DERBY-1156: Committing this for Suresh, reviewed by Mike Matrigali.

Here is Mike's review comments:
I have reviewed this patch and run a full set of tests on windows XP / sun jdk1.4.2 which passed. I think this patch should be committed as is. It is a good incremental checkin for this feature. It provides a set of tools for the rest of the project, and gets the code to the point that it can encrypt an existing unencrypted db. Future checkins should address a couple of things:
1) obviously more testing. Some quick notes, the current tests may want to show that accessing the newly encrypted db with a bad password does not work - just to insure all the url;s are not just being totally ignored. Also want to test abort - probably need a testing codepoint to cause the failure at the right time.
2) fix up the comments, there are some typo's .
3) usual nit - some greater than 80 char lines.

I would have committed this change now, but svn still is not back.

Patch submitted by Suresh Thalamati (suresh.thalamati@gmail.com)


------------------------------------------------------------------------
r407202 | fuzzylogic | 2006-05-17 01:55:41 -0700 (Wed, 17 May 2006) | 2 lines

Minor change to javadoc.tool property for Mac OS X build instructions.

------------------------------------------------------------------------
r407116 | rhillegas | 2006-05-16 18:09:10 -0700 (Tue, 16 May 2006) | 1 line

DERBY-1328: Commit Narayanan's ClobBlob_free_v1.diff patch, implementing the LOB free() method introduced by JDBC4.
------------------------------------------------------------------------
r406921 | tmnk | 2006-05-16 05:20:43 -0700 (Tue, 16 May 2006) | 1 line

- DERBY-1303 The test of derbynet/SuicideOfStreaming.java is failed when programs are build as Insane - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r406777 | fuzzylogic | 2006-05-15 16:36:12 -0700 (Mon, 15 May 2006) | 2 lines

DERBY-1307: Disable jdbc40 tests on J2ME/Foundation

------------------------------------------------------------------------
r406776 | bpendleton | 2006-05-15 16:34:28 -0700 (Mon, 15 May 2006) | 16 lines

DERBY-1219: jdbcapi/checkDataSource test hangs intermittently with client

This patch contributed by Deepa Remesh (dremesh@gmail.com).

This patch enables the checkDataSource and checkDataSource30 tests to
run with the client framework by removing the code which shuts down
the system in the middle of the test. This is the code which causes
the intermediate hang.

The hanging problem has been logged as a separate issue, DERBY-1326.

The shutdown is a valuable part of the test because it verifies that the
global transaction state is valid even after the database has been shut
down, so once the hang problem has been resolved, this test should be
modified again to re-enable the shutdown processing with the client framework.

------------------------------------------------------------------------
r406775 | fuzzylogic | 2006-05-15 16:33:58 -0700 (Mon, 15 May 2006) | 2 lines

DERBY-1309: Update j9_foundation/updatableResultSet.out canon

------------------------------------------------------------------------
r406773 | fuzzylogic | 2006-05-15 16:25:31 -0700 (Mon, 15 May 2006) | 2 lines

Back out 406771, should have only gone into 10.1 branch

------------------------------------------------------------------------
r406771 | fuzzylogic | 2006-05-15 16:20:31 -0700 (Mon, 15 May 2006) | 5 lines

DERBY-1311: Skip wisconsin test on J2ME/Foundation. Remove old reference to
wisc_setup.sql

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r406769 | fuzzylogic | 2006-05-15 16:16:08 -0700 (Mon, 15 May 2006) | 4 lines

DERBY-1154: Fix derbynet/testSecMec on jdk131

Committed for Sunitha Kambhampati <ksunithaghm@gmail.com>

------------------------------------------------------------------------
r406766 | fuzzylogic | 2006-05-15 16:09:04 -0700 (Mon, 15 May 2006) | 2 lines

Trivial patch to fix dblook_test diffs on wctme5.7

------------------------------------------------------------------------
r406683 | bernt | 2006-05-15 10:10:11 -0700 (Mon, 15 May 2006) | 1 line

DERBY-1087 Updatable result sets behave different depending on the type of query used to generate the result set. Submitted by Fernanda Pizzorno
------------------------------------------------------------------------
r406280 | kahatlen | 2006-05-14 01:11:01 -0700 (Sun, 14 May 2006) | 20 lines

DERBY-1234: Verify that we raise SQLException when calling methods on
closed java.sql objects

Final patch for DERBY-1234. The patch makes the methods in the client
driver check whether the object is closed. With this patch,
jdbcapi/StmtCloseFunTest.java has the same behaviour with the client
driver as with the embedded driver so the DerbyNetClient canon could
be removed. Also, jdbc4/ClosedObjectTest.junit runs cleanly both on
embedded and on the client, and it has been added to the jdbc40 suite.

In addition to adding checkForClosedXXX() calls, this patch

  a) implements Connection.getTypeMap() with the correct generic
     signature in NetConnection40 and LogicalConnection40 to avoid
     compiler warnings

  b) implements isWrapperFor() (with check for closed object) in
     Statement, so that it could be removed from Statement40,
     PreparedStatement40 and CallableStatement40

------------------------------------------------------------------------
r406279 | kahatlen | 2006-05-14 00:54:58 -0700 (Sun, 14 May 2006) | 5 lines

DERBY-1251: cancelRowUpdates() affects rows updated with updateRow()
in scrollable updatable resultsets

Fix contributed by Andreas Korneliussen.

------------------------------------------------------------------------
r406278 | kahatlen | 2006-05-14 00:32:19 -0700 (Sun, 14 May 2006) | 4 lines

DERBY-955: Get derbyall on jdk1.6

Run jdbc40 as part of derbynetclientmats.

------------------------------------------------------------------------
r406120 | kmarsden | 2006-05-13 08:21:08 -0700 (Sat, 13 May 2006) | 17 lines

DERBY-900 -  Remove use of String(byte[]) and String(byte[], int, int) constructors in network client leading to non-portable behaviour

Decided earlier to break up the derby900.p2.diff.txt, so I am attaching now a patch with the cleanup changes separately in derby900_p2_cleanup.diff.txt. Changes are:

-- remove unnecessary conversion from sqlstate string to bytes and back to string , in parseSQLDCGRP(Sqlca[] rowsetSqlca, int lastRow) in NetConnectionReply.
This has been done by adding a constructor in NetSqlca to take in the sqlstate as string.
-- cleanup method getSqlState() in Sqlca.
-- cleanup of ccsid_ in Sqlca as it is not used.

Please note, the parseSQLDCGRP method in the diff shows more changes because of change in indentation because of removal of the try block.

-- ran derbynetclientmats on ibm142/linux OK.

Contributed by Sunitha Kambhampati



------------------------------------------------------------------------
r406101 | rhillegas | 2006-05-13 06:51:40 -0700 (Sat, 13 May 2006) | 1 line

DERBY-1090: Commit Olav's brokeredlogical1090.diff patch, which forwards missing Connection calls for pooled and xa connections.
------------------------------------------------------------------------
r405670 | fuzzylogic | 2006-05-10 00:57:19 -0700 (Wed, 10 May 2006) | 4 lines

DERBY-577: Test harness should not alter user.dir property

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r405655 | fuzzylogic | 2006-05-10 00:00:24 -0700 (Wed, 10 May 2006) | 2 lines

DERBY-1078: Add lib-debug distribution to tools/release/build.xml

------------------------------------------------------------------------
r405563 | fuzzylogic | 2006-05-09 15:52:29 -0700 (Tue, 09 May 2006) | 2 lines

DERBY-178: Add debug archives to snapshot target.

------------------------------------------------------------------------
r405560 | rhillegas | 2006-05-09 15:41:26 -0700 (Tue, 09 May 2006) | 1 line

DERBY-1079: Patch bug1079_split2.diff, This splits the public javadoc into a jdbc3-specific and jdbc4-specific sets when built with the jdk16 variable set.
------------------------------------------------------------------------
r405210 | rhillegas | 2006-05-08 15:53:26 -0700 (Mon, 08 May 2006) | 1 line

DERBY-862: Commit bug 862_misc5.diff, more miscellaneous javadoc warnings.
------------------------------------------------------------------------
r405205 | davidvc | 2006-05-08 15:38:56 -0700 (Mon, 08 May 2006) | 3 lines

DERBY-1266 - Attempted deleteRow or updateRow while on insert row gives wrong error message.  Passes derbynetclientmats and jdbc40 test suite.


------------------------------------------------------------------------
r405201 | rhillegas | 2006-05-08 15:32:24 -0700 (Mon, 08 May 2006) | 1 line

DERBY-1079: Re-doing submission 393834. The old version of javacc was accidentally reintroduced by DERBY-846. I am checking in javacc version 4.0 again.
------------------------------------------------------------------------
r405037 | tmnk | 2006-05-08 05:36:39 -0700 (Mon, 08 May 2006) | 1 line

- DERBY-326 Improve streaming of large objects for network server and client - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r400366 | bpendleton | 2006-05-06 13:37:17 -0700 (Sat, 06 May 2006) | 16 lines

DERBY-1229: sysinfo and sysinfo_withProperties tests fail with SecurityException

This change modifies the handling of security exceptions in the Sysinfo tool.
If a security exception occurs while processing an element in the classpath,
sysinfo will now format that security exception's message into the output,
and then will continue on to process the other elements in the classpath.

This ensures that sysinfo provides more detailed and more complete information
about the classpath information in the environment.

Also, the sed properties for the sysinfo tests are now updated to mask out
the getProtectionDomain security exception, since that is an expected
exception in these tests (in fact, there are many expected security exceptions
in these tests).


------------------------------------------------------------------------
r400287 | kahatlen | 2006-05-06 04:26:58 -0700 (Sat, 06 May 2006) | 18 lines

DERBY-1234 (partial) Verify that we raise SQLException when calling
methods on closed java.sql objects

New patch (part5) which makes all the BrokeredXXX classes check
whether the object is closed. What the patch does, is:

  1) Implement checkIfClosed() and call it where needed.

  2) Implement BrokeredStatement.isClosed() which was needed by
     checkIfClosed().

  3) Remove isWrapperFor() from BrokeredStatement40,
     BrokeredPreparedStatement40 and BrokeredCallableStatement40 and
     replace it by one shared method (which does the right thing when
     the object is closed) in BrokeredStatement

With this patch, jdbc4/ClosedObjectTest.junit runs cleanly on embedded.

------------------------------------------------------------------------
r400212 | kahatlen | 2006-05-05 16:50:12 -0700 (Fri, 05 May 2006) | 20 lines

DERBY-1277: Call to rs.isLast() may cause rs.getXXX() return values
from the last row instead of the current row in scrollable resultsets

In scrollable updatable resultset, a call to rs.isLast() may cause
rs.getXXX() return values from the last row, instead of for the
current row. It is caused by TableScanResultSet and EmbedResultSet
sharing DataValueColumn descriptors, and that the call to isLast()
will make TableScanResultSet modify the data.

Attaching a fix, where ScrollInsensitiveResultSet does not return
ExecRow from the source resultset, only from the hashtable. This
ensures that navigation in source resultsets do not affect the current
row of the scrollinsensitive resultset.

Also extended the test testRelative to test with concurrency mode
CONCUR_UPDATABLE, and fixed it so that it can run in derbynetclient
framework.

Patch contributed by Andreas Korneliussen.

------------------------------------------------------------------------
r400172 | rhillegas | 2006-05-05 14:11:29 -0700 (Fri, 05 May 2006) | 1 line

DERBY-1253: Commit bug1253_verifier4_networkResultSet. This changes the NotSupported exception raised by network ResultSets to be one of the UnimplementedFeature exceptions which are mapped to SQLFeatureNotSupportedException under JDBC4. Also added more excludable methods to the UnsupportedVetter test.
------------------------------------------------------------------------
r400036 | kahatlen | 2006-05-05 03:16:36 -0700 (Fri, 05 May 2006) | 2 lines

DERBY-1234 (partial) Removed two unneeded checks for closed objects.

------------------------------------------------------------------------
r399909 | fuzzylogic | 2006-05-04 18:14:31 -0700 (Thu, 04 May 2006) | 4 lines

DERBY-1290: Add master files for JCC 2.8. 

Committed for Deepa Remesh <dremesh@gmail.com>

------------------------------------------------------------------------
r399907 | fuzzylogic | 2006-05-04 18:12:20 -0700 (Thu, 04 May 2006) | 4 lines

DERBY-514: Commit patch7-v2. Create upgrade suite. Describe 
derbyTesting.jar.path property in test README and BUILDING.txt. Don't regenerate
Upgrade_10_1_10_2.properties on a recompile.

------------------------------------------------------------------------
r399644 | kahatlen | 2006-05-04 02:58:54 -0700 (Thu, 04 May 2006) | 5 lines

DERBY-941: Add JDBC4 support for Statement Events

Implementation of statement events on the client side. Patch
contributed by V. Narayanan.

------------------------------------------------------------------------
r399615 | kahatlen | 2006-05-04 01:38:27 -0700 (Thu, 04 May 2006) | 4 lines

Fixed build script so that the JDBC 4.0 classes in
java/engine/org/apache/derby/iapi/jdbc/ are recompiled when they have
been modified.

------------------------------------------------------------------------
r399604 | kahatlen | 2006-05-04 01:17:00 -0700 (Thu, 04 May 2006) | 3 lines

DERBY-1234 (partial) Make the methods in EmbedConnection raise an
exception when the connection is closed.

------------------------------------------------------------------------
r399556 | fuzzylogic | 2006-05-03 22:49:16 -0700 (Wed, 03 May 2006) | 2 lines

Correct typo in impl/sql/build.xml

------------------------------------------------------------------------
r399482 | rhillegas | 2006-05-03 16:01:06 -0700 (Wed, 03 May 2006) | 1 line

DERBY-1253: Changes to the unsupported-method-verifier based on my review of the revised, draft JDBC4 Compliance chapter.
------------------------------------------------------------------------
r399450 | fuzzylogic | 2006-05-03 14:53:00 -0700 (Wed, 03 May 2006) | 4 lines

DERBY-1078: Fix problem with parsers on IBM JDK 1.3.1 by qualifying the
one reference to the interface field tokenImage in the generated parser source
with the interface class name.

------------------------------------------------------------------------
r399352 | davidvc | 2006-05-03 10:00:59 -0700 (Wed, 03 May 2006) | 4 lines

DERBY-850 - Internationalize client/org/apache/derby/jdbc classes.
Passes derbynetclientmats.


------------------------------------------------------------------------
r399351 | davidvc | 2006-05-03 09:55:50 -0700 (Wed, 03 May 2006) | 2 lines

DERBY-846: Check in missing updated master file

------------------------------------------------------------------------
r399293 | rhillegas | 2006-05-03 06:20:00 -0700 (Wed, 03 May 2006) | 1 line

DERBY-955: Commit bug955_blobclob4BLOB.diff. This converts a printout to an assertion in the blobclob4BLOB test and eliminates two more jdk16-specific canons.
------------------------------------------------------------------------
r399265 | kahatlen | 2006-05-03 04:27:35 -0700 (Wed, 03 May 2006) | 2 lines

DERBY-1180: Removed empty java file.

------------------------------------------------------------------------
r399164 | fuzzylogic | 2006-05-02 23:19:49 -0700 (Tue, 02 May 2006) | 2 lines

DERBY-1078: Fix stress and dataSourcePermissions related tests on jdk131

------------------------------------------------------------------------
r399078 | davidvc | 2006-05-02 16:10:44 -0700 (Tue, 02 May 2006) | 3 lines

DERBY-846: Internationalze NetAgent to NetDatabaseMetadata40 in org.apache.derby.client.net


------------------------------------------------------------------------
r399072 | rhillegas | 2006-05-02 15:32:59 -0700 (Tue, 02 May 2006) | 1 line

DERBY-1253: Dyre's derby-1253.v1.diff patch, which filters out optional methods from the output of the UnsupportedVetter test.
------------------------------------------------------------------------
r399063 | rhillegas | 2006-05-02 14:52:22 -0700 (Tue, 02 May 2006) | 1 line

DERBY-1238: Kristian's derby-1238-1a.diff patch, adding createStruct() and createArray(). I also wired Knut Anders' VerifySignatures test into the jdbc40 suite because now it passes cleanly.
------------------------------------------------------------------------
r399038 | rhillegas | 2006-05-02 13:25:44 -0700 (Tue, 02 May 2006) | 1 line

DERBY-1146: Kristian's derby-1146-v2-enable.diff patch, which cleans up the order in which the jdbc4 tests run. I removed VerifySignatures from the list until DERBY-1238 commits.
------------------------------------------------------------------------
r398944 | kmarsden | 2006-05-02 07:39:25 -0700 (Tue, 02 May 2006) | 11 lines

DERBY-900  Remove use of String(byte[]) and String(byte[], int, int) constructors in network client leading to non-portable behaviour

This patch derby900.p2_encodingChange.diff.txt makes the encoding related change to remove the non portable String.getBytes() method.
Additonal patch for cleanup will follow

Contributed by Sunitha Kambhampati

-- use correct encoding UTF8 for sqlstate in NetConnectionReply.::parseSQLDCGRP(Sqlca[] rowsetSqlca, int lastRow)



------------------------------------------------------------------------
r398940 | kahatlen | 2006-05-02 06:46:51 -0700 (Tue, 02 May 2006) | 8 lines

DERBY-1235: Move isPoolable() and setPoolable() from PreparedStatement
to Statement

Moved setPoolable() and isPoolable() from PreparedStatement to
Statement and implemented the methods in BrokeredStatement.

Contributed by Dyre Tjeldvoll.

------------------------------------------------------------------------
r398837 | kahatlen | 2006-05-02 00:51:17 -0700 (Tue, 02 May 2006) | 3 lines

DERBY-1234: Make all methods in EmbedResultSet, EmbedResultSet20 and
EmbedResultSet40 invoke checkIfClosed().

------------------------------------------------------------------------
r398630 | rhillegas | 2006-05-01 09:19:18 -0700 (Mon, 01 May 2006) | 1 line

DERBY-1265: Commit bug1265_01_sortMethods.diff. Sorts the result of Class.getMethods() to remove an indeterminacy in the test.
------------------------------------------------------------------------
r398594 | rhillegas | 2006-05-01 06:40:00 -0700 (Mon, 01 May 2006) | 1 line

DERBY-1180: Commit Kristian's derby-1180-4c-logicalconnection_and_tests.diff patch, adding vacuous implementations for missing signatures.
------------------------------------------------------------------------
r398031 | fuzzylogic | 2006-04-28 15:33:46 -0700 (Fri, 28 Apr 2006) | 5 lines

DERBY-1264: Fix importExportThruIj test on systems with non-ASCII native
encoding.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r398017 | fuzzylogic | 2006-04-28 14:25:43 -0700 (Fri, 28 Apr 2006) | 2 lines

Fix package name on MessageId

------------------------------------------------------------------------
r397989 | rhillegas | 2006-04-28 12:33:53 -0700 (Fri, 28 Apr 2006) | 1 line

DERBY-1129: Add encryption jar to classpaths so that compatibility tests run on jdk1.3.1.
------------------------------------------------------------------------
r397980 | davidvc | 2006-04-28 11:41:07 -0700 (Fri, 28 Apr 2006) | 9 lines

Move iapi/reference/MessageId.java to shared/common/reference, so that
it can be used by the client code.

In order to avoid naming confusion, I renamed client/am/MessageId.java
to ClientMessageId.  Apologies if this causes conflicts for anyone.

Passes derbynetclientmats


------------------------------------------------------------------------
r397959 | djd | 2006-04-28 10:25:02 -0700 (Fri, 28 Apr 2006) | 2 lines

DERBY-1258 Change the generated code for a new/old column in a row trigger to access columns
by position and not name to avoid the case-insensitive name lookup specified by JDBC.
------------------------------------------------------------------------
r397926 | rhillegas | 2006-04-28 08:40:05 -0700 (Fri, 28 Apr 2006) | 1 line

DERBY-1253: Second rev of UnsupportedVerifier test. The first rev failed on linux. I will log a bug for the discrepancy between xp/cygwin and linux. I am checking in this test (not wired into any suite) so that it is in evidence for the bug I will log.
------------------------------------------------------------------------
r397899 | rhillegas | 2006-04-28 06:44:29 -0700 (Fri, 28 Apr 2006) | 1 line

DERBY-1090: Commit Olav's client1090_patch2.diff patch, which addresses recovery from hanging servers.
------------------------------------------------------------------------
r397678 | rhillegas | 2006-04-27 16:35:15 -0700 (Thu, 27 Apr 2006) | 1 line

DERBY_1254: Checked in Narayanan's patch DERBY_1254.diff, which simplifies and cleans up the creation of JDBC4 NetConnections.
------------------------------------------------------------------------
r397675 | bandaram | 2006-04-27 16:18:48 -0700 (Thu, 27 Apr 2006) | 22 lines

DERBY-1007: Follow up patch to earlier submitted patch.

In a word, the fix for this issue ensures that, in the case of subqueries, the optimizer will correctly propagate the estimated costs for subqueries up to the parent subquery(-ies), thus allowing the parent query to make a better decision about which join order is ultimately the best. As seen in the example scenario included above, the correct estimates are higher--sometimes much higher--than what the optimizer was returning prior to this change: in the example, the optimizer was returning an incorrect cost estimate of 10783 before the patch, and a correct estimate of 1 million after the patch (where "correct" means that it's the value calculated by the optimizer and thus the value that should be returned; I'm not saying anything about the accuracy of the estimate here).

One side effect of this is that, for very deeply nested queries and/or queries with a high number of FROM tables/expressions, the higher cost estimates can be multiplied--sometimes many times over--throughout the optimization process, which means that the overall query estimate can climb to a much larger number much more quickly. If the query is big enough, this can actually cause the optimizer to reach an estimated cost of INFINITY.

That said, the current optimizer logic for choosing a plan does not expect to see an estimate of infinity for its plans. As a result the optimizer does comparisons of, and arithmetic with, cost estimates and row counts that, when applied to Infinity, give unexpected results.

I have filed DERBY-1259 and DERBY-1260 to address the "infinity problem" in more detail, but am attaching here a follow-up patch that takes some basic steps toward making the optimizer more robust in the face of infinite cost estimates, which are now more likely to occur given the DERBY-1007 changes. In particular, the d1007_followup_v1.patch does the following:

1) Fixes a couple of small problems with the handling of estimates for FromBaseTables, to ensure that a FromBaseTable's estimate is correctly propagated to (and handled by) the ProjectRestrictNode that sits above it. This parallels the original DERBY-1007 work but is a much simpler "follow-up" task as it deals only with base tables instead of subqueries, and thus the changes are fairly minor.

2) There are several places in OptimizerImpl where the optimizer will only choose to accept a plan's cost if the cost is less than the current "bestCost". If no best cost has been found yet, bestCost is set to an uninitialized value of Double.MAX_VALUE with the assumption that the first valid plan will have a cost less than Double.MAX_VALUE and thus will be chosen as the best so far. However, since a plan's cost estimate can actually end up being Double.POSITIVE_INFINITY, which is greater than Double.MAX_VALUE, it's possible that the optimizer will reject a valid join order because its cost is infinity, and then end up completing without ever finding a valid plan--which is wrong. What we want is for the optimizer to accept the first valid plan that it finds, regardless of what the cost is. Then if it later finds a better plan, it can use that. So in several places the d1007_followup_v1.patch adds a check to see if bestCost is uninitialized and, if so, we'll always accept the first valid join order we find, regardless of what its cost is--even if it's infinity--because that's better than no plan at all.

3) Modifies the "compare" method in CostEstimateImpl.java to try to account for comparisons between two plans that both have infinite costs. If this happens, we don't have much choice but to guess as to which plan is actually better. So the changes for followup_v1 make that guess based on a comparison of row counts for the two plans. And if the row counts themselves are infinity, then we'll guess based on the single scan row counts. And finally, if those values are both infinity, as well, then we're out of luck and we just say that the two costs are "equal" for lack of better alternative.

4) And finally, due to unexpected behavior that results from arithmetic using infinity (see DERBY-1259), it is currently possible (though rather rare) for the optimizer to decide to do a hash join that has a cost estimate of Infinity. An example of a query for which this could happen can be found in DERBY-1205, query #1. That said, the BackingStoreHashtable that is used for carrying out a hash join currently creates a Java Hashtable instance with a capacity that matches the optimizer's estimated row count. So if the row count is infinity we'll try to create a Hashtable with some impossibly large capacity and, as a result, we'll end up with an OutOfMemory error. So the d1007_followup_v1.patch adds some code to handle this kind of situation in a more graceful manner.

I ran derbyall with these changes on Linux Red Hat using ibm142 and saw no new failures.

Submitted by Army Brown (qozinx@gmail.com)

------------------------------------------------------------------------
r397650 | rhillegas | 2006-04-27 14:48:59 -0700 (Thu, 27 Apr 2006) | 1 line

DERBY-1079: Commit bug1079_clientPublicAPI, adding javadoc for client classes in our public api.
------------------------------------------------------------------------
r397624 | rhillegas | 2006-04-27 13:09:08 -0700 (Thu, 27 Apr 2006) | 1 line

DERBY-862: Fix misc javadoc warnings in DatabaseMetaData and SystemProcedures: bug862_misc4.diff.
------------------------------------------------------------------------
r397576 | djd | 2006-04-27 09:03:31 -0700 (Thu, 27 Apr 2006) | 2 lines

DERBY-1258 (testcase) Add test case that shows the trigger bug when referencing a column that matches
another column when upper-cased.
------------------------------------------------------------------------
r397318 | djd | 2006-04-26 15:05:27 -0700 (Wed, 26 Apr 2006) | 2 lines

DERBY-438 (partial) Handle CLOB columns in triggers by adding code to convert from a java.sql.Clob to a SQLClob.
Added tests in triggerGeneral.sql for small CLOB values.
------------------------------------------------------------------------
r397316 | djd | 2006-04-26 15:00:22 -0700 (Wed, 26 Apr 2006) | 4 lines

DERBY-438 (partial) Consolidate code around converting application character streams (Readers)
to the internal stored form (modified UTF8). Pushed handling of LimitReader into ReaderToUTF8Stream
to avoid duplicated code and ReaderToUTF8Stream having to make assumptions about the caller setting
up the LimitReader correctly. Added comments and clarifications to LimitReader and ReaderToUTF8Stream.
------------------------------------------------------------------------
r397315 | djd | 2006-04-26 14:55:08 -0700 (Wed, 26 Apr 2006) | 1 line

DERBY-438 (partial) Add testing of BLOBs in triggers with larger BLOB values.
------------------------------------------------------------------------
r397313 | djd | 2006-04-26 14:51:20 -0700 (Wed, 26 Apr 2006) | 2 lines

DERBY-438 (partial) Optimize Blob.length() to avoid reading the whole stream if the length
is encoded in the stream from the store or the length has already been obtained once.
------------------------------------------------------------------------
r397300 | kmarsden | 2006-04-26 13:58:09 -0700 (Wed, 26 Apr 2006) | 3 lines

DERBY-1247 - Make DerbyNetAutostart encoding safe
 

------------------------------------------------------------------------
r397278 | fuzzylogic | 2006-04-26 12:40:53 -0700 (Wed, 26 Apr 2006) | 2 lines

DERBY-1078: Fix XA, encryption, and a couple more tests for jdk131-built-on-jdk15/16.

------------------------------------------------------------------------
r397186 | kahatlen | 2006-04-26 04:59:43 -0700 (Wed, 26 Apr 2006) | 6 lines

DERBY-1234 (partial): Verify that we raise SQLException when calling
methods on closed java.sql objects

Added checkStatus() to the EmbedXXXStatement methods that don't check
whether the statement is closed.

------------------------------------------------------------------------
r397043 | bandaram | 2006-04-25 18:23:29 -0700 (Tue, 25 Apr 2006) | 15 lines

DERBY-805: Follow up patch to address remaining issues following Phase IV work.

1) Added logic to skip predicate pushdown when either of the predicate's column references does not point to a base table. This can happen if, for example, the column reference points to a literal or an aggregate expression. Further work is required for such situations in order to correctly "remap" the column reference to its source (or at least, to figure out what exactly it means to remap a ColumnReference that doesn't point to a base table, and then to implement the appropriate changes)--so in the meantime, I've just decided to skip pushing the predicate for now.

2) Added logic to correctly set the column number of a "scoped" reference based on whether or not the reference points to a base table. Existing comments in the relevant sections of code describe why we need to set the column numbers for references pointing to base tables, but the code itself didn't actually check for the base table condition--it set the column number for all scoped references, which wasn't always correct.

3) In cases where a ColumnReference's source ResultColumn's expression is not another ColumnReference, made it so that the scope operation will return a clone of ColumnReference (instead of the ColumnReference itself) since that ColumnReference will be pushed to two result sets.

4) Added corresponding test cases to the lang/predicatePushdown.sql test and updated the master file accordingly.

I ran derbyall on Red Hat Linux with ibm142 and saw no new failures.

Submitted by Army Brown.


------------------------------------------------------------------------
r397028 | fuzzylogic | 2006-04-25 17:26:41 -0700 (Tue, 25 Apr 2006) | 5 lines

DERBY-575: Fix blobclob4BLOB, lobStreams, and ieptests on systems with non-ASCII
native encodings.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r397014 | mikem | 2006-04-25 16:09:04 -0700 (Tue, 25 Apr 2006) | 5 lines

DERBY-1039, committed on behalf of Suresh Thalamati

New tests that should have been part of previous checkin for DERBY-1039 fix.


------------------------------------------------------------------------
r397011 | mikem | 2006-04-25 16:02:26 -0700 (Tue, 25 Apr 2006) | 8 lines

DERBY-1039, committed on behalf of Suresh Thalamati

-- database create will fail with error if the user specified logDevice location
   already contains non-empty "log" dir at that location.
   -- added a new test that tests database creation with logDevice location
      with absolute paths and also the above expected error case. 


------------------------------------------------------------------------
r396979 | fuzzylogic | 2006-04-25 13:40:43 -0700 (Tue, 25 Apr 2006) | 2 lines

Don't run jdbc40 suite on ibm15.

------------------------------------------------------------------------
r396973 | rhillegas | 2006-04-25 13:20:11 -0700 (Tue, 25 Apr 2006) | 1 line

DERBY-955: Wire the jdbc4 tests into derbyall.
------------------------------------------------------------------------
r396972 | kahatlen | 2006-04-25 13:10:26 -0700 (Tue, 25 Apr 2006) | 6 lines

DERBY-1234: Verify that we raise SQLException when calling methods on
closed java.sql objects

Removed getTypeMap() from EmbedConnection40 and NetConnection40 since
it is already implemented in their super-classes.

------------------------------------------------------------------------
r396889 | rhillegas | 2006-04-25 07:04:06 -0700 (Tue, 25 Apr 2006) | 1 line

DERBY-1236: Commit Dyre's new tests for setSavepoint(), derby-1236.v1.diff.
------------------------------------------------------------------------
r396881 | rhillegas | 2006-04-25 06:35:37 -0700 (Tue, 25 Apr 2006) | 1 line

DERBY-1246: Commit derby-1246.diff, making the public network api conform to the inheritance pattern of the embedded api.
------------------------------------------------------------------------
r396875 | rhillegas | 2006-04-25 06:14:28 -0700 (Tue, 25 Apr 2006) | 1 line

DERBY-955: Patch security policy for classtree so that sysinfo runs cleanly: bug955_sysinfo.diff.
------------------------------------------------------------------------
r396871 | kahatlen | 2006-04-25 05:51:29 -0700 (Tue, 25 Apr 2006) | 2 lines

Removed duplicated entry in jdbc40.runall.

------------------------------------------------------------------------
r396859 | kahatlen | 2006-04-25 05:22:08 -0700 (Tue, 25 Apr 2006) | 11 lines

DERBY-941 (partial): Add JDBC4 support for Statement Events

a) provide the imlementation for StatementEventListener methods in
   EmbedXAConnection40
b) Modify TestUtil.java to return EmbedXADataSource40 when running
   with mustang
c) remove testing for LSE_COMPILATION_PREFIX as the prefix for the
   SQLState when throwing the Statement Error Occurred events.

Patch contributed by V. Narayanan <V.Narayanan@Sun.COM>.

------------------------------------------------------------------------
r396705 | fuzzylogic | 2006-04-24 15:39:39 -0700 (Mon, 24 Apr 2006) | 5 lines

DERBY-1230: Remove Tester*.out log files from stress.multi test run if there
are no errors.

Committed for Ole Solberg <Ole Solberg@sun.com>

------------------------------------------------------------------------
r396669 | rhillegas | 2006-04-24 12:43:30 -0700 (Mon, 24 Apr 2006) | 1 line

DERBY-1180: Committed Kristian's patches providing tests and vacuous implementations for missing signatures: derby-1180-2a-client.diff and derby-1180-3a-testing.diff.
------------------------------------------------------------------------
r396638 | rhillegas | 2006-04-24 11:36:00 -0700 (Mon, 24 Apr 2006) | 1 line

DERBY-930: Enable autoloading of client drivers now that build 81 of jdk1.6 fixes a problem with autoloading under the SecurityManager.
------------------------------------------------------------------------
r396525 | kahatlen | 2006-04-24 04:55:02 -0700 (Mon, 24 Apr 2006) | 9 lines

DERBY-1094: Make DatabaseMetaData.getProcedureColumns() JDBC4
compliant

The result set returned by getProcedureColumns() is extended with 7
columns: COLUMN_DEF, SQL_DATA_TYPE, SQL_DATETIME_SUB,
CHAR_OCTET_LENGTH, ORDINAL_POSITION, IS_NULLABLE and SPECIFIC_NAME.

Patch contributed by Dyre Tjeldvoll <Dyre.Tjeldvoll@Sun.COM>.

------------------------------------------------------------------------
r396285 | kahatlen | 2006-04-23 08:31:17 -0700 (Sun, 23 Apr 2006) | 5 lines

DERBY-1078: Be able to build Derby when JAVA_HOME is set 1.6

Fixed build script so that all classes needed by the storerecovery
suite are compiled.

------------------------------------------------------------------------
r396269 | kahatlen | 2006-04-23 06:22:52 -0700 (Sun, 23 Apr 2006) | 7 lines

DERBY-1234: Verify that we raise SQLException when calling methods on
closed java.sql objects

Added test (jdbc4/ClosedObjectTest.junit) which checks whether
exceptions are thrown when calling methods on closed objects. The test
is not enabled in any suite.

------------------------------------------------------------------------
r396141 | fuzzylogic | 2006-04-22 09:28:06 -0700 (Sat, 22 Apr 2006) | 2 lines

Fix demo test compilation.

------------------------------------------------------------------------
r396088 | fuzzylogic | 2006-04-22 00:17:18 -0700 (Sat, 22 Apr 2006) | 3 lines

Add note to BUILDING.txt section 5 for Mac-specific properties concerning
the setting of ${javadoc.tool}.

------------------------------------------------------------------------
r396080 | fuzzylogic | 2006-04-21 22:24:11 -0700 (Fri, 21 Apr 2006) | 4 lines

DERBY-1244: Readjust ij's LocalizedResource if new locale properties were loaded
with the -p option. Update outdated masters for LocalizedDisplay and
LocalizedConnectionAttribute. 

------------------------------------------------------------------------
r396035 | fuzzylogic | 2006-04-21 16:51:52 -0700 (Fri, 21 Apr 2006) | 3 lines

DERBY-1078: Cleanup compilation order and JDK 1.3 and JDK 1.4 build separation
in the tests.

------------------------------------------------------------------------
r396034 | kmarsden | 2006-04-21 16:40:38 -0700 (Fri, 21 Apr 2006) | 5 lines

DERBY-972 tests derbynet/csPrepStmt and prepStmt use mechanisms that are not portable over encodings

Contributed by Sunitha Kambhampati


------------------------------------------------------------------------
r396028 | rhillegas | 2006-04-21 15:50:25 -0700 (Fri, 21 Apr 2006) | 1 line

DERBY-1090: Olav's patch to enable Connection.isValid() in the network client.
------------------------------------------------------------------------
r395878 | kahatlen | 2006-04-21 06:30:45 -0700 (Fri, 21 Apr 2006) | 5 lines

DERBY-876: DatabaseMetaData.getSchemas() is not JDBC 3.0 compliant

Added missing column to the result set returned by
EmbedDatabaseMetaData.getSchemas().

------------------------------------------------------------------------
r395877 | kahatlen | 2006-04-21 06:20:35 -0700 (Fri, 21 Apr 2006) | 7 lines

DERBY-1093: Make DatabaseMetaData.getProcedures() JDBC4 compliant

Added missing column to the result set returned by
DatabaseMetaData.getProcedures().

Patch contributed by Dyre Tjeldvoll <Dyre.Tjeldvoll@Sun.COM>.

------------------------------------------------------------------------
r395872 | kahatlen | 2006-04-21 06:01:32 -0700 (Fri, 21 Apr 2006) | 7 lines

DERBY-1180 (partial): Add vacuous implementations of missing JDBC4
methods

Stubs for missing JDBC 4.0 methods in the embedded driver.

Patch contributed by Kristian Waagan <Kristian.Waagan@Sun.COM>.

------------------------------------------------------------------------
r395866 | bernt | 2006-04-21 05:12:36 -0700 (Fri, 21 Apr 2006) | 1 line

DERBY-775 Network client: Add support for scrollable, updatable, insensitive result sets. Submitted by Dag H. Wanvik
------------------------------------------------------------------------
r395799 | kahatlen | 2006-04-21 00:02:39 -0700 (Fri, 21 Apr 2006) | 21 lines

DERBY-1176: Stored prepared statements in the SYSIBM schema are not
updated on upgrade

  1. DD_Version.doFullUpgrade() now drops and recreates SPSs in all
     system schemas, not SYSIBM only.

  2. EmbedDatabaseMetaData already has the necessary machinery to load
     queries from system tables or metadata.properties depending on
     whether the engine is in soft upgrade mode or not. I extended it
     so that it could read queries from metadata_net.properties as
     well.

  3. New method EmbedDatabaseMetaData.getClientCachedMetaData() which
     executes SYSIBM.METADATA (either from system table or
     metadata_net.properties) to fetch the metadata that will be
     cached on the client.

  4. SystemProcedures.METADATA() now invokes
     EmbedDatabaseMetaData.getClientCachedMetaData() instead of
     executing the METADATA SPS directly.

------------------------------------------------------------------------
r395749 | fuzzylogic | 2006-04-20 18:20:54 -0700 (Thu, 20 Apr 2006) | 6 lines

DERBY-1078: Fix client and demo to work with JDK 1.3 when compiled with JDK 1.5
or higher. For client, ask the compiler to generate 1.3 classes, but then feed
it the 1.4 runtime classes. Client does the right things internally to work
properly on 1.3. Also, update BUILDING.txt to mention need for Ant 1.6.3 or
higher.

------------------------------------------------------------------------
r395748 | kmarsden | 2006-04-20 18:20:38 -0700 (Thu, 20 Apr 2006) | 10 lines

DERBY-1127 client gives SqlException for test callable.java and parameterMapping.java on zOS

Contributed by Sunitha Kambhampati

This patch fixes
-- the calls in DateTime to use correct UTF8 encoding as the server expects.
-- adds these two tests (callable.java, parameterMapping.java) to encodingTests



------------------------------------------------------------------------
r395690 | davidvc | 2006-04-20 13:14:33 -0700 (Thu, 20 Apr 2006) | 4 lines

DERBY-845: Internationalize CcsidManager to FdocaSimpleArray in
client/net package.  Only one message needed to be internationalized
in this set.  derbynetclientmats passes.

------------------------------------------------------------------------
r395663 | fuzzylogic | 2006-04-20 11:08:48 -0700 (Thu, 20 Apr 2006) | 3 lines

DERBY-1078: Add JTA to classpath for compiles that should be under 1.3 but
need JTA in the classpath.

------------------------------------------------------------------------
r395643 | fuzzylogic | 2006-04-20 10:07:39 -0700 (Thu, 20 Apr 2006) | 4 lines

DERBY-1078: Move more files to 1.3 source/target tags. Add xml-api jars to
compile XML classes with 1.3. Break shared hierarchy up into 1.3 and 1.4 parts.
JDK 1.3 now passes basic tests when compiled with 1.5.

------------------------------------------------------------------------
r395573 | kahatlen | 2006-04-20 05:16:02 -0700 (Thu, 20 Apr 2006) | 6 lines

DERBY-1198: jdbc/StatementTest.java uses SQLState directly

Remove unused import.

Patch contributed by Kristian Waagan <Kristian.Waagan@Sun.COM>.

------------------------------------------------------------------------
r395561 | kahatlen | 2006-04-20 04:15:20 -0700 (Thu, 20 Apr 2006) | 5 lines

DERBY-970: Add new metadata methods to network client driver

Added the JDBC 4.0 methods DatabaseMetaData.getSchemas() and
DatabaseMetaData.getClientInfoProperties() to the client driver.

------------------------------------------------------------------------
r395525 | bernt | 2006-04-20 00:52:53 -0700 (Thu, 20 Apr 2006) | 3 lines

DERBY-1174 NullPointerException in network server with LDAP authentication
Submitted by Anders Morken

------------------------------------------------------------------------
r395486 | fuzzylogic | 2006-04-19 22:16:44 -0700 (Wed, 19 Apr 2006) | 4 lines

DERBY-658: Update README.htm for testing, fix TestProto and multi tests to run on non-ASCII systems.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r395484 | davidvc | 2006-04-19 21:59:30 -0700 (Wed, 19 Apr 2006) | 10 lines

DERBY-843: Internationalize SectionManager to XaException in client/am
package.  Also cleaned up any remaining hardcoded text in this package.
Also fixed DERBY-1198, where jdbc4/StatementTest.java was using
SQLState directly.

Passes derbynetclientmats on jdk14 and jdbc40 on jdk16, and fixed output 
files for jdk13 and jdk16 for those tests whose output files were 
affected in the derbynetclientmats run.


------------------------------------------------------------------------
r395458 | fuzzylogic | 2006-04-19 18:20:34 -0700 (Wed, 19 Apr 2006) | 4 lines

DERBY-1078: Add appropriate source and target attributes to all <javac> tasks in
the buildfile. This allows the build to proceed with compilers from JDK 1.5 and
1.6.

------------------------------------------------------------------------
r395453 | fuzzylogic | 2006-04-19 17:42:44 -0700 (Wed, 19 Apr 2006) | 3 lines

DERBY-1063: Modify derbyrunjartest to call org.apache.derby.iapi.run directly
if it is not in a jar file. Hook the test into the tools suite.

------------------------------------------------------------------------
r395434 | fuzzylogic | 2006-04-19 16:20:23 -0700 (Wed, 19 Apr 2006) | 3 lines

DERBY-1063: Change server command in derbyrun.jar to server instead of
NetworkServerControl. Touch up the javadoc.

------------------------------------------------------------------------
r395430 | kmarsden | 2006-04-19 16:14:44 -0700 (Wed, 19 Apr 2006) | 5 lines

DERBY-901 encoding test for client messages.

Contributed by Sunitha Kamhampati


------------------------------------------------------------------------
r395416 | kmarsden | 2006-04-19 15:40:25 -0700 (Wed, 19 Apr 2006) | 16 lines

DERBY-901
Remove use of String(byte[]) constructors in network server leading to non-portable behaviour

Contributed by Sunitha Kambhampati

I am attaching the patch ( derby901.p2.diff.txt, derby901.p2.stat.txt) to fix the remaining places that the String(byte[]) constructor is used in Network Server.

remove use of default String(byte[]) constructor in
-- trace method in DRDAConnThread.readAndSetParams to print out the hex string of the bytes .
-- use SQLERRMC_TOKEN_DELIMITER in SQLDIAGCI .

some cleanup
 -- define the SQLERRMC_MESSAGE_DELIMITER in SystemProcedures and use that in DRDAConnThread.



------------------------------------------------------------------------
r395414 | rhillegas | 2006-04-19 15:28:34 -0700 (Wed, 19 Apr 2006) | 1 line

DERBY-925: Dyre's derby-925.v1.diff patch enabling new JDBC4 getFunctionParamaters() metadata method.
------------------------------------------------------------------------
r395390 | rhillegas | 2006-04-19 13:41:44 -0700 (Wed, 19 Apr 2006) | 1 line

DERBY-514: Commit change to BUILDING.txt which somehow dropped out of the commit of derby-514-patch3-v2.diff.
------------------------------------------------------------------------
r395328 | bandaram | 2006-04-19 11:06:07 -0700 (Wed, 19 Apr 2006) | 6 lines

Remove code that is not being used. Not only improves our code coverage, will also reduces complexity by removing dead code.

Remove partial code for DROP TABLE/VIEW CASCADE.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r395263 | rhillegas | 2006-04-19 08:14:29 -0700 (Wed, 19 Apr 2006) | 1 line

DERBY-1147: Commit Kristian's patch adding embedded and network client support for miscellaneous CallableStatement methods.
------------------------------------------------------------------------
r395245 | rhillegas | 2006-04-19 06:46:42 -0700 (Wed, 19 Apr 2006) | 1 line

DERBY-940: Narayanan's network client support for JDBC4 Wrapper api.
------------------------------------------------------------------------
r395088 | fuzzylogic | 2006-04-18 16:52:22 -0700 (Tue, 18 Apr 2006) | 2 lines

DERBY-1216: Add --help option to ij. Cleanup Main.mainCore and util.invalidArgs.

------------------------------------------------------------------------
r395004 | davidvc | 2006-04-18 12:29:10 -0700 (Tue, 18 Apr 2006) | 4 lines

DERBY-842: This fixes the failures in jdbc40 test suite.  Passes 
derbynetclientmats on JDK 4 and jdbc40 test suite on JDK 6


------------------------------------------------------------------------
r394981 | mikem | 2006-04-18 09:27:39 -0700 (Tue, 18 Apr 2006) | 11 lines

DERBY-1113, committing on behalf of Suresh Thalamati

 The reason for missing log files is truncation logic at checkpoint was
 incorrectly deleting the log files that were needed for crash recovery
 if the backup is progress at the same time; The first log file that should
     not be deleted was incorrectly assigned to the log file number that is yet
     to be written to the backup.

     Attached patch changes the logic, so that all the log files that are required for both crash recovery and the backup are not deleted. Basically the first log file that should not be deleted is the lowest of first log needed for crash recovery or the log file that is yet to be copied to the backup.


------------------------------------------------------------------------
r394952 | rhillegas | 2006-04-18 07:16:08 -0700 (Tue, 18 Apr 2006) | 1 line

DERBY-955: eliminate another set of derbyall diffs under jdk1.6.
------------------------------------------------------------------------
r394949 | kmarsden | 2006-04-18 07:07:26 -0700 (Tue, 18 Apr 2006) | 10 lines

DERBY-1025 - [xa] client XAResource.start() does not commit an active local transaction when auto commit is true
patch 2

I am attaching 'derby-1025-patch2-v1.diff' which changes checkDataSource test to test that starting a global transcation when a local transaction is active will give an exception. The XA error code is also printed out to verify that we get the expected exception. This patch will resolve this issue fully.

Contributed by Deepa Remesh




------------------------------------------------------------------------
r394861 | kahatlen | 2006-04-17 23:48:05 -0700 (Mon, 17 Apr 2006) | 23 lines

DERBY-1224: Remove unused variables in DatabaseMetaData

Removing the following variables from
org.apache.derby.client.am.DatabaseMetaData

  lastGetColumnPrivilegesResultSet_
  lastGetColumnsResultSet_
  lastGetForeignKeysResultSet_
  lastGetPrimaryKeysResultSet_
  lastGetProcedureColumnsResultSet_
  lastGetProceduresResultSet_
  lastGetSpecialColumnsResultSet_
  lastGetStatisticsResultSet_
  lastGetTablePrivilegesResultSet_
  lastGetTablesResultSet_
  lastGetUDTsResultSet_
  lastGetTypeInfoResultSet_
  lastGetAttrResultSet_
  lastGetSuperTypesResultSet_
  lastGetSuperTablesResultSet_

since they seem to have no purpose.

------------------------------------------------------------------------
r394859 | kahatlen | 2006-04-17 23:41:04 -0700 (Mon, 17 Apr 2006) | 6 lines

DERBY-822: Client driver: Pre-fetch data on executeQuery()

This patch makes the network server include query data when it replies
to an OPNQRY command. (Query data is only included when there are no
LOB columns and the protocol is limited block protocol.)

------------------------------------------------------------------------
r394815 | fuzzylogic | 2006-04-17 17:02:59 -0700 (Mon, 17 Apr 2006) | 5 lines

DERBY-1121: remove redundant check for DERBY-618 in checkDriver.out so the
test will run in a remote server configuration.

Committed for Deepa Remesh <dremesh@gmail.com>

------------------------------------------------------------------------
r394814 | djd | 2006-04-17 17:02:31 -0700 (Mon, 17 Apr 2006) | 2 lines

DEBRY-438 (partial) Add some testing of the content of the BLOBs to blobclob4BLOB.java test
by checking the CRC32 checksum of the blob after fetching it.
------------------------------------------------------------------------
r394788 | rhillegas | 2006-04-17 15:18:21 -0700 (Mon, 17 Apr 2006) | 1 line

DERBY-941: Commit Narayanan's statementeventlisteners_embedded_v2.diff patch, implementing embedded support for JDBC4 statement event listening.
------------------------------------------------------------------------
r394782 | fuzzylogic | 2006-04-17 14:54:22 -0700 (Mon, 17 Apr 2006) | 2 lines

Master file for RunClassPathTester on ibm15 due to diffrence in exception text.

------------------------------------------------------------------------
r394780 | rhillegas | 2006-04-17 14:28:23 -0700 (Mon, 17 Apr 2006) | 1 line

DERBY-1079: Expand public API javadoc for visible JDBC4 classes in the embedded client.
------------------------------------------------------------------------
r394770 | fuzzylogic | 2006-04-17 13:30:21 -0700 (Mon, 17 Apr 2006) | 5 lines

DERBY-658: Improve the test harness' ability to run on platforms with non-ASCII
native encoding.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r394769 | fuzzylogic | 2006-04-17 13:28:26 -0700 (Mon, 17 Apr 2006) | 3 lines

DERBY-1082: Fix quoting of JAVA_HOME in scripts. Make use of JAVA_HOME
consistent across scripts.

------------------------------------------------------------------------
r394334 | fuzzylogic | 2006-04-15 10:01:45 -0700 (Sat, 15 Apr 2006) | 3 lines

DERBY-826: Improve sysinfo behavior in situations where the Derby classes are
loaded indirectly, such as through the manifest Class-Path attribute.

------------------------------------------------------------------------
r394270 | fuzzylogic | 2006-04-15 01:37:30 -0700 (Sat, 15 Apr 2006) | 8 lines

Remove revision specification on svn:externals for tools/testing.
If the revision is set for svn:externals, svnversion returns a range for
the current view, which sets the build number to a range, e.g.:
393115:394186M.

Allowing the current revision of the external jars to be the latest revision
keeps svnversion happy, and the build identifier consistent.

------------------------------------------------------------------------
r394205 | kmarsden | 2006-04-14 14:40:56 -0700 (Fri, 14 Apr 2006) | 10 lines

DERBY-901 Remove use of String(byte[]) constructors in network server leading to non-portable behaviour

Contributed by Sunitha Kambhampati 
patch1 - Remove use of String(byte[]) constructors in network server leading to non-portable behaviour

This fixes
- SQLERRMC_TOKEN_DELIMITER, SQLERRMC_MESSAGE_DELIMITER and the corresponding usage of it in SystemProcedures to not use the default string constructors that are non portable.



------------------------------------------------------------------------
r394169 | rhillegas | 2006-04-14 11:38:52 -0700 (Fri, 14 Apr 2006) | 1 line

Committing bug1079_deprecated.diff, part of DERBY-1079, which removes a deprecated generator option from the SQL grammar.
------------------------------------------------------------------------
r394157 | fuzzylogic | 2006-04-14 11:03:49 -0700 (Fri, 14 Apr 2006) | 5 lines

DERBY-514: get upgrade tests working with the test harness. Submitted
derby-514-patch3-v2.diff

Committed for Deepa Remesh <dremesh@gmail.com>

------------------------------------------------------------------------
r394134 | kmarsden | 2006-04-14 09:30:00 -0700 (Fri, 14 Apr 2006) | 11 lines

DERBY-1025 - [xa] client XAResource.start() does not commit an active local transaction when auto commit is true

Contributed by Deepa Remesh

------------------------------------------------
Summary:
------------------------------------------------
* Modifies NetXAResource.start to check if the connection is in autocommit mode and flow an auto commit.
* Uncomments the tests for this issue in jdbcapi/XATest.java and jdbcapi/checkDataSource.java


------------------------------------------------------------------------
r394112 | rhillegas | 2006-04-14 07:52:47 -0700 (Fri, 14 Apr 2006) | 1 line

More javadoc airbrushes: bug862_misc3.diff of DERBY-862.
------------------------------------------------------------------------
r394110 | rhillegas | 2006-04-14 07:28:16 -0700 (Fri, 14 Apr 2006) | 1 line

Commit bug1079_rev1.diff for DERBY-1079: Use jdk16 javadoc tool if ant.properties points at a jdk16 installation.
------------------------------------------------------------------------
r394109 | djd | 2006-04-14 07:23:03 -0700 (Fri, 14 Apr 2006) | 4 lines

DERBY-438 (partial) Ensure internal conversions of JDBC objects to BLOBs provide the conversion
using RawToBinaryFormatStream from the raw binary stream to the on-disk format stream as required
by the data type api. Make RawToBinaryFormatStream encode the length of the value in the first
bytes as defined in the format described in SQLBinary. Ensure the code handles this encoded lenght correctly.
------------------------------------------------------------------------
r394106 | rhillegas | 2006-04-14 07:07:56 -0700 (Fri, 14 Apr 2006) | 1 line

Commit Anurag's patch derby-1192.diff for DERBY-1192: more fine-tuning of the graph of connection classes.
------------------------------------------------------------------------
r393973 | djd | 2006-04-13 16:35:50 -0700 (Thu, 13 Apr 2006) | 3 lines

DERBY-438 (partial) Move ReaderToUTF8Stream.java from the JDBC implementation to the
types package so that it can be used directly by SQLCLob. This class converts from
a Reader (stream) format to the on-disk format for character types.
------------------------------------------------------------------------
r393967 | davidvc | 2006-04-13 15:59:22 -0700 (Thu, 13 Apr 2006) | 11 lines


DERBY-842 : Internationalize messages in PreparedStatement.java to
Section.java in client/am.  

This passes derbyall on JDK14.  I also verified that the tests whose
master files affected in the JDK14 run were also run on JDK13 and JDK16
and fixed output files for those platforms as well, as needed.

I also removed a few spurious SQL States based on the test I ran to find
SQL States with no messages.  More of those to come in a separate patch.

------------------------------------------------------------------------
r393907 | mikem | 2006-04-13 12:54:13 -0700 (Thu, 13 Apr 2006) | 5 lines

DERBY-1202

Adding message for DATA_SQLDATA_READ_INSTANTIATION_EXCEPTION.


------------------------------------------------------------------------
r393896 | mikem | 2006-04-13 12:19:29 -0700 (Thu, 13 Apr 2006) | 9 lines

DERBY-990
DERBY-1210

Removed piece of this test that is machine/jvm/thread timing dependent on 
the background space reclamation work.  
Filed a new issue DERBY-1213, to rewrite this testing in a more reproducible
manner.


------------------------------------------------------------------------
r393880 | djd | 2006-04-13 11:21:48 -0700 (Thu, 13 Apr 2006) | 5 lines

DERBY-438 (partial) Consistwnt handling of binary streams for updateXXX, namely check
the length correctly if it is greater than the 2Gb supported by Derby. Add some comments
to SQLBinary to clarify the format. Save the length when reading a binary stream from the
store into an application, will be used in a subsequent checkin. Ensure eof handling
when reading the binary value length in the on-disk format is handled correctly.
------------------------------------------------------------------------
r393869 | djd | 2006-04-13 10:58:05 -0700 (Thu, 13 Apr 2006) | 1 line

DERBY-438 (partial) Add to triggerGeneral to display the value of BLOBs inserted by a trigger.
------------------------------------------------------------------------
r393859 | rhillegas | 2006-04-13 10:11:33 -0700 (Thu, 13 Apr 2006) | 1 line

More javadoc airbrushes: bug862_misc2.diff of DERBY-862.
------------------------------------------------------------------------
r393834 | rhillegas | 2006-04-13 08:41:07 -0700 (Thu, 13 Apr 2006) | 1 line

First patch to DERBY-1079: upgrade JavaCC to version 4.0.
------------------------------------------------------------------------
r393791 | rhillegas | 2006-04-13 05:49:57 -0700 (Thu, 13 Apr 2006) | 1 line

Commit Anurag's derby-1137_4.diff patch to DERBY-1137: implement new JDBC4 CommonDataSource methods.
------------------------------------------------------------------------
r393608 | bandaram | 2006-04-12 13:51:09 -0700 (Wed, 12 Apr 2006) | 4 lines

DERBY-1073: Address subquery timeout mechanism issue when parent query has not timed out, but the subquery has. Find a complete and valid plan for the subquery and return this cost.

Submitted by Army Brown (qozinx@gmail.com)

------------------------------------------------------------------------
r393606 | kmarsden | 2006-04-12 13:46:43 -0700 (Wed, 12 Apr 2006) | 3 lines

DERBY-900 -  Remove use of String(byte[]) and String(byte[], int, int) constructors in network client leading to non-portable behaviour


------------------------------------------------------------------------
r393593 | bandaram | 2006-04-12 13:24:27 -0700 (Wed, 12 Apr 2006) | 4 lines

DERBY-805: Apply phase 4 changes to implement join-predicate pushdown. See attached write up in JIRA for details. Changes have been extensively documented there.

Submitted by Army Brown (qozinx@gmail.com)

------------------------------------------------------------------------
r393579 | djd | 2006-04-12 12:02:51 -0700 (Wed, 12 Apr 2006) | 3 lines

DERBY-438 (partial) Move RawToBinaryStreamFormat.java from org.apache.derby.impl.jdbc to
org.apache.derby.iapi.types to allow its use in SQLBlob and SQLBinary (in a future commit).
This will allow the setting of the internal binary types from JDBC objects in a consistent manner.
------------------------------------------------------------------------
r393570 | djd | 2006-04-12 11:32:59 -0700 (Wed, 12 Apr 2006) | 4 lines

DERBY-438 (partial) Clarify by adding comments or re-naming variables the expected format
of stream values passed to internal data types. The internal data types always work in streams
that represent the on-disk format of the data type and not the application visible stream.
Some code in SQLBinary and SQLBLob is incorrect and will be fixed in a subsequent commit.
------------------------------------------------------------------------
r393498 | rhillegas | 2006-04-12 09:33:29 -0700 (Wed, 12 Apr 2006) | 1 line

Miscellaneous javadoc errors. Patch attached to DERBY-862.
------------------------------------------------------------------------
r393460 | rhillegas | 2006-04-12 06:47:03 -0700 (Wed, 12 Apr 2006) | 1 line

Commit Anurag's patch derby-1163_3.diff from DERBY-1163: adjustments to graph of connection classes.
------------------------------------------------------------------------
r393337 | djd | 2006-04-11 17:11:49 -0700 (Tue, 11 Apr 2006) | 3 lines

DERBY-1204 (test only) Add additional test cases that shows what work and what doesn't
with trigger actions and INSERT clauses with multiple rows. Test case that shows the 1204
bug is commented out.
------------------------------------------------------------------------
r393318 | djd | 2006-04-11 14:55:13 -0700 (Tue, 11 Apr 2006) | 2 lines

DERBY-438 (partial) Support BLOBs as column in trigger actions. Initial testing with small BLOB values,
will add other test cases for larger BLOB values, and then subsequently CLOBs. 
------------------------------------------------------------------------
r393304 | kahatlen | 2006-04-11 13:16:25 -0700 (Tue, 11 Apr 2006) | 8 lines

DERBY-924: new JDBC4 metadata API getFunctions() needs to be implemented

Implementation of DatabaseMetaData.getFunctions() in the client
driver. Added tests for getFunctions() in the metadata test and the
upgrade test.

Patch contributed by Dyre Tjeldvoll <Dyre.Tjeldvoll@Sun.COM>.

------------------------------------------------------------------------
r393239 | rhillegas | 2006-04-11 07:49:30 -0700 (Tue, 11 Apr 2006) | 1 line

Commit patch for DERBY-1178: fix DRDA serialization of SQLExceptions for JDBC4 exception subclasses. Eliminate many jdk16-specific test canons.
------------------------------------------------------------------------
r393221 | rhillegas | 2006-04-11 06:58:02 -0700 (Tue, 11 Apr 2006) | 1 line

Commit Narayanan's patch for DERBY-940: embedded support for the JDBC4 wrapper api. Requires that you run with mustang build 78 or higher.
------------------------------------------------------------------------
r393164 | kahatlen | 2006-04-11 02:10:34 -0700 (Tue, 11 Apr 2006) | 8 lines

Partial patch for DERBY-924, DERBY-925 and DERBY-970.

New method added: DatabaseMetaData.checkServerJdbcVersionX() - checks
whether the server supports a given JDBC version. Throws an exception
if it doesn't.

Contributed by Dyre Tjeldvoll <Dyre.Tjeldvoll@Sun.COM>.

------------------------------------------------------------------------
r393123 | fuzzylogic | 2006-04-10 17:10:18 -0700 (Mon, 10 Apr 2006) | 3 lines

Fix dependencies of demo build targets so that insertMaps gets built properly
on an 'ant clean ; ant all'

------------------------------------------------------------------------
r393115 | fuzzylogic | 2006-04-10 16:23:58 -0700 (Mon, 10 Apr 2006) | 2 lines

Set svn:eol-style on upgrade java files

------------------------------------------------------------------------
r393111 | fuzzylogic | 2006-04-10 16:01:41 -0700 (Mon, 10 Apr 2006) | 4 lines

DERBY-514 (partial): Sed out version numbers in upgrade test output.

Committed for Deepa Remesh <dremesh@gmail.com>

------------------------------------------------------------------------
r393003 | djd | 2006-04-10 10:57:35 -0700 (Mon, 10 Apr 2006) | 3 lines

DERBY-446 Remove propertyKey_ constants from ClientbaseDataSOurce that were in place for
the old scheme to get the list of attributes.

------------------------------------------------------------------------
r392983 | kmarsden | 2006-04-10 09:39:13 -0700 (Mon, 10 Apr 2006) | 4 lines

DERBY-1196 -Network server closes prepared statements prematurely if exception occurs during OPNQRY and can cause "'Statement' already closed" exception on reexecution 
Master update for checkDataSource30


------------------------------------------------------------------------
r392781 | kmarsden | 2006-04-09 10:05:51 -0700 (Sun, 09 Apr 2006) | 9 lines

DERBY-1196 Network server closes prepared statements prematurely if exception occurs during OPNQRY 

- Takes out close of prepared statement on exception in OPNQRY in DRDAConnThread processCommands
- Updates the JCC master for derbnet/setTransactionIsolation.  
  This test was getting Statement already closed errors for valid statements with JCC that are no longer in the master.
- Enables test for DERBY-1047 in checkDataSource ( Note this case actually passes withtout the fix because of the fix for DERBY-1158)



------------------------------------------------------------------------
r392611 | kmarsden | 2006-04-08 14:15:34 -0700 (Sat, 08 Apr 2006) | 5 lines

Disable checkdatasource tests temporarily for DerbyNetClient to 
resolve issues with jdk 1.5 and jdk 1.6

Disable checkdatasource tests for JCC since it doesn't have XA

------------------------------------------------------------------------
r392439 | mikem | 2006-04-07 15:30:55 -0700 (Fri, 07 Apr 2006) | 9 lines

DERBY-1187

Defragment pass was not being committed properly, so when rows at
front of table were being deleted and freeing pages the defragment
pass did not move the rows to the free pages.  Longer term the 
defragment pass should commit more often, see DERBY-1188.
Added extra test to OnlineCompressTest.java for this case.


------------------------------------------------------------------------
r392404 | bpendleton | 2006-04-07 14:20:00 -0700 (Fri, 07 Apr 2006) | 9 lines

DERBY-1190: Network Server reports wrong product name when logging connections

Change contributed by John H. Embretsen (John.Embretsen@Sun.com)

When derby.drda.logConnections was set to true, the connection log message
written to derby.log said "Cloudscape Network Server". This change modifies
the message so that it says "Apache Derby Network Server".


------------------------------------------------------------------------
r392313 | bpendleton | 2006-04-07 08:23:33 -0700 (Fri, 07 Apr 2006) | 7 lines

DERBY-1184: registerOutParameter(int,int,String) should throw exception.

The test was out of sync with the SQL States in the code. In revision
392060, the SQL state "0AX01" was replaced by "0A000". This change
updates the test to use the new SQL State, and callable.java now passes.


------------------------------------------------------------------------
r392304 | bpendleton | 2006-04-07 07:32:48 -0700 (Fri, 07 Apr 2006) | 9 lines

DERBY-1184: registerOutParameter(int,int,String) should throw exception

Patch contributed by Kristian Waagan (Kristian.Waagan@Sun.com)

The method 'CallableStatement.registerOutParameter(int,int,String)'
does nothing in the client driver. As stated in DERBY-447, the method throws
a not-implemented exception in the embedded driver. The method should be
changed to do this on the client side as well.

------------------------------------------------------------------------
r392236 | bernt | 2006-04-07 03:15:17 -0700 (Fri, 07 Apr 2006) | 1 line

 DERBY-1177 updateObject with null as argument causes network driver to fail with NullPointerException
------------------------------------------------------------------------
r392194 | mikem | 2006-04-06 23:11:13 -0700 (Thu, 06 Apr 2006) | 12 lines

DERBY-1189

inplace compress could self deadlock on a latch/latch conflict.  Changed
the insert page find code for defragment to never return a page which is
higher than the source page of the row.  Previously the upper level code
made this decision, but that was too late.  As part of the change also 
optimized the "unfilled" search to be biased towards those pages near
the front of the container.  Checkin includes simple sql script which 
reproduced the deadlock prior to the fix.



------------------------------------------------------------------------
r392084 | djd | 2006-04-06 14:30:26 -0700 (Thu, 06 Apr 2006) | 2 lines

DERBY-1158 DERBY-1159 Remove special casing of network client for holdability tests
using executeUpdate methods.
------------------------------------------------------------------------
r392073 | djd | 2006-04-06 14:01:15 -0700 (Thu, 06 Apr 2006) | 2 lines

DERBY-1158 (partial) Embedded Statements that are holdable automatically downgrade to
close cursors on commit during a global transaction.
------------------------------------------------------------------------
r392060 | davidvc | 2006-04-06 13:14:33 -0700 (Thu, 06 Apr 2006) | 12 lines

DERBY-1185 - Move all client messages to messages.properties.  


I also got rid of the "XN" SQL State class and migrated those 
over to XJ.  

Similarly "0AX" warnings were migrated to "0AJ".  This affected the 
updatableResultSet test, so I updated those output files for JDK 1.3,
1.4 and 1.6.

Passes derbyall.

------------------------------------------------------------------------
r391902 | kmarsden | 2006-04-05 22:17:14 -0700 (Wed, 05 Apr 2006) | 10 lines

DERBY-435 jdbcapi/checkDataSource.java and jdbapi/checkDataSource30.java to tests should be changed or extended to test client DataSources

- Brings checkDataSource and checkDataSourc30 into derbynetclientmats
- Reenables tests for DERBY-1044 now that it is fixed.

Tests are excluded for some bugs  uncovered by this test that have yet to 
be resolved:
DERBY-1035, DERBY-1047, DERBY-1025, DERBY-1148, DERBY-1183


------------------------------------------------------------------------
r391846 | djd | 2006-04-05 16:37:58 -0700 (Wed, 05 Apr 2006) | 2 lines

DERBY-1101 Modify EmbedResultSet.getHoldability() so that it uses getActivation() instead of getStatement().
Contributed by  Knut Anders Hatlen knut.hatlen@sun.com
------------------------------------------------------------------------
r391844 | kmarsden | 2006-04-05 16:20:47 -0700 (Wed, 05 Apr 2006) | 19 lines

DERBY-514 Integrate upgrade tests into test suite
Contributed by Deepa Remesh.

Attaching a patch 'derby-514-patch2-runtest-v1.diff' which enables the upgrade test to run with the test harness.

Summary:

* findCodeBase method in harness/jvm.java is changed to public. This method is used by upgrade test to get the location of new jar files.

* Adds the other derby jars to the jar file list in UpgradeTester. This will allow the test to run in client framework. I tried running the test in client framework and it looks like this will need new master file and some more work.

* In UpgradeTester, File.toURL method is used when creating class loader. This seems to be a better way to construct the URL.

* Master file update

This patch combined with the previous patch (derby-514-buildfiles-v1.diff) will allow the upgrade test to be run using RunTest. The location of old jars has to be passed in as a property in jvmflags. Command to run:
java -Djvmflags=-DderbyTesting.oldJarLocation=<location of 10.1 jars> org.apache.derbyTesting.functionTests.harness.RunTest upgradeTests/Upgrade_10_1_10_2.java 
 

------------------------------------------------------------------------
r391842 | djd | 2006-04-05 16:08:33 -0700 (Wed, 05 Apr 2006) | 2 lines

DERBY-1158 (partial) Re-factor some code to enable BrokeredStatement.getResultSetHoldability()
to return CLOSE_CURSORS_ON_COMMIT when in a global transaction.
------------------------------------------------------------------------
r391806 | kmarsden | 2006-04-05 13:56:27 -0700 (Wed, 05 Apr 2006) | 9 lines

DERBY-514 Integrate upgrade tests into test suite.
Contributed by Deepa Remesh

Attaching a patch 'derby-514-buildfiles-v1.diff' which adds the build files for upgrade tests. This patch also adds the properties file for upgrade test which specifies not to run with security manager as more work is needed in this area (DERBY-1135).

This patch affects upgrade tests only. This is an incremental patch and does not resolve the issue fully. Please take a look at this patch. Thanks.

 

------------------------------------------------------------------------
r391737 | djd | 2006-04-05 12:21:14 -0700 (Wed, 05 Apr 2006) | 2 lines

DERBY-1015 (partial) Fix class name of EngineStatement in copyright statement.

------------------------------------------------------------------------
r391691 | djd | 2006-04-05 10:55:53 -0700 (Wed, 05 Apr 2006) | 5 lines

DERBY-1015 (partial) Add an interface for Statement objects from the engine, EngineStatement. Removes
some use of reflection in brokered objects and the network server. Is also a step towards solving
DERBY-1158, downgrading holdabilty in global transactions.


------------------------------------------------------------------------
r391667 | davidvc | 2006-04-05 09:41:10 -0700 (Wed, 05 Apr 2006) | 7 lines

DERBY-839: Final commit for this JIRA.  Fixed up some bugs in the
messages, removed some unused messages and SQLStates, and internationalized
Clob.java and CloseFilterInputStream.java

derbyall passes except for wisconsin


------------------------------------------------------------------------
r391559 | bernt | 2006-04-05 01:05:24 -0700 (Wed, 05 Apr 2006) | 1 line

DERBY-787 cursor closed as a sideeffect of closing another cursor with the same name on another connection. Submitted by Andreas Korneliussen
------------------------------------------------------------------------
r391461 | kmarsden | 2006-04-04 18:04:12 -0700 (Tue, 04 Apr 2006) | 3 lines

DERBY-1144 missed file to reduce lock timeout for checkDataSourc30 test


------------------------------------------------------------------------
r391396 | fuzzylogic | 2006-04-04 13:07:51 -0700 (Tue, 04 Apr 2006) | 4 lines

DERBY-1109: Fix predicatePushdown and subquery on wsdd5.6

Committed for Army Brown <qozinx@sbcglobal.net>

------------------------------------------------------------------------
r391387 | bpendleton | 2006-04-04 12:00:50 -0700 (Tue, 04 Apr 2006) | 17 lines

DERBY-1152: Failures in sysinfo tests with different classpath settings

Depending on the way the classpath was set, the sysinfo_withproperties and
sysinfo tests were unreliable. The problem is that the underlying sysinfo
classes are present in your classpath in several possible ways: you might
be pointing directly at the classes directory, or you might be pointing to
one of: derby.jar, derbytools.jar, or derbynet.jar, all three of which have
the sysinfo classes in them. This means that there are four possible
sections of the derby_tests.policy file that might be in effect for the
sysinfo classes during a test run, and those four sections were inconsistent.

This change modifies the derby_tests.policy file so that, at least for the
classpath and locale file permissions that are used by sysinfo, the policy
file expresses a consistent set of permissions for each of the four code
sources. The change also updates the master files to reflect the chosen
permissions, which are to allow access to the classpath and the locale files.

------------------------------------------------------------------------
r391384 | rhillegas | 2006-04-04 11:47:34 -0700 (Tue, 04 Apr 2006) | 1 line

Checkin patch to DERBY-955 which uses Sed to mask out jdk1.6-specific test diffs introduced by the JDBC4 subclasses of SQLException. This eliminates a number of jdk1.6-specific canons.
------------------------------------------------------------------------
r391383 | djd | 2006-04-04 11:41:36 -0700 (Tue, 04 Apr 2006) | 5 lines

DERBY-1158 (partial) Implement downgrading a request to create any holdable statement in a global
transaction to return a non-holdable statement. Such a downgrade adds a SQLWarning to the Connection
object. This follows section 16.1.3.1 from JDBC 4.0 proposed final draft.


------------------------------------------------------------------------
r391369 | kmarsden | 2006-04-04 10:17:34 -0700 (Tue, 04 Apr 2006) | 16 lines

DERBY-1144 With client PooledConnection.getConnection() does not reset holdability and isolation state properly


This patch addresses this issue by changing PooledConnection.getConnection() to reset the connection to the datasource defaults.

Code changes:
Just a small code change in ClientPooledConnection to pass true to the reset method to reset the defaults.

This change has the side effect of making DERBY- 1173 harder to reproduce. But I don't think it fixes that bug. With the change, the checkDataSource test hangs only very intermittently. The fixer of that bug will have to go back to a previous version to get a easily reproducable case.


Tests -
Changed the checkDataSource30.java test to test holdability,isolation, and autocommit reset.



------------------------------------------------------------------------
r391310 | kahatlen | 2006-04-04 06:45:25 -0700 (Tue, 04 Apr 2006) | 7 lines

DERBY-1146: Verify that JDBC4 signatures satisfied

Uploading patch with new test jdbc4/VerifySignatures.junit. The test
inspects the objects returned by JDBC methods and checks whether they
have methods with correct signatures. The test is not enabled in any
suite since it currently fails. It requires JVM 1.6 to run.

------------------------------------------------------------------------
r391255 | kahatlen | 2006-04-04 02:12:41 -0700 (Tue, 04 Apr 2006) | 17 lines

DERBY-1076: Resolve the output differences in upgrade test

Attaching a patch which updates the master file for upgrade test. The
master file is updated to reflect changes in the metadata test. Also
there were extra lines in the master file in the previous checkin. I
have also replaced 10.1.2.2 with 10.1.2.1 as Knut had suggested. This
version info will hopefully go away with my next patch to allow
running the test as part of harness. Still there are few diffs because
of the diffs in the generated SQL id which look like this line:

,APP,REFACTION1,A,,APP,REFACTNONE,A,1,3,3,SQL060329093642910,SQL060329093642450,7 

This will also go away once the test can be run with the harness,
which filters out the generated ids.

Patch contributed by Deepa Remesh <dremesh@gmail.com>.

------------------------------------------------------------------------
r391153 | bernt | 2006-04-03 14:26:55 -0700 (Mon, 03 Apr 2006) | 1 line

DERBY-1172 incorrect error message in updateRow() after a commit on a held scroll insensitive resultset. Submitted by Andreas Korneliussen
------------------------------------------------------------------------
r391139 | davidvc | 2006-04-03 13:19:57 -0700 (Mon, 03 Apr 2006) | 4 lines

DERBY-839 : (Partial) - internationalized ColumnMetaData.java and also
removed some methods that were not in use.  Passes derbynetclientmats.


------------------------------------------------------------------------
r391090 | rhillegas | 2006-04-03 10:39:19 -0700 (Mon, 03 Apr 2006) | 1 line

Commit Anurag's patch to DERBY-1163, adding JDBC4-specific versions of embedded pooled connection and embedded xa connection.
------------------------------------------------------------------------
r391086 | bpendleton | 2006-04-03 10:13:55 -0700 (Mon, 03 Apr 2006) | 17 lines

DERBY-349: Re-enable parameterMapping batch tests for DerbyNetClient

Due to bug DERBY-349, the parameterMapping tests of various data types
in the executeBatch() configuration had been disabled, because those
tests were hanging. The tests are no longer hanging, so this submission
re-enables the tests.

This change also modifies the parameterMapping test program so that it
knows how to unwind the BatchUpdateException when looking for an
underlying Invalid Conversion exception. This means that we can have
simpler and easier-to-read master output files, which makes the test
easier to maintain.

This change also deletes the separate jdk14 master file, since it is
identical to the primary master file.


------------------------------------------------------------------------
r391035 | bernt | 2006-04-03 05:48:34 -0700 (Mon, 03 Apr 2006) | 2 lines

svn:eol-style set to native

------------------------------------------------------------------------
r390838 | bandaram | 2006-04-02 08:47:56 -0700 (Sun, 02 Apr 2006) | 4 lines

DERBY-1085: Fix NullPointerException in SQLBinary.java that causes exception for all FOR BIT DATA types while getting length for NULL values.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r390536 | davidvc | 2006-03-31 15:06:34 -0800 (Fri, 31 Mar 2006) | 11 lines

DERBY-839 (Partial) : Internationalized a few more classes.  Also added
a helpful debug method to Types.java that allows you to get a String
name for a given type id.  

derbyall passes for jdk14. Also made sure output files that had
diffs were tested for jdk13 and jdk16, and fixed output files there
as well.  Also scanned the matching embedded output files to verify
that the SQL States were the same where it made sense, and fixed a couple
of bugs there.  


------------------------------------------------------------------------
r390486 | davidvc | 2006-03-31 11:54:27 -0800 (Fri, 31 Mar 2006) | 2 lines

Modified eol-style to be native for these output files

------------------------------------------------------------------------
r390481 | kmarsden | 2006-03-31 11:22:42 -0800 (Fri, 31 Mar 2006) | 4 lines

disable test case for client for DERBY-1047

accidentally enabled with  r387611

------------------------------------------------------------------------
r390292 | rhillegas | 2006-03-30 16:48:31 -0800 (Thu, 30 Mar 2006) | 1 line

Commit Kristian's first patch for DERBY-1147, adding vacuous implementations of missing CallableStatement methods.
------------------------------------------------------------------------
r390176 | davidvc | 2006-03-30 08:56:25 -0800 (Thu, 30 Mar 2006) | 9 lines

DERBY-1149 : Fix failures in StatementTest.java.  I also added
a new constants file for testing that contains all the standard
SQL State strings.  Derby-specific SQL States can be added as
needed.

Passes derbyall, except for the sysinfo tests, which is a known regression
when running against the classes directory.


------------------------------------------------------------------------
r390000 | fuzzylogic | 2006-03-29 21:47:37 -0800 (Wed, 29 Mar 2006) | 5 lines

DERBY-622 (partial): Add privileged blocks for calls to getResourceAsStream()
in impl.tools.sysinfo.Main.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r389875 | kahatlen | 2006-03-29 11:51:15 -0800 (Wed, 29 Mar 2006) | 5 lines

DERBY-977: jdbcapi/xaSimplePositive.sql fails

Added substitution rule which filters out transaction ids which can
be printed in different order.

------------------------------------------------------------------------
r389836 | bpendleton | 2006-03-29 09:06:31 -0800 (Wed, 29 Mar 2006) | 14 lines

DERBY-1143: derbynet/prepStmt.java fails with JCC 2.6

Patch contributed by Deepa Remesh

This patch reduces the number of batch elements in the test
derbynet/prepStmt.java so that it can run successfully with jcc2.6.

I checked with the JCC folks who told me that JCC2.6 driver supports
less than 32K batch elements. When I ran the test, I found that
maximum number supported is 32765. As mentioned by Bryan, any number
greater than 9000 will provoke the bug. So this number will still
allow us to test DERBY-428.


------------------------------------------------------------------------
r389825 | djd | 2006-03-29 08:41:57 -0800 (Wed, 29 Mar 2006) | 6 lines

DERBY-1158 (partial) Re-factor check holdability methods in the brokered stament
and connection control to support downgrading the holdability when needed. This
commit still implements at the user level throwing an exception for requesting
holdable ResultSets in a global transaction. A subsequent commit will change to
creting a warning on the Connection when creating a Statement with holdable ResultSets.

------------------------------------------------------------------------
r389822 | djd | 2006-03-29 08:36:19 -0800 (Wed, 29 Mar 2006) | 2 lines

DERBY-1158 (partial) Some method protection cleanup on EmbedStatement and EmbedPreparedStatement

------------------------------------------------------------------------
r389783 | kahatlen | 2006-03-29 04:38:04 -0800 (Wed, 29 Mar 2006) | 5 lines

DERBY-1162: Add mechanism to assert/compare SQLStates

Adding method 'assertSQLState' to BaseJDBCTestCase. Patch contributed
by Kristian Waagan.

------------------------------------------------------------------------
r389780 | kahatlen | 2006-03-29 04:26:25 -0800 (Wed, 29 Mar 2006) | 9 lines

DERBY-1157: Helper methods in BaseJDBCTestCase for creating data
sources

Adding getDataSource(), getConnectionPoolDataSource() and
getXADataSource() to BaseJDBCTestCase. The new methods call various
methods in TestUtil for creating the data sources. A minor adjustment
had to be made to TestUtil.getDataSource() in order to make it return
JDBC 4.0 DataSources.

------------------------------------------------------------------------
r389648 | djd | 2006-03-28 17:14:56 -0800 (Tue, 28 Mar 2006) | 4 lines

DERBY-1159 Add some test cases that show the bug. Execution of a statement that
does not return a ResultSet with various JDBC Statement objects using executeUpdate
in a global transaction.

------------------------------------------------------------------------
r389630 | djd | 2006-03-28 15:44:03 -0800 (Tue, 28 Mar 2006) | 3 lines

DERBY-1158 (partial) Some cleanup of field & method permissions in the embedded JDBC driver and rename getWarnings to addWarning to
correctly reflect its use.

------------------------------------------------------------------------
r389575 | bpendleton | 2006-03-28 10:58:09 -0800 (Tue, 28 Mar 2006) | 11 lines

DERBY-1136: getFloat throws LossOfPrecisionConversionException on MAX_VALUE

This patch contains a regression test for DERBY-1136. The regression test
verifies that we can successfully retrieve a value of Float.MAX_VALUE
from the database using ResultSet.getFloat.

The test runs for both the embedded driver and the DerbyNetClient driver.
The test is dummied out for the JCC driver, since that driver still suffers
from this bug (but we want to share the same set of master files).


------------------------------------------------------------------------
r389571 | rhillegas | 2006-03-28 10:29:18 -0800 (Tue, 28 Mar 2006) | 1 line

Commit Kristian's patch for DERBY-944: raising appropriate exceptions for RowID calls.
------------------------------------------------------------------------
r389570 | djd | 2006-03-28 10:25:47 -0800 (Tue, 28 Mar 2006) | 10 lines

DERBY-1155 Introduced new class EmbedXARessource. This class implements XAResources. I have moved all XAResource methods to this class.

Modified classes
EmbedXAConnection
Removed all the XAResource methods.
XATransactionState
This class now uses EmbedXAResource (earlier it was using EmbedXAConnection because it also had implementation of XAResource)

Patch contributed by Anurag Shekhar - anurag.shekhar@sun.com

------------------------------------------------------------------------
r389202 | kahatlen | 2006-03-27 09:16:22 -0800 (Mon, 27 Mar 2006) | 6 lines

DERBY-690: Add scrollable, updatable, insensitive result sets

Support for scrollable, updatable, insensitive result sets in the
embedded driver. Patch contributed by Fernanda Pizzorno, Andreas
Korneliussen and Dag H. Wanvik.

------------------------------------------------------------------------
r388778 | rhillegas | 2006-03-25 08:07:40 -0800 (Sat, 25 Mar 2006) | 1 line

Commit my patch, attached to DERBY-1140, which eliminates magic strings in the JDBC4 SQLException factories.
------------------------------------------------------------------------
r388776 | bandaram | 2006-03-25 08:04:01 -0800 (Sat, 25 Mar 2006) | 4 lines

Update master file to reflect modified code in the previous checkin.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r388775 | bandaram | 2006-03-25 08:02:48 -0800 (Sat, 25 Mar 2006) | 7 lines

DERBY-464: This batch of Grant & Revoke changes include:

1) Prevent GRANT statements on Synonyms, VTIs and Views (for now...pending more changes).
2) Change interface to StatementPermission objects... Dan suggested changing interface to include LCC.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r388771 | rhillegas | 2006-03-25 07:17:30 -0800 (Sat, 25 Mar 2006) | 1 line

Commit Olav's patch for DERBY-1090, implementing the JDBC4 Connection.isValid() method.
------------------------------------------------------------------------
r388708 | davidvc | 2006-03-24 21:41:21 -0800 (Fri, 24 Mar 2006) | 3 lines

Missed this output file.  Not sure why my tests are passing even though
the output files are incorrect.

------------------------------------------------------------------------
r388687 | djd | 2006-03-24 17:38:37 -0800 (Fri, 24 Mar 2006) | 4 lines

DERBY-446 (partial) Copy Attribute.java to the java/shared reference area and add in constants
for the client JDBC attributes. Change the client code to use these constants as preparation to
removing these constants from the user visible classes.

------------------------------------------------------------------------
r388663 | bandaram | 2006-03-24 14:22:57 -0800 (Fri, 24 Mar 2006) | 4 lines

DERBY-1124: Use 10.1 version of getColumnPrivileges and getTablePrivileges metadata queries during soft upgrade of pre-10.2 databases to software version 10.2 or beyond.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)_

------------------------------------------------------------------------
r388629 | bandaram | 2006-03-24 12:40:15 -0800 (Fri, 24 Mar 2006) | 6 lines

Enable Metadata tests to test columnPrivileges and tablePrivileges as part of grantRevoke test. Was previously disabled, pending code changes.

Also removed testing of defaultConnectionMode property, since this is not the way to set sqlAuthorization.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r388626 | djd | 2006-03-24 12:22:56 -0800 (Fri, 24 Mar 2006) | 3 lines

DERBY-1095 (partial) Once a ContextManager is empty no longer maintain a reference
to it in the thread local variable. Avoids a thread hanging onto memory for ever.

------------------------------------------------------------------------
r388558 | rhillegas | 2006-03-24 07:16:17 -0800 (Fri, 24 Mar 2006) | 1 line

Committing rev 2 of Anurag's patch for DERBY-1140: JDBC4 SQLException triage for the network client.
------------------------------------------------------------------------
r388539 | davidvc | 2006-03-24 06:36:48 -0800 (Fri, 24 Mar 2006) | 3 lines

Fix output files changed by new internationalized strings in network
client.  

------------------------------------------------------------------------
r388440 | kahatlen | 2006-03-23 23:48:28 -0800 (Thu, 23 Mar 2006) | 11 lines

DERBY-1112: TemporaryRowHolderResultSet is breaking the contract of
getActivation

The patch modifies the constructors of TemporaryRowHolderImpl so that
they take an Activation instead of a TransactionController. The
transaction controller can still be obtained from the Activation
object. TemporaryRowHolderResultSet now implements getActivation() by
returning the activation of the TemporaryRowHolderImpl that created
it. TemporaryRowHolderImpl and TemporaryRowHolderResultSet are made
package protected.

------------------------------------------------------------------------
r388309 | davidvc | 2006-03-23 16:55:44 -0800 (Thu, 23 Mar 2006) | 12 lines

DERBY-839 (Partial).  Internationalize Connection.java.  Also upgraded
the "i18n lint" test to be a little more intelligent, and to not exit
on the first failure.

Passes derbynetclientmats.  All changes are client-specific so derbyall
was not run.

Note there are some extra messages not currently being used.  These are
from the initial work Anurag did on this.  I'm just splitting up his
very big patch into smaller, more manageable pieces.


------------------------------------------------------------------------
r388234 | davidvc | 2006-03-23 11:06:05 -0800 (Thu, 23 Mar 2006) | 12 lines

DERBY-953: Add Statement.isClosed() JDBC4 method
DERBY-1097: Add tests for Statement.isClosed() JDBC4 method

Contributed by Kristian Waagan.  

I modified his patch for DERBY-953 to match
Dan's suggested approach.  I also added StatementTest.junit to the jdbc40
test suite, which passes.  Since this is a JDBC40-specific feature, and
only new code has been added (no existing code has been modified) I did
not run derbyall


------------------------------------------------------------------------
r388230 | djd | 2006-03-23 10:39:13 -0800 (Thu, 23 Mar 2006) | 2 lines

DERBY-953 (partial) Fix typo in javadoc.

------------------------------------------------------------------------
r388227 | djd | 2006-03-23 10:18:24 -0800 (Thu, 23 Mar 2006) | 2 lines

DERBY-953 (partial) Add/expand javadoc comments for EmbedStatement.checkStatus and checkExecStatus.

------------------------------------------------------------------------
r388161 | bernt | 2006-03-23 04:51:45 -0800 (Thu, 23 Mar 2006) | 5 lines

DERBY-1136 JDBC driver on rs.getFloat() gives LossOfPrecisionConversionException for float fields containing Float.MAX_VALUE

Submitted by H?\195?\165vard Mork


------------------------------------------------------------------------
r388144 | kahatlen | 2006-03-23 03:09:21 -0800 (Thu, 23 Mar 2006) | 6 lines

DERBY-1101 (partial): ResultSet.getHoldability will return incorrect
value when the ResultSet is obtained from a procedure call

Adding a regression test for this issue. The test does not fail, since
the bug won't be exposed until DERBY-1111 is fixed.

------------------------------------------------------------------------
r388100 | bernt | 2006-03-23 00:20:06 -0800 (Thu, 23 Mar 2006) | 5 lines

DERBY-1058 derby fails supporting holdable scrollable resultset: ERROR XSCB8: The btree conglomerate 1,141,037,436,752 is closed.

Submitted by Andreas Konreliussen


------------------------------------------------------------------------
r388093 | kahatlen | 2006-03-22 23:58:53 -0800 (Wed, 22 Mar 2006) | 6 lines

DERBY-1095 (partial): Closing an embedded connection does not seem to
close associated EmbedStatements

This patch makes EmbedResultSet.isClosed() return the correct result
when the connection is closed.

------------------------------------------------------------------------
r388051 | kmarsden | 2006-03-22 21:39:57 -0800 (Wed, 22 Mar 2006) | 27 lines

DERBY-1075 - Combine the script and the test available for upgrade testing into a java test

Intial checkin.  This is a work in progress.
Contributed by Deepa Remesh 

 Attaching a patch 'derby-1075-v1.diff'. This patch is based on the draft patch with some additional changes.

Summary of patch:

1. Creates a class UpgradeTester which does the following:

* Creates two class loaders using the jar locations provided for old and new release
* Switches between these two class loaders to run the different upgrade phases with old or new release.
* This class can be used to write tests for upgrades from different releases.

2. Adds a new test Upgrade_10_1_10_2 which uses UpgradeTester to test upgrade from 10.1 to 10.2. This test has not been added to any suite. Till the jars from previous release are available in svn, the test has to be run manually using the command:
java org.apache.derbyTesting.functionTests.tests.upgradeTests.Upgrade_10_1_10_2 <location of old jars> <location of new jars>
e.g, java org.apache.derbyTesting.functionTests.tests.upgradeTests.Upgrade_10_1_10_2 C:\derby\10.1\lib C:\derby\trunk\lib

Also, there are some issues in running the test using the harness because of use of security manager. These are mentioned in http://www.nabble.com/Upgrade-test-and-security-permissions-p3517019.html. Any suggestions to resolve these are welcome. I am planning to open separate sub-task for making this test run with a security manager.

3. Creates a new package upgradeTests under org.apache.derbyTesting.functionTests.tests. This package is for UpgradeTester class and the individual upgrade tests.

4. Adds a master 'Upgrade_10_1_10_2.out'. I have tried to reduce the diffs by doing version check in the code and removing reference to local machine paths. Still, there are few more diffs. I am planning to look at these once this patch is reviewed/committed.



------------------------------------------------------------------------
r387925 | rhillegas | 2006-03-22 11:57:15 -0800 (Wed, 22 Mar 2006) | 1 line

As part of DERBY-1133, remove vacuous test.
------------------------------------------------------------------------
r387905 | davidvc | 2006-03-22 10:14:30 -0800 (Wed, 22 Mar 2006) | 3 lines

DERBY-1125 : Revert putting JVMInfo into the shared area, as it causes
jar sealing issues

------------------------------------------------------------------------
r387895 | bpendleton | 2006-03-22 09:23:09 -0800 (Wed, 22 Mar 2006) | 22 lines

DERBY-428: PreparedStatement.executeBatch hangs if batch is too large

This patch contains a server-side change, a client-side change, and a test.

The server-side change is to call ensureLength() in DDMWriter.startDDM().
The DDMWriter working buffer is designed to dynamically grow to accomodate
the data being written; this dynamic growth is implemented using a coding
rule which requires that all DDMWriter internal routines must call
ensureLength to communicate the buffer size requirements prior to writing
bytes into the buffer. StartDDM was missing the call to ensureLength.

The client-side change is due to the fact that DRDA imposes a hard limit
of 65535 elements in a single correlated request because the correlation
identifier is a two byte unsigned integer. Prior to this change, the
correlation identifiers would wrap around when we added the 65536th
element into the batch, which breaks the DRDA protocol rule that requires
correlation IDs in a single request be always increasing. This change
causes the client to throw an exception if it is asked to execute a batch
containing more than 65534 elements. The reason for the number 65534,
rather than 65535, is that the value 0xFFFF is reserved for special use.


------------------------------------------------------------------------
r387640 | rhillegas | 2006-03-21 14:10:53 -0800 (Tue, 21 Mar 2006) | 1 line

Checkin patch for DERBY-1133: rototills the jdbc4 tests to conform to customary derbyall practices.
------------------------------------------------------------------------
r387637 | fuzzylogic | 2006-03-21 14:03:38 -0800 (Tue, 21 Mar 2006) | 2 lines

Fix entry for SqlExceptionTest in derbynetclientmats.runall

------------------------------------------------------------------------
r387611 | kmarsden | 2006-03-21 12:20:59 -0800 (Tue, 21 Mar 2006) | 5 lines

DERBY-435 -  jdbcapi/checkDataSource30 should test client DataSources

Update test with comments including Jira issues for excluded  cases.


------------------------------------------------------------------------
r387605 | fuzzylogic | 2006-03-21 11:27:36 -0800 (Tue, 21 Mar 2006) | 5 lines

DERBY-993: Enable running junitTests in J2ME environments.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com> and
Andreas Korneliussen <Andreas.Korneliussen@sun.com>

------------------------------------------------------------------------
r387602 | bpendleton | 2006-03-21 10:55:54 -0800 (Tue, 21 Mar 2006) | 1 line

Add release note for DERBY-668 to CHANGES
------------------------------------------------------------------------
r387599 | bpendleton | 2006-03-21 10:36:49 -0800 (Tue, 21 Mar 2006) | 22 lines

DERBY-668: SysInfo does not print the right info in class loader scenarios

This change modifies the sysinfo tool to print additional information about
the classes and jars that it examines. For each class that sysinfo examines,
it now calls getProtectionDomain().getCodeSource() to retrieve information
about the source of that file, which might be: an entry in the application
classpath, an entry in a class loader location list, a jar fetched due to
being listed in the manifest entry of another jar, a standard extension
in the JRE's extensions directory, a jar installed into the application
server, or any of various other possibilities.

The additional information about the class's origin is displayed in the
sysinfo output.

Note that when sysinfo runs under a Java security manager, it may need
special permissions to access this additional information, including the
permission to read the java.class.path property, and the permission to
call getProtectionDomain on a class. If sysinfo is not granted these
permissions, it will display an error message about the security problem
in place of displaying the class origin information.


------------------------------------------------------------------------
r387448 | fuzzylogic | 2006-03-20 23:13:56 -0800 (Mon, 20 Mar 2006) | 2 lines

Ignore intermediate build files for toursdb

------------------------------------------------------------------------
r387324 | djd | 2006-03-20 14:24:46 -0800 (Mon, 20 Mar 2006) | 4 lines

DERBY-538 (partial) Add a getURL method to the StorageFile interface of the virtual
file system layer. This will allow the standard URLClassLoader to access
jar files stored in a database, regradless of the file system implementation.

------------------------------------------------------------------------
r387264 | djd | 2006-03-20 09:53:09 -0800 (Mon, 20 Mar 2006) | 3 lines

DERBY-1095 Cleanup ContextManagers created during database boot.
Add some comments and synchronization to ContextService.

------------------------------------------------------------------------
r387214 | kahatlen | 2006-03-20 06:20:56 -0800 (Mon, 20 Mar 2006) | 43 lines

DERBY-1014: Make tests less sensitive to pre-fetching

Attached a patch (DERBY-1014-v1.diff) which modifies tests in
preparation for DERBY-822. There are two types of changes:

  1) Invoke ResultSet.next() to expose error even when the driver
     isn't pre-fetching data.

  2) Filter out some of the run-time statistics before comparing with
     the canon.

lang/wisconsin.java:

  * Added patterns to the sed file. Cursor names and some of the
    run-time statistics are filtered out.

  * Canons for DerbyNet and DerbyNetClient were deleted since they are
    no longer needed. Each of these files is 1.5M, so the diff is
    huge.

lang/scrollCursors1.sql:

  * Added patterns to the sed file. Number of rows seen and number of
    reads from hash table will be filtered out.

jdbcapi/parameterMetaDataJdbc30.java:

  * Added a call to ResultSet.next() to provoke an error in a test
    case for DERBY-44 regardless of framework/pre-fetching.

jdbcapi/resultset.java:

  * Don't print column headers until one row is successfully retrieved
    (achieved by calling ResultSet.next() earlier).

jdbcapi/setTransactionIsolation.java:

  * Added a call to ResultSet.next() to provoke a timeout regardless
    of framework/pre-fetching.

  * Added patterns to the sed file. Filtered out number of pages
    visited, number of rows qualified/visited etc.

------------------------------------------------------------------------
r387160 | bandaram | 2006-03-19 23:03:19 -0800 (Sun, 19 Mar 2006) | 6 lines

DERBY-464: Submit initial changes to make dblook report GRANT statements in sqlAuthorization mode.

Need to add or change existing test to use sqlAuthorization database.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r387134 | fuzzylogic | 2006-03-19 20:30:12 -0800 (Sun, 19 Mar 2006) | 2 lines

Fix casing of loadCITIES.sql

------------------------------------------------------------------------
r387101 | kmarsden | 2006-03-19 17:39:20 -0800 (Sun, 19 Mar 2006) | 7 lines

DERBY-962 Upgrade default security mechanism in client to use encrypted userid password if client can support it.

Fix some residual javadoc issues

Contributed by Sunitha Kambhampati


------------------------------------------------------------------------
r386984 | kahatlen | 2006-03-19 08:03:08 -0800 (Sun, 19 Mar 2006) | 5 lines

DERBY-1128: jdbc4/TestDbMetaData.java fails because of changes in
SQLException text

Fixed by updating canon.

------------------------------------------------------------------------
r386934 | fuzzylogic | 2006-03-18 22:35:45 -0800 (Sat, 18 Mar 2006) | 2 lines

Add toursdb.insertMaps to derbyTesting.jar

------------------------------------------------------------------------
r386867 | bandaram | 2006-03-18 08:59:16 -0800 (Sat, 18 Mar 2006) | 12 lines

DERBY-464: Continuation of Grant & Revoke feature checkins. This batch of changes address:

1) Introduce new property derby.database.sqlAuthorization to turn on SQL standard authorization model. Default authorization is still Derby legacy authorization model, with NO support for GRANT/REVOKE.

2) If this property is set to TRUE as system property, all new databases get created with sqlAuthorization to TRUE. If this property is set at a database level, authorization mode would be switched to SQL standard mode at next database boot time.

3) Remove all changes made to defaultConnectionMode property. This property was the previous way to enable GRANT/REVOKE.

4) Disable any changes to sqlAuthorization property once SQL standard authorization is enabled. This is done to prevent switching back to Derby legacy authorization model.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r386861 | rhillegas | 2006-03-18 08:13:00 -0800 (Sat, 18 Mar 2006) | 1 line

Commit Anurag's patch for DERBY-942: wiring JDBC4 Ease-of-development calls up to the default QueryObjectGenerator
------------------------------------------------------------------------
r386800 | kmarsden | 2006-03-17 19:42:09 -0800 (Fri, 17 Mar 2006) | 5 lines

Add cleanup for derbyStress to allow for remote testing

Contributed by Myrna Van Lunteren


------------------------------------------------------------------------
r386773 | davidvc | 2006-03-17 16:35:13 -0800 (Fri, 17 Mar 2006) | 4 lines

DERBY-1059 : Fix issues around calling stored procedure with out params.
Submitted by Anurag Shekhar.


------------------------------------------------------------------------
r386767 | fuzzylogic | 2006-03-17 16:08:36 -0800 (Fri, 17 Mar 2006) | 2 lines

DERBY-422: Contribute toursdb demo database to Derby.

------------------------------------------------------------------------
r386731 | davidvc | 2006-03-17 13:46:06 -0800 (Fri, 17 Mar 2006) | 3 lines

DERBY-1126 : Modified svn:ignore property on the sanity directory
to ignore SanityState.java

------------------------------------------------------------------------
r386710 | davidvc | 2006-03-17 12:47:45 -0800 (Fri, 17 Mar 2006) | 2 lines

DERBY-1117 - Fix bug in SqlException where we weren't chaining exceptions.

------------------------------------------------------------------------
r386501 | kmarsden | 2006-03-16 17:11:50 -0800 (Thu, 16 Mar 2006) | 14 lines

DERBY-962 Upgrade default security mechanism in client to use encrypted userid password if client can support it.

Contributed by Sunitha Kambhampati

1. If securityMechanism is explicitly specified in the connection request then client will not override it.
2. Dynamically figure out if the jvm in which the client is loaded, supports encrypted userid and
password security (EUSRIDPWD) or not and use this information to upgrade to a more secure default
security mechanism.
3. Thus if user has not specified the security mechanism, in that case the client will try to see if
it can upgrade the security mechanism and use the new upgraded security mechanism for connection to the server.




------------------------------------------------------------------------
r386483 | davidvc | 2006-03-16 15:24:56 -0800 (Thu, 16 Mar 2006) | 3 lines

DERBY-919 : Add support for base classes for JUnit tests.  Contributed
by Kristian Waagan.

------------------------------------------------------------------------
r386466 | bandaram | 2006-03-16 14:00:55 -0800 (Thu, 16 Mar 2006) | 8 lines

Address grantRevoke test failures and master updates.

1) Make grantRevokeDDL export table into extinout directory. (may be used for import later) and set useextdirs property.

2) Address test failures on J9 VM... Update master for grantRevokeDDL.sql for J9 and enable getting connection using DataSource to make the test run on J9.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r386463 | mikem | 2006-03-16 13:50:31 -0800 (Thu, 16 Mar 2006) | 5 lines

DERBY-1071 submitted on behalf of Sunitha Kambhampati

javadoc fixes from the UserAuthenticator class.


------------------------------------------------------------------------
r386457 | davidvc | 2006-03-16 12:56:06 -0800 (Thu, 16 Mar 2006) | 3 lines

DERBY-1067 - Submitted by Andreas Kornelliusen.   Adds scrollable,
updatable, insensitive result set tests.

------------------------------------------------------------------------
r386408 | fuzzylogic | 2006-03-16 10:26:00 -0800 (Thu, 16 Mar 2006) | 2 lines

Remove inadvertently committed SanityState.java.

------------------------------------------------------------------------
r386290 | kahatlen | 2006-03-16 00:53:02 -0800 (Thu, 16 Mar 2006) | 28 lines

DERBY-970 (partial): Add new metadata methods to network client driver

This patch implements the following new JDBC 4 DatabaseMetaData
methods in the client driver:

  - getRowIdLifetime() - returns RowIdLifetime.ROWID_UNSUPPORTED

  - supportsStoredFunctionsUsingCallSyntax() - returns true

  - autoCommitFailureClosesAllResultSets() - returns false

  - providesQueryObjectGenerator() - returns false

Canon for jdbc4/TestDbMetaData.java is updated to reflect that the
methods are implemented on the client.

New test cases added to TestDbMetaData:

  - try to execute a stored procedure using the escape syntax, and see
    if the success/failure corresponds to the value returned by
    supportsStoredFunctionsUsingCallSyntax()

  - open a holdable result set in auto-commit mode and, on the same
    connection, execute a query which causes SQLException. Check
    whether the result set is open or closed, and see if the state
    corresponds to the value returned by
    autoCommitFailureClosesAllResultSets()

------------------------------------------------------------------------
r386283 | bandaram | 2006-03-16 00:12:41 -0800 (Thu, 16 Mar 2006) | 16 lines

DERBY-464: More checkins to implement Grant & Revoke functionality as defined
by functional spec. This round of changes address:

1) Adding schema creation privilege checks for implicitly created schemas as
well. Previous checkin addressed explicitly created schemas.
2) Disable grant/revoke operations on system tables or system routines not in
SQLJ or SYSCS_UTIL schemas. These objects should always be available for
SELECT or EXECUTE operations as approriate.
3) Add RoutinePermDescriptors during database creation for routines that can
be executed by public. Currently 5 routines have EXECUTE privilege to PUBLIC.
It should be possible to execute these routines on a new database.

Add functional tests to test each of these.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r386248 | bandaram | 2006-03-15 19:37:17 -0800 (Wed, 15 Mar 2006) | 2 lines

Master update for 131 version of the test.

------------------------------------------------------------------------
r386247 | bandaram | 2006-03-15 19:21:25 -0800 (Wed, 15 Mar 2006) | 4 lines

DERBY-1119: Address NullPointerException while creating a schema when DumpParseTree is set and in SANITY mode.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r386221 | fuzzylogic | 2006-03-15 15:54:56 -0800 (Wed, 15 Mar 2006) | 4 lines

DERBY-434 DERBY-1052: Fix XA tests in remote server testing.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r386218 | fuzzylogic | 2006-03-15 15:47:49 -0800 (Wed, 15 Mar 2006) | 4 lines

DERBY-1037: Fix lang/ShutdownDatabase.java in J2ME environment.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r386216 | fuzzylogic | 2006-03-15 15:33:17 -0800 (Wed, 15 Mar 2006) | 4 lines

DERBY-949: Clean up tests to use common method to get connection.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r386205 | djd | 2006-03-15 15:12:26 -0800 (Wed, 15 Mar 2006) | 5 lines

Add and cleanup comments for ContextManager & ContextService to
correct and expand on how the mapping of current thread to current
context manager is handled. Some of the previous comments were incorrect,
also removed old commented out code.

------------------------------------------------------------------------
r386187 | davidvc | 2006-03-15 14:28:41 -0800 (Wed, 15 Mar 2006) | 36 lines

DERBY-1115 : Add a shell-script test generator for internationalized
messages (client-side only).

This is the script that generates the test source code that is then
run to validate client-side internationalized mesages
A    tools/testing
A    tools/testing/i18nTestGenerator
A    tools/testing/i18nTestGenerator/genClient1.sed
A    tools/testing/i18nTestGenerator/genClient2.sed
AM   tools/testing/i18nTestGenerator/generateClientMessageTest.sh
AM   tools/testing/i18nTestGenerator/README


Moved the sanity package to the shared directory so that I could
use ASSERT in some shared code.
M    java/engine/org/apache/derby/iapi/services/sanity/SanityManager.java
D    java/engine/org/apache/derby/iapi/services/sanity/SanityState.tmpl
M    java/engine/org/apache/derby/iapi/services/sanity/AssertFailure.java
A    java/shared/org/apache/derby/shared/common/sanity
AM   java/shared/org/apache/derby/shared/common/sanity/SanityManager.java
A    java/shared/org/apache/derby/shared/common/sanity/SanityState.tmpl
AM   java/shared/org/apache/derby/shared/common/sanity/SanityState.java
AM   java/shared/org/apache/derby/shared/common/sanity/AssertFailure.java
M    build.xml
M    tools/ant/properties/dirs.properties

Modified MessageUtil so that it ASSERTs that the number of parameters
passed in to formatMessage() actually matches the placeholders in the
message string.  Also modified the default message string so that it
is something I can look for in my test to tell me something went wrong.
M    java/shared/org/apache/derby/shared/common/i18n/MessageUtil.java

Found a bug by running the test, added a message id to the client
properties file
M    java/build/org/apache/derbyBuild/splitmessages.java

------------------------------------------------------------------------
r386176 | kmarsden | 2006-03-15 13:52:13 -0800 (Wed, 15 Mar 2006) | 5 lines

DERBY-1076  Test update to cleanup metadata tests in preparation for upgrade testing work.

Contributed by Deepa Remesh


------------------------------------------------------------------------
r386169 | davidvc | 2006-03-15 13:31:53 -0800 (Wed, 15 Mar 2006) | 3 lines

DERBY-1105 : Add master files for jdk16 run of derbyall.  Contributed
by Anurag Shekhar

------------------------------------------------------------------------
r386068 | kahatlen | 2006-03-15 05:11:17 -0800 (Wed, 15 Mar 2006) | 16 lines

DERBY-992: A corner case bug and missing optimization in
ScrollInsensitiveResultSet

a) For a scrollable, insensitive result set (read-only) which is
   empty, ResultSet#afterLast should have no effect, but erroneously
   sets the internal variable afterLast to true, so that a subsequent
   call to ResultSet#isAfterLast will return 'true' in the embedded
   client. It does not happen on the client driver, because it seems
   to do some double book-keeping for this case.

b) In ScrollInsensitiveResultSet#getNextRowCore and #getAbsoluteRow,
   there are missing checks will cause unnecessary read (attempts)
   from underlying result set even if end has been seen already.

Patch submitted by Dag H. Wanvik.

------------------------------------------------------------------------
r385941 | bandaram | 2006-03-14 16:42:39 -0800 (Tue, 14 Mar 2006) | 11 lines

This patch addresses following:

1) Remove parsing of EXTERNAL SECURITY clause. According to the lates
   functional specification of Grant & Revoke feature, this clause will not be
   implmented. It only had partial parsing support currently.

2) Fix javadoc warnings caused by Grant & Revoke work and other javadoc
   warnings too.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r385932 | djd | 2006-03-14 15:48:07 -0800 (Tue, 14 Mar 2006) | 2 lines

DERBY-1095 (partial) Mark an EmbedStatement as inactive once it sees that its connection has been closed.

------------------------------------------------------------------------
r385859 | djd | 2006-03-14 11:18:37 -0800 (Tue, 14 Mar 2006) | 3 lines

DERBY-623 Change BaseMonitor to use privileged blocks for reading derby.debug.* system properties
and also removing the workaround permissions granted in 'derby_tests.policy'.

------------------------------------------------------------------------
r385857 | bpendleton | 2006-03-14 11:11:46 -0800 (Tue, 14 Mar 2006) | 16 lines

DERBY-1080: Connection reset when using security mechanism=EUSRIDPWD results in protocol error

Patch contributed by Sunitha Kambhampati

For eusridpwd case, the client sends the encrypted userid and password
sectkns as part of SECCHK. The protocol error was happening because we
only read the 2 sectkns if the database.decryptedUserId ,
database.decryptedPassword is null, otherwise we think we have already
read this. Thus on a connection reset,if the decryptedUserId and
decryptedPassword are not reset, server assumes we have seen more SECTKN's
and thus we throw error too many codepoints.

Patch adds
-- code to reset the security mechanism related variables on a connection re-use
-- regression test to testSecMec.java 

------------------------------------------------------------------------
r385674 | mikem | 2006-03-13 14:20:10 -0800 (Mon, 13 Mar 2006) | 3 lines

fixing eol propset on some store tests files.


------------------------------------------------------------------------
r385610 | bandaram | 2006-03-13 10:28:20 -0800 (Mon, 13 Mar 2006) | 22 lines

DERBY-464: Continuation of previous Grant and Revoke checkins. This changes
implement:

1) Schema authorization checks: Only DBA can create a schema with authorization
of another user and regular non-DBA users can only create a schema that matches
their authorizationID in sqlStandard mode.

2) Make database owner authorizationId owner of all system schemas. This is
done in both sqlStandard mode or in legacy mode during database create time.
Need work to test hard upgrade to change system schema owner name to authId
of user doing full database upgrade.

3) Disable switching to sqlStandard mode in soft upgrade mode for 10.2. Since
Grant/Revoke is not enabled in soft upgrade mode in 10.2 release, sqlStandard
mode should be disabled in soft upgrade mode.

4) Disable all authorization checks for DBA user. This includes all object
permission checks and allowing DBA to grant/revoke any privilege on any database
object.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r385570 | djd | 2006-03-13 07:29:49 -0800 (Mon, 13 Mar 2006) | 3 lines

DERBY-1095 (partial) Clean up close methods on EmbedResultSet, mark the ResultSet
as closed (isClosed=true) once it discovers its Connection is closed.

------------------------------------------------------------------------
r385569 | djd | 2006-03-13 07:15:51 -0800 (Mon, 13 Mar 2006) | 3 lines

DERBY-1095 (partial) Ensure StatementContexts and CompilerContexts are popped from
context manager on a session close.

------------------------------------------------------------------------
r385389 | djd | 2006-03-12 15:22:04 -0800 (Sun, 12 Mar 2006) | 3 lines

DERBY-1102 (partial) Remove test case of use of stale TriggerExecutionContext in triggerGeneral.sql
because applications no longer have access to the TriggerExecutionContext.

------------------------------------------------------------------------
r385383 | djd | 2006-03-12 15:06:38 -0800 (Sun, 12 Mar 2006) | 2 lines

DERBY-1102 (partial) Remove unused code in Triggers.java

------------------------------------------------------------------------
r385379 | djd | 2006-03-12 14:40:53 -0800 (Sun, 12 Mar 2006) | 2 lines

DERBY-1102 (partial) Remove old unused replication related methods in test code Triggers.java

------------------------------------------------------------------------
r385377 | djd | 2006-03-12 14:27:55 -0800 (Sun, 12 Mar 2006) | 3 lines

DERBY-1102 (partial) Remove application code that printed the trigger information using
non-public apis.

------------------------------------------------------------------------
r385376 | djd | 2006-03-12 14:18:58 -0800 (Sun, 12 Mar 2006) | 4 lines

DERBY-1102 (partial) Remove triggers that only display trigger context information
since this is no longer part of the api. No need to rewrite any of the test cases
as they are not applicable for the triggers that Derby supports.

------------------------------------------------------------------------
r385291 | kahatlen | 2006-03-12 06:41:51 -0800 (Sun, 12 Mar 2006) | 6 lines

DERBY-1061: SqlException while fetching message results in recursive
calls between SqlException.getSQLException and Sqlca.getJDBCMessage

Don't convert SqlException to SQLException when fetching of error message
in Sqlca.getJDBCMessage() fails.

------------------------------------------------------------------------
r385157 | kahatlen | 2006-03-11 12:40:02 -0800 (Sat, 11 Mar 2006) | 8 lines

DERBY-970 (partial): Add new metadata methods to network client driver

Attaching patch derby-970-part1-v1.diff. This patch makes the JDBC4
database metadata test (jdbc4/TestDbMetaData.java) also test the
client driver. Currently, none of the new metadata calls are
implemented on the client, some of them even throw
AbstractMethodError. The canon is updated accordingly.

------------------------------------------------------------------------
r385106 | djd | 2006-03-11 08:39:53 -0800 (Sat, 11 Mar 2006) | 3 lines

DERBY-1095 (partial) Ensure DataDictionaryContexts are popped off the stack
when the connection/session is closed. Cleanup unused code of nested DataDictionaryContexts.

------------------------------------------------------------------------
r385006 | djd | 2006-03-10 20:18:47 -0800 (Fri, 10 Mar 2006) | 2 lines

Clean up dblook.java to make protected methods private to clean-up the published javadoc.

------------------------------------------------------------------------
r385004 | djd | 2006-03-10 20:16:31 -0800 (Fri, 10 Mar 2006) | 2 lines

Fix modules.properties for JDBC 4.0 driver to correctly require JSE 6, constant 7 in derby.

------------------------------------------------------------------------
r384946 | fuzzylogic | 2006-03-10 15:12:08 -0800 (Fri, 10 Mar 2006) | 5 lines

DERBY-956: prevent OutOfMemoryError on certain platforms caused by revision
370059

Committed for Deepa Remesh <dremesh@gmail.com>

------------------------------------------------------------------------
r384900 | djd | 2006-03-10 11:10:49 -0800 (Fri, 10 Mar 2006) | 4 lines

DERBY-1095 (partial) Ensure on a close connection/session contexts are popped off the
context manager. This ensures that references to database wide objects
are not maintained after a close connection.

------------------------------------------------------------------------
r384753 | kahatlen | 2006-03-10 02:17:11 -0800 (Fri, 10 Mar 2006) | 10 lines

DERBY-947: Miscellaneous PreparedStatement methods added by JDBC4

As described in the JDBC 4 spec sections 13.2 and 3.1.

This involves building support for JDBC4 methods added to
PreparedStatement and not addressed by other JIRAs: isPoolable() and
setPoolable().

Patch contributed by Francois Orsini.

------------------------------------------------------------------------
r384661 | mikem | 2006-03-09 17:00:23 -0800 (Thu, 09 Mar 2006) | 28 lines

DERBY-1042: committed on behalf of Suresh Thalamati

I could not reproduce this problem on my machine. By looking at the code I
found backup is getting unblocked before the post commit work is done.
This may cause the error that is reported, if the jar files to copied to the
backup is deleted by the post commit. Attached patch unblocks the backup
only after the post commit work that is schedules to run in the same
transaction is done. While scanning the code for this problem, I also noticed
couple of other small issues, this patch addresses them also.


DERBY-1042:

-- unblock the backup only after the post commit work to be done on the same
transaction is complete.
-- when backup is in progress drop stub files are not deleted during
checkpoint. These are necessary to perform recovery starting from the
backup checkpoint.
-- synchronized getContaineNames() that gets the containers to be written to
the backup. This method need to be synchronized so that other privileged
actions does not run in parallel and vice versa.

-- Modified the OnlineBackupTest1.java and OnlineBackupTest3.java tests to
abort if there is a error during the backup instead of waiting incorrectly
for the failed backup to complete forever.



------------------------------------------------------------------------
r384605 | djd | 2006-03-09 12:29:47 -0800 (Thu, 09 Mar 2006) | 5 lines

DERBY-444 Handle out of memory errors when embedded opening connections. Provide some
initial framework that sets low memory water marks for an operation and fails that operation
until free memory is above that mark or five seconds have elapsed.
See java/engine/org/apache/derby/iapi/services/memory/LowMemory.java for more details.

------------------------------------------------------------------------
r384331 | kmarsden | 2006-03-08 13:16:49 -0800 (Wed, 08 Mar 2006) | 26 lines

DERBY-210 Network Server will leak prepared statements if not explicitly closed by the user until the connection is closed 


Contributed by Deepa Remesh

----------------------------------------------------------------
Summary of patch: 'derby-210-patch5-v1.diff'
-----------------------------------------------------------------
1. Eliminates the below references to PreparedStatement objects by using WeakHashMap instead of LinkedList. When there are no other references to the keys in a WeakHashMap, they will get removed from the map and can thus get garbage-collected. They do not have to wait till the Connection object is collected.
       - 'openStatements_' in org.apache.derby.client.am.Connection
       - 'CommitAndRollbackListeners_' in org.apache.derby.client.am.Connection

2. Updates the following comment for openStatements_:
// Since DERBY prepared statements must be re-prepared after a commit,
// then we must traverse this list after a commit and notify statements
// that they are now in an un-prepared state.
final java.util.LinkedList openStatements_ = new java.util.LinkedList();

In the code, I did not see this list being traversed after a commit to re-prepare statements. Also, I think this is not needed since Derby does not require re-prepare of statements after a commit. Currently, this list is used to close all open statements when the originating connection is closed.

3. Removes all ResultSets from HashTable 'positionedUpdateCursorNameToResultSet_' in SectionManager. Only result sets of positioned update statements were being removed from this hashtable whereas all result sets were added. Because of this, client driver was holding on to result sets and statements even after rs.close() was called.

4. Modifies the test jdbcapi/derbyStress.java to run the test for derby-210. The test was checked in as patch2 but disabled for client framework.



------------------------------------------------------------------------
r384282 | mikem | 2006-03-08 09:51:15 -0800 (Wed, 08 Mar 2006) | 12 lines

DERBY-616, committing on behalf of Suresh Thalamati

- Added a missing privileged blocks for I/O call in StreamFileContainer.java ,
this class is used by the sort during index creation ..etc.

-- Enabled some of the tests which were not running under security manager
earlier because of this bug to run by default with security manager.

-- removed the additional permissions from the derby test policy file
that were added earlier to avoid this bug for some test cases.


------------------------------------------------------------------------
r384101 | fuzzylogic | 2006-03-07 18:52:33 -0800 (Tue, 07 Mar 2006) | 2 lines

DERBY-1063: Add derbyrun.jar - new jar file to execute tools with java -jar

------------------------------------------------------------------------
r384083 | mikem | 2006-03-07 17:15:54 -0800 (Tue, 07 Mar 2006) | 12 lines

DERBY-937

Fixing typo in the no timeout setting for this test.  it should have
been derby.optimizer.noTimeout=true not derby.optimize.noTimeout=true.
Unfortunately did this did not fix the diffs I am seeing on my machine, but
it clearly makes sense for this test to set no timeout to eliminate the
variance of running this test on a number of different speeds of hardware.
Maybe this change will help others, at least it will eliminate one variable
as we continue to track down the cause.



------------------------------------------------------------------------
r384061 | fuzzylogic | 2006-03-07 16:00:56 -0800 (Tue, 07 Mar 2006) | 5 lines

DERBY-975: Catch exception but don't call getMessage on it in 1.3 VMs. Fixes a canon diff in
updatableResultSet.java on ibm131.

Committed for Fernanda Pizzorno <Fernanda.Pizzorno@sun.com>

------------------------------------------------------------------------
r383703 | davidvc | 2006-03-06 15:22:30 -0800 (Mon, 06 Mar 2006) | 2 lines

Added my key

------------------------------------------------------------------------
r383663 | mikem | 2006-03-06 12:50:46 -0800 (Mon, 06 Mar 2006) | 9 lines

DERBY-670 - improve automatic space reclamation of long rows and long columns.

This patch provides a non-upgrade solution to the problem.  It uses existing
row and column format information to determine at delete time if the row or
column is "long".  If so it schedules a post commit reclamation immediately
rather than waiting for all rows on a page to be deleted.



------------------------------------------------------------------------
r383606 | djd | 2006-03-06 10:14:56 -0800 (Mon, 06 Mar 2006) | 3 lines

Javadoc fixes related to DERBY-623
Contributed by Kristian Waagan Kristian.Waagan@Sun.COM

------------------------------------------------------------------------
r383600 | djd | 2006-03-06 09:53:34 -0800 (Mon, 06 Mar 2006) | 2 lines

DERBY-467 Reduce visibilty of context implementation classes and their methods.

------------------------------------------------------------------------
r383597 | djd | 2006-03-06 09:43:52 -0800 (Mon, 06 Mar 2006) | 2 lines

Call ContextService.stop() correctly as a static method.

------------------------------------------------------------------------
r383595 | djd | 2006-03-06 09:38:39 -0800 (Mon, 06 Mar 2006) | 2 lines

DERBY-467 Reduce the visibility of some methods in classes for EmbedConnection.

------------------------------------------------------------------------
r383592 | djd | 2006-03-06 09:22:50 -0800 (Mon, 06 Mar 2006) | 2 lines

Remove unused code in ConnectionChild.java

------------------------------------------------------------------------
r383587 | djd | 2006-03-06 09:17:01 -0800 (Mon, 06 Mar 2006) | 2 lines

Add some javadoc comments to methods in ContextService.java

------------------------------------------------------------------------
r383550 | kahatlen | 2006-03-06 06:45:15 -0800 (Mon, 06 Mar 2006) | 4 lines

DERBY-1070: add tests for holdable SUR

Patch contributed by Andreas Korneliussen <Andreas.Korneliussen@Sun.COM>

------------------------------------------------------------------------
r383394 | kahatlen | 2006-03-05 12:34:20 -0800 (Sun, 05 Mar 2006) | 8 lines

DERBY-1060: ResultSet methods should throw exception when the
ResultSet is closed

The patch adds calls to checkIfClosed (embeddded) or
checkForClosedResultSet (network client) in the ResultSet methods
which don't check whether the ResultSet is closed. It also adds a test
case to jdbc4/TestResultSetMethods.java.

------------------------------------------------------------------------
r383062 | fuzzylogic | 2006-03-03 22:46:06 -0800 (Fri, 03 Mar 2006) | 4 lines

DERBY-805: test fix to prevent truncating query plans in predicatePushdown.sql

Committed for Army Brown <qozinx@sbcglobal.net>

------------------------------------------------------------------------
r382975 | fuzzylogic | 2006-03-03 16:03:43 -0800 (Fri, 03 Mar 2006) | 4 lines

DERBY-928: Add new canons for testSecMec for JCC 2.6 and exclude two tests from remote testing for now.

Committed for Sunitha Kambhampati <ksunithaghm@gmail.com>

------------------------------------------------------------------------
r382953 | bandaram | 2006-03-03 14:52:48 -0800 (Fri, 03 Mar 2006) | 18 lines

DERBY-1073: Reset optimizer timeout for subqueries after new scoped predicates
are pushed into it for next round of evaluation.

If we have predicates that were pushed down to this OptimizerImpl from an
outer query, then we reset the timeout state to prepare for the next round
of optimization.  Otherwise if we timed out during a previous round and then
we get here for another round, we'll immediately "timeout" again before
optimizing any of the Optimizables in our list.  This is okay if we don't
have any predicates from outer queries because in that case the plan we find
this round will be the same one we found in the previous round, in which
case there's no point in resetting the timeout state and doing the work a
second time.  But if we have predicates from an outer query, those predicates
could help us find a much better plan this round than we did in previous
rounds--so we reset the timeout state to ensure that we have a chance to
consider plans that can take advantage of the pushed predicates.

Submitted by Army Brown (qozinx@sbcglobal.net)

------------------------------------------------------------------------
r382940 | bandaram | 2006-03-03 13:56:07 -0800 (Fri, 03 Mar 2006) | 9 lines

DERBY-805: Implement join-predicate push down into Unions.

This Phase III patch builds on two earlier patches already submitted.

Implement pushdown by pushing optimizable predicates onto both sides of UNION.
If either side fails to push the predicate, stop pushing this predicate.

Submitted by Army Brown (qozinx@sbcglobal.net)

------------------------------------------------------------------------
r382935 | bandaram | 2006-03-03 13:28:28 -0800 (Fri, 03 Mar 2006) | 58 lines

DERBY-1007: Fix optimizer to make subqueries return correct cost estimates.

More description of the changes:
1. Added the "prepForNextRound()" method that was part of OptimizerImpl
to the Optimizer interface since that seemslike an appropriate place for it.

2. Added a single line to OptimizerImpl.prepForNextRound() to reset the "bestCost"
for the current round of optimization. Note that I do _not_ reset the "foundABestPlan"
 variable nor the "bestJoinOrder" array. This is because it's possible that a 
"best join order" may not exist for the current round, in which case the optimizer
 must know whether or not it found a best join order in a previous round
 (foundABestPlan) and if so what the corresponding join order was (bestJoinOrder).
 That information is required so that a valid query plan can be generated after
 optimization is complete.

3. After making the above changes, I noticed that the optimizer cost
estimates were not always showing up when logQueryPlan was set to true--they 
were sometimes being printed as question marks to represent "Infinity". The reason 
for this was that most of the code in the "modifyAccessPaths" phase of query 
compilation uses the estimates as they sit in the ResultSetNode.costEstimate 
field--which, for nodes above subqueries, will hold the "bestCost" estimates for 
the most recent plan chosen by the OptimizerImpl for the subquery. Since I am now 
(with DERBY-1007) resetting the "bestCost" variable at the start of every round,
 it's possible that "bestCost" will hold an estimate that has been "reset" to 
Double.MAX_VALUE. This can happen if it was reset (in prepForNextRound()) and 
then no valid join order was found for the current round (ex. if no valid join
 order exists or if there was an optimizer "timeout"). That in turn meant that 
the "costEstimate" field for nodes above the OptimizerImpl would have been "reset" 
as well, and hence the "infinity" value (i.e. question mark) was showing up in the 
logged query plan. So I had to find all nodes that use "costEstimate" during 
modifyAccessPaths() and update them to use the final, best cost estimate for 
that node (instead of just using the most recent value of "costEstimate"). This 
touched several of ResultSetNode's subclasses, but the diff in most cases is just 
a few lines. The exceptions are FromTable, SelectNode, UnionNode, 
IntersectOrExceptNode, and JoinNode, where I added new "getFinalCostEstimate" methods
 to correctly figure out the final cost estimate based on the final estimates for 
child nodes, as appropriate.

4. The current optimizer "timeout" mechanism is based on the value in 
OptimizerImpl.bestCost. Since I'm now resetting that value at the start of every
round, the timeout mechanism had to be changed in order to preserve its current 
functionality while removing the dependency on bestCost. So I've added a new 
variable, timeLimit, to OptimizerImpl that plays the same role w.r.t optimizer
 "timeout" that the old bestCost value did.

5. Updated master/derived.out to match new behavior. There's one query in 
derived.sql that is affected by this issue. Before these changes the optimizer 
thought one join order B was cheaper than another join order A and so it chose 
to generate join order B. With these changes, though, it now (correctly) sees that 
join order A and join order B are equivalent, so it just goes with join order A. 
This difference manifests itself in the ordering of two rows in the result set for
that query--so I've updated the masters accordingly.

6. Added a new, simple test case specific to DERBY-1007 to lang/subquery.sql, and 
updated the master file accordingly. The test case is the same one mentioned in the 
description for this issue.

Submitted by Army Brown (qozinx@sbcglobal.net)
------------------------------------------------------------------------
r382931 | mikem | 2006-03-03 13:17:47 -0800 (Fri, 03 Mar 2006) | 7 lines

DERBY-654, committing on behalf of Sunitha Kambhampati.  

This change disables the test from running in the j9 environment, so that
regression test don't fail.  The bug remains open, and can be intermittently
reproduced in the environment described in DERBY-654.


------------------------------------------------------------------------
r382917 | kmarsden | 2006-03-03 11:51:46 -0800 (Fri, 03 Mar 2006) | 15 lines

DERBY-618 Make the client driver connection URL work when spaces are in the URL.

Contributed by Deepa Remesh

 Attaching a patch 'derby-618-v2.diff' which includes code change and a test for this issue. Patch does the following:

* Modifies ClientDriver.java - removes the space separator in the call to nextToken in tokenizeDatabase method. This allows use of URL containing database name with spaces.

* Adds tests to jdbcapi/checkDriver.java for an url with spaces in database name. Since embedded and jcc driver work with spaces, I added this test for all three frameworks. Test verfies that the specified database gets created.

* Modifies master files for the test

Ran derbyall with Sun JDK 1.4.2 on Windows XP. I also ran jdbcapi/checkDriver.java with j9 vms. 


------------------------------------------------------------------------
r382911 | kmarsden | 2006-03-03 10:55:58 -0800 (Fri, 03 Mar 2006) | 11 lines

DERBY-1055 Security.AccessControlException in client under SecurityManager when trying to connect using EUSRIDPWD security mechanism

Contributed by Sunitha Kambhampati

Patch
- removes the unnecessary addProvider call in EncryptionManager that was causing
the Security.AccessControlException.
- enables test to connect using EUSRIDPWD mechanism and updates necessary masters



------------------------------------------------------------------------
r382906 | rhillegas | 2006-03-03 10:43:34 -0800 (Fri, 03 Mar 2006) | 1 line

Checkin Anurag's patch for DERBY-819: Triaging of SQLExceptions into new JDBC4 subclasses.
------------------------------------------------------------------------
r382759 | kahatlen | 2006-03-03 03:13:25 -0800 (Fri, 03 Mar 2006) | 25 lines

DERBY-965: DatabaseMetadata method supportsResultSetConcurrency
returns wrong result on network client

This patch (derby965b-v1) updates the master for phaseTester.java.
This test is not part of derbyall and the master must be manually
compared with the output of the phase tests, cf description in
DERBY-573.

phaseTester runs metadata_test.java as part of its work, so the master
needs to be updated whenever metadata_test.java changes (as this issue
does).

Note: Even with this patch, phaseTester when run as described,
failed. I noticed the following:

- the shell script driving it is WIndows specific (";" as classpath
  delimiter)

- in the soft upgrade phase, the metadata test fails (table not
  found), when performing a stored procedure: 'CALL
  SYSIBM.SQLCOLPRIVILEGES' (in odbc_metadata#getMetadataRS).
  
This patch lessens the diff between the master and the "current"
output, though, so i think it should be committed.

------------------------------------------------------------------------
r382710 | kahatlen | 2006-03-02 23:52:28 -0800 (Thu, 02 Mar 2006) | 7 lines

DERBY-948: Miscellaneous ResultSet methods added by JDBC 4

Implemented new methods defined by the JDBC 4 spec:

  * ResultSet.getHoldability()
  * ResultSet.isClosed()

------------------------------------------------------------------------
r382611 | djd | 2006-03-02 17:44:06 -0800 (Thu, 02 Mar 2006) | 2 lines

DERBY-444 minor improvements to memory/ConnectionHandling code to
minimize object creation outside Derby.
------------------------------------------------------------------------
r382588 | djd | 2006-03-02 16:26:49 -0800 (Thu, 02 Mar 2006) | 3 lines

DERBY-444 add count to ConnectionHandling test output of how many
of the successfully opened Connections were closed due to
database shutdown.
------------------------------------------------------------------------
r382578 | djd | 2006-03-02 16:05:17 -0800 (Thu, 02 Mar 2006) | 1 line

DERBY-444 Try to isolate out of memory exceptions from the engine in the ConnectionHandling test.
------------------------------------------------------------------------
r382565 | djd | 2006-03-02 15:39:41 -0800 (Thu, 02 Mar 2006) | 3 lines

DERBY-444 Add a class in the test area memory/ConnectionHandling.java that pushes the
limit on obtaining connections once an out of memory siutation is hit.
Not added as a real test yet, just code that could form the basis of a test.
------------------------------------------------------------------------
r382564 | djd | 2006-03-02 15:39:10 -0800 (Thu, 02 Mar 2006) | 3 lines

DERBY-444 Add a class in the test area memory/ConnectionHandling.java that pushes the
limit on obtaining connections once an out of memory siutation is hit.
Not added as a real test yet, just code that could form the basis of a test.
------------------------------------------------------------------------
r382563 | bandaram | 2006-03-02 15:38:08 -0800 (Thu, 02 Mar 2006) | 4 lines

Apply javadoc fix to phase II checkin for DERBY-805.

Submitted by Army Brown(qozinx@sbcglobal.net)

------------------------------------------------------------------------
r382502 | mikem | 2006-03-02 12:23:38 -0800 (Thu, 02 Mar 2006) | 7 lines

DERBY-1071 submitting on behalf of Sunitha Kambhampati.

Derby passes the user in a connection request as is; to the authenticateUser method. Thus if user attribute value is delimited with quotes, the userName in authenticateUser will also be delimited. Mentioned this explicitly in the javadoc.

Javadoc change only.


------------------------------------------------------------------------
r382450 | djd | 2006-03-02 09:16:40 -0800 (Thu, 02 Mar 2006) | 3 lines

DERBY-997 Fix ClassCastExceptions for queries containing aggregates when executing in application servers
or other class loading environments where the thread context loader provides another path to the derby engine code.

------------------------------------------------------------------------
r382379 | rhillegas | 2006-03-02 05:28:56 -0800 (Thu, 02 Mar 2006) | 1 line

Dyre's patch for DERBY-924: Implementing new JDBC4 method for embedded case, DatabaseMetadata.getFunctions()
------------------------------------------------------------------------
r382319 | kahatlen | 2006-03-02 00:25:28 -0800 (Thu, 02 Mar 2006) | 9 lines

DERBY-965: DatabaseMetadata method supportsResultSetConcurrency
returns wrong result on network client

The DatabaseMetaData method supportsResultSetConcurrency erroneously
returns false on the network client for all arguments combination. The
embedded client returns correct results.

Patch contributed by Dag H. Wanvik <Dag.Wanvik@Sun.COM>.

------------------------------------------------------------------------
r382296 | djd | 2006-03-01 20:46:23 -0800 (Wed, 01 Mar 2006) | 4 lines

DERBY-997 Add test lang/AggregateClassLoading.java that demonstrates the
ClassCastException typically seen in application servers.
Test is not added to any suite yet, will be added when the bug is fixed.

------------------------------------------------------------------------
r382200 | bandaram | 2006-03-01 15:36:11 -0800 (Wed, 01 Mar 2006) | 8 lines

DERBY-805: Phase II changes that are described in detail in JIRA attachment. 

This phase essentially tries to scope join predicates that could be pushed
into table expressions. More work is needed to actually perform this pushing
and costing, which will come in follow up patches.

Submitted by Army Brown (qozinx@sbcglobal.net)

------------------------------------------------------------------------
r382138 | fuzzylogic | 2006-03-01 11:51:53 -0800 (Wed, 01 Mar 2006) | 5 lines

DERBY-834: test i18n/urlLocale.sql fails in non-en_US locales. Remove hardcoded references to en_US and verify that the
locale of the database is internally consistent.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r382019 | kmarsden | 2006-03-01 05:55:05 -0800 (Wed, 01 Mar 2006) | 10 lines

DERBY-928 Add ability to network server to accept connections with a certain security mechanism.

Add derby.drda.securityMechanism property to restrict securityMechanisms accepted from client

Detailed description of patch in bug
https://issues.apache.org/jira/browse/DERBY-928#action_12366294

Contrbuted by Sunitha Kambhampati


------------------------------------------------------------------------
r381937 | kmarsden | 2006-02-28 23:29:33 -0800 (Tue, 28 Feb 2006) | 38 lines

DERBY-1002 - Check that DRDAStatement and DRDAResultSet states are reset when they are re-used

Contributed by Deepa  Remesh

Please take a look at following two patches - patch 1 contains code changes and patch 2 contains tests. These have to be committed together.

------------------------------------------
1. derby1002-patch1-v1
------------------------------------------
* Adds reset() methods to DRDAStatement and DRDAResultSet objects. The purpose of reset method is to reset the states of all variables so that the objects can be re-used and will not have left-over states.

* In case of DRDAStatement, the following variables are not reset:
+ * 1. database - This variable gets initialized in the constructor and by
+ * call to setDatabase.
+ * 2. members which get initialized in setPkgnamcsn (pkgnamcsn, pkgcnstkn,
+ * pkgid, pkgsn, isolationLevel, cursorName). pkgnamcsn is the key used to
+ * find if the DRDAStatement can be re-used. Hence its value will not change
+ * when the object is re-used.

* close() methods are changed to only close and dereference objects.

* DRDAStatement.rsClose() method is not used in close() or reset(). This method has some checks which were causing the method to return without resetting currentDrdaRs. Now, close() calls currentDrdaRs.close() and reset() calls currentDrdaRs.reset().

* In Database.newDrdaStatement, close() method is called followed by reset() when the server finds the statement can be re-used.

------------------------------------------
2. derby1002-patch2-v2
------------------------------------------
Modifies test lang/procedure.java. Adds a method 'setupStatementReuse' which creates and uses statements in such a way as to provoke re-use of statements and result sets on network server. This method is called from tests for jira-491 and 'testImplicitClose'.

------------------------------------------------------------------------------------
Remaining TODOs for DERBY-1002
------------------------------------------------------------------------------------
* pkgcnstkn, pkgid, pkgsn variables can be removed from DRDAStatement since these are derived from pkgnamcsn object.
* Look into what is required by initialize() of default statement. Currently, initialize just calls setTypDefValues(). Once the purpose of this method is confirmed, we may need to modify the comments at places it is currently called.



------------------------------------------------------------------------
r381883 | mikem | 2006-02-28 19:01:55 -0800 (Tue, 28 Feb 2006) | 18 lines

DERBY-709, committing on behalf of Suresh Thalamati

This patch (derby-709_latest.diff) fixes the problems appreared with earlier
patch when tests are run againest JARS.

--- correctly catch the Security Exception when there is no permission to get
a canonical path.
--- Modified the deryb_tests.plocy to allow deltes in
${user.dir}${/}extinout${/}- .,
It is needed because, backup tests deletes the old copy of the backup at the
backup location.
--- set noSecurityManager = true for the tests that can not be run under
security manager due to bug : 1066
--- changes st_1 properties to use external tests dirs , so that tests does not
required "user.dir" permission to create parent directories for the backup
paths.


------------------------------------------------------------------------
r381859 | bandaram | 2006-02-28 17:23:44 -0800 (Tue, 28 Feb 2006) | 18 lines

DERBY-805: Apply Part I of the fix. Refer to JIRA for complete writeup
on all the phases. This Phase broadly addresses:

When remembering "truly the best" access path for an Optimizable, we have to 
keep track of which OptimizerImpl the "truly the best" access is for.  
In most queries there will only be one OptimizerImpl in question, but in 
cases where there are nested subqueries, there will be one OptimizerImpl
for every level of nesting, and each OptimizerImpl might have its own
idea of what this Optimizable's "truly the best path" access path really is.
So whenever we save a "truly the best" path, we take note of which Optimizer
told us to do so.  Then as each level of subquery finishes optimization,
the corresponding OptimizerImpl can load its preferred access path into this
Optimizable's trulyTheBestAccessPath field and pass it up the tree, until 
eventually the outer-most OptimizerImpl can choose to either use the best path
that it received from below (by calling "rememberAsBest()") or else use the
path that it found to be "best" for itself.

Submitted by Army Brown (qozinx@sbcglobal.net)
------------------------------------------------------------------------
r381562 | bandaram | 2006-02-27 20:42:01 -0800 (Mon, 27 Feb 2006) | 6 lines

DERBY-464: Enforce TRIGGER privilege checks and add tests.

Change createTriggerNode to expect TRIGGER privilege on triggering table.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r381553 | djd | 2006-02-27 19:55:29 -0800 (Mon, 27 Feb 2006) | 6 lines

DERBY-479 Fix linkage error when passing the value of a RETURNS NULL ON NULL INPUT function
to another function. Fixed by only removing SQLToJava/JavaToSQL nodes for the function's
return value when the function is a CALLED ON NULL INPUT function.

Fix contributed by Mamta Satoor - msatoor@gmail.com

------------------------------------------------------------------------
r381549 | djd | 2006-02-27 19:42:32 -0800 (Mon, 27 Feb 2006) | 4 lines

DERBY-1006 Disallow holdable cursor setting at the connection and statement
level while in a global transaction for the client driver. Matches the embedded
as the holdable cursors are not supported in global (XA) transactions.

------------------------------------------------------------------------
r381430 | fuzzylogic | 2006-02-27 12:18:18 -0800 (Mon, 27 Feb 2006) | 5 lines

DERBY-1045: Remove Class-Path attribute from derbytools.jar manifest. 
Autoloading of the JDBC drivers causes problems in a mixed-jar environment, 
because the load from the tools Class-Path will take precedence over a client 
that appears later in the classpath.

------------------------------------------------------------------------
r381418 | bandaram | 2006-02-27 11:53:05 -0800 (Mon, 27 Feb 2006) | 5 lines

Enable new grantRevoke.java test as part of derbyAll and also add master
file for this test.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r381408 | bandaram | 2006-02-27 10:54:27 -0800 (Mon, 27 Feb 2006) | 9 lines

DERBY-464: Enable routine privilege checking. Most of the code for routine
privileges is already in trunk. Just enable this checking, add tests to both
grantRevokeDDL and grantRevoke tests.

Permission scheme for system routines still need to be resolved. For now,
everyone has execute permission on all system routines in system schemas.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r381389 | mikem | 2006-02-27 09:19:02 -0800 (Mon, 27 Feb 2006) | 20 lines

DERBY-709, committing on behalf of Suresh Thalamati

-- Removed the requirement for read permission on "user.dir" for backup to
run under security manager. Absolute Path were used only to log into backup
history file. Changed it to log canonical paths only if it can be obtainer
,otherwise only relative paths are written to the backup history file.

-- Added a missing privileged blocks to the save service.properties file into 
the backup.

-- Added privileged blocks for test util file functions that are called
through SQL functions/procedures.

-- Enabled some of the tests which were not running under security manager
earlier because of this bug to run by default with security manager.

Backup tests that test backup with jar Operations still can not be run under 
security manager due to bug DERBY-537.


------------------------------------------------------------------------
r381375 | bpendleton | 2006-02-27 08:37:54 -0800 (Mon, 27 Feb 2006) | 9 lines

DERBY-809 Incorrect documentation for NetworkServerControl.logConnections

Patch contributed by Kristian Waagan

This is a small patch for the javadoc of NetworkServerControl and
NetworkServerControlImpl, removing the false statement that
disconnections are logged to derby.log.


------------------------------------------------------------------------
r381333 | kahatlen | 2006-02-27 04:59:59 -0800 (Mon, 27 Feb 2006) | 20 lines

DERBY-788: 'store/encryptionKey.sql' fails on Solaris 10

Contributed by Kristian Waagan <Kristian.Waagan@Sun.COM>.

'DERBY-788-1a.diff' is a patch that replaces the 16 byte key with a 8
byte key for the DES encryption algorithm used in the test
'store/encryptionKey.sql'. The test still exercises the intended parts
of the Derby code (according to my own analysis and that of
Sunitha). The patch makes the test stop failing on Solaris10 (with
security provider 'SunPCKS11-Solaris') .

One test case is changed; where it previously tested a key that was of
incorrect length (longer than 8 bytes, shorter than 16), it now tests
an incorrect key of the correct length. It is not possible to make the
test pass on Solaris10 with a key of incorrect length, because keys of
length less than 8 bytes are caught by a check in the code, and keys
longer than 8 bytes cause the underlying security provider to fail
('SunPCKS11-Solaris'). This issue will be addressed in DERBY-1001
(rewrite of test to a JUnit-test).

------------------------------------------------------------------------
r381299 | bandaram | 2006-02-27 01:19:26 -0800 (Mon, 27 Feb 2006) | 4 lines

Delete wrongly cased master file GrantRevoke.out

Submitted by Satheesh bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r381109 | bandaram | 2006-02-26 07:52:18 -0800 (Sun, 26 Feb 2006) | 83 lines

DERBY-464: Enable Grant and Revoke DML permission checking for tables. Builds on earlier submitted Part I patch.

Previously submitted Part I patch implemented Grant and Revoke DDL statements.
While permissions granted were correctly recorded in system catalogs, no
permission checks were done at execution time. This Part II patch implements
these privilege checking at execution time for TABLE PRIVILEGES only. This
patch does some work for ROUTINE privileges, though not enabled yet. More work
is needed to enforce ROUTINE and TRIGGER privileges.

Bind phase changes
------------------

Bind phase needs to record access to database objects that need required
privileges. No permission checking is done during compilation process. All 
checks are done at execution time.

Top level nodes know what type of access is needed (like INSERT or UPDATE) but
don't know on which columns. Lower level nodes (like ResultColumn) know what
columns are being used, but not what type of privilege is needed. So, top level
nodes push their required privilege type at the beginning of their bind phase.
As lower level nodes go through their bind phase, they get current requested
privilege and add required StatementPermission objects.

DMLStatementNode now has now method, getPrivType() which defaults to
SELECT_PRIV. Other DML nodes override this method to request their own default
privilege.

Bind phase changes for nodes:

	1) CallStatementNode: Set privType to EXECUTE_PRIV
	2) SelectNode: Set privType to SELECT_PRIV
	3) ResultColumn: Add column privilege of request type
	4) DeleteNode: Add SELECT_PRIV to columns in where clause and DELETE_PRIV to targetTable
	5) UpdateNode: Add SELECT_PRIV to columns in where clause and UPDATE_PRIV to columns in SET clause.
	   There is a problem with this scheme for UpdateNode. While it correctly checks permissions for
	   UPDATE T set a=2 where b=5 by checking for SELECT_PRIV on b and UPDATE_PRIV on a, current code
	   incorrectly expects UPDATE_PRIV on c for UPDATE T set a=c where b=5. This can be resolved by
	   binding on the left and right sides separately, with different default privilege.
	6) Change DMLStatementNode to add schema owner check in getSchemaDescriptor().
	7) FkConstraintDefinitionNode: Set REFERENCES_PRIV as the privType on list of columns specified.
	8) InsertNode: Add SELECT_PRIV to columns in expressions and INSERT_PRIV for targetTable
	9) CompilerContextImpl: Add another List to track schema ownership privilege checks. Would this only have
	   one entry at most?

Dictionary changes
------------------

Phase I already added StatementTablePermission, StatementColumnPermission and StatementRoutinePermission access
descriptors. To check that only a schema owner can issue DDLs in their schema, another access descriptor has been
added, StatementSchemaDescriptor.

Conn package changes
--------------------

Change GenericAuthorizer.authorize() to perform runtime privilege checks right after current legacy checks for READ_ONLY
or FULLUSER.

Execute phase changes
---------------------

Changed GenericResultSetFactory to pass activation when invoking Authorizer.authorize().
Pass access descriptors needed to check for privileges to execute phase.

Other changes
-------------

sqlgrammar.jj: Change grantee to be an authorization identifier (sql-identifier)

DDLStatementNode: Add new method getSchemaDescriptor(ownerCheck)

Some metadata changes. Need testing.

Test changes
------------

1) Moved current test grantRevoke.sql to grantRevokeDDL.sql. I intend to keep this test primarily for testing DDLs. Added
some more tests here, including some DML statements too.
2) Added new multi-user grantRevoke.java test to test DML statements. As the test grants/revokes privileges, it verifies
behavior by invoking metadata, check against system tables and by issuing a DML statement that is expected to raise error.
Plan to add more tests here, as additional privileges are implemented.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r380892 | kmarsden | 2006-02-24 19:57:51 -0800 (Fri, 24 Feb 2006) | 40 lines

patch 4 toward resolving DERBY-210 Network Server will leak prepared statements if not explicitly closed by the user until the connection is closed

Contributed by Deepa Remesh

Changes the finalizer method in Statement and PreparedStatement to not send commits or CLSQRY to the server


n PreparedStatement class, the finalizer was calling closeX method, which was doing:
    * Call super.closeX() ---> Statement.closeX()
    * Cleanup parameter objects - parameterMetaData_, sql_, parameters_ array
    * Remove the PreparedStatement from connection_.CommitAndRollbackListeners_ list

   Changes done by patch:
    * Add a new method markClosed() which will free client-side resources.
    * The new method is named markClosed() to keep it uniform with naming convention in superclass.
    * This method is called from close() and finalize() methods.
    * markClosed() method will call super.markClosed() to perform cleanup of parent class. It will cleanup the objects specific to PreparedStatement, which are ParameterMetaData and parameters. It also removes the PreparedStatement form the list in Connection object.
    
2. In Statement class, the finalizer was calling closeX method, which was doing:
    * Close any open cursors for this statement on the server.
           - If result set is open on server, send CLSQRY to the server.
           - check if autocommit is required when closing result sets and flow a commit to server, if required
    * Call Statement.markClosed(), which does
             - Mark close the result sets on the client
             - If cursor name was set on the statement, remove it from Connection.clientCursorNameCache_
             - Call markClosed() on prepared statements for auto generated keys
             - Call markClosedOnServer(), which frees up the section. The freed section will be re-used by new statements.
    * Remove the Statement from Connection.openStatements_ list
    * Cleanup ResultSetMetaData

    Changes done by patch:
        * Move the cleanup of ResultSetMetaData and remove of Statement from Connection.openStatements_ list into markClosed() method. This will keep all client-side cleanup in markClosed().
        * Change the finalizer to just call markClosed(). This method frees up client-side resources and operates on synchronized collections. So I have removed the synchronize block from the finalizer.
     * The autocommit logic does not exist in the finalizer since only markClosed() is called from finalizer. This will avoid untimely commits which was causing the regression in the test lang/updatableResultSet.java 

-This line, and those below, will be ignored--

M    java/client/org/apache/derby/client/am/Statement.java
M    java/client/org/apache/derby/client/am/PreparedStatement.java

------------------------------------------------------------------------
r380722 | bpendleton | 2006-02-24 09:25:26 -0800 (Fri, 24 Feb 2006) | 17 lines

DERBY-515 Network Server should log server start and shutdown time to derby.log

Patch contributed by Deepa Remesh.

Summary of patch:

* Removes identical master files in DerbyNetClient and DerbyNet for
derbynet/NSinSameJVM.java and moves it the top master directory.

* Modified tools/release/build.xml to point to the new master file.

* Adds comments as to why CheapDateFormatter and GMT is used to format
timestamp. Moves formatting of timestamp to a method getFormattedTimestamp().
This will be helpful if timestamp is planned to be used for more messages
as Kathey indicated. 


------------------------------------------------------------------------
r380672 | kmarsden | 2006-02-24 06:09:11 -0800 (Fri, 24 Feb 2006) | 6 lines

DERBY-435 continuing work to get checkDataSource running with client
disabled test cases for DERBY-1025, DERBY-1044, and DERBY-1047
added workaround for DERBY-1036 to give statements different cursor names



------------------------------------------------------------------------
r380288 | djd | 2006-02-23 16:52:39 -0800 (Thu, 23 Feb 2006) | 3 lines

DERBY-434 Enable jdbcapi/XATest.java to be run under client. Several bugs exist and
are noted in the test or its output. All of these bugs are entered in Jira.

------------------------------------------------------------------------
r380287 | fuzzylogic | 2006-02-23 16:51:26 -0800 (Thu, 23 Feb 2006) | 4 lines

DERBY-417: Remove hardcoded references to encryption providers in Beetle6038 and
let Derby choose the correct encryption provider. This allows the test to pass
on Mac OS X and any other JVM where the vendor is not Sun or IBM.

------------------------------------------------------------------------
r380282 | djd | 2006-02-23 16:30:33 -0800 (Thu, 23 Feb 2006) | 7 lines

DERBY-1024 Remove the XA constants in XAResource that were duplicates of standard
constants from XAException and XAResource. Removed the code that translated (incorrectly)
an XA return value from one constant to another (with the same value in most cases).
Thus fixing 1024 where the incorrect XA code was being thrown, this was because the
unneded conversion code was incomplete.


------------------------------------------------------------------------
r380278 | djd | 2006-02-23 16:14:16 -0800 (Thu, 23 Feb 2006) | 6 lines

DERBY-966 DERBY-1005 1) Change DRDAStatement to use the EngineConnection.prepareStatement() method that has a holdability parameter. This ensures prepares on a connection that was obtained from a XADataSource (or a ConnectionPoolDataSource) do not lose the holdability requested by the application.

2) Change the client's state of holdability to match the embedded in that a Connection's holdability is set to close cursors on commit when it has an active global XA transaction.

Patch addresses this issue completely.

------------------------------------------------------------------------
r380259 | fuzzylogic | 2006-02-23 14:49:20 -0800 (Thu, 23 Feb 2006) | 2 lines

Fix dyslexic repackaging of run.class. Also fix build instructions for Mac OS X.

------------------------------------------------------------------------
r380187 | rhillegas | 2006-02-23 10:22:35 -0800 (Thu, 23 Feb 2006) | 1 line

Narayanan's patch for DERBY-796: 1) implements JDBC4 LOB extensions, 2) refactors logic for creating JDBC4-specific implementations.
------------------------------------------------------------------------
r380112 | bandaram | 2006-02-23 05:19:19 -0800 (Thu, 23 Feb 2006) | 6 lines

Add support for 
    1) Creating schemas with AUTHORIZATION option. Still need to enforce permission checks.
    2) Upgrade support for grant & revoke. Tested full upgrade from 10.0 to 10.2 and 10.1 to 10.2.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r380099 | tmnk | 2006-02-23 03:49:23 -0800 (Thu, 23 Feb 2006) | 1 line

- DERBY-273_2 The derbynet/dataSourcePermissions_net.java test fails intermittently - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r380071 | kahatlen | 2006-02-23 01:02:54 -0800 (Thu, 23 Feb 2006) | 2 lines

Fixed build failure caused by check-in of DERBY-1019.

------------------------------------------------------------------------
r380020 | kmarsden | 2006-02-22 17:48:07 -0800 (Wed, 22 Feb 2006) | 3 lines

Disable tests for setting isolation with an SQL statement for client until DERBY-1035 is fixed


------------------------------------------------------------------------
r380003 | bandaram | 2006-02-22 16:24:52 -0800 (Wed, 22 Feb 2006) | 4 lines

Update two master files to reflect new output.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r379996 | fuzzylogic | 2006-02-22 16:07:48 -0800 (Wed, 22 Feb 2006) | 4 lines

Update master file for resultsetJdbc30.java on j9_foundation.

Committed for Rajesh Kartha <kartha02@gmail.com>

------------------------------------------------------------------------
r379993 | kmarsden | 2006-02-22 15:57:30 -0800 (Wed, 22 Feb 2006) | 7 lines

DERBY-1010 - setTransactionIsolation can cause ava.sql.SQLException: Invalid operation: statement closed in some contexts with xa

Client has a Statement object that it reuses to send SET CURRENT ISOLATION commands to the server.  Added a check to make sure this statement was not closed before trying to reuse it.

This change takes the checkDataSource test a bit further (DERBY-435) but there seem to be issues with isolation being set correctly with xa_join.  I will investigate that and file a Jira issue


------------------------------------------------------------------------
r379989 | djd | 2006-02-22 15:48:42 -0800 (Wed, 22 Feb 2006) | 2 lines

DEBRY-434 XATest changes to get closer to running it with client.

------------------------------------------------------------------------
r379939 | fuzzylogic | 2006-02-22 14:04:14 -0800 (Wed, 22 Feb 2006) | 3 lines

DERBY-1019: Add Main-Class to derbytools.jar to allow running the tools with
java -jar.

------------------------------------------------------------------------
r379927 | rhillegas | 2006-02-22 13:48:29 -0800 (Wed, 22 Feb 2006) | 1 line

Correct the build instructions for jdk 1.6: you only need to set jdk16 (not jdk16.java also) in your ant.properties.
------------------------------------------------------------------------
r379848 | fuzzylogic | 2006-02-22 11:18:59 -0800 (Wed, 22 Feb 2006) | 2 lines

DERBY-683: Remove duplicate lines from encodingTests files

------------------------------------------------------------------------
r379733 | bernt | 2006-02-22 01:18:21 -0800 (Wed, 22 Feb 2006) | 3 lines

DERBY-800 derbylang/ConcurrentImplicitCreateSchema.java fails intermittently with a lock timeout
Submitted by ?\195?\152ystein Gr?\195?\184vlen

------------------------------------------------------------------------
r379723 | fuzzylogic | 2006-02-21 23:50:51 -0800 (Tue, 21 Feb 2006) | 10 lines

DERBY-683: Commit _tstpatch3_ by Myrna. Adds derbyTesting.encoding property to
harness. Excludes encodingTests from all JDKs except Sun JDK 1.5. Further
investigation is required to understand why this is necessary. The changes
introduced in this patch (specifically, setting -Dfile.encoding on the command-
line of the spawned JVM) should not cause NoClassDefFoundErrors on JDK 1.4.2,
but they do.

Committed for Deepa Remesh <dremesh@gmail.com> and 
Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r379721 | fuzzylogic | 2006-02-21 23:45:57 -0800 (Tue, 21 Feb 2006) | 3 lines

Exclude *.rej from the javadoc build to prevent rejected patch hunks from
interefering with the build.

------------------------------------------------------------------------
r379719 | fuzzylogic | 2006-02-21 23:37:18 -0800 (Tue, 21 Feb 2006) | 2 lines

Build fix for gump. Add shared package to list of dependencies for gump_split_1

------------------------------------------------------------------------
r379652 | bandaram | 2006-02-21 18:34:09 -0800 (Tue, 21 Feb 2006) | 4 lines

Submit updated grantRevoke.out master file.

Submitted by Satheesh bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r379651 | bandaram | 2006-02-21 18:29:58 -0800 (Tue, 21 Feb 2006) | 4 lines

Submit master update for syscat.out

Submitted by Satheesh bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r379643 | fuzzylogic | 2006-02-21 16:57:01 -0800 (Tue, 21 Feb 2006) | 5 lines

DERBY-903: Followup patch to remove use of String(byte[]) in two tests and
print an error message instead.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r379634 | rhillegas | 2006-02-21 16:19:39 -0800 (Tue, 21 Feb 2006) | 1 line

Anurag's fix to bug 1013: Make JDBC4 tests check for SQLState rather than variable text when catching exceptions from stubbed-out methods.
------------------------------------------------------------------------
r379620 | mikem | 2006-02-21 15:16:20 -0800 (Tue, 21 Feb 2006) | 17 lines

DERBY-304 submitted on behalf of Suresh Thalamati
Fix :

1) Do not allow backup path to be any derby database directory. A directory is
assumed to be a derby database directory if it has service.properties file in it.

2) copy files needed from the database home into the backup one by one
instead of recursive copy from the top directory.

3) while copying the directories under jar directory, copy each sub directory
separately without copying any subdirectories under them (There should not
be any unless if user has created explicitly or created backup at that location).

4) Log and Seg0 directory are NOT already copied recursively, this was changed as part of
online backup work (DERBY-239). 


------------------------------------------------------------------------
r379609 | djd | 2006-02-21 14:43:21 -0800 (Tue, 21 Feb 2006) | 4 lines

DERBY-1015 Use the EngineConnection class to call setDRDAId, set/getPrepareIsolation from
the network server on an embedded connction. Removes the requirement for specialized methods
in XADatasource.

------------------------------------------------------------------------
r379571 | djd | 2006-02-21 12:09:49 -0800 (Tue, 21 Feb 2006) | 2 lines

Add package.html file for org.apache.derby.shared.common.reference package.

------------------------------------------------------------------------
r379567 | djd | 2006-02-21 12:06:08 -0800 (Tue, 21 Feb 2006) | 5 lines

DERBY-1015 (partial) Modify the network server to hold the embedded Connection
object as a EngineConnection reference instead of a vanilla Connection. Does
not change the uses of the connection reference to take advantage of the consistent
api, will be done in a future patch.

------------------------------------------------------------------------
r379565 | djd | 2006-02-21 11:56:40 -0800 (Tue, 21 Feb 2006) | 3 lines

DERBY-446 Remove holdability constants from ClientBaseDataSource and instead use
the identical values in JDBC30Translation.

------------------------------------------------------------------------
r379551 | djd | 2006-02-21 10:08:53 -0800 (Tue, 21 Feb 2006) | 2 lines

DERBY-1015 (partial) Minor cleanup in the methods to obtain a connection in the network server.

------------------------------------------------------------------------
r379545 | djd | 2006-02-21 09:54:52 -0800 (Tue, 21 Feb 2006) | 7 lines

DERBY-1015 (partial) Initial code for EngineConnection. Add the EngineConnection
interface with a set of initial methods, make EmbedConnection and BrokeredConnection
implement this interface. No uses of the interface added yet. Some of the initial
methods were moved from BrokeredConnectionControl which looked like a start on the
same approach but did not address the issue of a single api for embedded and brokered
connections.

------------------------------------------------------------------------
r379536 | djd | 2006-02-21 09:12:57 -0800 (Tue, 21 Feb 2006) | 6 lines

DERBY-446 (partial) Make ClientDataSource use public setter and getter methods as standard
for its Java bean properties. Avoids security exceptions or requiring extreme security
permissions in order to create a Reference from the data source. Staged development, subsequent
commits will clean up some of the remants of the old code, by removing or moving the "propertyKey_*" fields.


------------------------------------------------------------------------
r379530 | djd | 2006-02-21 08:53:02 -0800 (Tue, 21 Feb 2006) | 2 lines

DERBY-615 Add bug number for why st_1 test is not running under the SecurityManager.

------------------------------------------------------------------------
r379265 | djd | 2006-02-20 14:45:46 -0800 (Mon, 20 Feb 2006) | 5 lines

DERBY-938 Optimize ContextManager
Use an unsynchronized collection for the manager since
it is owned by a single thread, provide optimized
access to a set of contexts with the same identifier.
Contributed by Dyre Tjeldvoll Dyre.Tjeldvoll@sun.com
------------------------------------------------------------------------
r379257 | djd | 2006-02-20 14:22:02 -0800 (Mon, 20 Feb 2006) | 4 lines

Remove some dead code in DRDAConnThread where a result set or prepared statement
reference was obtained but never used. There were no side-effects in any of the
methods called.

------------------------------------------------------------------------
r379208 | bandaram | 2006-02-20 11:34:22 -0800 (Mon, 20 Feb 2006) | 4 lines

Increase AUTHORIZATION_ID_LENGTH from 30 to 128. Note this change doesn't allow longer user names than 30 as currently enforced. This only increases catalog column size for 3 permissions tables that store authorizationID.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r379178 | djd | 2006-02-20 09:39:41 -0800 (Mon, 20 Feb 2006) | 3 lines

DERBY-1009 Ensure EmbedResultSet.getStatement() returns the BrokeredStatement object
the application used to create it, rather than the underlying physical statament.

------------------------------------------------------------------------
r379174 | djd | 2006-02-20 09:29:03 -0800 (Mon, 20 Feb 2006) | 4 lines

DERBY-467 Make DRDA implementation classes and their constructors package
protected instead of public or protected. Code is only required to be accessed
from this package. 

------------------------------------------------------------------------
r379091 | tmnk | 2006-02-20 03:20:02 -0800 (Mon, 20 Feb 2006) | 1 line

- rollback DERBY-273.patch - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r378903 | tmnk | 2006-02-19 06:37:57 -0800 (Sun, 19 Feb 2006) | 1 line

DERBY-273 The derbynet/dataSourcePermissions_net.java test fails intermittently - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r378797 | djd | 2006-02-18 15:53:27 -0800 (Sat, 18 Feb 2006) | 8 lines

DERBY-434 DERBY-1009 DERBY-435
 Remove static check methods with duplicated code in instance methods,
 have the Java procedure call the instance method for the connection checks
 on the nested connection.
 Have the checkDataSource30 procedure nested connection checks use checkDataSource30 as
 the object for the instance method, adds the holdability and savepoint tests for checkDataSource30.
 Add test of the return of ResultSet.getStatement to expose DERBY-1009.

------------------------------------------------------------------------
r378796 | djd | 2006-02-18 15:29:26 -0800 (Sat, 18 Feb 2006) | 1 line

DERBY-434 Fix build error with XATestUil.java
------------------------------------------------------------------------
r378771 | kmarsden | 2006-02-18 12:18:31 -0800 (Sat, 18 Feb 2006) | 11 lines

DERBY-435 patch 3 continuing work to bring checkDataSource into client testing
This patch disables some instances of setTransactionIsolation for client because it causes a statement closed exception in some contexts.
This bug makes it hard to analyse the isolation testing in this test with client.


Also exposes a bug that client returns an invalid connection for Statement.getConnection for connections obtained from a connection pool datasource.
 

No change to the embedded tests and not yet enabled for client.


------------------------------------------------------------------------
r378758 | djd | 2006-02-18 11:06:53 -0800 (Sat, 18 Feb 2006) | 2 lines

DERBY-434 Disable XATest for JDK 1.3 as it requires JDBC 3.0

------------------------------------------------------------------------
r378755 | djd | 2006-02-18 10:36:02 -0800 (Sat, 18 Feb 2006) | 6 lines

DERBY-434 Add a new initial version XATest.java that will work with the
embedded and client XA data sources. Contains test cases taken from the
xaSimplePositve,sql, xaStateTran.sql and all of xaMorph.sql. Future work
includes getting it to run with client (currently some XA client bugs hold
this up) and moving the remaining test cases from the XA SQL tests into it.

------------------------------------------------------------------------
r378744 | djd | 2006-02-18 09:55:48 -0800 (Sat, 18 Feb 2006) | 7 lines

DERBY-176 DERBY-766 Modify pushing a long value in generated code to avoid
using constant pool entries if the long is within the range of a short.
Then use the I2L instruction to convert the int to a long. Also if
the long is within range of an int, then create a integer constant pool
entry and I2L to avoid using two constant pool slots.
Add some clarifying comments over the code length in complete.

------------------------------------------------------------------------
r378657 | davidvc | 2006-02-17 15:32:20 -0800 (Fri, 17 Feb 2006) | 3 lines

DERBY-840: Message internationalization for client driver.  Originally
submitted by V. Narayanan, with some changes applied by myself.

------------------------------------------------------------------------
r378613 | kmarsden | 2006-02-17 11:44:47 -0800 (Fri, 17 Feb 2006) | 14 lines

DERBY-960 Client xa prepare returns XA_OK instead of XA_RDONLY for a read only transaction

- Changed DRDAXAProtocol prepareXATransaction to return the return value of prepare in the SYNCCRD
The server was always returning XA_OK if prepare did not throw an error instead of passing the return value to the client.

For Network Client
- Changed NetXAResource() prepare to handle XA_RDONLY returned from the server. It was throwing an exception for any value returned from the server other than XA_OK.

Test was checked in by enabling checkDataSource30.java in svn  378532


Reviewed by Bryan Pendleton


------------------------------------------------------------------------
r378552 | kmarsden | 2006-02-17 07:59:55 -0800 (Fri, 17 Feb 2006) | 12 lines

DERBY-614 patch 2 - clear splitQRYTDA field for reuse of the resultset
Bryan said ..

 With my first patch to this bug, I introduced a problem in this processing; the
splitQRYDTA field was not cleared when the statement was closed. This meant that
if that splitQRYDTA field just happened to have some pending query data from the
previous statement at the point where it was re-used, the pending query data would
erroneously stick around and be returned as the first result for the new statement.

Contributed by Bryan Pendleton


------------------------------------------------------------------------
r378538 | davidvc | 2006-02-17 06:51:37 -0800 (Fri, 17 Feb 2006) | 5 lines

DERBY-983: Remove use of Util.notImplemented(), and instead have
a client-only utility class for shorthand exceptions

Contributed by Anurag Shekhar

------------------------------------------------------------------------
r378535 | davidvc | 2006-02-17 06:49:29 -0800 (Fri, 17 Feb 2006) | 3 lines

DERBY-998: SUR tests already in jdbcapi suite, which is part of
derbynetclientmats, so removed them from the runall

------------------------------------------------------------------------
r378532 | kmarsden | 2006-02-17 06:41:59 -0800 (Fri, 17 Feb 2006) | 14 lines

DERBY-435 jdbapi/checkDataSource30.java test should be changed or extended to test client DataSources
 patch 2 - checkDataSource30 holdability testing for client
 
- Enables the checkDataSource30 test for holdability tests that are currently passing.
  There appear to be several holdability bugs associated with network XA in additon to DERBY-966.

- Makes some progress toward getting checkDataSource.java to run with client, but it is not enabled yet.
  - Changed to only run connection toString tests for embedded.
  - Changed to only test SimpleDataSource for embedded
 - Changed to perform an explicit rollback of active transactions for client before performing a PooledConnection.getConnection()
  I think this is an issue with embedded that it allows a PooledConnection.getConnection() with an active transaction, instead of throwing an error if the transaction is active.



------------------------------------------------------------------------
r378388 | kmarsden | 2006-02-16 14:52:37 -0800 (Thu, 16 Feb 2006) | 18 lines

* Changes network server start and shutdown messages to include product name, version and timestamp. I changed the messages to what Kathey suggested. With the patch, messages will look like this:
Apache Derby Network Server - 10.2.0.0 alpha started and ready to accept connections on port 1527 at 2006-02-15 03:42:51.676 GMT
Apache Derby Network Server - 10.2.0.0 alpha shutdown at 2006-02-15 03:49:14.988 GMT

* Changes only English messages. The first parameter for start message is kept the same.

* Modifies NetworkServerControlImpl to pass in the additional parameters to the messages. Formatiing of timestamp is done same way as it is done for Derby boot message.

* Modifies master files.

* Since the changed master files contain version information, they are added to tools\release\build.xml so that version will get bumped at release time.


I chose GMT to keep it consistent with what is used for Derby boot message. The network server start and shutdown messages get printed along with derby boot messages in derby.log. Something like this:

Contributed by Deepa Remesh


------------------------------------------------------------------------
r378383 | djd | 2006-02-16 14:29:07 -0800 (Thu, 16 Feb 2006) | 2 lines

DERBY-176 fix javadoc error in CodeChunk from previous commit 377609

------------------------------------------------------------------------
r378337 | fuzzylogic | 2006-02-16 10:50:58 -0800 (Thu, 16 Feb 2006) | 5 lines

DERBY-903: Remove use of String(byte[]) constructors in tests. Also, fix casing
of previously committed errorCode master

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r378313 | kmarsden | 2006-02-16 09:35:12 -0800 (Thu, 16 Feb 2006) | 10 lines

DERBY-435 patch 1.  Cleanup geared toward getting checkDataSource and checkDataSo
urce30.java running for network server

- Changes the test to use the TestUtil.getDatasource methods
- Changes the names to be generic.
- organizes imports
- Adds getSimpleDataSource to TestUtil



------------------------------------------------------------------------
r378129 | fuzzylogic | 2006-02-15 16:45:16 -0800 (Wed, 15 Feb 2006) | 4 lines

DERBY-933: Skip junitTest/LangSuite tests in J2ME environment, for now.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r378109 | bandaram | 2006-02-15 14:48:08 -0800 (Wed, 15 Feb 2006) | 4 lines

DERBY-85: Address NullPointerException when creating a trigger on a table and default schema doesn't exist.

Submitted by Dyre Tjeldvoll (Dyre.Tjeldvoll@sun.com)

------------------------------------------------------------------------
r378106 | davidvc | 2006-02-15 14:24:50 -0800 (Wed, 15 Feb 2006) | 2 lines

Knut Anders as committer

------------------------------------------------------------------------
r378063 | fuzzylogic | 2006-02-15 11:08:43 -0800 (Wed, 15 Feb 2006) | 4 lines

New and updated master files for j9.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r378045 | davidvc | 2006-02-15 10:18:47 -0800 (Wed, 15 Feb 2006) | 51 lines

DERBY-918: Introduce new "junit" test type

DERBY-934: Create a set of JUnit tests for scrollable updatable cursors.  I
also added these tests to the jdbcapi and derbynetclientmats suites (except
for ConcurrencyTest, which takes too long to run currently)

DERBY-797: After calling ResultSet.relative(0) the cursor loses its position

These are all submitted together because of interdependencies.

All contributed by Andreas Kornelliusen

NOTE: This may cause test failures on the IBM JDK; I did not test it with
this JDK, nor did I exclude these tests from running on this JDK, as I 
couldn't say whether they work or not (I don't have the IBM JDK).

I did exclude running these tests on DerbyNet, because they have a hard
failure saying "null user not supported."

Ran these tests on JDK 1.4, JDK 1.3, with both embedded and network
client drivers.  Note that the SURTest.out has failures; this is because
(a) the scrollable updatable result set work is not yet finished and
(b) there are differences between network client and embedded client which
need to be resolved.

--------

DERBY-797 files:
M    java/engine/org/apache/derby/impl/sql/execute/ScrollInsensitiveResultSet.java

DERBY-918 files:
M    java/testing/org/apache/derbyTesting/functionTests/util/TestUtil.java
M    java/testing/org/apache/derbyTesting/functionTests/harness/testtypes.properties
M    java/testing/org/apache/derbyTesting/functionTests/harness/RunTest.java

DERBY-934 files:
AM   java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/ConcurrencyTest_app.properties
AM   java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/SURBaseTest.java
AM   java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/SURQueryMixTest.java
AM   java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/SURQueryMixTest_app.properties
AM   java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/ConcurrencyTest.java
AM   java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/SURDataModelSetup.java
AM   java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/SURTest.java
AM   java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/SURTest_app.properties
A    java/testing/org/apache/derbyTesting/functionTests/master/SURTest.out
A    java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/SURTest.out
M    java/testing/org/apache/derbyTesting/functionTests/suites/jdbcapi.runall
M    java/testing/org/apache/derbyTesting/functionTests/suites/derbynetclientmats.runall
M    java/testing/org/apache/derbyTesting/functionTests/suites/DerbyNet.exclude


------------------------------------------------------------------------
r377998 | bernt | 2006-02-15 04:47:40 -0800 (Wed, 15 Feb 2006) | 1 line

DERBY-557 Added a test case for DERBY-557. Submitted by Knut Anders Hatlen
------------------------------------------------------------------------
r377822 | fuzzylogic | 2006-02-14 12:37:34 -0800 (Tue, 14 Feb 2006) | 2 lines

Add XMLTypeCompiler to the jar build.

------------------------------------------------------------------------
r377807 | davidvc | 2006-02-14 11:31:24 -0800 (Tue, 14 Feb 2006) | 2 lines

DERBY-976, DERBY-978 : Fixed master output files.

------------------------------------------------------------------------
r377793 | fuzzylogic | 2006-02-14 10:13:31 -0800 (Tue, 14 Feb 2006) | 5 lines

DERBY-917: Exclude LobLimits.java from running in Network Server until DERBY-326
and DERBY-550 are fixed.

Committed for Sunitha Kambhampati <ksunithaghm@gmail.com>

------------------------------------------------------------------------
r377782 | rhillegas | 2006-02-14 09:39:16 -0800 (Tue, 14 Feb 2006) | 1 line

Canon seems to be missing from submission r377503, adding metadata methods to embedded client.
------------------------------------------------------------------------
r377609 | djd | 2006-02-13 20:20:11 -0800 (Mon, 13 Feb 2006) | 11 lines

DERBY-176 DERBY-776 Add the initial utility code and split algorithm
to split a single generated method that execeeds the java virtual
machine limit of 65535 bytes of instructions. Allows the byte-code api
caller to generate code without worrying about exceeding the limit.
The initial split algorithm is the ability to split methods
that consist of multiple independent statements, seen by the stack
depth dropping to zero after a statement.
In the largeCodeGen test this change allowed the number of parameters
in the IN list query to increase from 3,400 to 97,000. The limit hit
at 98,000 was the number of constant pool entries.

------------------------------------------------------------------------
r377555 | fuzzylogic | 2006-02-13 16:58:52 -0800 (Mon, 13 Feb 2006) | 5 lines

DERBY-943: Fix syscat.sql failure by adding permissions to policy file. Related
to DERBY-616.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r377503 | davidvc | 2006-02-13 13:47:35 -0800 (Mon, 13 Feb 2006) | 12 lines

DERBY-968: Added new metadata methods to embedded client.  This
revision returns EMPTY RESULT SETS for the new methods getFunctions()
and getFunctionParameters(). DERBY-924 and DERBY-925 have been opened
for these, and linked to this issue.

I also fixed some existing metadata calls that throw a not-implemented
exception when they should have been returning empty result sets.

I also fixed a bug in Driver40 where it did not override 
newEmbedDatabaseMetaData(), so EmbedDatabaseMetaData40 was not being
used.

------------------------------------------------------------------------
r377480 | rhillegas | 2006-02-13 12:17:47 -0800 (Mon, 13 Feb 2006) | 1 line

Fix javadoc warning in Property.java
------------------------------------------------------------------------
r377367 | bernt | 2006-02-13 04:44:07 -0800 (Mon, 13 Feb 2006) | 4 lines

DERBY-821 Client driver: Implicitly close exhausted result sets on the server.
Submitted by Knut Anders Hatlen


------------------------------------------------------------------------
r377272 | djd | 2006-02-12 15:27:04 -0800 (Sun, 12 Feb 2006) | 6 lines

DERBY-927 (partial) Load sub-sub protocol implementations (derby.subSubProtocol.*)
from implementation locations using the same mechanism as modules (derby.module.*).
This allows sub-sub protocols to utilize the environment requirement variables
derby.env.jdk.* and derby.env.classes.* to control their booting.
Move some constants into Property.java with detailed comments.

------------------------------------------------------------------------
r377240 | djd | 2006-02-12 12:44:32 -0800 (Sun, 12 Feb 2006) | 3 lines

Add an overview page to the published api javadoc and
an overview for the JDBC package.

------------------------------------------------------------------------
r377210 | djd | 2006-02-12 10:02:58 -0800 (Sun, 12 Feb 2006) | 3 lines

Change titles in engine Javadoc to Internals to better match the fact that
the javadoc is for the complete set of code.

------------------------------------------------------------------------
r377173 | tmnk | 2006-02-12 05:26:26 -0800 (Sun, 12 Feb 2006) | 1 line

- DERBY-511_2 Fix problem that output from ShutdownDatabase.java is intermittently in the different order than print method was called.  - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r377131 | tmnk | 2006-02-11 21:08:58 -0800 (Sat, 11 Feb 2006) | 1 line

- DERBY-511 Test of shutting down database when active connections alive - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r376904 | kmarsden | 2006-02-10 17:29:09 -0800 (Fri, 10 Feb 2006) | 12 lines

DERBY-210 test case checkin in preparation for DERBY-210 fix
 Attaching second patch 'derby-210-patch2.diff' which adds a test to jdbcapi suite for this issue. Patch does the following:

* Adds a test derbyStress.java to jdbcapi suite. This test is based on the repro for this patch.
* Excludes the new test from running with client driver, jcc and j9 because it gives out of memory error. Once derby-210 is resolved, this test should pass with client driver and the exclude must be removed from DerbyNetClient.exclude
* Creates 'derbyStress_app.properties' with following property 'jvmflags=-Xmx64M' to guarantee the test fails on all machines with the current client driver.

I ran jdbcapi suite with all frameworks using Sun JDK1.4.2 on Windows XP. Verified that the new test gets run with embedded and is skipped for client and jcc frameworks. Also ran the new test with j9 vms. Verified it passes with j9_foundation and is skipped for other j9s. Please take a look at this patch.

Contributed by Deepa Remesh


------------------------------------------------------------------------
r376897 | djd | 2006-02-10 16:32:16 -0800 (Fri, 10 Feb 2006) | 10 lines

DERBY-927 (partial) Remove the (unused) code path that incorrectly seemed to allow
service providers (implementations for a service, e.g. a database) and
storage factory implementations to be set from the Properties object passed
into a connection. This would be a security hole as it would allow remote
users to possibly change the implementation used to access the database,
thus changing the security environment. The code could not be exercised
as the embedded driver correctly stripped out derby.* properties from
the JDBC attributes passed in with a connection request.


------------------------------------------------------------------------
r376882 | djd | 2006-02-10 14:33:56 -0800 (Fri, 10 Feb 2006) | 11 lines

DERBY-766 (partial) Add code to the byte code compiler to enable it to
analyze a block of existing generated byte code. Provide utility methods to allow
other methods to be written to walk the byte code. Add an method to find the maximum
stack depth of a piece of java code. 
Add sanity checks to double check the data used (OPCODE_ACTION) to walk the byte code
and compare the calculated max stack depth with the existing generated value.
This is progress towards providing the ability to split generated methods that exceed
the JVM's limit into a number of smaller methods. This will replace the existing mechanisms
which are reactive, non-optimal and only work in a limited number of situations.


------------------------------------------------------------------------
r376874 | kmarsden | 2006-02-10 14:00:11 -0800 (Fri, 10 Feb 2006) | 8 lines

DERBY-210 cleanup patch in preparation for change
Attaching a patch 'derby-210-patch1.diff' which removes the list 'RollbackOnlyListeners_' from org.apache.derby.client.am.Connection class since this is not being used. This is an incremental patch and does not solve the issue fully.

While working on this issue, I found one of the causes of memory leaks is object references stored in the lists in the Connection class. On looking at the lists, I found that 'RollbackOnlyListeners' is not being used anywhere in the client code. Submitting this patch to remove this. 

Contributed by Deepa Remesh


------------------------------------------------------------------------
r376804 | kmarsden | 2006-02-10 11:22:37 -0800 (Fri, 10 Feb 2006) | 12 lines

DERBY-907 regression test failure in RecoveryAfterBackup on wssd5.6 ibm jvm (j2me)

* Modifies app_properties files to add ij.dataSource properties. Also changed 'database' to 'ij.database' property. Removed usedefaults to avoid conflict with default property.
* Adds a method getConnection to TestUtil to get connection using different set of attributes than what is specified in _app.properties file.
* Changes the test store/RecoveryAfterBackup to use the above method to shutdown and get connection. I'll change other tests to use the new method in a later patch.

With the patch, I ran the RecoveryAfterBackup tests with Sun JDK1.4.2, j9 and j9 foundation vm. 

Contributed by Deepa Remesh



------------------------------------------------------------------------
r376801 | bernt | 2006-02-10 11:17:11 -0800 (Fri, 10 Feb 2006) | 1 line

DERBY-100 Small extra fix by Fernanda Pizzorno
------------------------------------------------------------------------
r376798 | mikem | 2006-02-10 11:10:57 -0800 (Fri, 10 Feb 2006) | 3 lines

javadoc fix.


------------------------------------------------------------------------
r376777 | bandaram | 2006-02-10 10:07:18 -0800 (Fri, 10 Feb 2006) | 4 lines

DERBY-635: Get exception message from PrivilegedActionException after getting real exception.

Submitted by John C Landers (jcl@pc-intouch.com)

------------------------------------------------------------------------
r376770 | davidvc | 2006-02-10 09:14:14 -0800 (Fri, 10 Feb 2006) | 2 lines

DERBY-840: Fixed bug where I skipped build of jdbc4 tests

------------------------------------------------------------------------
r376502 | mikem | 2006-02-09 16:12:00 -0800 (Thu, 09 Feb 2006) | 7 lines

DERBY-888

Add specific errors for failure while doing initpage redo recovery attempt.
Remove "loadTran" references, that term isn't really useful to current code.
All cases now apply to redo recovery.


------------------------------------------------------------------------
r376372 | bandaram | 2006-02-09 10:22:07 -0800 (Thu, 09 Feb 2006) | 4 lines

DERBY-541: Do not apply soft upgrade changes if database is readOnly.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r376371 | bandaram | 2006-02-09 10:18:12 -0800 (Thu, 09 Feb 2006) | 4 lines

Update master file, following previous checkin for dblook usage change.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r376296 | kmarsden | 2006-02-09 06:02:18 -0800 (Thu, 09 Feb 2006) | 7 lines

DERBY-898 setAutoCommit(false) is not working properly with connections objtained with ClientXADataSource.

- Changes server side connection for network server XA to autocommit false. Even when the client has autocommit on, the server side connection should be autocommit false and let the client drive the commits.

- Adds connections obtained from an XADataSource to the savepointJdbc30_XA test to verify that autocommit is being set properly and also verify that DERBY-899 (a dup of this issue) is fixed.


------------------------------------------------------------------------
r376142 | bandaram | 2006-02-08 17:20:41 -0800 (Wed, 08 Feb 2006) | 4 lines

Use Derby client URL in dblook usage message, rather than JCC driver's URL.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r376034 | djd | 2006-02-08 11:43:18 -0800 (Wed, 08 Feb 2006) | 3 lines

DERBY-927 (partial) Clarify purpose of stripping derby.* properties from
the set of JDBC attributes passed into a connection request.

------------------------------------------------------------------------
r376016 | kmarsden | 2006-02-08 10:08:31 -0800 (Wed, 08 Feb 2006) | 3 lines

Reaname savepointJdbc30 to savepointJdbc30_JSR169 in preparation for additional test for XA connections with DERBY-898


------------------------------------------------------------------------
r376008 | davidvc | 2006-02-08 09:52:14 -0800 (Wed, 08 Feb 2006) | 3 lines

DERBY-932 - removed need for jdk16.java variable, and fixed ordering
of section 2.2 in BUILDING.txt in response to Dan's comment

------------------------------------------------------------------------
r375975 | djd | 2006-02-08 06:52:43 -0800 (Wed, 08 Feb 2006) | 2 lines

DERBY-927 Fix jar build broken by previous commit.

------------------------------------------------------------------------
r375877 | bandaram | 2006-02-07 23:10:47 -0800 (Tue, 07 Feb 2006) | 5 lines

DERBY-628: Allow setting a CLOB to NULL using any character types for setNull.

Submitted by Satheesh Bandaram(satheesh@sourcery.org)


------------------------------------------------------------------------
r375845 | fuzzylogic | 2006-02-07 20:18:57 -0800 (Tue, 07 Feb 2006) | 2 lines

Swap the use of Math.ceil and Math.floor to round the result percentages.

------------------------------------------------------------------------
r375829 | fuzzylogic | 2006-02-07 18:52:19 -0800 (Tue, 07 Feb 2006) | 3 lines

Use a relative path for the link reference. This prevents errors on Windows
that the link reference is an invalid URL.

------------------------------------------------------------------------
r375818 | mikem | 2006-02-07 16:59:25 -0800 (Tue, 07 Feb 2006) | 7 lines

DERBY-861

issue is that  just prior to this query the test deletes and commits some rows.  In one phase of this locking test
the table is configured to have one row per page.  In this case as soon as the delete commits, the post commit background
thread can be scheduled to reclaim the deleted rows.  This scheduling is completely at the discretion of a number of factors including: OS/JVM/processor availbility .  To get reproducible results for this query I added a wait after the delete.


------------------------------------------------------------------------
r375816 | djd | 2006-02-07 16:48:36 -0800 (Tue, 07 Feb 2006) | 5 lines

DERBY-927 (partial) Rename PersistentServiceImpl to StorageFactoryService to correctly
represent its purpose. Remove the partial ReadOnly implementation of PersistentService
as it is never used. It's functionality migrated into StorageFactoryService as read-only
StorageFactorys when the StorageFactory api was implemented.

------------------------------------------------------------------------
r375815 | fuzzylogic | 2006-02-07 16:42:41 -0800 (Tue, 07 Feb 2006) | 3 lines

DERBY-875: Use nested filesets to improve javadoc generation. This patch moves
the publishedapi javadoc set to using nested filesets.

------------------------------------------------------------------------
r375810 | fuzzylogic | 2006-02-07 16:33:48 -0800 (Tue, 07 Feb 2006) | 4 lines

DERBY-875: Use nested filesets to improve Javadoc generation.

Original patch contributed by Bryan Pendleton <bpendleton@amberpoint.com>

------------------------------------------------------------------------
r375801 | davidvc | 2006-02-07 16:28:07 -0800 (Tue, 07 Feb 2006) | 2 lines

DERBY-933: Fix output of Stream.java for JDK 1.3

------------------------------------------------------------------------
r375784 | djd | 2006-02-07 16:04:11 -0800 (Tue, 07 Feb 2006) | 3 lines

Cleanup LogChecksum tests to put derby.subSubProtocol properties in the test_derby.properties
file and not the _app properties file.

------------------------------------------------------------------------
r375777 | davidvc | 2006-02-07 15:46:07 -0800 (Tue, 07 Feb 2006) | 6 lines

DERBY-932 - Fixed the way JDK 1.6 files are built so we don't use <exec>
but <javac> with fork="yes".  

Also updated BUILDING.txt to include instructions on how to build with
JDK 1.6

------------------------------------------------------------------------
r375775 | mikem | 2006-02-07 15:33:16 -0800 (Tue, 07 Feb 2006) | 19 lines

DERBY-750, committed on behalf of Suresh Thalamati

 Problem was backup was trying to a read a pages from a container before the first
 allocation page for it is created with a invalid page number. First allocation page
 number is invalid only when first page is not created.

 The reason backup sees containers in that state, backup finds the containers to
 backup by scanning through the seg0 list files and gets access to the container
 conglomerate cache, cache returns the handles after the container file is
 created.

 Fix is NOT to backup containers whose first allocation page not yet created. It is
 safe to not backup containers in such case instead of waiting for container
 creation to complete, redo of the log on restore will create them.

 Renabled the test case that hit this problem in OnlineBackupTest1.java , which was commented
 earlier. 


------------------------------------------------------------------------
r375717 | mikem | 2006-02-07 13:25:43 -0800 (Tue, 07 Feb 2006) | 5 lines

DERBY-885, committing on behalf of: Deepa Remesh

Ataching a patch 'derby-885.diff' which adds new j9 masters for nist/dml160.sql test. With this patch, I ran nist suite with j9 vms and Sun JDK 1.4.2.


------------------------------------------------------------------------
r375715 | davidvc | 2006-02-07 13:18:08 -0800 (Tue, 07 Feb 2006) | 3 lines

DERBY-387: Fix Simple Network Client sample to work correctly by fixing
database name.  Contributed by Rajesh Kartha

------------------------------------------------------------------------
r375698 | fuzzylogic | 2006-02-07 12:52:25 -0800 (Tue, 07 Feb 2006) | 4 lines

DERBY-817: Improvements to remote host testing

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r375635 | bernt | 2006-02-07 08:09:10 -0800 (Tue, 07 Feb 2006) | 1 line

DERBY-100 Add support for insert functionality using BC 2.0 updatable resultset apis. Submitted by Fernanda Pizzorno
------------------------------------------------------------------------
r375583 | mikem | 2006-02-07 04:07:14 -0800 (Tue, 07 Feb 2006) | 9 lines

DERBY-888
initial partial checkin of allocation improvement.  This checkin changes
the default of the system to not sync on allocation.  All tests pass, 
and hand testing of allocation encountering bad pages during redo worked.
Also adds back in development only path to be able to turn on and off
various sync options under an insane build, to compare affect of log sync,
vs. allocation sync, vs. checkpoint sync.


------------------------------------------------------------------------
r375312 | rhillegas | 2006-02-06 09:00:36 -0800 (Mon, 06 Feb 2006) | 1 line

Add public key for Rick Hillegas
------------------------------------------------------------------------
r374809 | davidvc | 2006-02-03 17:28:14 -0800 (Fri, 03 Feb 2006) | 6 lines

DERBY-922: Fix chaining of exceptions so the underlying client
SqlException/SqlWarning context is maintained and is available
for debugging.  

derbynetclientmats passes on JDK 1.4

------------------------------------------------------------------------
r374785 | djd | 2006-02-03 15:35:12 -0800 (Fri, 03 Feb 2006) | 2 lines

DERBY-921 Missing file from last commit for this bug.

------------------------------------------------------------------------
r374778 | djd | 2006-02-03 15:12:08 -0800 (Fri, 03 Feb 2006) | 12 lines

DERBY-921 Support 32bit branch offsets for conditional logic in generated code.
Rewrite IF instructions to use a GOTO_W instruction when the branch offset is
greater than the 32767 allowed by the IF instructions. Replace GOTO instructions
with GOTO_W instruction when the branch offset is greater than the 32767.
Full details are in the Conditional.java file.

Write all instructions logically through CodeChunk methods containing the
code byte array knowledge within the CodeChunk class. Replaces the previous
direct modification of the code byte array by the Conditional class.

Increases number of logical operators to 800 for the test query in large code gen.

------------------------------------------------------------------------
r374726 | davidvc | 2006-02-03 10:56:03 -0800 (Fri, 03 Feb 2006) | 4 lines

DERBY-906, DERBY-905, DERBY-904.  Fixed output files so that the
tests work on jdk14 as well as jdk13.  


------------------------------------------------------------------------
r374713 | rhillegas | 2006-02-03 09:36:04 -0800 (Fri, 03 Feb 2006) | 1 line

Scrub javadoc error in SystemProcedures.java
------------------------------------------------------------------------
r374696 | djd | 2006-02-03 07:52:26 -0800 (Fri, 03 Feb 2006) | 4 lines

DERBY-856 modify EmbedPreparedStatement.setCharacterStreamInternal to take a long
for the length, and perform the > max int check in the method.

Contributed by V.Narayanan <V.Narayanan@Sun.COM>
------------------------------------------------------------------------
r374683 | djd | 2006-02-03 07:14:07 -0800 (Fri, 03 Feb 2006) | 2 lines

DERBY-891 Change db2j and csinfo properties to have consistent derbyTesting prefix.
Contributed by Myrna van Lunteren <m.v.lunteren@gmail.com>
------------------------------------------------------------------------
r374585 | kmarsden | 2006-02-02 21:24:45 -0800 (Thu, 02 Feb 2006) | 3 lines

DERBY-877 second patch to fix javadoc warnings


------------------------------------------------------------------------
r374553 | rhillegas | 2006-02-02 16:51:15 -0800 (Thu, 02 Feb 2006) | 1 line

Test drive commit privilege
------------------------------------------------------------------------
r374550 | davidvc | 2006-02-02 16:40:55 -0800 (Thu, 02 Feb 2006) | 5 lines

DERBY-905 - Added jdk13-specific output file because now in JDK 1.3 we
include the causing exception's class and message text as part of the
overall exception message text (since jdk13 does not support exception
chaining)

------------------------------------------------------------------------
r374548 | davidvc | 2006-02-02 16:22:50 -0800 (Thu, 02 Feb 2006) | 4 lines

DERBY-906: Fixed output to reflect that in jdk13 we are now appending
the causing exception class and message since jdk13 doesn't support
exception chaining

------------------------------------------------------------------------
r374543 | davidvc | 2006-02-02 15:44:46 -0800 (Thu, 02 Feb 2006) | 3 lines

DERBY-904: Fixed master output for jdk13 tests to represent new exception
output, now that we include the exception cause in the message text.

------------------------------------------------------------------------
r374471 | djd | 2006-02-02 11:34:54 -0800 (Thu, 02 Feb 2006) | 3 lines

DERBY-475 DEBRY-592 Expand the builtin function table to handle zero parameter
functions and add the functions PI and LOG10 as builting and JDBC escaped functions.

------------------------------------------------------------------------
r374469 | kmarsden | 2006-02-02 11:32:16 -0800 (Thu, 02 Feb 2006) | 5 lines

DERBY-683 Use correct encoding for ClobOutputStream on client

Change to use US-ASCII instead of jvm default encoding


------------------------------------------------------------------------
r374432 | kmarsden | 2006-02-02 08:45:27 -0800 (Thu, 02 Feb 2006) | 5 lines

DERBY-398 remove a few more j9 masters  missing from last commit

Contributed by Deepa Remesh


------------------------------------------------------------------------
r374282 | kmarsden | 2006-02-01 22:20:27 -0800 (Wed, 01 Feb 2006) | 10 lines

DERBY-398   J2ME Testing
 
* Removes four j9_foundation masters. Instead of printing the url returned by call to DatabaseMetaData.getURL, the tests now compare the output and print pass/fail to the master.
* Added a method compareURL to TestUtil which compares with expected URL based on framework.
* Modified master file for LOBTest
* Modified properties files for network server suites to add runwithfoundation=false. Unlike test properties, they only had runwithj9=false.

Contributed by Deepa Remesh 


------------------------------------------------------------------------
r374271 | kmarsden | 2006-02-01 21:41:12 -0800 (Wed, 01 Feb 2006) | 12 lines

DERBY-877 zOS - with DerbyClient getDate(#) fails with IllegalArgumentException - unsupported date format - resultset.java

The patch fixes issues with getString, getTimeStamp, getDate and getTime on TIMESTAMP, DATE and TIME columns when the client JVM encoding does not match the server encoding for the characters being evaluated in DateTime.java methods

- Changes the following methods in DateTime.java to take encoding parameter and create string based on encoding.
dateBytesToDate, timeBytesToTime, timeBytesToTimeStamp, dateBytesToTimeStamp, timestampBytesToDate, timestampBytesToTime

- Changes calling code to pass column encoding and throw SQLExceptions for UnsupportedEncoding exceptions if thrown from the methods above.

Tests: derbyall passed as did the repro attached to this issue on Windows with Sun JDK 1.5 . Verified on zOS


------------------------------------------------------------------------
r374203 | davidvc | 2006-02-01 15:30:33 -0800 (Wed, 01 Feb 2006) | 3 lines

DERBY-841: Internationalize message text from GetResourceBundleAction
to ParameterMetadata in org.apache.derby.client.am

------------------------------------------------------------------------
r374198 | davidvc | 2006-02-01 14:46:09 -0800 (Wed, 01 Feb 2006) | 3 lines

DERBY-862: Fix javadoc errors in JDK 1.6 build.  Submitted by Rick
Hillegas

------------------------------------------------------------------------
r374146 | davidvc | 2006-02-01 11:21:27 -0800 (Wed, 01 Feb 2006) | 4 lines

DERBY-874 : Contributed by Rick Hillegas.  Adds comments to DerbyJUnitTest,
explaining usage and why in some cases exceptions are swallowed


------------------------------------------------------------------------
r374144 | djd | 2006-02-01 10:59:57 -0800 (Wed, 01 Feb 2006) | 3 lines

DERBY-680 (partial) Commit part of patch related to modifying ejbql test as it is
separate from the the issue of changing ij.

------------------------------------------------------------------------
r374085 | djd | 2006-02-01 07:21:15 -0800 (Wed, 01 Feb 2006) | 5 lines

Cleanup of CallStatementNode.java, since CALL statements are simple, taking
only parameters or constants as arguments, the node cna be simplified not
to create and handle lists for subqueries and aggregates that will always be empty.
Improved some of the comments in the file.

------------------------------------------------------------------------
r374029 | bernt | 2006-02-01 01:37:45 -0800 (Wed, 01 Feb 2006) | 1 line

DERBY-815 Patch 371897 revrted
------------------------------------------------------------------------
r374009 | fuzzylogic | 2006-01-31 23:10:07 -0800 (Tue, 31 Jan 2006) | 2 lines

Edits to maven project files after deploying 10.1.2.1 to maven repo.

------------------------------------------------------------------------
r373948 | djd | 2006-01-31 16:06:34 -0800 (Tue, 31 Jan 2006) | 4 lines

DERBY-592 Provide a mechanism to map JDBC escape functions directly onto
builtin functions in the SYSFUN schema. Escape functions added are:
ACOS, ASIN, ATAN, COS, SIN, TAN, DEGREES, RADIANS, EXP, LOG, CEILING, FLOOR

------------------------------------------------------------------------
r373752 | mikem | 2006-01-30 23:56:39 -0800 (Mon, 30 Jan 2006) | 3 lines

a few javadoc fixes.


------------------------------------------------------------------------
r373644 | kmarsden | 2006-01-30 16:21:59 -0800 (Mon, 30 Jan 2006) | 5 lines

Add largeCodeGen test to largeData suite

Since there are known failures in the test, exception traces are 
suppressed by default to avoid diffs between runs, jvms etc.

------------------------------------------------------------------------
r373606 | davidvc | 2006-01-30 14:07:38 -0800 (Mon, 30 Jan 2006) | 4 lines

DERBY-893: Contributed by Rick Hillegas.

This fixes the build problems in optional jdbc4 classes introduced by the SQLException rototill.

------------------------------------------------------------------------
r373580 | djd | 2006-01-30 12:29:41 -0800 (Mon, 30 Jan 2006) | 2 lines

Minor cleanup for CallStatementNode, remove unused field methodName and unused method getMethodCallNode.

------------------------------------------------------------------------
r373569 | djd | 2006-01-30 11:08:54 -0800 (Mon, 30 Jan 2006) | 5 lines

DERBY-475 Switch the new maths functions to use java.lang.StrictMath to ensure
consistent results across Java Virtual Machines. Added a natual log function
LOG which is identical to LN() but will aid DERBY-592, adding a match for 
the escaped function {fn log(value)}

------------------------------------------------------------------------
r373380 | mikem | 2006-01-29 14:51:42 -0800 (Sun, 29 Jan 2006) | 31 lines

Derby-239, onlinebackup_8.diff patch
committed on behalf of Suresh Thalamati

This patch addresses the improvements suggested by Oystein in his review of the
first online backup patch(onlinebackup_1.diff) and also resolved some more
online backup issues.

-- fixed comments and moved a duplicate code in write page and the backup of
container into a separate method.

fixes with this patch:

-- backup of container was using the same encryption buffer as container
read/writes, this requires backup of the container and read/writes are
synchronized to avoid corrupting the encryption buffer. This patch modified
the backup of container code to use it's own temporary encryption
buffer to avoid the buffer corruption.

-- added code to prevent truncation of log during checkpoint and disabling of
log archival does not delete log files that are yet to be copied
into the backup, if backup is running in parallel.

-- In-place compress is blocked during backup and vice-versa, until the
compress nested transaction commits. This change is needed because compress
does a special checkpoint to avoid redo on the truncated pages. If backup is
running in parallel, the checkpoint backup is based on can be earlier than
checkpoint done by the truncate operation. Without the blocking during
restore from backup, recovery will fail if it needs redo ant log records on
the truncated pages. 


------------------------------------------------------------------------
r373356 | mikem | 2006-01-29 12:52:34 -0800 (Sun, 29 Jan 2006) | 16 lines

DERBY-599
committing on behalf of: Sunitha Kambhampati 

Problem:
setBlob(i,blob) does not set the length of the stream in the blob and but instead passes a -1 for stream length. 
During the normalization process, setBlob.normalize(DTD,DVD) calls SQLBlob.setWith. 
The setWidth is called in order to compare the length of the blob value to the maximum width of the column and to throw a truncation error in case the value wont fit into the column.  setWidth() calls SQLBinary.getLength().  If tvalue is a stream, the getLength() method checks for streamLength value and if the streamLength value is set to -1 (ie unknown) , it calls getBytes().length() which calls getValue() and this is where the entire stream is getting materialized.  

This patch fixes DERBY-599 so using setBlob call, will not  materialize the entire blob into memory. 
- changes to setBlob to pass the length of the blob value instead of -1.  The length of the blob value passed into setBlob can be obtained by calling Blob.length() which returns a long.
- move the -ve length check from setBinaryStream to setBinaryStreamInternal since setBlob will not pass a -1 for length.
- change setBinaryStreamInternal to take the length parameter as a long instead of int.  
- Currently Derby allows max value of 2G-1 ( Max value of an int) for blobs. Add check to ensure that if a stream with a length > max value of int is passed, an error is thrown. Use an existing error message 
'The resulting value is outside the range for the data type {0}'


------------------------------------------------------------------------
r373291 | kmarsden | 2006-01-28 21:54:06 -0800 (Sat, 28 Jan 2006) | 7 lines

DERBY-395  Server-side "trace on" and "trace off" commands do not appear to be working correctly.

Contributed by Bryan Pendleton

Attached is a proposed fix. derbyall passed. I put a small comment in the code. I didn't add any new tests, which is unfortunate, but I didn't have any brilliant inside about an easy way to add such tests. Testing with the server tracing is already somewhat of a PITA because the server tracing interacts poorly with things like the security manager.


------------------------------------------------------------------------
r373067 | bandaram | 2006-01-27 18:21:18 -0800 (Fri, 27 Jan 2006) | 6 lines

DERBY-882: Set Nullability of new typeDescriptor from previous typeDescriptor following changing of varchar column length using ALTER TABLE.

Merged from 10.1 branch.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r373038 | fuzzylogic | 2006-01-27 16:15:54 -0800 (Fri, 27 Jan 2006) | 4 lines

DERBY-859: Updated test masters for IBM JDK 1.5

Committed for Manjula Kutty <manjula.kutty@gmail.com>

------------------------------------------------------------------------
r373011 | djd | 2006-01-27 14:31:45 -0800 (Fri, 27 Jan 2006) | 6 lines

DERBY-885 Disable running with the security manager for useProcess=false
for j9 vms. Causes some unexpected execption that needs to be investigated
and halts test runs. This is a workaround that will cause dml160 to fail
with j9 vms, as it checks to see a security manager is installed.
Will be investigating, but this will allow derbyall runs to complete.

------------------------------------------------------------------------
r372934 | djd | 2006-01-27 10:14:20 -0800 (Fri, 27 Jan 2006) | 4 lines

DERBY-766 Add some comments to largeCodeGen.java indicating what passes
with reference to an svn revision number. Made all the data fetching/execution switchable.
Note this is still not run as a regular test.

------------------------------------------------------------------------
r372923 | davidvc | 2006-01-27 09:21:51 -0800 (Fri, 27 Jan 2006) | 3 lines

DERBY-860: Internationalized SqlWarning and its messages.  I also fixed
the way SqlException.setNextException(), it was incorrect.  

------------------------------------------------------------------------
r372871 | bernt | 2006-01-27 07:11:55 -0800 (Fri, 27 Jan 2006) | 5 lines

DERBY-491 Protocol exception when Network Server
 tries to return ~32K of data or greater in a result set for a Java stored
 procedure.
Submitted by Bryan Pendleton

------------------------------------------------------------------------
r372708 | kmarsden | 2006-01-26 19:06:10 -0800 (Thu, 26 Jan 2006) | 12 lines

DERBY-398 enable tests for J2ME
Attaching a patch 'parameterMapping.diff' which changes the tests jdbcapi/parameterMapping.java and lang/updatableResultSet.java to run in J2ME/CDC/FP. Changes are:

* In parameterMapping.java, SQL types DECIMAL and NUMERIC are mapped to the String class in B3_GET_OBJECT for J2ME.
* When changing the tests, I have covered testing of SQL DECIMAL type. This is tested using wrapper methods in BigDecimalHandler which use get/setString methods for J2ME. I have not used the wrapper in cases where DECIMAL type is already being tested with get/set/updateXXX methods of other JDBC types.
* The tests work the same way as before in non-J2ME environments.
* In JSR169, get/setUnicodeStream methods are not present. NoSuchMethodError exception is used to handle these cases.
* New masters are needed for the tests. These are to account for absence of BigDecimal class in J2ME and methods which are not present in JSR169.

Ran both the changed tests using Sun JDK1.4.2 (all frameworks) and IBM WCTME 5.7 j9_foundation. 


------------------------------------------------------------------------
r372692 | djd | 2006-01-26 17:25:49 -0800 (Thu, 26 Jan 2006) | 4 lines

DERBY-766 Modify ResultSetFactory getXXXResultSet methods to not pass in an
Activation if it is available through a passed in source ResultSet. Reduces the
amount of code generated for queries.

------------------------------------------------------------------------
r372660 | bandaram | 2006-01-26 15:35:12 -0800 (Thu, 26 Jan 2006) | 4 lines

DERBY-783: Follow up to previous checkins for this bug. Set START value in catalog to the RESTART value specified in ALTER TABLE statement.

Submitted by Mamta Satoor (msatoor@gmail.com)

------------------------------------------------------------------------
r372368 | davidvc | 2006-01-25 16:01:37 -0800 (Wed, 25 Jan 2006) | 7 lines

DERBY-400: Fixed the SQL states for warnings so they are compliant with
SQL2003 -- can't use SQL states that are reserved for standard
SQL States.

Also refactored the two messages for JDBC2 not supported and JDBC3
not supported into a single message.

------------------------------------------------------------------------
r372263 | mikem | 2006-01-25 08:41:33 -0800 (Wed, 25 Jan 2006) | 6 lines

Fix for DERBY-665, committed on behalf of Suresh Thalamati.

Comments from submitter:
 This patch removes the unused backup functions with File as parameter, 


------------------------------------------------------------------------
r372240 | davidvc | 2006-01-25 07:25:08 -0800 (Wed, 25 Jan 2006) | 3 lines

DERBY-400: Fixed the SQLState for some of the new client messages
to better match what is required by SQL2003

------------------------------------------------------------------------
r372034 | djd | 2006-01-24 14:30:48 -0800 (Tue, 24 Jan 2006) | 2 lines

DERBY-615 Fix derbynet/NSinSameJVM when running of the classes directory.

------------------------------------------------------------------------
r371897 | bernt | 2006-01-24 03:56:16 -0800 (Tue, 24 Jan 2006) | 3 lines

DERBY-815 Prevent unneeded object creation and excessive decoding in parseSQLDTA_work()
Submitted by Dyre Tjeldvoll

------------------------------------------------------------------------
r371800 | djd | 2006-01-23 20:15:44 -0800 (Mon, 23 Jan 2006) | 3 lines

DERBY-615 Enable some tests in derbynet to run with the security manager
with derby's client and identify those others which cannot run with a security manager.

------------------------------------------------------------------------
r371762 | bandaram | 2006-01-23 17:08:40 -0800 (Mon, 23 Jan 2006) | 4 lines

DERBY-783: Follow up patch to previous checkin for this bug. Mark RESTART as a nonReservedWord.

Submitted by Mamta Satoor (msatoor@gmail.com)

------------------------------------------------------------------------
r371714 | djd | 2006-01-23 15:34:24 -0800 (Mon, 23 Jan 2006) | 2 lines

DERBY-615 Remove noSecurityManager=false and old comment for T_SortController

------------------------------------------------------------------------
r371664 | djd | 2006-01-23 12:55:15 -0800 (Mon, 23 Jan 2006) | 4 lines

DERBY-615 Enable the T_Cipher* and T_SortController tests under the SecurityManager.
Add comments (bug numbers) for why lang.dcl and jdbcapi/secureUsers1 are not runnable
under the SecurityManager.

------------------------------------------------------------------------
r371611 | mikem | 2006-01-23 10:24:23 -0800 (Mon, 23 Jan 2006) | 5 lines

changing lock timeout and lock deadlock default times to speed up the
test.  On my machine it cut the time for the st_derby715.java test to 
run in half.


------------------------------------------------------------------------
r371603 | kmarsden | 2006-01-23 09:34:23 -0800 (Mon, 23 Jan 2006) | 10 lines

DERBY-125 Network Server can send DSS greater than 32K to client, which breaks DRDA protocol.

Fixes off by one error during segment shifting.
Fixes continuation flag handling to not overwrite the length.

See changes.html attached to DERBY-125 for more info

Contributed by Bryan Pendleton


------------------------------------------------------------------------
r371561 | davidvc | 2006-01-23 07:58:34 -0800 (Mon, 23 Jan 2006) | 10 lines

DERBY-852 - Convert client.am.SqlException to no longer extend
java.sql.SQLException.

The general approach here was to have all public methods throw
SQLException, and all internal methods throw SqlException.  In
some cases internal methods call public methods, and in those cases
I wrap the thrown SQLException into a SqlException for future use.
Otherwise the chain of exception dependencies would have caused almost
all internal methods to throw SQLException

------------------------------------------------------------------------
r371506 | bernt | 2006-01-23 01:45:07 -0800 (Mon, 23 Jan 2006) | 1 line

DERBY-23 Patch (DERBY-23-npe.diff) that addresses the NullPointerException messages from rawStoreDaemon threads we. Submitted by Knut Anders Hatlen
------------------------------------------------------------------------
r370978 | bandaram | 2006-01-20 20:32:17 -0800 (Fri, 20 Jan 2006) | 9 lines

DERBY-756: Close scan controller in DistinctScalarAggregateResultSet to avoid memory leak.

Submitted by Manish Khettry (manish_khettry@yahoo.com)

Here is more info from the contributor:
It looks like the scan controller created in DistinctScalarAggregateResultSet is never closed. This causes the scanController instance variable in RAMTransaction to continue to grow with each open/close. 

Shouldn't DistinctScalarAggregateRS implement a close or a finish method (not sure what the difference is) and close the scan controller there.

------------------------------------------------------------------------
r370967 | mikem | 2006-01-20 18:43:36 -0800 (Fri, 20 Jan 2006) | 8 lines

DERBY-757

Now that this routine can be called while concurrently with XA transactions
being created and committed, checks have to be made to make sure the object
being searched for does not go null while we are looking at it.  The search
is for existing xacts, so skipping when we find a null is fine.


------------------------------------------------------------------------
r370932 | fuzzylogic | 2006-01-20 16:00:40 -0800 (Fri, 20 Jan 2006) | 4 lines

DERBY-804: Disable floattypes.sql for Sun and IBM 1.3.1

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r370886 | djd | 2006-01-20 11:21:56 -0800 (Fri, 20 Jan 2006) | 3 lines

Add some additional test cases to metadata.java test to resolve some
result set meta data nits with DECIMAL and DOUBLE types.

------------------------------------------------------------------------
r370885 | bandaram | 2006-01-20 11:14:54 -0800 (Fri, 20 Jan 2006) | 20 lines

DERBY-783: Enhance ALTER TABLE to support RESTART option to enable setting of identity column start value.

Submitted by Mamta Satoor (msatoor@gmail.com)

Here is more info from the contributor:

I have attached a review package for this feature to the JIRA entry. Following is a brief description of the changes involved.

Changed sqlgrammar.jj to add parser support for ALTER TABLE <tablename> ALTER <columnName> RESTART WITH integer-constant
Also, added another element to the array which keeps track of autoincrement information in the parser. This 4th element will record if the autoincrement column is getting added or it is getting altered for INCREMENT BY value change or it is getting altered for RESTART WITH value change. This information is required later in the compile and execute phase.

In the compile phase, this information is used to see if a user is trying to sneak in a value of 0 for INCREMENT BY. A value of 0 for INCREMENT BY should be caught at the time of autoincrement column add or at the time of autoincrement column alter to change the INCREMENT BY value. At the time of autoincrement column alter to change the RESTART WITH value,  the INCREMENT BY value should not be checked. This is done in ColumnDefinitionNode.java. TableElementList generates ColumnInfo which needs to keep track of autoincrement column change status from ColumnDefinitionNode. This infromation in ColumnInfo will be used at execute time.

In the execute phase, we need to know which columns of SYSCOLUMNS table need to be changed for an ALTER TABLE command on the autoincrement column. In the past, we only allowed to change the INCREMENT BY criteria of an autoincrement column but with this feature, it is possible for a user to change the start with value of autoincrement column and leave the INCREMENT BY unchanged. This autoincrement column change information is passed to the execute phase via ColumnInfo.

In order to provide this distinction between ALTER BY..INCREMENT BY.. and ALTER BY..RESTART WITH.., I have had to add a variable in ColumnDefinitionNode.java, ColumnInfo.java and ColumnDescriptor.java. The value of the variable in each of these classes depend on what parser recorded for the autoincrement column status ie adding an autoincrement column/changing INCREMENT BY of the autoincrement column/changing RESTART WITH of the autoincrement column.

Hope this information along with the comments in the code will help in the code review. Please let me know if you have any comments.


------------------------------------------------------------------------
r370884 | djd | 2006-01-20 11:13:09 -0800 (Fri, 20 Jan 2006) | 3 lines

DERBY-483 Set correct property name derby.database.classpath name in X0X07 exception.
Patch contributed by Anders Morken andersmo@stud.ntnu.no

------------------------------------------------------------------------
r370881 | davidvc | 2006-01-20 11:05:23 -0800 (Fri, 20 Jan 2006) | 2 lines

DERBY-838: Slight typo in properties file name

------------------------------------------------------------------------
r370880 | davidvc | 2006-01-20 11:03:14 -0800 (Fri, 20 Jan 2006) | 3 lines

DERBY-838: refinement - get rid of dash in "client-messages" to be
consistent with names of other properties files in Derby

------------------------------------------------------------------------
r370864 | davidvc | 2006-01-20 09:09:54 -0800 (Fri, 20 Jan 2006) | 4 lines

DERBY-838: Added files missing to original checkin

Apologies for the broken build.

------------------------------------------------------------------------
r370815 | davidvc | 2006-01-20 06:25:53 -0800 (Fri, 20 Jan 2006) | 56 lines

DERBY-838: Establish an internationalization framework for the network
client.

Added a new shared directory and shared packages.  These shared packages
are only used by the derbyclient.jar until we establish a shared
code framework
M    tools/ant/properties/dirs.properties
A    java/shared
A    java/shared/org
A    java/shared/org/apache
A    java/shared/org/apache/derby
A    java/shared/org/apache/derby/shared
A    java/shared/org/apache/derby/shared/common
A    java/shared/org/apache/derby/shared/common/i18n
AM   java/shared/org/apache/derby/shared/common/i18n/MessageUtil.java
A    java/shared/org/apache/derby/shared/common/error
AM   java/shared/org/apache/derby/shared/common/error/ExceptionSeverity.java
AM   java/shared/org/apache/derby/shared/common/error/ExceptionUtil.java
A    java/shared/org/apache/derby/shared/common/info
AM   java/shared/org/apache/derby/shared/common/info/JVMInfo.java
A    java/shared/org/apache/derby/shared/common/reference
A    java/shared/org/apache/derby/shared/common/reference/SQLState.java
A    java/shared/org/apache/derby/shared/common/reference/JDBC20Translation.java
A    java/shared/org/apache/derby/shared/common/reference/JDBC30Translation.java
AM   java/shared/org/apache/derby/shared/package.html
AM   java/shared/build.xml
M    build.xml

Modified splitmessages to copy messages shared with the client over
to client-messages.properties
M    java/build/org/apache/derbyBuild/splitmessages.java
M    java/engine/org/apache/derby/loc/build.xml

Modified SQLException to have new constructors that take a message 
id
M    java/client/org/apache/derby/client/am/SqlException.java
AM   java/client/org/apache/derby/client/am/MessageId.java

Relocated some reference classes over to the shared framework
D    java/engine/org/apache/derby/iapi/reference/SQLState.java
D    java/engine/org/apache/derby/iapi/reference/JDBC20Translation.java
D    java/engine/org/apache/derby/iapi/reference/JDBC30Translation.java
M    java/engine/org/apache/derby/iapi/error/ExceptionSeverity.java

Added client-specific messages
A    java/client/org/apache/derby/loc
AM   java/client/org/apache/derby/loc/client-messages_en.properties
AM   java/client/org/apache/derby/loc/client-messages.properties

Internationalized some client classes
M    java/client/org/apache/derby/client/am/Blob.java
M    java/client/org/apache/derby/client/am/CallableStatement.java

Fixed test output to handle new messages/SQLStates
M    java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/blobclob4BLOB.out

------------------------------------------------------------------------
r370806 | bernt | 2006-01-20 05:34:53 -0800 (Fri, 20 Jan 2006) | 1 line

DERBY-825 writeSQLCAGRP() should use byte[] constants instead of Strings where feasible. submitted by Dyre Tjeldvoll
------------------------------------------------------------------------
r370583 | fuzzylogic | 2006-01-19 11:46:37 -0800 (Thu, 19 Jan 2006) | 2 lines

DERBY-499: Add missed masters from previous checkin of bug499_jdk13_rev2.diff

------------------------------------------------------------------------
r370574 | djd | 2006-01-19 10:56:25 -0800 (Thu, 19 Jan 2006) | 3 lines

DERBY-818 Remove the object allocation and reseting overhead for updateable ResultSet information
when the ResultSet is read-only. Similar changes for the stream single fetch (getXXXStream) logic.

------------------------------------------------------------------------
r370570 | djd | 2006-01-19 10:42:56 -0800 (Thu, 19 Jan 2006) | 4 lines

DERBY-467 Add intial framework for security checking of returned JDBC objects to
try and catch code that allows complete access to internal Derby objects, such
as the page cache.

------------------------------------------------------------------------
r370549 | djd | 2006-01-19 09:14:00 -0800 (Thu, 19 Jan 2006) | 2 lines

DERBY-615 Update testinh README file to match current state with respect to the noSecurityManager property.

------------------------------------------------------------------------
r370546 | djd | 2006-01-19 09:05:18 -0800 (Thu, 19 Jan 2006) | 3 lines

DERBY-615 Modify the tests' policy file to grant permissions to all files and sub-directories under
the extin, extout and extinout directories. Allows the iepnegativetests tests to pass with jars.

------------------------------------------------------------------------
r370530 | mikem | 2006-01-19 08:32:08 -0800 (Thu, 19 Jan 2006) | 15 lines

DERBY-239, most recent patch committed on behalf of Suresh Thalamati

This patch addresses the issues raised by ?\194?\183?\194?\185ystein in his review of previous
online backup patches 3-6. 

- changed the backup procedures names with ONLINE to NOWAIT 
- removed the transaction Idle restriction to run backup procedures.
- removed implicit commit/rollbacks.
- Added a new lesser impact restriction, which only disallows backup call only if
  there are unlogged operations executed in the same transaction before the backup. 
  - Removed casting to  RawTransaction. 
  - fixed Names and Comments. 
  - Enhanced the tests with addional test cases suggested by  ?\194?\183?\194?\185ystein.


------------------------------------------------------------------------
r370342 | kmarsden | 2006-01-18 17:35:27 -0800 (Wed, 18 Jan 2006) | 6 lines

DERBY-398 - Rename wisconsin support file to wisc_setup.sql.
Fix issue with  lang/wisconsin.java test in derbyall

Contributed by Deepa Remesh


------------------------------------------------------------------------
r370275 | kmarsden | 2006-01-18 13:55:36 -0800 (Wed, 18 Jan 2006) | 3 lines

DERBY-210 reverting change until jdk1.5 lang/updatableResultset.java diff can be resolved


------------------------------------------------------------------------
r370254 | bandaram | 2006-01-18 12:46:47 -0800 (Wed, 18 Jan 2006) | 8 lines

DERBY-772: Optimize IN predicates on derived tables with UNIONs by pushing
them into underlying select statements.

Add some test cases to show index being used. Will also add more tests in
another pending change to improve finding matching column.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r370247 | bandaram | 2006-01-18 12:22:30 -0800 (Wed, 18 Jan 2006) | 6 lines

DERBY-649: Push single table predicates that can be pushed into underlying SELECTs of a union.

Merging from 10.1 branch. It is possible to further improve the patch to handle more cases for this optimization.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r370240 | davidvc | 2006-01-18 11:56:27 -0800 (Wed, 18 Jan 2006) | 5 lines

DERBY-823:  This minor patch changes a few for loops into equivalent uses 
of System.arraycopy() and java.util.Arrays.fill().

Contributed by Anders Morken

------------------------------------------------------------------------
r370217 | bandaram | 2006-01-18 11:03:46 -0800 (Wed, 18 Jan 2006) | 6 lines

DERBY-808: PreparedStatements could take longer to execute than equivalent statements, because of incorect code in search clause transitive closure method.

Handle the case of ParameterNodes, in addition to ConstantNodes on the rightside.

Submitted by Satheesh Bandaram(satheesh@sourcery.org)

------------------------------------------------------------------------
r370195 | davidvc | 2006-01-18 09:25:09 -0800 (Wed, 18 Jan 2006) | 5 lines

Fix for DERBY-810, contributed by Oystein Grovlen

Removes spurious diffs for RecoveryAfterBackup test by testing for shutdown
SQL State rather than printing a stack trace.

------------------------------------------------------------------------
r370059 | kmarsden | 2006-01-17 21:43:13 -0800 (Tue, 17 Jan 2006) | 89 lines

DERBY-398  add jdk14 suite to J2ME

Contributed by Deepa Remesh
 Attaching a patch 'jdk14_tests.diff' which adds jdk14 suite and some more tests to run with J2ME/CDC/FP. Changes are:

M java\tools\org\apache\derby\impl\tools\ij\mtTestCase.java

If ij.dataSource property is specified, remove ij.database and ij.protocol property. Similar to what is done by test harness. This is needed for stress.multi.

M java\testing\org\apache\derbyTesting\functionTests\tests\i18n\iepnegativetests_ES_app.properties
M java\testing\org\apache\derbyTesting\functionTests\multi\stress\init.properties
M java\testing\org\apache\derbyTesting\functionTests\multi\stress\run.properties

Change 'database' property to 'ij.database' and add ij.dataSource properties.

M java\testing\org\apache\derbyTesting\functionTests\tests\lang\holdCursorJava.java
M java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\autoGeneratedJdbc30.java

Execute procedure tests only if DriverManager class is present.

A java\testing\org\apache\derbyTesting\functionTests\tests\lang\procedureJdbc30_app.properties
A java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\checkDataSource30_app.properties
M java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\copyfiles.ant
M java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\parameterMetaDataJdbc30_app.properties

These tests are part of jdk14 suite but cannot be run with JSR169.

M java\testing\org\apache\derbyTesting\functionTests\tests\lang\maxMemPerTab_app.properties
M java\testing\org\apache\derbyTesting\functionTests\tests\lang\triggerStream_app.properties
M java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\LOBTest_app.properties
M java\testing\org\apache\derbyTesting\functionTests\tests\store\bootLock_app.properties

Removed 'runwithfoundation=false' exclude from these tests

M java\testing\org\apache\derbyTesting\functionTests\tests\lang\copyfiles.ant
D java\testing\org\apache\derbyTesting\functionTests\tests\lang\maxMemPerTab.sql
A java\testing\org\apache\derbyTesting\functionTests\tests\lang\triggerStream.java
A java\testing\org\apache\derbyTesting\functionTests\tests\lang\maxMemPerTab.java
D java\testing\org\apache\derbyTesting\functionTests\tests\lang\triggerStream.sql
M java\testing\org\apache\derbyTesting\functionTests\suites\derbylang.runall
M java\testing\org\apache\derbyTesting\functionTests\master\maxMemPerTab.out
M java\testing\org\apache\derbyTesting\functionTests\master\triggerStream.out
M java\testing\org\apache\derbyTesting\functionTests\util\StreamUtil.java
M java\testing\org\apache\derbyTesting\functionTests\util\ProcedureTest.java

maxMemPerTab and triggerStream tests are converted from sql to java to avoid using procedures with nested connections.

M java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\dbMetaDataJdbc30.java
M java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\resultsetJdbc30.java

NoSuchMethodError for methods not present in JSR169.

M java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\users_app.properties

User and password are specified in databaseName itself so that they don't get re-used for other connections in the test

M java\testing\org\apache\derbyTesting\functionTests\tests\store\bootLock1.java
M java\testing\org\apache\derbyTesting\functionTests\tests\store\bootLock.java

Use Datasource instead of DriverManager

M java\testing\org\apache\derbyTesting\functionTests\harness\RunList.java
M java\testing\org\apache\derbyTesting\functionTests\suites\jdk14.properties

Change 'jdk14test' property to 'jdbc30test' property. Add check for jdb30test so that it can run with foundation vm.

M java\testing\org\apache\derbyTesting\functionTests\master\resultsetJdbc30.out

Small correction in the test and master.

A java\testing\org\apache\derbyTesting\functionTests\master\j9_foundation\iepnegativetests_ES.out

Added new master because of difference in output of show connections.

A java\testing\org\apache\derbyTesting\functionTests\master\j9_foundation\dbMetaDataJdbc30.out
A java\testing\org\apache\derbyTesting\functionTests\master\j9_foundation\LOBTest.out
A java\testing\org\apache\derbyTesting\functionTests\master\j9_foundation\autoGeneratedJdbc30.out
A java\testing\org\apache\derbyTesting\functionTests\master\j9_foundation\resultsetJdbc30.out
A java\testing\org\apache\derbyTesting\functionTests\master\j9_foundation\holdCursorJava.out
A java\testing\org\apache\derbyTesting\functionTests\master\j9_foundation\users.out

New masters for difference in behaviour in J2ME

M java\testing\org\apache\derbyTesting\functionTests\suites\jdk14.runall

Remove store/bootlock.java which is also part of store suite.



------------------------------------------------------------------------
r369956 | fuzzylogic | 2006-01-17 15:19:09 -0800 (Tue, 17 Jan 2006) | 4 lines

DERBY-499: Fix metadata.java and syscat.sql in jdk131 vms.

Committed for Rick Hillegas <richard.hillegas@sun.com>

------------------------------------------------------------------------
r369858 | davidvc | 2006-01-17 10:26:37 -0800 (Tue, 17 Jan 2006) | 2 lines

Updated to include vote for Rick Hillegas as a committer

------------------------------------------------------------------------
r369619 | bandaram | 2006-01-16 17:10:52 -0800 (Mon, 16 Jan 2006) | 13 lines

DERBY-573: Enhance RUNSTAT output to show user specified optimizer hints are bing used.

Here is the checkin message from the contributor:

I have attached a patch named Derby573OptimizerOverridesAndRunTimeStatistics011206.txt to JIRA Derby573 Provide support for optimizer overrides in Derby. This patch enables users to see the optimizer overrides specified in the sql as part of runtime statistics info. This is achieved by changing the 
generator so that these properties get passed from compile time to execute time. This change in generate phase can be found in FromBaseTable,
BaseJoinStrategy and JoinNode. The changes in the other classes is for returning the correct number of arguments to the scan. That change is in 
getScanArgs method. 

In addition, I have changed the existing lang/optimizerOverrides.sql to test this patch. derbyall suite has run fine on my Windows XP m/c with Sun's jdk14.

Submitted by Mamta Satoor (msatoor@google.com)

------------------------------------------------------------------------
r369612 | kmarsden | 2006-01-16 16:10:58 -0800 (Mon, 16 Jan 2006) | 34 lines

DERBY-210 - Network Server will leak prepared statements if not explicitly closed by the user until the connection is closed


 I am uploading a combined patch 'derby-210.diff' which solves the memory leak. As Bryan suggested, I am uploading this patch and will open jira issues for other optimizations. Patch does the following:

* Eliminates the below references to PreparedStatement objects by using WeakHashMap instead of LinkedList. When there are no other references to the keys in a WeakHashMap, they will get removed from the map and can thus get garbage-collected. They do not have to wait till the Connection object is collected.
       - 'openStatements_' in org.apache.derby.client.am.Connection
       - 'CommitAndRollbackListeners_' in org.apache.derby.client.am.Connection

* Removes the list 'RollbackOnlyListeners_' since this is not being used.

* Updates the following comment for openStatements_:
// Since DERBY prepared statements must be re-prepared after a commit,
// then we must traverse this list after a commit and notify statements
// that they are now in an un-prepared state.
final java.util.LinkedList openStatements_ = new java.util.LinkedList();

In the code, I did not see this list being traversed after a commit to re-prepare statements. Also, I think this is not needed since Derby does not require re-prepare of statements after a commit. Currently, this list is used to close all open statements when the originating connection is closed.

* Removes all ResultSets from HashTable 'positionedUpdateCursorNameToResultSet_' in SectionManager. Only result sets of positioned update statements were being removed from this hashtable whereas all result sets were added. Because of this, client driver was holding on to result sets and statements even after rs.close() was called.

* Adds a test 'derbyStress.java' to jdbcapi suite. This test is based on the repro for this patch. Without this patch, it fails when run with client driver. Kathey had suggested in another mail that tests for client memory leak problems (DERBY-557, DERBY-210) can be added to same test. I did not see an existing test. So I created this new test. If DERBY-557 does not have a test, I think it can be added to this new test.

* Excludes the new test from running with jcc because jcc gives out of memory error.

* Creates 'derbyStress_app.properties' with following property 'jvmflags=-Xmx64M' to guarantee the test fails on all machines.

Successfully ran derbyall with Sun JDK 1.4.2 on Windows XP. Please take a look at this patch.


Contributed by Deepa Remesh



------------------------------------------------------------------------
r369549 | kmarsden | 2006-01-16 11:19:26 -0800 (Mon, 16 Jan 2006) | 7 lines

DERBY-170  Inserting large string value into non-existent table causes communication link failure over Network Server.

 Attached is a proposed patch for DERBY-170, which teaches the skipDSS method how to handle segmented DDM objects. changes.html attached to DERBY-170  provides a bit of background and discussion for the reviewer. I have successfully run derbyall with this patch. The patch includes a new test, and new master output files. 

Contributed by Bran Pendleton


------------------------------------------------------------------------
r368919 | djd | 2006-01-13 15:27:10 -0800 (Fri, 13 Jan 2006) | 3 lines

DERBY-615 Enable the JUnit CompatibilityTest under the SecurityManager now that JUnit tests
can be run with a SecurityManager.

------------------------------------------------------------------------
r368903 | djd | 2006-01-13 14:59:50 -0800 (Fri, 13 Jan 2006) | 2 lines

DERBY-615 Enable Junit tests under the SecurityManager.

------------------------------------------------------------------------
r368876 | djd | 2006-01-13 14:06:10 -0800 (Fri, 13 Jan 2006) | 3 lines

DERBY-615 Indicate which bugs cause dblook_test and checkDriver to fail with SecurityManager.
Enable importExport with SecurityManager as it seems to work fine.

------------------------------------------------------------------------
r368827 | djd | 2006-01-13 11:22:19 -0800 (Fri, 13 Jan 2006) | 3 lines

DERBY-615 Enable the iepnegativetests to run under the security manager
by using a filename in a location the code has access to for the not exists file test.

------------------------------------------------------------------------
r368728 | kmarsden | 2006-01-13 06:16:48 -0800 (Fri, 13 Jan 2006) | 4 lines


High level design of Network Server Implementation


------------------------------------------------------------------------
r368333 | bernt | 2006-01-12 02:09:50 -0800 (Thu, 12 Jan 2006) | 1 line

DERBY-212 Optimize some specific methods in Network Server to improve performance. Submitted by Knut Anders Hatlen
------------------------------------------------------------------------
r368163 | bandaram | 2006-01-11 15:10:20 -0800 (Wed, 11 Jan 2006) | 4 lines

Add missing GrantRevoke nodes to JAR build process. Likely the cause of grantRevoke test failure.

Submitted by Satheesh Bandaram(satheesh@sourcery.org)

------------------------------------------------------------------------
r367801 | fuzzylogic | 2006-01-10 13:38:51 -0800 (Tue, 10 Jan 2006) | 2 lines

DERBY-612: Add locale jars as ClassPath entries in derby.jar

------------------------------------------------------------------------
r367712 | djd | 2006-01-10 10:21:03 -0800 (Tue, 10 Jan 2006) | 1 line

DERBY-746 Correct spelling mistake in error message.
------------------------------------------------------------------------
r367619 | djd | 2006-01-10 06:41:25 -0800 (Tue, 10 Jan 2006) | 3 lines

DERBY-467 Make some public & protected classes and members in the org.apache.derby.impl.sql.execute package
have more secure protection by making them private or package protected.

------------------------------------------------------------------------
r367613 | djd | 2006-01-10 06:32:13 -0800 (Tue, 10 Jan 2006) | 2 lines

Modify some access scans to use the faster fetchNext() rather than separate next() & fetch() calls.

------------------------------------------------------------------------
r367433 | kmarsden | 2006-01-09 16:12:34 -0800 (Mon, 09 Jan 2006) | 5 lines

Master updates to accomodate group by print order for j9 jvms

Contributed by Myrna Van Lunteren


------------------------------------------------------------------------
r367377 | jta | 2006-01-09 12:02:49 -0800 (Mon, 09 Jan 2006) | 3 lines

DERBY-793 Replaced the incubator disclaimer with current information about
the derby project and where to find more info.

------------------------------------------------------------------------
r367352 | mikem | 2006-01-09 10:23:46 -0800 (Mon, 09 Jan 2006) | 71 lines

fix for DERBY-298.  committing change for ?\194?\183?\194?\185ystein Gr?\194?\177?\194?\177?\194?\177vlen

 The attached patch fixes the bug by setting the logEnd after recovery to the beginning of the new empty log file instead of the end of the previous file.
The patch contains changes to the following files:

M java/engine/org/apache/derby/impl/store/raw/log/FileLogger.java
        - At the end of the redo scan, if the scan stopped in a file succeeding the file of the last log record, update logEnd to this position.
        - Change assert to allow logEnd to be in a newer file than that of the last log record.
         
M java/engine/org/apache/derby/impl/store/raw/log/Scan.java
        - Introduced new variable newFileStart which will only have a valid LogInstant value when the scan is at the header of the file.
        - When a new file is entered, set newFileStart to the first possible LogInstant of this file (end of header).
        - When a log record is encountered, set newFileStart to INVALID_LOG_INSTANT.
        - Changed getLogRecordEnd() to return newFileStart if that is valid (i.e., scan is at the start of a file)
        - Removed comment about not starting to write to the new empty log file, since that is not true anymore.

A java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup_app.properties
         - Test properties

M java/testing/org/apache/derbyTesting/functionTests/tests/store/copyfiles.ant
         - Added new property files

A java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackupSetup_app.properties
        - Test properties.
        - useextdirs=true needed so the backup is placed somewhere the next test can find it.

A java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup.java
        - Test that is supposed to be run after RecoveryAfterBackupSetup.java.
        - Does recovery, updates the database, shutdowns the database, and does roll-forward restore.
        - Checks that updates made after recovery is reflected in the database after roll-forward restore.

A java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackupSetup.java
        - Test that does the preparation for the RecoveryAfterBackup test.
        - Inserts a few records, makes a backup, and stops without shutting down.

M java/testing/org/apache/derbyTesting/functionTests/harness/RunTest.java
        - For tests where the database is not deleted at the end of the test, do not delete the external directories either.
        - This is necessary to be able to access the backup in suceeding tests.

A java/testing/org/apache/derbyTesting/functionTests/master/RecoveryAfterBackupSetup.out
        - Test output

A java/testing/org/apache/derbyTesting/functionTests/master/RecoveryAfterBackup.out
        - Test output

MM java/testing/org/apache/derbyTesting/functionTests/suites/storerecovery.runall
        - Added tests to storerecovery suite.
        - Changed property eol-style.

 The recently attached patch (derby-298a.diff) addresses Suresh's
review comments. The only major change from the previous patch is in
java/engine/org/apache/derby/impl/store/raw/log/Scan.java. The changes
to this file compared to the current head of trunk are:
 
   - When a new log file is entered, check that the header of this
     file refers to the end of the last log record of the previous log
     file. If not, stop the scan.
   - If the header was consistent, update knowGoodLogEnd to the first
     possible LogInstant of this file (end of header).
   - close() no longer reset knownGoodLogEnd since it is needed by
     FileLogger after the scan is closed.
   - Changed comment of getLogRecordEnd() to reflect that it can be
     used after the scan is closed, and that it at that time may
     return the start of an empty log file.
   - Removed comment about not starting to write to the new empty log
     file, since that is not true anymore.

In addition, the property files for the tests have been updated so
they are run without the security manager. 


------------------------------------------------------------------------
r366987 | kmarsden | 2006-01-07 21:34:06 -0800 (Sat, 07 Jan 2006) | 12 lines

DERBY-398 - Include tests for J2ME/CDC/foundation

* lang/wisconsin.sql test currenly did not work in J2ME environment because the test setup uses stored procedures with nested connection. To make this test run in this environment, I moved the setup (sql for table creation and inserts) to a Java class (wisconsin). From the Java class, the remaining sql is run using ij.
* Modified master files
* Modified the test name from wisconsin.sql to wisconsin.java in the runall and exclude files

Ran lang/wisconsin.java successfully using Sun JDK1.4.2 in all 3 frameworks and also with j9_foundation in IBM WCTME5.7. Please take a look at this patch. Thanks.

Contributed by Deepa Remesh



------------------------------------------------------------------------
r366866 | djd | 2006-01-07 09:53:27 -0800 (Sat, 07 Jan 2006) | 2 lines

DERBY-615 Recent changes to JapanCodeConversion test allow it to be run under the SecurityManager.

------------------------------------------------------------------------
r366862 | djd | 2006-01-07 09:43:09 -0800 (Sat, 07 Jan 2006) | 2 lines

Minor cleanup of public members in MethodCallNode, JavaValueNode and QueryTreeNodeVector.

------------------------------------------------------------------------
r366859 | djd | 2006-01-07 09:33:17 -0800 (Sat, 07 Jan 2006) | 6 lines

Cleanup related to ConstantAction class hierachy in preparation
for splitting the implementation hierachy into constant actions
and DML constants.
Remove uptoDate method which always returned true and unused interface KeyToBaseRowConstantAction
and some other unused implementation methods and constants.

------------------------------------------------------------------------
r366629 | kmarsden | 2006-01-06 18:04:57 -0800 (Fri, 06 Jan 2006) | 7 lines

* updated masters for jdbcapi/metadata.java,
jdbcapi/odbc_metadata.java for j9_foundation.
* changes to OnlineBackupTest to run with j9 vms.

Contributed by Deepa Remesh


------------------------------------------------------------------------
r366564 | bandaram | 2006-01-06 12:44:57 -0800 (Fri, 06 Jan 2006) | 4 lines

Add grantRevoke test to derbyLang suite.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r366544 | bandaram | 2006-01-06 09:59:54 -0800 (Fri, 06 Jan 2006) | 4 lines

DERBY-464: Enable Grant and Revoke DDLs again that were disabled because of two test failures.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r366259 | djd | 2006-01-05 11:43:02 -0800 (Thu, 05 Jan 2006) | 4 lines

Reduce the visibility of various methods and fields based upon some
early investigation of object inspection by applications for security holes.
Methods/fields reduced to private or package from public or protected.

------------------------------------------------------------------------
r366258 | djd | 2006-01-05 11:36:09 -0800 (Thu, 05 Jan 2006) | 7 lines

Modify the i18n/JapanCodeConversion.sql test not to perform execs of native2ascii.
Instead use a Java SQL function to perform the same function, display the content
of a file in ascii with unicode escapes. Function was added as a standard test
routine so dml160 and databaseProperties master files were updated as they install
the standard test functions.
Execing a program requires wide permissions under the security manager and
was failing on IBM JVMs.
------------------------------------------------------------------------
r366226 | djd | 2006-01-05 09:38:00 -0800 (Thu, 05 Jan 2006) | 3 lines

DERBY-798 Fix NullPointerException when Derby is loaded by the bootstrap
class loader in a jvm which returns null on Class.getClassLoader().
Fix suggested by Timothy Luksha (RIT Student).
------------------------------------------------------------------------
r365785 | djd | 2006-01-03 16:48:38 -0800 (Tue, 03 Jan 2006) | 7 lines

DERBY-746 Fix NullPointerException on passing an invalid format as encryptionKey on a JDBC URL
* JCECipherFactory.boot() now checks the output from the fromHexString-method and throws an exception if it is invalid.
* Added 2 new SQLStates and messages (only English)
* Added 2 new test cases (invalid char in encryption key and encryption key of with odd length).
* Updated master file. 
Patch contributed by Kristian Waagan (Kristian.Waagan@Sun.com)

------------------------------------------------------------------------
r365776 | djd | 2006-01-03 15:59:10 -0800 (Tue, 03 Jan 2006) | 3 lines

DERBY-615 Make RunTest install a SecurityManager when using useprocess=false.
Add a utility SQL test function to indicate if a SecurityManager is installed.

------------------------------------------------------------------------
r360519 | djd | 2006-01-01 11:12:54 -0800 (Sun, 01 Jan 2006) | 5 lines

DERBY-776 Remove method DataValueDescriptor.setValue(Object). Objects are now
set using DataValueDescriptor.setObjectForCast(Object) consistently.
Cleanup CastNode to use these methods correctly. Make DataValueDescriptor.setWidth
void rather than return itself.

------------------------------------------------------------------------
r360412 | djd | 2005-12-31 11:06:43 -0800 (Sat, 31 Dec 2005) | 2 lines

DERBY-731 Replace the inefficient StringSlicer class with a simple utility slice method in StringUtil.

------------------------------------------------------------------------
r360226 | djd | 2005-12-30 19:43:35 -0800 (Fri, 30 Dec 2005) | 3 lines

DERBY-786 Make TypeId.variableLength() return true for CLOBs to ensure values
assigned to CLOBs are truncated correctly on a CAST.

------------------------------------------------------------------------
r359833 | djd | 2005-12-29 08:10:33 -0800 (Thu, 29 Dec 2005) | 9 lines

DERBY-777 Remove use of java.io.InputStreamReader.getEncoding to get the
platform's default encoding. Creating this reader on System.in was causing
a hang on Z/OS.
Now simply use the stream/reader constructors that do not take a encoding
argument and thus use the default. With this Derby does not need to know
the actual value of default encoding.

Merge of 358137 from 10.1

------------------------------------------------------------------------
r359634 | djd | 2005-12-28 12:37:15 -0800 (Wed, 28 Dec 2005) | 3 lines

DERBY-776 Cleanup related to setValue(Object). Set return parameter for ? = call
statements directly from ResultSet, rather than through an Object.

------------------------------------------------------------------------
r359572 | djd | 2005-12-28 09:35:31 -0800 (Wed, 28 Dec 2005) | 4 lines

DERBY-776 ENsure some calls to DataValueDescriptor.setValue(Object) are made through the UserDataValue
interface as a step towards removing the DataValueDescriptor.setValue(Object) method. Use the setBigDecimal
methods in some cases for JDBC update/setBigDecimal methods.

------------------------------------------------------------------------
r359345 | djd | 2005-12-27 18:06:22 -0800 (Tue, 27 Dec 2005) | 2 lines

Remove ReadCursorNode from DBMSnodes.properties as it was removed in 359264

------------------------------------------------------------------------
r359331 | djd | 2005-12-27 16:15:40 -0800 (Tue, 27 Dec 2005) | 2 lines

DERBY-413 Add missing file from previous commit 358591.

------------------------------------------------------------------------
r359290 | djd | 2005-12-27 13:44:37 -0800 (Tue, 27 Dec 2005) | 5 lines

DERBY-445 Ensure client data sources do not lose the value of their
connectionAttributes property during serialization. Added data source
test that stores DataSource instances using Serialization and Reference
and checks they are restored correctly.

------------------------------------------------------------------------
r359264 | djd | 2005-12-27 11:10:36 -0800 (Tue, 27 Dec 2005) | 4 lines

Cleanup in the StatementNode hierachy. Remove the nodes
ReadCursorNode, CreateStatementNode and DropStatementNode
which added no value.

------------------------------------------------------------------------
r358954 | djd | 2005-12-24 14:09:13 -0800 (Sat, 24 Dec 2005) | 5 lines

DERBY-766 (partial) Remove passing the activation into some ResultSetFactory methods
and instead obtain the activation from the passed in ResultSet. Incremental progess
on removing activations from ResultSetFactory methods.


------------------------------------------------------------------------
r358605 | djd | 2005-12-22 11:11:44 -0800 (Thu, 22 Dec 2005) | 4 lines

DERBY-176 Produce a clear error message when a SQL statement exceeds the
limit(s) of the generated Java class. These limits are imposed by the Java
Virtual Machine specification.

------------------------------------------------------------------------
r358591 | fuzzylogic | 2005-12-22 09:26:55 -0800 (Thu, 22 Dec 2005) | 5 lines

DERBY-413: Allow Network Server tests to be run against a server on a machine
other than localhost.

Committed for Myrna Van Lunteren <m.v.lunteren@gmail.com>

------------------------------------------------------------------------
r358560 | bernt | 2005-12-22 04:29:35 -0800 (Thu, 22 Dec 2005) | 1 line

DERBY-774 DRDAConnThread::doneData should use statically allocated SQLException objects. Submitted by Dyre.Tjeldvoll@Sun.COM
------------------------------------------------------------------------
r358163 | djd | 2005-12-20 16:53:42 -0800 (Tue, 20 Dec 2005) | 3 lines

DERBY-499 Add BOOLEAN datatype. See jira comments for details.
Commit of patch bug499_rev4.diff, contributed by Rick Hillegas

------------------------------------------------------------------------
r357966 | tmnk | 2005-12-20 04:09:51 -0800 (Tue, 20 Dec 2005) | 1 line

- DERBY-721_5 State of InputStream retrieved from resultset is not clean , if there exists previous InputStream . Add mater .out file to be passed using DB2 universal driver. - Patch by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r357820 | djd | 2005-12-19 14:35:45 -0800 (Mon, 19 Dec 2005) | 4 lines

Remove some unimplemented methods in GenericController.java and its sub-classes
that are not required, either because they are already defined in an interface
or can be converted to abstract methods.

------------------------------------------------------------------------
r357756 | djd | 2005-12-19 11:06:27 -0800 (Mon, 19 Dec 2005) | 11 lines

DERBY-776 (partial) Remove type descriptor methods builtIn and systemBuiltIn and
replace their use with userType(). Simplifies the scheme to is a type a user type
(represented currently by a Java class) or a system defined type (e.g. INT, CHAR).
Previously the code had methods for three types but in reality all checks were for
is it a user type or not. Note that the only use externally for user types (Java types) is in
the system catalogs. User-defined types are not supported in Derby, until SQL Part13
is implemented (create type as java class). If Derby ever supports other forms
of user-defined types, e.g. distinct types it would probably be better to change
the userType method to isJavaType(), which really represents its usage today.


------------------------------------------------------------------------
r357678 | bernt | 2005-12-19 02:08:36 -0800 (Mon, 19 Dec 2005) | 1 line

DERBY-611 Network client: updateRow() causes a commit when autoCommit = true. Submitted by Dag.Wanvik@Sun.COM
------------------------------------------------------------------------
r357435 | tmnk | 2005-12-17 21:15:39 -0800 (Sat, 17 Dec 2005) | 1 line

- DERBY-721_4  - State of InputStream retrieved from resultset is not clean , if there exists previous InputStream . Patch to throw exception if user get stream for a value in result set twice . by Tomohito Nakayama (tomonaka@basil.ocn.ne.jp)
------------------------------------------------------------------------
r357275 | mikem | 2005-12-16 18:26:40 -0800 (Fri, 16 Dec 2005) | 7 lines

DERBY-733, committed on behalf of Knut Anders Hatlen.

Attached patch (DERBY-733-more-exception-handling.diff) that addresses
Mike's concerns for exception handling. If something goes wrong when
locking, Derby will now fall back to the old behaviour.


------------------------------------------------------------------------
r357272 | mikem | 2005-12-16 18:11:28 -0800 (Fri, 16 Dec 2005) | 11 lines

DERBY-750, committing on behalf of Suresh Thalamati.

By looking at the stacks,  my suspicion is backup is looking at a table that 
is not completely created yet, container file might be there but the  
first page (Alloc page) might have been created.  

It might take some time for me to fix this one.  As a temporary solution,  
attached patch comments out the section of the test that might be hitting this 
problem. 


------------------------------------------------------------------------
r357269 | mikem | 2005-12-16 17:52:03 -0800 (Fri, 16 Dec 2005) | 18 lines

DERBY-239, committing on behalf of Suresh Thalamati.

This patch adds code to support online backup when  jar operations 
are running parallel to the backup. Jar files are not logged, but the 
system catalogs updates are logged when a jar file is added/replaced. 
If the jar file operations are allowed during the backup, system catalog 
(sys.sysfiles) table in the backup database can have a reference to a jar file 
that does not exist in the backup database. And also backup can contain 
partial written jar files. To make a consistent online backup, this patch:

1) Makes Backup operation wait/fail for all the jar operations activity in progress to complete.
2) Blocks jar file operations when a backup is in progress.

This patch also adds a new test to test the online backup 
with jar operations.



------------------------------------------------------------------------
r357083 | mikem | 2005-12-15 14:28:01 -0800 (Thu, 15 Dec 2005) | 5 lines

DERBY-758, fixing I/O retry logic to throw an I/O exception rather
than loop forever on I/O read errors.  4 retry's are attempted before
giving up.


------------------------------------------------------------------------
r357057 | kmarsden | 2005-12-15 11:03:30 -0800 (Thu, 15 Dec 2005) | 6 lines

DERBY-739  Reduce generated code required to access a parameter's value

follow up patch.
callMethod was missing the declaring class. 


------------------------------------------------------------------------
r356961 | bandaram | 2005-12-14 16:29:30 -0800 (Wed, 14 Dec 2005) | 6 lines

Submitting a temporary fix to disable defaultConnectionMode of sqlStandard until two failed tests are resolved.

I will reenable the mode soon and also make derbylang run grantRevoke.sql test. A new test was added, but I forgot to include it in the derbylang suite.

Submitted by Satheesh Bandaram (satheesh@sourcery.org)

------------------------------------------------------------------------
r356884 | mikem | 2005-12-14 13:40:44 -0800 (Wed, 14 Dec 2005) | 20 lines

Fix for DERBY-733.  Committed on behalf of Knut Anders Hatlen.

I have attached a patch which invokes ReentrantLock.lock() and
unlock() when reading in a page from disk. I did not build my own
ReentrantLock replacement, as I said I would. Instead, I have used
reflection to enable this feature if the JVM supports it. This seemed
like an easier approach, and I also discovered that the handling of
threads waiting for monitors had changed between 1.4 and 1.5 and that
this issue was not so serious on 1.4.

The maximum response time was drastically reduced in the disk-bound
case. Derbyall ran successfully on both Sun JVM 1.4.2 and 1.5.0. I
have also tested the performance, and I could not see any change in
throughput or CPU usage. (The performance test was run with a very
small page cache and with a database that was many times bigger than
the page cache, but smaller than the file system cache. This way,
Derby called readPage() very often, but it was CPU-bound since the
requested page always was in the file system cache.) 


